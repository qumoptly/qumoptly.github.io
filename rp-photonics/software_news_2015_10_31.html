<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from www.rp-photonics.com/software_news_2015_10_31.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Feb 2019 03:10:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Software from RP Photonics - The Powerful Expression Engine in Software from RP Photonics</title>
<link rel="stylesheet" type="text/css" href="styles.css">
<link rel="stylesheet" type="text/css" href="shariff/shariff.complete.css">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="alternate" type="application/rss+xml" title="The Photonics Spotlight" href="spotlight.rss">
<link rel="alternate" type="application/rss+xml" title="The RP Photonics Software News" href="software_news.rss">
<link rel="alternate" type="application/rss+xml" title="New encyclopedia articles" href="new_articles.rss">
<meta name="date" content="2015-10-31">
<meta name="description" content="A summary of this blog article: This article explains the most important features of our expression engine, which is contained in various software products for the modeling of fiber amplifiers and lasers, passive fiber optics, bulk lasers and multilayer optics. It demonstrates that expressions can not only be used for performing sophisticated mathematical calculations, but also for defining and modifying physics models, storing or retrieving data in or from files, defining optimization goals and displaying results in text or graphical form.">
<meta name="copyright" content="2019 RP Photonics Consulting GmbH">
<meta name="author" content="Dr. R&uuml;diger Paschotta">
<meta name="publisher" content="RP Photonics Consulting GmbH">
<meta name="referrer" content="always">
<meta name="geo.position" content="48.018; 8.540">
<meta name="geo.placename" content="Bad D&uuml;rrheim">
<meta name="geo.region" content="DE">
<meta name="distribution" content="global">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="photonics, modeling, software, optics, lasers, simulations, analysis, optimization, news, newsletter">
<script type="text/javascript" src="jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="general.js"></script>
<script type="text/javascript">
page="software_news_2015_10_31.html"; cat="S"; shownbanner=""; ref="software_news.html"; ts = new Date().toJSON().substring(0, 19);
$(document).ready(function($){ $.get("log.html",{cat:cat,page:page,ref:ref,shownbanner:shownbanner,ts:ts}); })
</script>
</head>
<body>
<div id="logohead">
<div class="areadiv"><table id="areatable"><tr><td>
<div class="areadiv"><table class="areasubtable">
<tr><td colspan="2" class="basicarea"><a href="marketing.html">RP Photonics Marketing</a></td></tr>
<tr><td><a href="encyclopedia.html">Encyclopedia</a></td>
<td><a href="buyersguide.html">Buyer's Guide</a></td></tr>
</table></div>
</td>
<td>
<div class="areadiv"><table class="areasubtable">
<tr><td colspan="2" class="basicarea"><a href="consulting.html">RP Services and Tools</a></td></tr>
<tr><td><a href="consulting.html">Consulting</a></td>
<td class="selected"><a href="software.html">Software</a></td></tr>
</table></div>
</td></tr></table></div>
<p><span id="title1">RP Photonics</span></p>
<p><span id="title2">Software</span> <span id="slogan">&hellip; powerful tools for your research &amp; development!</span></p>
</div>
<nav id="soft">
<div id="navitems">
<a id="Software" href="software.html">Overview</a>
<a id="Modeling" href="software_modeling.html">Modeling</a>
<a id="rp_fiber_calculator" href="rp_fiber_calculator.html">RP Fiber Calculator</a>
<a id="rp_fiberpower" href="fiberpower.html">RP Fiber Power</a>
<a id="rp_resonator" href="resonator.html">RP Resonator</a>
<a id="rp_propulse" href="propulse.html">RP ProPulse</a>
<a id="rp_coating" href="coating.html">RP Coating</a>
<a id="rp_q_switch" href="rp_q_switch.html">RP Q-switch</a>
<a id="script_language" href="software_script_language.html">Script language</a>
<a id="debugger" href="software_debugger.html">Debugger</a>
<a id="custom_forms" href="software_custom_forms.html">Custom forms</a>
<a id="licenses" href="software_licenses.html">Licenses</a>
<a id="documentation" href="software_docu.html">Documentation</a>
<a id="support" href="software_support.html">Support</a>
<a id="distributors" href="software_distributors.html">Distributors</a>
<a id="software_news" href="software_news.html" class="sel">Software News</a>
<a id="contact" href="software_contact.html">*Get a quotation*</a>
</div>
</nav>
<div id="main" style="margin-top:20px;">
<main>
<h1 class="spotlight_heading">The RP Photonics Software News</h1>
<h1 class="posting">The Powerful Expression Engine in Software from RP Photonics</h1>
<div class="posting_details">
<p>Posted on 2015-10-31 in the <a href="software_news.html">RP Photonics Software News (available as e-mail newsletter!)</a>
<p>Permanent link: <a href="software_news_2015_10_31.html">https://www.rp-photonics.com/software_news_2015_10_31.html</a></p>
<p>Author: <a href="paschotta.html">Dr. Rüdiger Paschotta</a>, <a href="index.html">RP Photonics Consulting GmbH</a></p>
<p>Abstract: This article explains the most important features of our expression engine, which is contained in various software products for the modeling of fiber amplifiers and lasers, passive fiber optics, bulk lasers and multilayer optics. It demonstrates that expressions can not only be used for performing sophisticated mathematical calculations, but also for defining and modifying physics models, storing or retrieving data in or from files, defining optimization goals and displaying results in text or graphical form.</p>
</div>
<figure class="right" style="width:130px;">
<img src="img/paschotta5.jpg" alt="Dr. Rüdiger Paschotta">
</figure>
<p>Most of our software products support a powerful <a href="software_script_language.html">script language</a>.
Part of that is the capability to work with mathematical expressions and string expressions.
In this newsletter article, I will describe the essentials of our expression engine.
This should be useful for those already using the software as well as for those who consider to purchase user licenses.</p>
<h3 class="togglediv">Simple Expressions</h3>
<div>
<p>In the simplest case, a mathematical expression calculates a value, using some of the arithmetic features.
Here are some examples, where either the evaluation result of an expression is assigned to a variable or a new function is defined:</p>
<pre class="codedisplay">
A := sqrt(2)
k := 2 * pi / 1380.73
phi := pi / 4
f(x) := A * sin(k * x - phi)
</pre>
<p>There is a wide range of standard functions which can be used in such expressions:</p>
<ul>
<li>There are all the trigonometric and various other functions such as sin(), arcsin() and sinh(), Hermite polynomials and different types of Bessel functions.</li>
<li>The functions min() and max() find the position of the minimum and maximum, respectively, of a function within some interval.</li>
<li>The function rnd() delivers random values, which can have a constant probability density in some interval, or a Gaussian probability function, and can even be correlated with previous random values (e.g. for modeling &ldquo;pink noise&rdquo;).</li>
<li>With sum() and prod() you can calculate sums and products using some loop variables.
Example:</li>
</ul>
<pre class="codedisplay">
s := sum(j := 1 to N, 1 / a[j]^2)
</pre>
<ul>
<li class="ta_left">With zero(), one can find a zero of an expression (root finding):</li>
</ul>
<pre class="codedisplay">
x := zero(cos(x), x in [0, 2], xtol = 1e-6)
</pre>
<ul>
<li class="ta_left">With numdif(), one can numerically calculate derivatives:</li>
</ul>
<pre class="codedisplay">
s := numdif(sin(x), x, 2{x position}, 1e-3{step size}, 2{order})
</pre>
<ul>
<li class="ta_left">With int(), one can numerically integrate a function:</li>
</ul>
<pre class="codedisplay">
I := int(cos(x)^2, x := 0 to 2pi, tol = 1e-6)
</pre>
<ul>
<li>The function odeprop() can be used to solve initial value problems with coupled differential equations.</li>
</ul>
<ul>
<li>The function FFT() can perform a fast Fourier transform on an array.
(Even Fourier transforms on higher-dimensional arrays are possible.)</li>
</ul>
</div>
<h3 class="togglediv">Arrays</h3>
<div>
<p>One can define areas of real, complex or string values.
The array indices do not have to be integer values; an index can also range from 3.5 to 7.5 in steps of 0.25:</p>
<pre class="codedisplay">
defarray a[3.5, 7.5, 0.25]
</pre>
<p>Arrays can be multi-dimensional, for example for storing optical intensity values on a three-dimensional grid:</p>
<pre class="codedisplay">
defarray I_signal[x1, x2, dx; y1, y2, dy; z1, z2, dz]
</pre>
<p>There are various functions for performing operations on arrays, for example multiplying all array components with a certain value, multiplying two arrays component by component, getting the sum of the squares of all array components, or calculating the n<sup>th</sup> moment of an array.</p>
</div>
<h3 class="togglediv">Complex Arithmetics</h3>
<div>
<p>Much of the arithmetics works not only with real values, but also with complex values.
This holds not only for the standard operators, but also for functions like sqrt(), exp(), ln() and sin().
One can have complex variables, where the variable name ends on &ldquo;&#37;&rdquo;:</p>
<pre class="codedisplay">
z% := a% *exp(i * w * t) / (1 - z0%)
</pre>
</div>
<h3 class="togglediv">String Expressions</h3>
<div>
<p>Strings are sequences of characters.
String values can be stored in string variables, where the variable name ends on &ldquo;$&rdquo;.
There are a lot of useful functions for processing strings.
Some examples:</p>
<pre class="codedisplay">
number$(j) := listitem(1 + j, "zero,one,two,three,four,five,six,seven,eight,nine,ten")
s$ := datetostr(now(), "E", "yyyy-mm-dd") + ": " + number$(3) + ", " + number$(5)
</pre>
<p>There are also functions for performing complex search and replace operations, using so-called regular expressions; I have elaborated on these in the <a href="software_news_2015_07_13.html">article of 2015-07-13</a>.</p>
</div>
<h3 class="togglediv">Assignments in Expressions</h3>
<div>
<p>The assignment of the value to a variable can not only be made in the form of a command, but also within an arithmetic expression. Example:</p>
<pre class="codedisplay">
a := 2 * (b := 3.5)
</pre>
<p>Here, the expression in parenthesis will assign the value 3.5 to the variable b and return that value as its result; the variable a will then get the value 7.</p>
</div>
<h3 class="togglediv">Composite Expressions</h3>
<div>
<p>Several expressions can be combined to a composite expression (or a block of expressions); they simply must be put between parentheses or between begin and end, and separated with semicolons. Example:</p>
<pre class="codedisplay">
f(x, y) := (r := sqrt(x^2 + y^2); A / r + B / r^2)
</pre>
<p>The expressions will be evaluated subsequently, and the result of the last expression is taken as the result of the composite expression.
In our example case, the first expression sets the variable r, and the second expression then uses that to obtain the final result.</p>
<p>Within composite expressions, one can use local variables, declared after &ldquo;var&rdquo;:</p>
<pre class="codedisplay">
f(x, y) := (var r; r := sqrt(x^2 + y^2); A / r + B / r^2)
</pre>
<p>That way, a global variable named r will not be affected by the evaluation of the function; the local variable r is used only within that expression (on the so-called stack).
One thus avoids possibly unwanted side effects.</p>
<p>Although only the value of the last expression in such a block is taken as the end result, the other expressions before that can have important effects:</p>
<ul>
<li>As in the example above, some variable values (or array values) can be set, which can be used in further expressions.</li>
<li>One may call some functions which modify something in a physics model.
For example, in the software <a href="fiberpower.html">RP Fiber Power</a> there is a function for modifying the input power of an optical channel, and its call will affect the results of further function calls, for example for calculated output powers:</li>
</ul>
<pre class="codedisplay">
P_signal_out := (set_P_in(signal, 1 mW); P_out(signal))
</pre>
<ul>
<li>Other functions produce outputs in text or graphical form.
For example, the function showoutput() displays a value in the so-called output area, the function point() can draw a marker (e.g. a rectangle) in a diagram for indicating a data point, and the function line() can draw a line in a diagram.</li>
<li>There are also various functions for obtaining data from files or writing data to files.
One can handle both text and binary files of any format.</li>
<li>Even sound outputs can be produced &ndash; e.g. with play() a tone with given frequency and duration.</li>
</ul>
<p>You can see that in many cases some kind of &ldquo;side effect&rdquo; and not the calculated result is the actual purpose of an expression.</p>
</div>
<h3 class="togglediv">Control Structures</h3>
<div>
<p>It is quite common that certain control structures (e.g. if-then-else) can be used to control the flow of execution of commands.
In our software, however, it is even possible to use control structures within expressions.
A simple example case:</p>
<pre class="codedisplay">
y := if x &gt;= 0 then sqrt(x) else 0
</pre>
<p>When such an &ldquo;if&rdquo; expression is evaluated, the program first calculates an expression which is interpreted as a condition (here: x >= 0) and then evaluates the &ldquo;then&rdquo; expression, if the obtained value is non-zero, or otherwise the &ldquo;else&rdquo; expression.</p>
<p>Similarly, one can use while-do, repeat-until and for-do loops:</p>
<pre class="codedisplay">
f(x) := (while x &gt; 1 do x := x / 2; sqrt(x))
g(x) := (repeat x := x / 2 until x &lt;= 1; sqrt(x))
h(x,n) := (for j := 1 to n do x := 2 * x; x)
</pre>
<p>Note that the script language is designed for good readability.
I consider this as essential, not only for quickly learning the language, but also for avoiding mistakes.
(There are certain quite cryptic languages, which may save you a few keystrokes but cost you hours to locate and fix certain bugs.)</p>
</div>
<h2 class="togglediv">Expressions Are Essential for Maximum Flexibility</h2>
<div>
<p>For computer modeling, the power of our expression engine is not just nice to have, but essential for reaching your goals.
It allows you to do most sophisticated things, for which I just give you a few examples:</p>
<p>In the software <a href="fiberpower.html">RP Fiber Power</a> or <a href="propulse.html">RP ProPulse</a>, you can define a function which propagates an ultrashort pulse through some sequence of optical elements, for example in order to simulate a complete round trip in the resonator of a <a href="fiberpower_ml_fl.html">mode-locked fiber laser</a>:</p>
<pre class="codedisplay">
DoResonatorRoundTrip() := 
  begin
  global allow all;
  pp_loss(T_oc);  { output coupler }
  pp_multiply_f(t_filter[]);  { bandpass filter }
  pp_fiber(1, signal_passive1);  { first passive fiber }
  pp_fiber(2, signal_active);  { active fiber }
  pp_fiber(3, signal_passive2);  { second passive fiber }
  pp_sat_abs(l_abs, tau_abs, E_sat_abs);  { slow saturable absorber }
  pp_center(1);  { center the pulse }
  end
</pre>
<p>One could define a further function (not shown here) which does multiple resonator round trips until essential pulse parameters such as the energy, duration and bandwidth do not change significantly any more.
In that way, you can find the steady state of a system.</p>
<p>Similarly, one can define the function which simulates the whole pulse amplification process in a <a href="fiberpower_regen.html">regenerate if amplifier model</a>: pumping of the gain medium, injection of a short seed pulse, some number of round trips for amplifying the pulse, and finally ejection of the pulse.</p>
<p>In the software <a href="resonator.html">RP Resonator</a>, one can define a figure-of-merit function for defining the goals of a numerical optimization.
That function can depend on calculated values of mode radii for different values of the dioptric power of the thermal lens in the laser crystal:</p>
<pre class="codedisplay">
FOM() := 
  { figure of merit for given arm lengths }
  begin
    global allow all;
    const dF = 0.5;
    var F_cr0;
    F_cr0 := F_cr;
    sqrt(sum(F := 0 to F_cr_max step dF,
              ((Init(F_cr := F); w(zm[Crystal], lambda_ref)) / w_cr_w - 1)^2)
         +((Init(F_cr := F_cr0); w(zm[M4], lambda_ref)) / w4_w - 1)^2
         +(L_res / L_res_w - 1)^2
     );
  end
</pre>
<p>In the multilayer optics software <a href="coating.html">RP Coating</a>, one can define similar figure-of-merit functions, in that case depending on properties of a multilayer coating.
One could also define a function which sets all layer thickness values of a <a href="chirped_mirrors.html" title="chirped mirrors: Bragg-type dispersive mirrors with a spatial variation of the Bragg wavelength">chirped mirror</a> based on a few parameters, determining e.g. some range of Bragg wavelengths.
Also, one can define a function which saves an obtained reflectivity profile in a file:</p>
<pre class="codedisplay">
SaveReflectivity(Filename$, l1, l2, dl) := 
  begin
    var f;
    f := open_file(Filename$, "wt");
    for l := l1 to l2 step dl do
      write(f, str(l) + "," + str(100 * R(l):f1) + char(13) + char(10));
    close_file(f);
  end
</pre>
<p>In various programs, you could also do certain calculations on a model many times, each time with slightly different input values (e.g. with random noise), and get the results statistically evaluated.
Similarly, I have made simulations where an ultrashort pulse circulates in a mode-locked laser under the influence of quantum noise, and the script then displays noise spectra for pulse energy (<a href="intensity_noise.html" title="intensity noise: noise of the optical intensity or power of a laser beam">intensity noise</a>), pulse timing (<a href="timing_jitter.html" title="timing jitter: fluctuations of the temporal positions of pulses">timing jitter</a>) and other quantities.</p>
<p>You see that expressions are by far not only used for calculating certain things, but also for defining and modifying physics models, storing or retrieving data in or from files, defining optimization goals, displaying results in text or graphical form, etc.</p>
<p>Quite obviously, such enormous flexibility could never be obtained with a purely graphical user interface.
There, one might for example provide some options for saving reflectivity profiles (see the last example), but one could hardly allow the user to save the data in virtually any format which can imagined.
Also, the user could probably not trigger such an operation at any time within a sophisticated procedure.
The full flexibility is possible only if one allows the user to do full-blown programming &ndash; both on the level of script commands and within expressions.</p>
</div>
<h2 class="togglediv">Some Historical Remarks</h2>
<div>
<p>Of course, the design and implementation of such a <a href="software_script_language.html">script language</a> or even just a powerful expression engine is a huge undertaking.
In my case, it has a long history.
I started such things around 1990 just for curiosity: I wanted to understand how a computer can interpret, evaluate and manipulate mathematical expressions.
Soon, I discovered the enormous usefulness of such things, and as the first application I made a program for processing data and plotting diagrams.
A much improved version of that program &ndash; called JPLOT &ndash; has become the ancestor of most of my professional simulation software:</p>
<ul>
<li class="ta_left"><a href="fiberpower.html">RP Fiber Power</a> for fiber optics</li>
<li class="ta_left"><a href="resonator.html">RP Resonator</a> for laser resonator design</li>
<li class="ta_left"><a href="propulse.html">RP ProPulse</a> for ultrashort pulse propagation (mostly in bulk devices)</li>
<li class="ta_left"><a href="coating.html">RP Coating</a> for multilayer optics</li>
</ul>
<p>These products inherit all the capabilities of JPLOT, and specific capabilities for certain physics modeling tasks are added.
For example, in RP Fiber Power the expression engine is extended by hundreds of physics functions which e.g. modify model details or retrieve calculated quantities.
In addition, helpful features are added to the user interface &ndash; for example, interactive forms for exploring the evolution of ultrashort pulses or the results of numerical beam propagation.</p>
<p>With that concept, multiple software products can profit from the powerful script language and expression engine, and only the specific extensions had to be worked out beyond the general basic capabilities, which already go quite far.
As a result, RP Photonics has a substantial competitive advantage in the software area, since most of our competitors cannot offer such scripting features, or at least not on a comparably advanced level, and obviously it would require a huge investment to design and implement that.</p>
</div>
<p style="font-size:85%; margin-bottom:10px;">This article is a posting of the <a href="software_news.html">RP Photonics Software News</a>, authored by <a href="paschotta.html">Dr. Rüdiger Paschotta</a>.
You may link to this page, because its location is permanent.</p>
<p style="font-size:85%; margin-bottom:15px;">Note that you can also receive the articles in the form of a <a href="newsletters.html">newsletter</a> or with an <a href="software_news.rss">RSS feed</a>.</p>
<p style="margin-top:15px;">If you like this article, share it with your friends and colleagues, e.g. via social media:</p>
<div class="shariff" data-services="[&quot;linkedin&quot;,&quot;facebook&quot;,&quot;twitter&quot;,&quot;googleplus&quot;]" data-theme="standard" data-lang="en" data-orientation="horizontal"></div>
<script type="text/javascript" src="shariff/shariff.min.js"></script>
</main>
<div id="up_arrow">
<a href="javascript:scroll(0,0)"><img src="img/up.png" width="32" height="20" alt="arrow"></a>
</div>

</div>
<footer id="copyrightbox">
<span class="copyright">&copy; <a href="paschotta.html">Dr. Rüdiger Paschotta</a>, RP Photonics Consulting GmbH, also at <a href="https://profiles.google.com/109063044353551581702?rel=author">Google+</a>&nbsp;&nbsp;&nbsp;&nbsp; All rights reserved worldwide</span>
</footer>
</body>

<!-- Mirrored from www.rp-photonics.com/software_news_2015_10_31.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Feb 2019 03:10:11 GMT -->
</html>
