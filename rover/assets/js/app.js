// --------------------------------------
// 
//    _  _ _/ .  _  _/ /_ _  _  _        
//   /_|/_ / /|//_  / / //_ /_// /_/     
//   https://activetheory.net    _/      
// 
// --------------------------------------
//   7/26/18 7:15p
// --------------------------------------

"undefined"==typeof console&&(window.console={},console.log=console.error=console.info=console.debug=console.warn=console.trace=function(){}),window.performance=window.performance&&window.performance.now?window.performance:Date,Date.now=Date.now||function(){return+new Date},window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){const start=Date.now();return function(callback){window.setTimeout(()=>callback(Date.now()-start),1e3/60)}}()),window.defer=window.requestAnimationFrame,window.clearTimeout=function(){const _clearTimeout=clearTimeout;return function(ref){return window.Timer?Timer.__clearTimeout(ref)||_clearTimeout(ref):_clearTimeout(ref)}}(),window.requestIdleCallback=function(){const _requestIdleCallback=window.requestIdleCallback;return function(callback,max){return _requestIdleCallback?_requestIdleCallback(callback,max?{timeout:max}:null):defer(()=>{callback({didTimeout:!1})},0)}}(),window.onIdle=window.requestIdleCallback,"undefined"==typeof Float32Array&&(Float32Array=Array),Math.sign=function(x){return 0==(x=+x)||isNaN(x)?Number(x):x>0?1:-1},Math._round=Math.round,Math.round=function(value,precision=0){let p=Math.pow(10,precision);return Math._round(value*p)/p},Math._random=Math.random,Math.rand=Math.random=function(min,max,precision=0){return void 0===min?Math._random():min===max?min:(min=min||0,max=max||1,Math.round(min+Math._random()*(max-min),precision))},Math.degrees=function(radians){return radians*(180/Math.PI)},Math.radians=function(degrees){return degrees*(Math.PI/180)},Math.clamp=function(value,min=0,max=1){return Math.min(Math.max(value,Math.min(min,max)),Math.max(min,max))},Math.map=Math.range=function(value,oldMin=-1,oldMax=1,newMin=0,newMax=1,isClamp){const newValue=(value-oldMin)*(newMax-newMin)/(oldMax-oldMin)+newMin;return isClamp?Math.clamp(newValue,Math.min(newMin,newMax),Math.max(newMin,newMax)):newValue},Math.mix=function(a,b,alpha){return a*(1-alpha)+b*alpha},Math.step=function(edge,value){return value<edge?0:1},Math.smoothStep=function(min,max,value){const x=Math.max(0,Math.min(1,(value-min)/(max-min)));return x*x*(3-2*x)},Math.fract=function(value){return value-Math.floor(value)},Math.mod=function(value,n){return(value%n+n)%n},Array.prototype.shuffle=function(){let temp,r,i=this.length-1;for(;0!==i;)r=Math.random(0,i,0),temp=this[i-=1],this[i]=this[r],this[r]=temp;return this},Array.storeRandom=function(arr){arr.randomStore=[]},Array.prototype.random=function(range){let value=Math.random(0,this.length-1);if(arguments.length&&!this.randomStore&&Array.storeRandom(this),!this.randomStore)return this[value];if(range>this.length-1&&(range=this.length),range>1){for(;~this.randomStore.indexOf(value);)(value+=1)>this.length-1&&(value=0);this.randomStore.push(value),this.randomStore.length>=range&&this.randomStore.shift()}return this[value]},Array.prototype.remove=function(element){if(!this.indexOf)return;const index=this.indexOf(element);return~index?this.splice(index,1):void 0},Array.prototype.last=function(){return this[this.length-1]},window.Promise=window.Promise||{},Promise.create=function(){const promise=new Promise((resolve,reject)=>{this.temp_resolve=resolve,this.temp_reject=reject});return promise.resolve=this.temp_resolve,promise.reject=this.temp_reject,delete this.temp_resolve,delete this.temp_reject,promise},String.prototype.includes=function(str){if(!Array.isArray(str))return!!~this.indexOf(str);for(let i=str.length-1;i>=0;i--)if(~this.indexOf(str[i]))return!0;return!1},String.prototype.strpos=function(str){return console.warn("strpos deprecated: use .includes()"),this.includes(str)},String.prototype.clip=function(num,end){return this.length>num?this.slice(0,num)+end:this},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.replaceAll=function(find,replace){return this.split(find).join(replace)},(!window.fetch||window.nativeHydra&&!window._AURA_)&&(window.fetch=function(url,options){function response(){let header,keys=[],all=[],headers={};return request.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,(m,key,value)=>{keys.push(key=key.toLowerCase()),all.push([key,value]),header=headers[key],headers[key]=header?`${header},${value}`:value}),{ok:1==(request.status/200|0),status:request.status,statusText:request.statusText,url:request.responseURL,clone:response,text:()=>Promise.resolve(request.responseText),json:()=>Promise.resolve(request.responseText).then(JSON.parse),xml:()=>Promise.resolve(request.responseXML),blob:()=>Promise.resolve(new Blob([request.response])),headers:{keys:()=>keys,entries:()=>all,get:n=>headers[n.toLowerCase()],has:n=>n.toLowerCase()in headers}}}options=options||{};const promise=Promise.create(),request=new XMLHttpRequest;request.open(options.method||"get",url);for(let i in options.headers)request.setRequestHeader(i,options.headers[i]);return request.onload=(()=>{promise.resolve(response())}),request.onerror=promise.reject,request.send(options.body),promise}),window.get=function(url,options={credentials:"same-origin"}){let promise=Promise.create();return options.method="GET",fetch(url,options).then(function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then(text=>{if(text.charAt(0).includes(["[","{"]))try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}else promise.resolve(text)})}).catch(promise.reject),promise},window.post=function(url,body,options={}){let promise=Promise.create();return options.method="POST",options.body=JSON.stringify(body),fetch(url,options).then(function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then(text=>{if(text.charAt(0).includes(["[","{"]))try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}else promise.resolve(text)})}).catch(promise.reject),promise},window.Class=function(_class,_type,_static){const _this=this||window,_name=_class.name||_class.toString().match(/function ?([^\(]+)/)[1];"function"==typeof _type&&(_static=_type,_type=null),(_type=(_type||"").toLowerCase())?"static"==_type?_this[_name]=new _class:"singleton"==_type&&(_this[_name]=_class,function(){let _instance;_this[_name].instance=function(a,b,c){return _instance||(_instance=new _class(a,b,c)),_instance}}(),_static&&_static()):(_this[_name]=_class,_static&&_static()),this&&this!==window&&(this[_name]._namespace=this.__namespace)},window.Inherit=function(child,parent){const args=[].slice.call(arguments,2);parent.apply(child,args);const save={};for(let method in child)save[method]=child[method];defer(()=>{for(let method in child)save[method]&&child[method]!==save[method]&&(child["_"+method]=save[method])})},window.Namespace=function(obj){"string"==typeof obj?window[obj]||(window[obj]={Class:Class,__namespace:obj}):(obj.Class=Class,obj.__namespace=obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1])},window.Global={},window.THREAD=!1,Class(function Hydra(){function initLoad(){return document&&window?window._NODE_?setTimeout(loaded,1):window._AURA_?window.Main?setTimeout(loaded,1):setTimeout(initLoad,1):void window.addEventListener("load",loaded,!1):setTimeout(initLoad,1)}function loaded(){if(window.removeEventListener("load",loaded,!1),_readyPromise.resolve(),window.Main){if(window._AURA_)return void setTimeout(()=>Hydra.Main=new window.Main,50);_readyPromise.then(()=>Hydra.Main=new window.Main)}}const _readyPromise=Promise.create();this.HASH=window.location.hash.slice(1),this.LOCAL=!window._BUILT_&&(location.hostname.indexOf("local")>-1||"10"==location.hostname.split(".")[0]||"192"==location.hostname.split(".")[0]),initLoad(),this.__triggerReady=function(){loaded()},this.ready=function(callback){if(!callback)return _readyPromise;_readyPromise.then(callback)}},"Static"),Class(function Utils(){this.query=function(key){const str=decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(key).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"));return str.length&&"0"!=str&&"false"!=str?str:location.search.includes(key)},this.getConstructorName=function(obj){return obj?obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1]:obj},this.nullObject=function(object){if(object.destroy||object.div)for(var key in object)void 0!==object[key]&&(object[key]=null);return null},this.cloneObject=function(obj){return JSON.parse(JSON.stringify(obj))},this.headsTails=function(n0,n1){return Math.random(0,1)?n1:n0},this.mergeObject=function(){for(var obj={},i=0;i<arguments.length;i++){var o=arguments[i];for(var key in o)obj[key]=o[key]}return obj},this.timestamp=function(){return(Date.now()+Math.random(0,99999,0)).toString()},this.randomColor=function(){var color="#"+Math.floor(16777215*Math.random()).toString(16);return color.length<7&&(color=this.randomColor()),color},this.numberWithCommas=function(num){return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},this.padInt=function(num,digits,isLimit){isLimit&&(num=Math.min(num,Math.pow(10,digits)-1));let str=Math.floor(num).toString();return Math.pow(10,Math.max(0,digits-str.length)).toString().slice(1)+str}},"Static"),Class(function Render(){function render(){let tsl=performance.now(),delta=tsl-_last;delta=Math.min(_skipLimit,delta),_last=tsl,_this.TIME=tsl,_this.DELTA=delta;for(let i=_render.length-1;i>=0;i--){var callback=_render[i];if(callback)if(callback.fps){if(tsl-callback.last<1e3/callback.fps)continue;callback(++callback.frame),callback.last=tsl}else callback(tsl,delta);else _render.remove(callback)}THREAD||_this.isPaused||rAF(render)}const _this=this,_render=[];let _last=performance.now(),_skipLimit=200;var rAF=requestAnimationFrame;THREAD||rAF(render),this.start=function(callback,fps){fps&&(callback.fps=fps,callback.last=-1/0,callback.frame=-1),~_render.indexOf(callback)||_render.unshift(callback)},this.stop=function(callback){_render.remove(callback)},this.tick=function(){THREAD&&(this.TIME=performance.now(),render(this.TIME))},this.Worker=function(_callback,_budget=4){function loop(){for(;_elapsed<_budget;){if(_scope.dead)return;const start=performance.now();_callback&&_callback(),_elapsed+=performance.now()-start}_elapsed=0}Inherit(this,Component);let _scope=this,_elapsed=0;this.startRender(loop),this.stop=function(){this.dead=!0,this.stopRender(loop)},this.pause=function(){this.stopRender(loop)},this.resume=function(){this.startRender(loop)}},this.pause=function(){_this.isPaused=!0},this.resume=function(){_this.isPaused&&(_this.isPaused=!1,rAF(render))},this.useRAF=function(raf){rAF=raf}},"Static"),Class(function Timer(){function loop(t,delta){for(let i=_discard.length-1;i>=0;i--){let obj=_discard[i];obj.callback=null,_callbacks.remove(obj)}_discard.length&&(_discard.length=0);for(let i=_callbacks.length-1;i>=0;i--){let obj=_callbacks[i];obj?(obj.current+=delta)>=obj.time&&(obj.callback&&obj.callback.apply(this,obj.args),_discard.push(obj)):_callbacks.remove(obj)}}function find(ref){for(let i=_callbacks.length-1;i>-1;i--)if(_callbacks[i].ref==ref)return _callbacks[i]}const _this=this,_callbacks=[],_discard=[];Render.start(loop),this.__clearTimeout=function(ref){const obj=find(ref);return!!obj&&(obj.callback=null,_callbacks.remove(obj),!0)},this.create=function(callback,time){if(window._NODE_)return setTimeout(callback,time);const obj={time:Math.max(1,time||1),current:0,ref:Utils.timestamp(),callback:callback,args:[].slice.call(arguments,2)};return _callbacks.unshift(obj),obj.ref},window.defer=this.defer=function(callback){if(!callback){let promise=Promise.create();return _this.create(promise.resolve,1),promise}_this.create(callback,1)}},"static"),Class(function Events(){this.events={};const _e={},_linked=[];let _emitter;this.events.sub=function(obj,evt,callback){if("object"!=typeof obj&&(callback=evt,evt=obj,obj=null),!obj)return Events.emitter._addEvent(evt,callback.resolve?callback.resolve:callback,this),callback;let emitter=obj.events.emitter();return emitter._addEvent(evt,callback.resolve?callback.resolve:callback,this),emitter._saveLink(this),_linked.push(emitter),callback},this.events.unsub=function(obj,evt,callback){if("object"!=typeof obj&&(callback=evt,evt=obj,obj=null),!obj)return Events.emitter._removeEvent(evt,callback.resolve?callback.resolve:callback);obj.events.emitter()._removeEvent(evt,callback.resolve?callback.resolve:callback)},this.events.fire=function(evt,obj,isLocalOnly){(obj=obj||_e).target=this,Events.emitter._check(evt),_emitter&&_emitter._fireEvent(evt,obj)||isLocalOnly||Events.emitter._fireEvent(evt,obj)},this.events.bubble=function(obj,evt){let _this=this;_this.sub(obj,evt,e=>_this.fire(evt,e))},this.events.destroy=function(){return Events.emitter._destroyEvents(this),_linked&&_linked.forEach(emitter=>emitter._destroyEvents(this)),_emitter&&_emitter.links&&_emitter.links.forEach(obj=>obj.events&&obj.events._unlink(_emitter)),null},this.events.emitter=function(){return _emitter||(_emitter=Events.emitter.createLocalEmitter()),_emitter},this.events._unlink=function(emitter){_linked.remove(emitter)}},()=>{function Emitter(){const prototype=Emitter.prototype;this.events=[],void 0===prototype._check&&(prototype._check=function(evt){if(void 0===evt)throw"Undefined event"},prototype._addEvent=function(evt,callback,object){this._check(evt),this.events.push({evt:evt,object:object,callback:callback})},prototype._removeEvent=function(eventString,callback){this._check(eventString);let _this=this,marked=!1;for(let i=this.events.length-1;i>=0;i--)this.events[i].evt==eventString&&this.events[i].callback==callback&&(this.events[i].markedForDeletion=!0,marked=!0);marked&&defer(()=>_this._sweepEvents())},prototype._sweepEvents=function(){for(let i=0;i<this.events.length;i++)this.events[i].markedForDeletion&&this.events.remove(this.events[i])},prototype._fireEvent=function(eventString,obj){this._check&&this._check(eventString),obj=obj||_e;let called=!1;for(let i=0;i<this.events.length;i++){let evt=this.events[i];evt.evt!=eventString||evt.markedForDeletion||(evt.callback(obj),called=!0)}return called},prototype._destroyEvents=function(object){for(var i=this.events.length-1;i>=0;i--)this.events[i].object==object&&(this.events.splice(i,1)[0]=null)},prototype._saveLink=function(obj){this.links||(this.links=[]),~this.links.indexOf(obj)||this.links.push(obj)},prototype.createLocalEmitter=function(){return new Emitter})}Events.emitter=new Emitter,Events.VISIBILITY="hydra_visibility",Events.HASH_UPDATE="hydra_hash_update",Events.COMPLETE="hydra_complete",Events.PROGRESS="hydra_progress",Events.UPDATE="hydra_update",Events.LOADED="hydra_loaded",Events.END="hydra_end",Events.FAIL="hydra_fail",Events.SELECT="hydra_select",Events.ERROR="hydra_error",Events.READY="hydra_ready",Events.RESIZE="hydra_resize",Events.CLICK="hydra_click",Events.HOVER="hydra_hover",Events.MESSAGE="hydra_message",Events.ORIENTATION="orientation",Events.BACKGROUND="background",Events.BACK="hydra_back",Events.PREVIOUS="hydra_previous",Events.NEXT="hydra_next",Events.RELOAD="hydra_reload",Events.FULLSCREEN="hydra_fullscreen";const _e={};Hydra.ready(()=>{function updateStage(){Stage.width=document.body.clientWidth||document.documentElement.offsetWidth||window.innerWidth,Stage.height=document.body.clientHeight||document.documentElement.offsetHeight||window.innerHeight}!function(){function onfocus(){"focus"!=_last&&Events.emitter._fireEvent(Events.VISIBILITY,{type:"focus"}),_last="focus"}function onblur(){"blur"!=_last&&Events.emitter._fireEvent(Events.VISIBILITY,{type:"blur"}),_last="blur"}let _last,_lastTime=performance.now();Timer.create(function addVisibilityHandler(){let hidden,eventName;if([["msHidden","msvisibilitychange"],["webkitHidden","webkitvisibilitychange"],["hidden","visibilitychange"]].forEach(d=>{void 0!==document[d[0]]&&(hidden=d[0],eventName=d[1])}),!eventName){const root="ie"==Device.browser?document:window;return root.onfocus=onfocus,void(root.onblur=onblur)}document.addEventListener(eventName,()=>{const time=performance.now();time-_lastTime>10&&(!1===document[hidden]?onfocus():onblur()),_lastTime=time})},250)}(),window.Stage=window.Stage||{},updateStage(),window.onresize=function(){updateStage(),Events.emitter._fireEvent(Events.RESIZE)},window.onorientationchange=window.onresize,defer(window.onresize)})}),Class(function Dispatch(){const _instances={};this.registerInstance=function(object){let ref=Utils.getConstructorName(object);_instances[ref]=object,object.removeDispatch=function(){delete _instances[ref]}},this.lookup=function(_class){let name=_class.toString().match(/function ([^\(]+)/)[1];return _instances[name]||console.error(`No instance ${name} found`)}},"static"),Class(function Device(){var _this=this;this.agent=navigator.userAgent.toLowerCase(),this.detect=function(match){return this.agent.includes(match)},this.touchCapable=!!("ontouchstart"in window),this.pixelRatio=window.devicePixelRatio,this.system={},this.system.retina=window.devicePixelRatio>1,this.system.webworker=void 0!==window.Worker,this.system.offline=void 0!==window.applicationCache,window._NODE_||(this.system.geolocation=void 0!==navigator.geolocation),window._NODE_||(this.system.pushstate=void 0!==window.history.pushState),this.system.webcam=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),this.system.language=window.navigator.userLanguage||window.navigator.language,this.system.webaudio=void 0!==window.AudioContext,this.system.vr=function(){if(!navigator.getVRDisplays)return!1;navigator.getVRDisplays().then(displays=>{_this.system.vr=displays.length>0})}();try{this.system.localStorage=void 0!==window.localStorage}catch(e){this.system.localStorage=!1}this.system.fullscreen=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled,this.system.os=_this.detect(["ipad","iphone"])?"ios":_this.detect(["android","kindle"])?"android":_this.detect(["blackberry"])?"blackberry":_this.detect(["mac os"])?"mac":_this.detect(["windows","iemobile"])?"windows":_this.detect(["linux"])?"linux":"unknown",this.system.version=function(){try{if("ios"==_this.system.os){var num=_this.agent.split("os ")[1].split("_"),main=num[0],sub=num[1].split(" ")[0];return Number(main+"."+sub)}if("android"==_this.system.os){var version=_this.agent.split("android ")[1].split(";")[0];return version.length>3&&(version=version.slice(0,-2)),"."==version.charAt(version.length-1)&&(version=version.slice(0,-1)),Number(version)}if("windows"==_this.system.os)return _this.agent.includes("rv:11")?11:Number(_this.agent.split("windows phone ")[1].split(";")[0])}catch(e){}return-1}(),this.system.browser="ios"==_this.system.os?_this.detect(["twitter","fbios"])?"social":_this.detect(["crios"])?"chrome":_this.detect(["safari"])?"safari":"unknown":"android"==_this.system.os?_this.detect(["twitter","fb","facebook"])?"social":_this.detect(["chrome"])?"chrome":_this.detect(["firefox"])?"firefox":"browser":_this.detect(["msie"])?"ie":_this.detect(["trident"])&&_this.detect(["rv:"])?"ie":_this.detect(["windows"])&&_this.detect(["edge"])?"ie":_this.detect(["chrome"])?"chrome":_this.detect(["safari"])?"safari":_this.detect(["firefox"])?"firefox":"unknown",this.system.browserVersion=function(){try{if("chrome"==_this.system.browser)return Number(_this.agent.split("chrome/")[1].split(".")[0]);if("firefox"==_this.system.browser)return Number(_this.agent.split("firefox/")[1].split(".")[0]);if("safari"==_this.system.browser)return Number(_this.agent.split("version/")[1].split(".")[0].split(".")[0]);if("ie"==_this.system.browser)return _this.detect(["msie"])?Number(_this.agent.split("msie ")[1].split(".")[0]):_this.detect(["rv:"])?Number(_this.agent.split("rv:")[1].split(".")[0]):Number(_this.agent.split("edge/")[1].split(".")[0])}catch(e){return-1}}(),this.mobile=!(window._NODE_||!("ontouchstart"in window||"onpointerdown"in window)||!this.detect(["ios","iphone","ipad","windows phone","android","blackberry"]))&&{},this.mobile&&this.detect(["windows"])&&!this.detect(["touch"])&&(this.mobile=!1),this.mobile&&(this.mobile.tablet=Math.max(window.screen?screen.width:window.innerWidth,window.screen?screen.height:window.innerHeight)>1e3,this.mobile.phone=!this.mobile.tablet,this.mobile.pwa=!(!window.matchMedia||!window.matchMedia("(display-mode: standalone)").matches)||!!window.navigator.standalone,Hydra.ready(()=>{_this.mobile.native=!(!Mobile.NativeCore||!Mobile.NativeCore.active)||!!window._AURA_})),this.media={},this.media.audio=!!document.createElement("audio").canPlayType&&(_this.detect(["firefox","opera"])?"ogg":"mp3"),this.media.video=function(){var vid=document.createElement("video");return!!vid.canPlayType&&(vid.canPlayType("video/webm;")?"webm":"mp4")}(),this.media.webrtc=!!(window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection||window.oRTCPeerConnection||window.RTCPeerConnection),this.graphics={},this.graphics.webgl=function(){let DISABLED=!1;Object.defineProperty(_this.graphics,"webgl",{get:()=>{if(DISABLED)return!1;if(window._AURA_)return _this.graphics._webglContext={detect:_=>!1},_this.graphics._webglContext;if(_this.graphics._webglContext)return _this.graphics._webglContext;try{const names=["webgl","experimental-webgl","webkit-3d","moz-webgl"],canvas=document.createElement("canvas");let gl;for(let i=0;i<names.length&&!(gl=canvas.getContext(names[i]));i++);let info=gl.getExtension("WEBGL_debug_renderer_info"),output={};if(info){let gpu=info.UNMASKED_RENDERER_WEBGL;output.gpu=gl.getParameter(gpu).toLowerCase()}return output.renderer=gl.getParameter(gl.RENDERER).toLowerCase(),output.version=gl.getParameter(gl.VERSION).toLowerCase(),output.glsl=gl.getParameter(gl.SHADING_LANGUAGE_VERSION).toLowerCase(),output.extensions=gl.getSupportedExtensions(),output.detect=function(matches){if(output.gpu&&output.gpu.toLowerCase().includes(matches))return!0;if(output.version&&output.version.toLowerCase().includes(matches))return!0;for(let i=0;i<output.extensions.length;i++)if(output.extensions[i].toLowerCase().includes(matches))return!0;return!1},_this.graphics._webglContext=output,output}catch(e){return!1}},set:v=>{!1===v&&(DISABLED=!0)}})}(),this.graphics.canvas=!!document.createElement("canvas").getContext;const checkForStyle=function(){let _tagDiv;return function(prop){const vendors=["Khtml","ms","O","Moz","Webkit"];if(prop in(_tagDiv=_tagDiv||document.createElement("div")).style)return!0;prop=prop.replace(/^[a-z]/,val=>val.toUpperCase());for(let i=vendors.length-1;i>=0;i--)if(vendors[i]+prop in _tagDiv.style)return!0;return!1}}();this.styles={},this.styles.filter=checkForStyle("filter"),this.styles.blendMode=checkForStyle("mix-blend-mode"),this.tween={},this.tween.transition=checkForStyle("transition"),this.tween.css2d=checkForStyle("transform"),this.tween.css3d=checkForStyle("perspective")},"Static"),Class(function Component(){function defineSetter(_this,prop){_setters[prop]={},Object.defineProperty(_this,prop,{set:function(v){_setters[prop]&&_setters[prop].s&&_setters[prop].s.call(_this,v),v=null},get:function(){if(_setters[prop]&&_setters[prop].g)return _setters[prop].g.apply(_this)}})}function internalLoop(a,b,c,d){if(!1!==_this.visible&&(!_this.group||!1!==_this.group.visible))for(let i=0;i<_loops.length;i++)_loops[i](a,b,c,d)}Inherit(this,Events);const _this=this,_setters={},_flags={},_timers=[],_loops=[];this.classes={},this.set=function(prop,callback){_setters[prop]||defineSetter(this,prop),_setters[prop].s=callback},this.get=function(prop,callback){_setters[prop]||defineSetter(this,prop),_setters[prop].g=callback},this.initClass=function(clss){if(!clss)throw"unable to locate class";const args=[].slice.call(arguments,1),child=Object.create(clss.prototype);if(child.parent=this,clss.apply(child,args),child.destroy){const id=Utils.timestamp();this.classes[id]=child,this.classes[id].__id=id}if(child.element){const last=arguments[arguments.length-1];Array.isArray(last)&&1==last.length&&last[0]instanceof HydraObject?last[0].add(child.element):this.element&&null!==last&&this.element.add(child.element)}if(child.group){const last=arguments[arguments.length-1];this.group&&null!==last&&this.group.add(child.group)}return child},this.delayedCall=function(callback,time){const args=[].slice.call(arguments,2),timer=Timer.create(()=>{_this&&_this.destroy&&callback&&callback.apply(this,args)},time);return _timers.push(timer),_timers.length>50&&_timers.shift(),timer},this.clearTimers=function(){for(let i=_timers.length-1;i>=0;i--)clearTimeout(_timers[i]);_timers.length=0},this.startRender=function(callback){-1==_loops.indexOf(callback)&&_loops.push(callback),Render.start(internalLoop)},this.stopRender=function(callback){_loops.remove(callback),_loops.length||Render.stop(internalLoop)},this.clearRenders=function(){_loops.length=0,Render.stop(internalLoop)},this.wait=function(object,key,callback){function test(){if(!object)return Render.stop(test);object[key]&&(callback(),Render.stop(test))}const promise=Promise.create();if("number"==typeof object&&!key)return _this.delayedCall(promise.resolve,object),promise;if("function"==typeof object&&"function"!=typeof callback){let _object=object;object=key,key=callback,callback=_object}return callback=callback||promise.resolve,Render.start(test),promise},this.flag=function(name,value,time){if(void 0===value)return _flags[name];_flags[name]=value,time&&(clearTimeout(_flags[name+"_timer"]),_flags[name+"_timer"]=this.delayedCall(()=>{_flags[name]=!_flags[name]},time))},this.destroy=function(){this.removeDispatch&&this.removeDispatch(),this.onDestroy&&this.onDestroy();for(let id in this.classes){var clss=this.classes[id];clss&&clss.destroy&&clss.destroy()}return this.classes=null,this.clearRenders&&this.clearRenders(),this.clearTimers&&this.clearTimers(),this.events&&(this.events=this.events.destroy()),this.parent&&this.parent.__destroyChild&&this.parent.__destroyChild(this.__id),Utils.nullObject(this)},this.__destroyChild=function(name){delete this.classes[name]}}),Class(function Model(){Inherit(this,Component),Namespace(this);const _this=this,_storage={};let _data=0,_triggered=0;this.push=function(name,val){_storage[name]=val},this.pull=function(name){return _storage[name]},this.waitForData=this.promiseData=function(num=1){_data+=num},this.fulfillData=this.resolveData=function(){++_triggered==_data&&(_this.dataReady=!0)},this.ready=function(callback){let promise=Promise.create();return callback&&promise.then(callback),_this.wait(_this,"dataReady").then(promise.resolve),promise},this.initWithData=function(data){_this.STATIC_DATA=data;for(var key in _this){var model=_this[key],init=!1;for(var i in data)i.toLowerCase().replace(/-/g,"")==key.toLowerCase()&&(init=!0,model.init&&model.init(data[i]));!init&&model.init&&model.init()}_this.init&&_this.init(data)},this.loadData=function(url,callback){let promise=Promise.create();callback||(callback=promise.resolve);var _this=this;return get(url+"?"+Utils.timestamp()).then(d=>{defer(()=>{_this.initWithData(d),callback(d)})}),promise}}),Class(function Modules(){function exec(){for(let m in _modules)for(let key in _modules[m]){let module=_modules[m][key];module._ready||(module._ready=!0,module.exec&&module.exec())}}function requireModule(root,path){let module=_modules[root];if(!module)throw`Module ${root} not found`;return(module=module[path])._ready||(module._ready=!0,module.exec&&module.exec()),module}const _modules={};defer(exec),this.Module=function(module){let m=new module,name=module.toString().slice(0,100).match(/function ([^\(]+)/);name?(m._ready=!0,name=name[1],_modules[name]={index:m}):(_modules[m.module]||(_modules[m.module]={}),_modules[m.module][m.path]=m)},this.require=function(path){let root;return path.includes("/")?(root=path.split("/")[0],path=path.replace(root+"/","")):(root=path,path="index"),requireModule(root,path).exports},window.Module=this.Module,window._NODE_&&!window.EJECTA||(window.requireNative=window.require,window.require=this.require)},"Static"),Class(function LinkedList(){var prototype=LinkedList.prototype;this.length=0,this.first=null,this.last=null,this.current=null,this.prev=null,void 0===prototype.push&&(prototype.push=function(obj){this.first?(obj.__next=this.first,obj.__prev=this.last,this.last.__next=obj,this.last=obj):(this.first=obj,this.last=obj,obj.__prev=obj,obj.__next=obj),this.length++},prototype.remove=function(obj){obj&&obj.__next&&(this.length<=1?this.empty():(obj==this.first?(this.first=obj.__next,this.last.__next=this.first,this.first.__prev=this.last):obj==this.last?(this.last=obj.__prev,this.last.__next=this.first,this.first.__prev=this.last):(obj.__prev.__next=obj.__next,obj.__next.__prev=obj.__prev),this.length--),obj.__prev=null,obj.__next=null)},prototype.empty=function(){this.first=null,this.last=null,this.current=null,this.prev=null,this.length=0},prototype.start=function(){return this.current=this.first,this.prev=this.current,this.current},prototype.next=function(){if(this.current&&(this.current=this.current.__next,1!=this.length&&this.prev.__next!=this.first))return this.prev=this.current,this.current},prototype.destroy=function(){return Utils.nullObject(this),null})}),Class(function ObjectPool(_type,_number=10){var _pool=[];this.array=_pool,function(){if(_type)for(var i=0;i<_number;i++)_pool.push(new _type)}(),this.get=function(){return _pool.shift()||(_type?new _type:null)},this.empty=function(){_pool.length=0},this.put=function(obj){obj&&_pool.push(obj)},this.insert=function(array){void 0===array.push&&(array=[array]);for(var i=0;i<array.length;i++)_pool.push(array[i])},this.length=function(){return _pool.length},this.destroy=function(){for(let i=_pool.length-1;i>=0;i--)_pool[i].destroy&&_pool[i].destroy();return _pool=null}}),Hydra.ready(function(){window.__window=$(window),window.__document=$(document),window.__body=$(document.getElementsByTagName("body")[0]),window.Stage=window.Stage&&window.Stage.style?$(window.Stage):__body.create("#Stage"),Stage.size("100%"),Stage.__useFragment=!0,Stage.width=document.body.clientWidth||document.documentElement.offsetWidth||window.innerWidth,Stage.height=document.body.clientHeight||document.documentElement.offsetHeight||window.innerHeight}),Class(function CSS(){function objToCSS(key){var match=key.match(/[A-Z]/),camelIndex=match?match.index:null;return camelIndex&&(key=key.slice(0,camelIndex)+"-"+key.slice(camelIndex).toLowerCase()),key}function cssToObj(key){var match=key.match(/\-/),camelIndex=match?match.index:null;if(camelIndex){var start=key.slice(0,camelIndex),end=key.slice(camelIndex).slice(1),letter=end.charAt(0);end=end.slice(1),key=start+(end=letter.toUpperCase()+end)}return key}function setHTML(){_obj.innerHTML=_style,_needsUpdate=!1}var _obj,_style,_needsUpdate,_this=this;Hydra.ready(function(){_style="",(_obj=document.createElement("style")).type="text/css",document.getElementsByTagName("head")[0].appendChild(_obj)}),this._read=function(){return _style},this._write=function(css){_style=css,_needsUpdate||(_needsUpdate=!0,defer(setHTML))},this.style=function(selector,obj){var s=selector+" {";for(var key in obj){var prop=objToCSS(key),val=obj[key];"string"!=typeof val&&"opacity"!=key&&(val+="px"),s+=prop+":"+val+"!important;"}s+="}",_this._write(_style+s)},this.get=function(selector,prop){for(var values=new Object,string=_obj.innerHTML.split(selector+" {"),i=0;i<string.length;i++){var str=string[i];if(str.length){var split=str.split("!important;");for(var j in split)if(split[j].includes(":")){var fsplit=split[j].split(":");"px"==fsplit[1].slice(-2)&&(fsplit[1]=Number(fsplit[1].slice(0,-2))),values[cssToObj(fsplit[0])]=fsplit[1]}}}return prop?values[prop]:values},this.textSize=function($obj){var $clone=$obj.clone();$clone.css({position:"relative",cssFloat:"left",styleFloat:"left",marginTop:-99999,width:"",height:""}),__body.addChild($clone);var width=$clone.div.offsetWidth,height=$clone.div.offsetHeight;return $clone.remove(),{width:width,height:height}},this.prefix=function(style){return""==_this.styles.vendor?style.charAt(0).toLowerCase()+style.slice(1):_this.styles.vendor+style},this._toCSS=objToCSS},"Static"),Class(function HydraObject(_selector,_type,_exists,_useFragment){this._children=new LinkedList,this.__useFragment=_useFragment,this._initSelector(_selector,_type,_exists)},()=>{var prototype=HydraObject.prototype;prototype._initSelector=function(_selector,_type,_exists){if(_selector&&"string"!=typeof _selector)this.div=_selector;else{var first=_selector?_selector.charAt(0):null,name=_selector?_selector.slice(1):null;if("."!=first&&"#"!=first&&(name=_selector,first="."),_exists){if("#"!=first)throw"Hydra Selectors Require #ID";this.div=document.getElementById(name)}else this._type=_type||"div","svg"==this._type?(this.div=document.createElementNS("http://www.w3.org/2000/svg",this._type),this.div.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")):(this.div=document.createElement(this._type),first&&("#"==first?this.div.id=name:this.div.className=name))}this.div.hydraObject=this},prototype.add=function(child){var div=this.div,_this=this,createFrag=function(){_this.__useFragment&&(_this._fragment||(_this._fragment=document.createDocumentFragment(),defer(function(){if(!_this._fragment||!_this.div)return _this._fragment=null;_this.div.appendChild(_this._fragment),_this._fragment=null})),div=_this._fragment)};return child.element&&child.element instanceof HydraObject?(createFrag(),div.appendChild(child.element.div),this._children.push(child.element),child.element._parent=this,child.element.div.parentNode=this.div):child.div?(createFrag(),div.appendChild(child.div),this._children.push(child),child._parent=this,child.div.parentNode=this.div):child.nodeName&&(createFrag(),div.appendChild(child),child.parentNode=this.div),this},prototype.clone=function(){return $(this.div.cloneNode(!0))},prototype.create=function(name,type){var $obj=$(name,type);return this.add($obj),$obj},prototype.empty=function(){for(var child=this._children.start();child;)child&&child.remove&&child.remove(),child=this._children.next();return this.div.innerHTML="",this},prototype.parent=function(){return this._parent},prototype.children=function(){return this.div.children?this.div.children:this.div.childNodes},prototype.removeChild=function(object,keep){try{object.div.parentNode.removeChild(object.div)}catch(e){}keep||this._children.remove(object)},prototype.remove=prototype.destroy=function(){this.removed=!0;var parent=this._parent;parent&&!parent.removed&&parent.removeChild&&parent.removeChild(this,!0);for(var child=this._children.start();child;)child&&child.remove&&child.remove(),child=this._children.next();this._children.destroy(),this.div.hydraObject=null,Utils.nullObject(this)},window.$=function(selector,type,exists){return new HydraObject(selector,type,exists)},$.fn=HydraObject.prototype}),$.fn.text=function(text){return void 0!==text?(this.__cacheText!=text&&(this.div.textContent=text),this.__cacheText=text,this):this.div.textContent},$.fn.html=function(text,force){return!text||text.includes("<")||force?void 0!==text?(this.div.innerHTML=text,this):this.div.innerHTML:this.text(text)},$.fn.hide=function(){return this.div.style.display="none",this},$.fn.show=function(){return this.div.style.display="",this},$.fn.visible=function(){return this.div.style.visibility="visible",this},$.fn.invisible=function(){return this.div.style.visibility="hidden",this},$.fn.setZ=function(z){return this.div.style.zIndex=z,this},$.fn.clearAlpha=function(){return this.div.style.opacity="",this},$.fn.size=function(w,h,noScale){return"string"==typeof w?(void 0===h?h="100%":"string"!=typeof h&&(h+="px"),this.div.style.width=w,this.div.style.height=h):(this.div.style.width=w+"px",this.div.style.height=h+"px",noScale||(this.div.style.backgroundSize=w+"px "+h+"px")),this.width=w,this.height=h,this},$.fn.mouseEnabled=function(bool){return this.div.style.pointerEvents=bool?"auto":"none",this},$.fn.fontStyle=function(family,size,color,style){var font={};return family&&(font.fontFamily=family),size&&(font.fontSize=size),color&&(font.color=color),style&&(font.fontStyle=style),this.css(font),this},$.fn.bg=function(src,x,y,repeat){return src?(src.includes(".")&&(src=Assets.getPath(src)),src.includes(".")?this.div.style.backgroundImage="url("+src+")":this.div.style.backgroundColor=src,void 0!==x&&(x="number"==typeof x?x+"px":x,y="number"==typeof y?y+"px":y,this.div.style.backgroundPosition=x+" "+y),repeat&&(this.div.style.backgroundSize="",this.div.style.backgroundRepeat=repeat),"cover"!=x&&"contain"!=x||(this.div.style.backgroundSize=x,this.div.style.backgroundPosition=void 0!==y?y+" "+repeat:"center"),this):this},$.fn.center=function(x,y,noPos){var css={};return void 0===x?(css.left="50%",css.top="50%",css.marginLeft=-this.width/2,css.marginTop=-this.height/2):(x&&(css.left="50%",css.marginLeft=-this.width/2),y&&(css.top="50%",css.marginTop=-this.height/2)),noPos&&(delete css.left,delete css.top),this.css(css),this},$.fn.max=function(width,height){let w,h;return void 0!==width&&(w="number"==typeof width?width+"px":width,this.div.style.maxWidth=w),void 0!==height?(h="number"==typeof height?height+"px":height,this.div.style.maxHeight=h):(h=w,this.div.style.maxHeight=h),this},$.fn.min=function(width,height){let w,h;return void 0!==width&&(w="number"==typeof width?width+"px":width,this.div.style.minWidth=w),void 0!==height?(h="number"==typeof height?height+"px":height,this.div.style.minHeight=h):(h=w,this.div.style.minHeight=h),this},$.fn.flex=function(inline){return this.div.style.display=inline?"inline-flex":"flex",this.div.style.justifyContent="center",this.div.style.alignItems="center",this.div.classList.add("relative-children"),this},$.fn.order=function(opts={}){let s=this.div.style;return"none"===opts.flexWrap&&(opts.flexWrap="nowrap"),opts.direction&&(s.flexDirection=opts.direction),opts.wrap&&(s.flexWrap=opts.wrap),opts.order&&(s.order=opts.order),this},$.fn.align=function(opts={}){function flex(str,contentMode=!1){return"start"===str?"flex-start":"end"===str?"flex-end":"between"===str?contentMode?"space-between":"flex-between":"around"===str?contentMode?"space-around":"flex-around":"none"===str?"nowrap":str}let s=this.div.style;return opts.justify&&(s.justifyContent=flex(opts.justify)),opts.items&&(s.alignItems=flex(opts.items)),opts.self&&(s.alignSelf=flex(opts.self)),opts.content&&(s.alignContent=flex(opts.content,!0)),this},$.fn.flexibility=function(opts={}){let s=this.div.style;return"undefined"!==opts.grow&&(s.flexGrow=opts.grow),"undefined"!==opts.shrink&&(s.flexGrow=opts.shrink),void 0!==opts.basis&&(s.flexBasis="number"==typeof opts.basis?opts.basis+"px":opts.basis),this},$.fn.mask=function(arg){return this.div.style[CSS.prefix("Mask")]=(arg.includes(".")?"url("+arg+")":arg)+" no-repeat",this.div.style[CSS.prefix("MaskSize")]="contain",this},$.fn.blendMode=function(mode,bg){return bg?this.div.style["background-blend-mode"]=mode:this.div.style["mix-blend-mode"]=mode,this},$.fn.css=function(obj,value){if("boolean"==typeof value&&(value=null),"object"!=typeof obj){if(value)return this.div.style[obj]=value,this;var style=this.div.style[obj];if("number"!=typeof style){if(!style)return!1;style.includes("px")&&(style=Number(style.slice(0,-2))),"opacity"==obj&&(style=isNaN(Number(this.div.style.opacity))?1:Number(this.div.style.opacity))}return style||(style=0),style}TweenManager._clearCSSTween(this);for(var type in obj){var val=obj[type];"string"!=typeof val&&"number"!=typeof val||("string"!=typeof val&&"opacity"!=type&&"zIndex"!=type&&(val+="px"),this.div.style[type]=val)}return this},$.fn.transform=function(props){if(!(this.multiTween&&this.cssTweens&&this._cssTweens.length>1&&this.__transformTime&&Render.TIME-this.__transformTime<15)){if(this.__transformTime=Render.TIME,TweenManager._clearCSSTween(this),Device.tween.css2d){if(props)for(var key in props)"number"==typeof props[key]&&(this[key]=props[key]);else props=this;var transformString=TweenManager._parseTransform(props);this.__transformCache!=transformString&&(this.div.style[CSS.styles.vendorTransform]=transformString,this.__transformCache=transformString)}return this}},$.fn.willChange=function(props){if("boolean"==typeof props)this._willChangeLock=!0===props;else if(this._willChangeLock)return;var string="string"==typeof props;this._willChange&&!string||"null"==typeof props?(this._willChange=!1,this.div.style["will-change"]=""):(this._willChange=!0,this.div.style["will-change"]=string?props:CSS.transformProperty+", opacity")},$.fn.backfaceVisibility=function(visible){this.div.style[CSS.prefix("BackfaceVisibility")]=visible?"visible":"hidden"},$.fn.enable3D=function(perspective,x,y){return Device.tween.css3d?(this.div.style[CSS.prefix("TransformStyle")]="preserve-3d",perspective&&(this.div.style[CSS.prefix("Perspective")]=perspective+"px"),void 0!==x&&(x="number"==typeof x?x+"px":x,y="number"==typeof y?y+"px":y,this.div.style[CSS.prefix("PerspectiveOrigin")]=x+" "+y),this):this},$.fn.disable3D=function(){return this.div.style[CSS.prefix("TransformStyle")]="",this.div.style[CSS.prefix("Perspective")]="",this},$.fn.transformPoint=function(x,y,z){var origin="";return void 0!==x&&(origin+="number"==typeof x?x+"px ":x+" "),void 0!==y&&(origin+="number"==typeof y?y+"px ":y+" "),void 0!==z&&(origin+="number"==typeof z?z+"px":z),this.div.style[CSS.prefix("TransformOrigin")]=origin,this},$.fn.tween=function(props,time,ease,delay,callback,manual){"boolean"==typeof delay?(manual=delay,delay=0,callback=null):"function"==typeof delay&&(callback=delay,delay=0),"boolean"==typeof callback&&(manual=callback,callback=null),delay||(delay=0);var usePromise=null;callback&&callback instanceof Promise&&(usePromise=callback,callback=callback.resolve);var tween=TweenManager._detectTween(this,props,time,ease,delay,callback,manual);return usePromise||tween},$.fn.clearTransform=function(){return"number"==typeof this.x&&(this.x=0),"number"==typeof this.y&&(this.y=0),"number"==typeof this.z&&(this.z=0),"number"==typeof this.scale&&(this.scale=1),"number"==typeof this.scaleX&&(this.scaleX=1),"number"==typeof this.scaleY&&(this.scaleY=1),"number"==typeof this.rotation&&(this.rotation=0),"number"==typeof this.rotationX&&(this.rotationX=0),"number"==typeof this.rotationY&&(this.rotationY=0),"number"==typeof this.rotationZ&&(this.rotationZ=0),"number"==typeof this.skewX&&(this.skewX=0),"number"==typeof this.skewY&&(this.skewY=0),this.div.style[CSS.styles.vendorTransform]="",this},$.fn.clearTween=function(){return this._cssTween&&this._cssTween.stop(),this._mathTween&&this._mathTween.stop(),this},$.fn.stopTween=function(){return console.warn(".stopTween deprecated. use .clearTween instead"),this.clearTween()},$.fn.keypress=function(callback){this.div.onkeypress=function(e){(e=e||window.event).code=e.keyCode?e.keyCode:e.charCode,callback&&callback(e)}},$.fn.keydown=function(callback){this.div.onkeydown=function(e){(e=e||window.event).code=e.keyCode,callback&&callback(e)}},$.fn.keyup=function(callback){this.div.onkeyup=function(e){(e=e||window.event).code=e.keyCode,callback&&callback(e)}},$.fn.attr=function(attr,value){if(attr&&value)""==value?this.div.removeAttribute(attr):this.div.setAttribute(attr,value);else if(attr)return this.div.getAttribute(attr);return this},$.fn.val=function(value){return void 0===value?this.div.value:(this.div.value=value,this)},$.fn.change=function(callback){var _this=this;"select"==this._type&&(this.div.onchange=function(){callback({object:_this,value:_this.div.value||""})})},$.fn.svgSymbol=function(id,width,height){var config=SVG.getSymbolConfig(id),svgHTML='<svg viewBox="0 0 '+config.width+" "+config.height+'" width="'+width+'" height="'+height+'"><use xlink:href="#'+config.id+'" x="0" y="0" /></svg>';this.html(svgHTML,!0)},$.fn.overflowScroll=function(dir){var x=!!dir.x,y=!!dir.y,overflow={};(!x&&!y||x&&y)&&(overflow.overflow="scroll"),!x&&y&&(overflow.overflowY="scroll",overflow.overflowX="hidden"),x&&!y&&(overflow.overflowX="scroll",overflow.overflowY="hidden"),Device.mobile&&(overflow["-webkit-overflow-scrolling"]="touch",Mobile._addOverflowScroll(this)),this.css(overflow)},$.fn.removeOverflowScroll=function(){this.css({overflow:"hidden",overflowX:"",overflowY:"","-webkit-overflow-scrolling":""}),Device.mobile&&Mobile._removeOverflowScroll(this)},function(){var windowsPointer=!!window.MSGesture,translateEvent=function(evt){if(windowsPointer)switch(evt){case"touchstart":return"pointerdown";case"touchmove":return"MSGestureChange";case"touchend":return"pointerup"}return evt},convertTouchEvent=function(e){var touchEvent={};if(touchEvent.x=0,touchEvent.y=0,e.windowsPointer)return e;if(!e)return touchEvent;if(e.touches||e.changedTouches?e.touches.length?(touchEvent.x=e.touches[0].pageX,touchEvent.y=e.touches[0].pageY):(touchEvent.x=e.changedTouches[0].pageX,touchEvent.y=e.changedTouches[0].pageY):(touchEvent.x=e.pageX,touchEvent.y=e.pageY),Mobile.ScreenLock&&Mobile.ScreenLock.isActive&&Mobile.orientationSet&&Mobile.orientation!==Mobile.orientationSet){if(90==window.orientation||0===window.orientation){var x=touchEvent.y;touchEvent.y=touchEvent.x,touchEvent.x=Stage.width-x}if(-90==window.orientation||180===window.orientation){var y=touchEvent.x;touchEvent.x=touchEvent.y,touchEvent.y=Stage.height-y}}return touchEvent};$.fn.click=function(callback){var _this=this;return this.div.addEventListener(translateEvent("click"),function click(e){return!!_this.div&&!Mouse._preventClicks&&(e.object="hit"==_this.div.className?_this.parent():_this,e.action="click",e.pageX||(e.pageX=e.clientX,e.pageY=e.clientY),callback&&callback(e),void(Mouse.autoPreventClicks&&Mouse.preventClicks()))},!0),this.div.style.cursor="pointer",this},$.fn.hover=function(callback){function hover(e){if(!_this.div)return!1;var time=performance.now(),original=e.toElement||e.relatedTarget;if(_time&&time-_time<5)return _time=time,!1;switch(_time=time,e.object="hit"==_this.div.className?_this.parent():_this,e.type){case"mouseout":case"mouseleave":e.action="out";break;default:e.action="over"}if(_over){if(Mouse._preventClicks)return!1;if("over"==e.action)return!1;if("out"==e.action&&isAChild(_this.div,original))return!1;_over=!1}else{if("out"==e.action)return!1;_over=!0}e.pageX||(e.pageX=e.clientX,e.pageY=e.clientY),callback&&callback(e)}function isAChild(div,object){for(var len=div.children.length-1,i=len;i>-1;i--)if(object==div.children[i])return!0;for(i=len;i>-1;i--)if(isAChild(div.children[i],object))return!0}var _time,_this=this,_over=!1;return this.div.addEventListener(translateEvent("mouseover"),hover,!0),this.div.addEventListener(translateEvent("mouseout"),hover,!0),this},$.fn.press=function(callback){function press(e){if(!_this.div)return!1;switch(e.object="hit"==_this.div.className?_this.parent():_this,e.type){case"mousedown":e.action="down";break;default:e.action="up"}e.pageX||(e.pageX=e.clientX,e.pageY=e.clientY),callback&&callback(e)}var _this=this;return this.div.addEventListener(translateEvent("mousedown"),press,!0),this.div.addEventListener(translateEvent("mouseup"),press,!0),this},$.fn.bind=function(evt,callback){function touchEvent(e){windowsPointer&&target.msGesture&&"touchstart"==evt&&target.msGesture.addPointer(e.pointerId);var touch=convertTouchEvent(e);if(windowsPointer){var windowsEvt=e;(e={}).x=Number(windowsEvt.pageX||windowsEvt.clientX),e.y=Number(windowsEvt.pageY||windowsEvt.clientY),e.target=windowsEvt.target,e.currentTarget=windowsEvt.currentTarget,e.path=[];for(var node=e.target;node;)e.path.push(node),node=node.parentElement||null;e.windowsPointer=!0}else e.x=touch.x,e.y=touch.y;for(var i=0;i<_events.length;i++){var ev=_events[i];ev.target==e.currentTarget&&ev.callback(e)}}if(this._events=this._events||{},windowsPointer&&this==__window)return Stage.bind(evt,callback);"touchstart"==evt?Device.mobile||(Device.touchCapable?this.bind("mousedown",callback):evt="mousedown"):"touchmove"==evt?(Device.mobile||(Device.touchCapable?this.bind("mousemove",callback):evt="mousemove"),windowsPointer&&!this.div.msGesture&&(this.div.msGesture=new MSGesture,this.div.msGesture.target=this.div)):"touchend"==evt&&(Device.mobile||(Device.touchCapable?this.bind("mouseup",callback):evt="mouseup")),this._events["bind_"+evt]=this._events["bind_"+evt]||[];var _events=this._events["bind_"+evt],e={},target=this.div;return e.callback=callback,e.target=this.div,_events.push(e),this._events["fn_"+evt]||(this._events["fn_"+evt]=touchEvent,this.div.addEventListener(translateEvent(evt),touchEvent,!0)),this},$.fn.unbind=function(evt,callback){if(this._events=this._events||{},windowsPointer&&this==__window)return Stage.unbind(evt,callback);"touchstart"==evt?Device.mobile||(Device.touchCapable?this.unbind("mousedown",callback):evt="mousedown"):"touchmove"==evt?Device.mobile||(Device.touchCapable?this.unbind("mousemove",callback):evt="mousemove"):"touchend"==evt&&(Device.mobile||(Device.touchCapable?this.unbind("mouseup",callback):evt="mouseup"));var _events=this._events["bind_"+evt];if(!_events)return this;for(var i=0;i<_events.length;i++)_events[i].callback==callback&&_events.splice(i,1);return this._events["fn_"+evt]&&!_events.length&&(this.div.removeEventListener(translateEvent(evt),this._events["fn_"+evt],!Device.mobile||{passive:!0}),this._events["fn_"+evt]=null),this},$.fn.interact=function(overCallback,clickCallback){this.hit||(this.hit=$(".hit"),this.hit.css({width:"100%",height:"100%",zIndex:99999,top:0,left:0,position:"absolute"}),this.add(this.hit)),Device.mobile?this.hit.touchClick(overCallback,clickCallback):this.hit.hover(overCallback).click(clickCallback)},$.fn.touchSwipe=function(callback,distance){function touchMove(e){if(!_this.div)return!1;if(_moving){var touch=convertTouchEvent(e),dx=_startX-touch.x,dy=_startY-touch.y;_move.direction=null,_move.moving=null,_move.x=null,_move.y=null,_move.evt=e,Math.abs(dx)>=_distance?(touchEnd(),_move.direction=dx>0?"left":"right"):Math.abs(dy)>=_distance?(touchEnd(),_move.direction=dy>0?"up":"down"):(_move.moving=!0,_move.x=dx,_move.y=dy),callback&&callback(_move,e)}}function touchEnd(e){if(!_this.div)return!1;_startX=_startY=_moving=!1,_this.div.removeEventListener(translateEvent("touchmove"),touchMove)}if(!window.addEventListener)return this;var _startX,_startY,_this=this,_distance=distance||75,_moving=!1,_move={};return Device.mobile&&(this.div.addEventListener(translateEvent("touchstart"),function touchStart(e){var touch=convertTouchEvent(e);if(!_this.div)return!1;1==e.touches.length&&(_startX=touch.x,_startY=touch.y,_moving=!0,_this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:!0}))},{passive:!0}),this.div.addEventListener(translateEvent("touchend"),touchEnd,{passive:!0}),this.div.addEventListener(translateEvent("touchcancel"),touchEnd,{passive:!0})),this},$.fn.touchClick=function(hover,click){function findDistance(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)}function touchMove(e){if(!_this.div)return!1;_touch=convertTouchEvent(e),_move=findDistance(_start,_touch)>5}function touchMove(e){if(!_this.div)return!1;_touch=convertTouchEvent(e),_move=findDistance(_start,_touch)>5}function setTouch(e){var touch=convertTouchEvent(e);e.touchX=touch.x,e.touchY=touch.y,_start.x=e.touchX,_start.y=e.touchY}if(!window.addEventListener)return this;var _time,_move,_this=this,_start={},_touch={};return Device.mobile&&(this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:!0}),this.div.addEventListener(translateEvent("touchstart"),function touchStart(e){if(!_this.div)return!1;_time=performance.now(),e.action="over",e.object="hit"==_this.div.className?_this.parent():_this,setTouch(e),hover&&!_move&&hover(e)},{passive:!0}),this.div.addEventListener(translateEvent("touchend"),function touchEnd(e){if(!_this.div)return!1;var time=performance.now();if(e.object="hit"==_this.div.className?_this.parent():_this,setTouch(e),_time&&time-_time<750){if(Mouse._preventClicks)return!1;click&&!_move&&(e.action="click",click&&!_move&&click(e),Mouse.autoPreventClicks&&Mouse.preventClicks())}hover&&(e.action="out",Mouse._preventFire||hover(e)),_move=!1},{passive:!0})),this}}(),Class(function Element(){Inherit(this,Component);var name=Utils.getConstructorName(this);this.element=$("."+name),this.element.__useFragment=!0,this.destroy=function(){this.element&&this.element.remove&&(this.element=this.element.remove()),this._destroy&&this._destroy()}}),Hydra.ready(()=>{TweenManager.Transforms=["scale","scaleX","scaleY","x","y","z","rotation","rotationX","rotationY","rotationZ","skewX","skewY","perspective"],TweenManager.CubicEases=[{name:"easeOutCubic",curve:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"},{name:"easeOutQuad",curve:"cubic-bezier(0.250, 0.460, 0.450, 0.940)"},{name:"easeOutQuart",curve:"cubic-bezier(0.165, 0.840, 0.440, 1.000)"},{name:"easeOutQuint",curve:"cubic-bezier(0.230, 1.000, 0.320, 1.000)"},{name:"easeOutSine",curve:"cubic-bezier(0.390, 0.575, 0.565, 1.000)"},{name:"easeOutExpo",curve:"cubic-bezier(0.190, 1.000, 0.220, 1.000)"},{name:"easeOutCirc",curve:"cubic-bezier(0.075, 0.820, 0.165, 1.000)"},{name:"easeOutBack",curve:"cubic-bezier(0.175, 0.885, 0.320, 1.275)"},{name:"easeInCubic",curve:"cubic-bezier(0.550, 0.055, 0.675, 0.190)"},{name:"easeInQuad",curve:"cubic-bezier(0.550, 0.085, 0.680, 0.530)"},{name:"easeInQuart",curve:"cubic-bezier(0.895, 0.030, 0.685, 0.220)"},{name:"easeInQuint",curve:"cubic-bezier(0.755, 0.050, 0.855, 0.060)"},{name:"easeInSine",curve:"cubic-bezier(0.470, 0.000, 0.745, 0.715)"},{name:"easeInCirc",curve:"cubic-bezier(0.600, 0.040, 0.980, 0.335)"},{name:"easeInBack",curve:"cubic-bezier(0.600, -0.280, 0.735, 0.045)"},{name:"easeInOutCubic",curve:"cubic-bezier(0.645, 0.045, 0.355, 1.000)"},{name:"easeInOutQuad",curve:"cubic-bezier(0.455, 0.030, 0.515, 0.955)"},{name:"easeInOutQuart",curve:"cubic-bezier(0.770, 0.000, 0.175, 1.000)"},{name:"easeInOutQuint",curve:"cubic-bezier(0.860, 0.000, 0.070, 1.000)"},{name:"easeInOutSine",curve:"cubic-bezier(0.445, 0.050, 0.550, 0.950)"},{name:"easeInOutExpo",curve:"cubic-bezier(1.000, 0.000, 0.000, 1.000)"},{name:"easeInOutCirc",curve:"cubic-bezier(0.785, 0.135, 0.150, 0.860)"},{name:"easeInOutBack",curve:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},{name:"easeInOut",curve:"cubic-bezier(.42,0,.58,1)"},{name:"linear",curve:"linear"}],TweenManager.useCSSTrans=function(props,ease,object){return!props.math&&(("string"!=typeof ease||!ease.includes(["Elastic","Bounce"]))&&(!object.multiTween&&!TweenManager._inspectEase(ease).path&&!!Device.tween.transition))},TweenManager._detectTween=function(object,props,time,ease,delay,callback){return TweenManager.useCSSTrans(props,ease,object)?new CSSTransition(object,props,time,ease,delay,callback):new FrameTween(object,props,time,ease,delay,callback)},TweenManager._parseTransform=function(props){var transforms="",translate="";if(props.perspective>0&&(transforms+="perspective("+props.perspective+"px)"),void 0!==props.x||void 0!==props.y||void 0!==props.z){var x=props.x||0,y=props.y||0,z=props.z||0;translate+=x+"px, ",translate+=y+"px",Device.tween.css3d?transforms+="translate3d("+(translate+=", "+z+"px")+")":transforms+="translate("+translate+")"}return void 0!==props.scale?transforms+="scale("+props.scale+")":(void 0!==props.scaleX&&(transforms+="scaleX("+props.scaleX+")"),void 0!==props.scaleY&&(transforms+="scaleY("+props.scaleY+")")),void 0!==props.rotation&&(transforms+="rotate("+props.rotation+"deg)"),void 0!==props.rotationX&&(transforms+="rotateX("+props.rotationX+"deg)"),void 0!==props.rotationY&&(transforms+="rotateY("+props.rotationY+"deg)"),void 0!==props.rotationZ&&(transforms+="rotateZ("+props.rotationZ+"deg)"),void 0!==props.skewX&&(transforms+="skewX("+props.skewX+"deg)"),void 0!==props.skewY&&(transforms+="skewY("+props.skewY+"deg)"),transforms},TweenManager._clearCSSTween=function(obj){obj&&!obj._cssTween&&obj.div._transition&&!obj.persistTween&&(obj.div.style[CSS.styles.vendorTransition]="",obj.div._transition=!1,obj._cssTween=null)},TweenManager._isTransform=function(key){return TweenManager.Transforms.indexOf(key)>-1},TweenManager._getAllTransforms=function(object){for(var obj={},i=TweenManager.Transforms.length-1;i>-1;i--){var tf=TweenManager.Transforms[i],val=object[tf];0!==val&&"number"==typeof val&&(obj[tf]=val)}return obj};const prefix=function(){let pre="",dom="";if(window._NODE_||window._GLES_)pre="webkit",dom="WebKit";else{var styles=window.getComputedStyle(document.documentElement,"");pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1],dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1]}return{unprefixed:"ie"==Device.system.browser&&!Device.detect("msie 9"),dom:dom,lowercase:pre,css:"-"+pre+"-",js:("ie"==Device.system.browser?pre[0]:pre[0].toUpperCase())+pre.substr(1)}}();CSS.styles={},CSS.styles.vendor=prefix.unprefixed?"":prefix.js,CSS.styles.vendorTransition=CSS.styles.vendor.length?CSS.styles.vendor+"Transition":"transition",CSS.styles.vendorTransform=CSS.styles.vendor.length?CSS.styles.vendor+"Transform":"transform",CSS.vendor=prefix.css,CSS.transformProperty=function(){switch(prefix.lowercase){case"moz":return"-moz-transform";case"webkit":return"-webkit-transform";case"o":return"-o-transform";case"ms":return"-ms-transform";default:return"transform"}}(),CSS.tween={},CSS.tween.complete=prefix.unprefixed?"transitionend":prefix.lowercase+"TransitionEnd"}),Class(function CSSTransition(_object,_props,_time,_ease,_delay,_callback){function killed(){return!_this||_this.kill||!_object||!_object.div}function initProperties(){var transform=TweenManager._getAllTransforms(_object),properties=[];for(var key in _props)TweenManager._isTransform(key)?(transform.use=!0,transform[key]=_props[key],delete _props[key]):("number"==typeof _props[key]||key.includes(["-","color"]))&&properties.push(key);transform.use&&(properties.push(CSS.transformProperty),delete transform.use),_transformProps=transform,_transitionProps=properties}async function initCSSTween(values){if(!killed()){_object._cssTween&&(_object._cssTween.kill=!0),_object._cssTween=_this,_object.div._transition=!0;var strings=buildStrings(_time,_ease,_delay);_object.willChange(strings.props);var time=values?values.time:_time,delay=values?values.delay:_delay,props=values?values.props:_props,transformProps=values?values.transform:_transformProps;if(_this.time=_time,_this.delay=_delay,await defer(),await defer(),!killed()){if(_object.div.style[CSS.styles.vendorTransition]=strings.transition,_this.playing=!0,"safari"==Device.system.browser){if(Device.system.browserVersion<11&&await defer(),killed())return;_object.css(props),_object.transform(transformProps)}else _object.css(props),_object.transform(transformProps);Timer.create(function(){killed()||(clearCSSTween(),_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve())},time+delay)}}}function buildStrings(time,ease,delay){for(var props="",str="",len=_transitionProps.length,i=0;i<len;i++){var transitionProp=_transitionProps[i];props+=(props.length?", ":"")+transitionProp,str+=(str.length?", ":"")+transitionProp+" "+time+"ms "+TweenManager._getEase(ease)+" "+delay+"ms"}return{props:props,transition:str}}function clearCSSTween(){killed()||(_this.playing=!1,_object._cssTween=null,_object.willChange(null),_object=_props=null,Utils.nullObject(this))}const _this=this;let _transformProps,_transitionProps;this.playing=!0,function(){if("number"!=typeof _time)throw"CSSTween Requires object, props, time, ease";initProperties(),initCSSTween()}(),this.stop=function(){this.playing&&(this.kill=!0,this.playing=!1,_object.div.style[CSS.styles.vendorTransition]="",_object.div._transition=!1,_object.willChange(null),_object._cssTween=null,Utils.nullObject(this))},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise=Promise.create(),_this.completePromise}}),Class(function FrameTween(_object,_props,_time,_ease,_delay,_callback,_manual){function initValues(){_props.math&&delete _props.math,Device.tween.transition&&_object.div._transition&&(_object.div.style[CSS.styles.vendorTransition]="",_object.div._transition=!1),_this.time=_time,_this.delay=_delay,_endValues={},_transformEnd={},_transformStart={},_startValues={},_object.multiTween||(void 0===_props.x&&(_props.x=_object.x),void 0===_props.y&&(_props.y=_object.y),void 0===_props.z&&(_props.z=_object.z));for(var key in _props)if(key.includes(["damping","spring"]))_endValues[key]=_props[key],_transformEnd[key]=_props[key];else if(TweenManager._isTransform(key))_isTransform=!0,_transformStart[key]=_object[key]||("scale"==key?1:0),_transformEnd[key]=_props[key];else{_isCSS=!0;var v=_props[key];"string"==typeof v?_object.div.style[key]=v:"number"==typeof v&&(_startValues[key]=Number(_object.css(key)),_endValues[key]=v)}}function startTween(){!_object._cssTween||_manual||_object.multiTween||(_object._cssTween.kill=!0),_this.time=_time,_this.delay=_delay,_object.multiTween&&(_object._cssTweens||(_object._cssTweens=[]),_object._cssTweens.push(_this)),_object._cssTween=_this,_this.playing=!0,_props=copy(_startValues),_transformProps=copy(_transformStart),_isCSS&&(_cssTween=tween(_props,_endValues,_time,_ease,_delay,null,_manual).onUpdate(update).onComplete(tweenComplete)),_isTransform&&(_transformTween=tween(_transformProps,_transformEnd,_time,_ease,_delay,null,_manual).onComplete(_isCSS?null:tweenComplete).onUpdate(_isCSS?null:update))}function copy(obj){let newObj={};for(let key in obj)"number"==typeof obj[key]&&(newObj[key]=obj[key]);return newObj}function clear(){_object._cssTweens&&_object._cssTweens.remove(_this),_this.playing=!1,_object._cssTween=null,_object=_props=null}function update(){if(_isCSS&&_object.css(_props),_isTransform)if(_object.multiTween){for(var key in _transformProps)"number"==typeof _transformProps[key]&&(_object[key]=_transformProps[key]);_object.transform()}else _object.transform(_transformProps);_update&&_update()}function tweenComplete(){_this.playing&&(clear(),_callback&&_callback())}var _endValues,_transformEnd,_transformStart,_startValues,_isTransform,_isCSS,_transformProps,_cssTween,_transformTween,_update,_this=this;this.playing=!0,defer(function(){if(_this.overrideValues){let values=_this.overrideValues(_this,_object,_props,_time,_ease,_delay);values&&(_props=values.props||_props,_time=values.time||_time,_ease=values.ease||_ease,_delay=values.delay||_delay)}if("object"==typeof _ease&&(_ease="easeOutCubic"),_object&&_props){if("number"!=typeof _time)throw"FrameTween Requires object, props, time, ease";initValues(),startTween()}}),this.stop=function(){this.playing&&(_cssTween&&_cssTween.stop&&_cssTween.stop(),_transformTween&&_transformTween.stop&&_transformTween.stop(),clear())},this.interpolate=function(elapsed){_cssTween&&_cssTween.interpolate(elapsed),_transformTween&&_transformTween.interpolate(elapsed),update()},this.getValues=function(){return{start:_startValues,transformStart:_transformStart,end:_endValues,transformEnd:_transformEnd}},this.setEase=function(ease){_cssTween&&_cssTween.setEase(ease),_transformTween&&_transformTween.setEase(ease)},this.onUpdate=function(){return this},this.onComplete=function(callback){return _callback=callback,this}}),Class(function Interaction(_object){function Vec2(){this.x=0,this.y=0,this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}function addHandlers(){_object==Stage||_object==__window?Interaction.bind("touchstart",down):_object.bind("touchstart",down),Interaction.bind("touchmove",move),Interaction.bind("touchend",up)}function down(e){_this.isTouching=!0,e.touches&&"number"==typeof e.touches[0].force&&(e.force=e.touches[0].force),_this.x=e.x,_this.y=e.y,_this.hold.x=_this.last.x=e.x,_this.hold.y=_this.last.y=e.y,_this.delta.x=_this.move.x=_this.velocity.x=0,_this.delta.y=_this.move.y=_this.velocity.y=0,_distance=0,_this.events.fire(Interaction.START,e,!0),_timeDown=_timeMove=Render.TIME}function move(e){_this.isTouching&&(_this.move.x=e.x-_this.hold.x,_this.move.y=e.y-_this.hold.y),e.touches&&"number"==typeof e.touches[0].force&&(e.force=e.touches[0].force),_this.x=e.x,_this.y=e.y,_this.delta.x=e.x-_this.last.x,_this.delta.y=e.y-_this.last.y,_this.last.x=e.x,_this.last.y=e.y,_distance+=_this.delta.length();let delta=Math.max(.001,Render.TIME-(_timeMove||Render.TIME));_timeMove=Render.TIME,_this.velocity.x=Math.abs(_this.delta.x)/delta,_this.velocity.y=Math.abs(_this.delta.y)/delta,_this.events.fire(Interaction.MOVE,e,!0),_this.isTouching&&_this.events.fire(Interaction.DRAG,e,!0)}function up(e){_this.isTouching&&(_this.isTouching=!1,_this.move.x=0,_this.move.y=0,Math.max(.001,Render.TIME-(_timeMove||Render.TIME))>100&&(_this.delta.x=0,_this.delta.y=0),_distance<20&&Render.TIME-_timeDown<2e3&&_this.events.fire(Interaction.CLICK,e,!0),_this.events.fire(Interaction.END,e,!0))}Inherit(this,Events);const _this=this;this.x=0,this.y=0,this.hold=new Vec2,this.last=new Vec2,this.delta=new Vec2,this.move=new Vec2,this.velocity=new Vec2;let _distance,_timeDown,_timeMove;!function(){if(!_object instanceof HydraObject)throw"Interaction.Input requires a HydraObject";addHandlers()}(),this.destroy=function(){return Interaction.unbind("touchstart",down),Interaction.unbind("touchmove",move),Interaction.unbind("touchend",up),_object&&_object.unbind&&_object.unbind("touchstart",down),this._destroy&&this._destroy()}},()=>{function touchMove(e){_events.touchmove.forEach(c=>c(e))}function touchStart(e){_events.touchstart.forEach(c=>c(e))}function touchEnd(e){_events.touchend.forEach(c=>c(e))}Namespace(Interaction),Interaction.CLICK="interaction_click",Interaction.START="interaction_start",Interaction.MOVE="interaction_move",Interaction.DRAG="interaction_drag",Interaction.END="interaction_end";const _events={touchstart:[],touchmove:[],touchend:[]};Hydra.ready(()=>{__window.bind("touchstart",touchStart),__window.bind("touchmove",touchMove),__window.bind("touchend",touchEnd),__window.bind("touchcancel",touchEnd),__window.bind("contextmenu",touchEnd)}),Interaction.bind=function(evt,callback){_events[evt].push(callback)},Interaction.unbind=function(evt,callback){_events[evt].remove(callback)}}),Class(function Mouse(){function init(){_this.input=new Interaction(__window),_this.events.sub(_this.input,Interaction.START,update),_this.events.sub(_this.input,Interaction.MOVE,update),_this.events.sub(_this.input,Interaction.END,end),_this.hold=_this.input.hold,_this.last=_this.input.last,_this.delta=_this.input.delta,_this.move=_this.input.move,_this.velocity=_this.input.velocity,defer(()=>{_this.events.sub(Events.RESIZE,resize),resize()})}function update(e){_this.x=e.x,_this.y=e.y,Stage.width&&Stage.height&&(_this.normal.x=e.x/Stage.width-_offset.x,_this.normal.y=e.y/Stage.height-_offset.y,_this.tilt.x=2*_this.normal.x-1,_this.tilt.y=1-2*_this.normal.y,_this.inverseNormal.x=_this.normal.x,_this.inverseNormal.y=1-_this.normal.y)}function end(e){Device.mobile&&_this.resetOnRelease&&update(_this.resetOnRelease)}function resize(){Stage.css("top")&&(_offset.y=Stage.css("top")/Stage.height),Stage.css("left")&&(_offset.x=Stage.css("left")/Stage.width)}Inherit(this,Events);const _this=this;this.x=0,this.y=0,this.normal={x:0,y:0},this.tilt={x:0,y:0},this.inverseNormal={x:0,y:0},this.resetOnRelease=!1;const _offset={x:0,y:0};Hydra.ready(init)},"Static"),Class(function Assets(){function parseResolution(path){if(!window.ASSETS||!ASSETS.RES)return path;var res=ASSETS.RES[path],ratio=Math.min(Device.pixelRatio,3);if(!res)return path;if(!res["x"+ratio])return path;var split=path.split("/"),file=split[split.length-1];return split=file.split("."),path.replace(file,split[0]+"-"+ratio+"x."+split[1])}function AssetList(arr){return arr.__proto__=AssetList.prototype,arr}const _this=this;this.__loaded=[],this.FLIPY=!0,this.CDN="",this.CORS=null,this.IMAGES={},this.SDF={},this.JSON={push:function(prop,value){this[prop]=value,Object.defineProperty(this,prop,{get:()=>JSON.parse(JSON.stringify(value))})}},Object.defineProperty(this.JSON,"push",{enumerable:!1,writable:!0}),this.SVG={},AssetList.prototype=new Array,AssetList.prototype.filter=function(items){for(let i=this.length-1;i>=0;i--)this[i].includes(items)||this.splice(i,1);return this},AssetList.prototype.exclude=function(items){for(let i=this.length-1;i>=0;i--)this[i].includes(items)&&this.splice(i,1);return this},AssetList.prototype.prepend=function(prefix){for(let i=this.length-1;i>=0;i--)this[i]=prefix+this[i];return this},AssetList.prototype.append=function(suffix){for(let i=this.length-1;i>=0;i--)this[i]=this[i]+suffix;return this},this.list=function(){return window.ASSETS||console.warn("ASSETS list not available"),new AssetList(window.ASSETS.slice(0)||[])},this.getPath=function(path){return~path.indexOf("//")?path:(path=parseResolution(path),this.CDN&&!~path.indexOf(this.CDN)&&(path=this.CDN+path),path)},this.loadImage=function(path,isStore){var img=new Image;return img.crossOrigin=this.CORS,img.src=_this.getPath(path),img.loadPromise=function(){let promise=Promise.create();return img.onload=promise.resolve,promise},isStore&&(this.IMAGES[path]=img),img},this.decodeImage=function(path,flipY){let promise=Promise.create();if(window.createImageBitmap&&Device.system.browser.includes("chrome")){let img=_this.loadImage(path);img.onload=function(){flipY="boolean"==typeof flipY?flipY:_this.FLIPY,createImageBitmap(img,{imageOrientation:flipY?"flipY":"none"}).then(imgBmp=>{promise.resolve(imgBmp)})}}else{let img=_this.loadImage(path);img.onload=(()=>promise.resolve(img))}return promise}},"static"),Class(function AssetLoader(_assets,_callback,ASSETS=Assets){function init(){if(!_assets.length)return complete();for(let i=0;i<AssetLoader.SPLIT;i++)_assets.length&&loadAsset()}function loadAsset(){function loaded(){timeout&&clearTimeout(timeout),increment(),_assets.length&&loadAsset()}let path=_assets.splice(_assets.length-1,1)[0];const name=path.split("assets/").last().split(".")[0],ext=path.split(".").last().split("?")[0].toLowerCase();let timeout=Timer.create(timedOut,AssetLoader.TIMEOUT,path);if(~Assets.__loaded.indexOf(path))return loaded();if(ext.includes(["jpg","jpeg","png","gif"])){let image=ASSETS.loadImage(path);return image.complete?loaded():(image.onload=loaded,void(image.onerror=loaded))}if(window.AURA&&window.AURA.import&&"js"==ext)return AURA.import(path),void loaded();if("js"==ext){let s=document.createElement("script");return s.src=path,s.async=!0,document.head.appendChild(s),void(s.onload=loaded)}get(Assets.getPath(path),Assets.HEADERS).then(data=>{Assets.__loaded.push(path),"json"==ext&&ASSETS.JSON.push(name,data),"svg"==ext&&(ASSETS.SVG[name]=data),"fnt"==ext&&(ASSETS.SDF[name.split("/")[1]]=data),ext.includes(["fs","vs","glsl"])&&window.Shaders&&Shaders.parse(data,path),loaded()}).catch(e=>{console.warn(e),loaded()})}function increment(){_this.events.fire(Events.PROGRESS,{percent:++_loaded/_total}),_loaded==_total&&defer(complete)}function complete(){defer(()=>{_callback&&_callback(),_this.events.fire(Events.COMPLETE)})}function timedOut(path){console.warn("Asset timed out",path)}Inherit(this,Events);const _this=this;let _total=_assets.length,_loaded=0;!function(){if(!Array.isArray(_assets))throw"AssetLoader requires array of assets to load";_assets=_assets.slice(0).reverse(),init()}(),this.add=function(num){_total+=num||1},this.trigger=function(num){for(let i=0;i<(num||1);i++)increment()}},()=>{AssetLoader.SPLIT=2,AssetLoader.TIMEOUT=5e3,AssetLoader.loadAllAssets=function(callback){let promise=Promise.create();return callback||(callback=promise.resolve),promise.loader=new AssetLoader(Assets.list(),()=>{callback&&callback(),promise.loader&&promise.loader.destroy&&(promise.loader=promise.loader.destroy())}),promise},AssetLoader.loadAssets=function(list,callback){let promise=Promise.create();return callback||(callback=promise.resolve),promise.loader=new AssetLoader(list,()=>{callback&&callback(),promise.loader&&promise.loader.destroy&&(promise.loader=promise.loader.destroy())}),promise},AssetLoader.waitForLib=function(name,callback){function check(){window[name]&&(Render.stop(check),callback&&callback())}let promise=Promise.create();return callback||(callback=promise.resolve),Render.start(check),promise}}),Class(function Mobile(){function addHandlers(){_this.events.sub(Events.RESIZE,resize),Device.mobile.native||window.addEventListener("touchstart",preventNativeScroll,{passive:!1})}function preventNativeScroll(e){if(_this.isAllowNativeScroll)return;let target=e.target;if("INPUT"==target.nodeName||"TEXTAREA"==target.nodeName||"SELECT"==target.nodeName||"A"==target.nodeName)return;let prevent=!0;for(;target.parentNode&&prevent;)target._scrollParent&&(prevent=!1),target=target.parentNode;prevent&&e.preventDefault()}function resize(){updateOrientation(),checkResizeRefresh(),_this.isAllowNativeScroll||(document.body.scrollTop=0)}function updateOrientation(){_this.orientation=Stage.width>Stage.height?"landscape":"portrait",_this.orientationSet&&(window.Fullscreen.isOpen||Device.mobile.pwa)&&window.screen&&window.screen.orientation.lock&&window.screen.orientation.lock(_this.orientationSet)}Inherit(this,Component),Namespace(this);const _this=this;Hydra.ready(()=>{Device.mobile&&(addHandlers(),"safari"!=Device.system.browser||Device.mobile.native||(__body.css({height:"100%"}).div.scrollTop=0),Device.mobile.native&&Stage.css({width:"100vw",height:"100vh"}))});const checkResizeRefresh=function(){let _lastWidth;return function(){_this.isPreventResizeReload||_lastWidth!=Stage.width&&(_lastWidth=Stage.width,("ios"===Device.system.os||"android"==Device.system.os&&Device.system.version>=7)&&(!Device.mobile.tablet||Math.max(Stage.width,Stage.height)>800||window.location.reload()))}}();this.vibrate=function(duration){navigator.vibrate&&navigator.vibrate(duration)},this.fullscreen=function(){if(Device.mobile&&!Device.mobile.native&&!Device.mobile.pwa&&!Dev.emulator){if(!window.Fullscreen)throw"Mobile.fullscreen requires Fullscreen module";"android"===Device.system.os&&(__window.bind("touchend",()=>{Fullscreen.open()}),_this.ScreenLock&&_this.ScreenLock.isActive&&window.onresize())}},this.setOrientation=function(orientation,isForce){if(_this.System&&_this.NativeCore.active)return _this.System.orientation=_this.System[orientation.toUpperCase()];if(_this.orientationSet=orientation,updateOrientation(),isForce){if(!_this.ScreenLock)throw"Mobile.setOrientation isForce argument requires ScreenLock module";"any"===orientation?_this.ScreenLock.unlock():_this.ScreenLock.lock()}},this.allowNativeScroll=function(){_this.isAllowNativeScroll=!0},this.preventResizeReload=function(){_this.isPreventResizeReload=!0},this._addOverflowScroll=function($obj){$obj.div._scrollParent=!0,Device.mobile.native||($obj.div._preventEvent=function(e){e.stopPropagation()},$obj.bind("touchmove",$obj.div._preventEvent))},this._removeOverflowScroll=function($obj){$obj.unbind("touchmove",$obj.div._preventEvent)},this.get("phone",()=>{throw"Mobile.phone is removed. Use Device.mobile.phone"}),this.get("tablet",()=>{throw"Mobile.tablet is removed. Use Device.mobile.tablet"}),this.get("os",()=>{throw"Mobile.os is removed. Use Device.system.os"})},"Static"),Class(function Dev(){function catchErrors(){window.onerror=function(message,file,line){var string=message+" ::: "+file+" : "+line;_alert&&alert(string),_post&&post(_post+"/api/data/debug",getDebugInfo(string)),_this.onError&&_this.onError(message,file,line)}}function getDebugInfo(string){var obj={};return obj.time=(new Date).toString(),obj.deviceId=_id,obj.err=string,obj.ua=Device.agent,obj.width=Stage.width,obj.height=Stage.height,obj.screenWidth=screen.width,obj.screenHeight=screen.height,obj}var _post,_alert,_inter,_timerName,_this=this,_id=Utils.timestamp();this.emulator=Device.mobile&&navigator.platform&&navigator.platform.toLowerCase().includes(["mac","windows"]),this.alertErrors=function(url){_alert=!0,"string"==typeof url&&(url=[url]);for(var i=0;i<url.length;i++)if(location.href.includes(url[i])||location.hash.includes(url[i]))return catchErrors()},this.postErrors=function(url,post){_post=post,"string"==typeof url&&(url=[url]);for(var i=0;i<url.length;i++)if(location.href.includes(url[i]))return catchErrors()},this.expose=function(name,val,force){(Hydra.LOCAL||force)&&(window[name]=val)},this.logServer=function(msg){_post&&post(_post+"/api/data/debug",getDebugInfo(msg))},this.unsupported=function(needsAlert){needsAlert&&alert("Hi! This build is not yet ready for this device, things may not work as expected. Refer to build schedule for when this device will be supported.")},this.checkForLeaks=function(flag,array){var matchArray=function(prop){if(!array)return!1;for(var i=0;i<array.length;i++)if(prop.includes(array[i]))return!0;return!1};clearInterval(_inter),flag&&(_inter=setInterval(function(){for(var prop in window)if(!prop.includes("webkit")&&"function"!=typeof window[prop]&&prop.length>2){if(prop.includes("_ga")||prop.includes("_typeface_js")||matchArray(prop))continue;var char1=prop.charAt(0),char2=prop.charAt(1);"_"!=char1&&"$"!=char1||char2.toUpperCase()}},1e3))},this.startTimer=function(name){_timerName=name||"Timer",console.time&&!window._NODE_?console.time(_timerName):_timer=performance.now()},this.stopTimer=function(){console.time&&!window._NODE_?console.timeEnd(_timerName):console.log("Render "+_timerName+": "+(performance.now()-_timer))},this.writeFile=function(file,data){if(!Hydra.LOCAL)return;let url=location.protocol+"//"+location.hostname+":8017"+location.pathname+file;post(url,data).then(e=>{"OK"!=e&&console.warn(`Unable to write to ${file}`)})},Hydra.LOCAL&&_this.checkForLeaks(!0)},"Static"),Class(function Service(){function initWorker(){_this.active=!0,navigator.serviceWorker.register("sw.js").then(handleRegistration).then(handleReady).then(handleError)}function checkCache(){Storage.get("service_cache")!=window._CACHE_&&_this.post("clearCache")}function getSWAssets(){if(!window.ASSETS.SW||_this.cached)return[];var assets=window.ASSETS.SW;return assets.forEach((asset,i)=>{asset.includes(".js")&&(asset=assets[i].replace(".js",".js?"+window._CACHE_))}),assets}function handleRegistration(e){}function handleReady(e){_this.ready=!0,_this.events.fire(Events.READY,e,!0),_sw=navigator.serviceWorker.controller,checkCache()}function handleError(e){e&&(_this.events.fire(Events.ERROR,e,!0),_this.active=!1)}function handleMessage(e){var data=e.data;data.evt&&_this.events.fire(data.evt,data)}Inherit(this,Component);var _sw,_this=this;this.active=!1,this.ready=!1,this.cached=!1,this.offline=!1,this.disabled=!1,this.init=function(){Hydra.ready(()=>{!("serviceWorker"in navigator)||Hydra.LOCAL&&""==location.port||window.process||_this.disabled||initWorker()})},this.cache=function(assets=[]){assets=Array.from(assets);_this.active&&_this.wait(_this,"ready",function(){_this.post("upload",{assets:assets,cdn:Assets.CDN,hostname:location.hostname,sw:getSWAssets(),offline:_this.offline}),Storage.set("service_cache",window._CACHE_),_this.cached=!0})},this.post=function(fn,data={}){if(!_this.active)return;_this.wait(_this,"ready",function(){let mc=new MessageChannel;mc.port1.onmessage=handleMessage,data.fn=fn,_sw&&_sw.postMessage(data,[mc.port2])})}},"static"),Class(function Storage(){function testStorage(){try{if(window.localStorage)try{window.localStorage.test=1,window.localStorage.removeItem("test"),_storage=!0}catch(e){_storage=!1}else _storage=!1}catch(e){_storage=!1}}function cookie(key,value,expires){var options;if(arguments.length>1&&(null===value||"object"!=typeof value)){if(options={},options.path="/",options.expires=expires||1,null===value&&(options.expires=-1),"number"==typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[encodeURIComponent(key),"=",options.raw?String(value):encodeURIComponent(String(value)),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var result,decode=(options=value||{}).raw?function(s){return s}:decodeURIComponent;return(result=new RegExp("(?:^|; )"+encodeURIComponent(key)+"=([^;]*)").exec(document.cookie))?decode(result[1]):null}var _storage;testStorage(),this.setCookie=function(key,value,expires){cookie(key,value,expires)},this.getCookie=function(key){return cookie(key)},this.set=function(key,value){null!=value&&"object"==typeof value&&(value=JSON.stringify(value)),_storage?null===value?window.localStorage.removeItem(key):window.localStorage[key]=value:cookie(key,value,365)},this.get=function(key){var val;if(val=_storage?window.localStorage[key]:cookie(key)){var char0;val.charAt&&(char0=val.charAt(0)),"{"!=char0&&"["!=char0||(val=JSON.parse(val)),"true"!=val&&"false"!=val||(val="true"==val)}return val}},"Static"),Class(function Thread(_class){function init(){let file=window._ES5_?"assets/js/hydra/hydra-thread-es5.js":"assets/js/hydra/hydra-thread.js";_callbacks={},_worker=new Worker(Thread.PATH+file)}function importClasses(){importClass(Utils),importClass(Component),importClass(Events),importClass(_class,!0)}function importClass(_class,scoped){if(_class){var code;if(scoped){code=(code=_class.toString().replace("{","!!!")).split("!!!")[1];for(var splitChar=window._MINIFIED_?"=":" ";code.includes("this");){var name=code.slice(code.indexOf("this.")).split("this.")[1].split(splitChar)[0];code=code.replace("this","self"),createMethod(name)}code=code.slice(0,-1)}else if("function"!=typeof _class){if((code=_class.constructor.toString()).includes("[native"))return;code=(_class.constructor._namespace?_class.constructor._namespace+".":"")+"Class("+code+', "static");'}else code=(_class._namespace?_class._namespace+".":"")+"Class("+_class.toString()+");";_worker.postMessage({code:code})}}function createMethod(name){_this[name]=function(message={},callback){let promise;return callback||(callback=(promise=Promise.create()).resolve),_this.send(name,message,callback),promise}}function addListeners(){_worker.addEventListener("message",workerMessage)}function workerMessage(e){if(e.data.console)console.log(e.data.message);else if(e.data.id)(callback=_callbacks[e.data.id])&&callback(e.data.message),delete _callbacks[e.data.id];else if(e.data.emit)(callback=_callbacks[e.data.evt])&&callback(e.data.msg);else{var callback=_callbacks.transfer;callback&&callback(e.data)}}Inherit(this,Component);var _worker,_callbacks,_this=this,_msg={};init(),importClasses(),addListeners(),this.on=function(evt,callback){_callbacks[evt]=callback},this.off=function(evt){delete _callbacks[evt]},this.loadFunction=function(){let names=[];for(var i=0;i<arguments.length;i++)(code=>{var split=(code=(code=code.toString()).replace("(","!!!")).split("!!!"),name=split[0].split(" ")[1];code="self."+name+" = function("+split[1],_worker.postMessage({code:code}),createMethod(name),names.push(name)})(arguments[i]);return names},this.importScript=function(path){_worker.postMessage({path:Thread.absolutePath(path),importScript:!0})},this.importClass=function(){for(var i=0;i<arguments.length;i++)importClass(arguments[i])},this.send=function(name,message,callback){if("string"==typeof name){(message=message||{}).fn=name}else callback=message,message=name;var id=Utils.timestamp();callback&&(_callbacks[id]=callback),message.transfer?(message.msg.id=id,message.msg.fn=message.fn,message.msg.transfer=!0,_worker.postMessage(message.msg,message.buffer)):(_msg.message=message,_msg.id=id,_worker.postMessage(_msg))},this.destroy=function(){if(_worker.terminate&&_worker.terminate(),this._destroy)return this._destroy()}},()=>{Thread.PATH="",Thread.absolutePath=function(path){if(window.AURA)return path;let base;try{if(document.getElementsByTagName("base").length>0){var a=document.createElement("a");a.href=document.getElementsByTagName("base")[0].href,base=a.pathname}}catch(e){}let pathname=base||location.pathname;pathname.includes("/index.html")&&(pathname=pathname.replace("/index.html",""));let port=Number(location.port)>1e3?`:${location.port}`:"";return path.includes("http")?path:location.protocol+"//"+(location.hostname+port+pathname+"/"+path).replace("//","/")}}),Class(function TweenManager(){function updateTweens(time){for(let i=_tweens.length-1;i>=0;i--){let tween=_tweens[i];tween.update?tween.update(time):_this._removeMathTween(tween)}}function stringToValues(str){for(var values=str.split("(")[1].slice(0,-1).split(","),i=0;i<values.length;i++)values[i]=parseFloat(values[i]);return values}function findEase(name){for(var eases=_this.CubicEases,i=eases.length-1;i>-1;i--)if(eases[i].name==name)return eases[i];return!1}Namespace(this);var _this=this,_tweens=[];this.CubicEases=[],Render.start(updateTweens),this._addMathTween=function(tween){_tweens.push(tween)},this._removeMathTween=function(tween){_tweens.remove(tween)},this._getEase=function(name,values){var ease=findEase(name);return!!ease&&(values?ease.path?ease.path.solve:ease.values:ease.curve)},this._inspectEase=function(name){return findEase(name)},this.tween=function(object,props,time,ease,delay,complete,isManual){"number"!=typeof delay&&(update=complete,complete=delay,delay=0);const tween=new MathTween(object,props,time,ease,delay,complete,isManual);let usePromise=null;return complete&&complete instanceof Promise&&(usePromise=complete,complete=complete.resolve),usePromise||tween},this.clearTween=function(object){if(object._mathTween&&object._mathTween.stop&&object._mathTween.stop(),object._mathTweens){for(var tweens=object._mathTweens,i=0;i<tweens.length;i++){var tw=tweens[i];tw&&tw.stop&&tw.stop()}object._mathTweens=null}},this.addCustomEase=function(ease){var add=!0;if("object"!=typeof ease||!ease.name||!ease.curve)throw"TweenManager :: addCustomEase requires {name, curve}";for(var i=_this.CubicEases.length-1;i>-1;i--)ease.name==_this.CubicEases[i].name&&(add=!1);if(add){if("m"==ease.curve.charAt(0).toLowerCase()){if(!window.EasingPath)throw"Using custom eases requires easingpath module";ease.path=new EasingPath(ease.curve)}else ease.values=stringToValues(ease.curve);_this.CubicEases.push(ease)}return ease},Math.interpolate=function(start,end,alpha,ease){const fn=_this.Interpolation.convertEase(ease);return Math.mix(start,end,"function"==typeof fn?fn(alpha):_this.Interpolation.solve(fn,alpha))},window.tween=this.tween,window.clearTween=this.clearTween},"Static"),TweenManager.Class(function Interpolation(){function calculateBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function getTForX(aX,mX1,mX2){for(var aGuessT=aX,i=0;i<4;i++){var currentSlope=getSlope(aGuessT,mX1,mX2);if(0==currentSlope)return aGuessT;aGuessT-=(calculateBezier(aGuessT,mX1,mX2)-aX)/currentSlope}return aGuessT}function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}this.convertEase=function(ease){var fn=function(){switch(ease){case"easeInQuad":return TweenManager.Interpolation.Quad.In;case"easeInCubic":return TweenManager.Interpolation.Cubic.In;case"easeInQuart":return TweenManager.Interpolation.Quart.In;case"easeInQuint":return TweenManager.Interpolation.Quint.In;case"easeInSine":return TweenManager.Interpolation.Sine.In;case"easeInExpo":return TweenManager.Interpolation.Expo.In;case"easeInCirc":return TweenManager.Interpolation.Circ.In;case"easeInElastic":return TweenManager.Interpolation.Elastic.In;case"easeInBack":return TweenManager.Interpolation.Back.In;case"easeInBounce":return TweenManager.Interpolation.Bounce.In;case"easeOutQuad":return TweenManager.Interpolation.Quad.Out;case"easeOutCubic":return TweenManager.Interpolation.Cubic.Out;case"easeOutQuart":return TweenManager.Interpolation.Quart.Out;case"easeOutQuint":return TweenManager.Interpolation.Quint.Out;case"easeOutSine":return TweenManager.Interpolation.Sine.Out;case"easeOutExpo":return TweenManager.Interpolation.Expo.Out;case"easeOutCirc":return TweenManager.Interpolation.Circ.Out;case"easeOutElastic":return TweenManager.Interpolation.Elastic.Out;case"easeOutBack":return TweenManager.Interpolation.Back.Out;case"easeOutBounce":return TweenManager.Interpolation.Bounce.Out;case"easeInOutQuad":return TweenManager.Interpolation.Quad.InOut;case"easeInOutCubic":return TweenManager.Interpolation.Cubic.InOut;case"easeInOutQuart":return TweenManager.Interpolation.Quart.InOut;case"easeInOutQuint":return TweenManager.Interpolation.Quint.InOut;case"easeInOutSine":return TweenManager.Interpolation.Sine.InOut;case"easeInOutExpo":return TweenManager.Interpolation.Expo.InOut;case"easeInOutCirc":return TweenManager.Interpolation.Circ.InOut;case"easeInOutElastic":return TweenManager.Interpolation.Elastic.InOut;case"easeInOutBack":return TweenManager.Interpolation.Back.InOut;case"easeInOutBounce":return TweenManager.Interpolation.Bounce.InOut;case"linear":return TweenManager.Interpolation.Linear.None}}();if(!fn){var curve=TweenManager._getEase(ease,!0);fn=curve||TweenManager.Interpolation.Cubic.Out}return fn},this.solve=function(values,elapsed){return values[0]==values[1]&&values[2]==values[3]?elapsed:calculateBezier(getTForX(elapsed,values[0],values[2]),values[1],values[3])},this.Linear={None:function(k){return k}},this.Quad={In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)}},this.Cubic={In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},this.Quart={In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-.5*((k-=2)*k*k*k-2)}},this.Quint={In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},this.Sine={In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},this.Expo={In:function(k){return 0===k?0:Math.pow(1024,k-1)},Out:function(k){return 1===k?1:1-Math.pow(2,-10*k)},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(2-Math.pow(2,-10*(k-1)))}},this.Circ={In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},this.Elastic={In:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),-a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1)},InOut:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),(k*=2)<1?a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*-.5:a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1)}},this.Back={In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?k*k*((s+1)*k-s)*.5:.5*((k-=2)*k*((s+1)*k+s)+2)}},this.Bounce={In:function(k){return 1-this.Bounce.Out(1-k)},Out:function(k){return k<1/2.75?7.5625*k*k:k<2/2.75?7.5625*(k-=1.5/2.75)*k+.75:k<2.5/2.75?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return k<.5?.5*this.Bounce.In(2*k):.5*this.Bounce.Out(2*k-1)+.5}}},"Static"),Class(function MathTween(_object,_props,_time,_ease,_delay,_callback,_manual){function start(){_object.multiTween||!_object._mathTween||_manual||TweenManager.clearTween(_object),_manual||TweenManager._addMathTween(_this),_this.time=_time,_this.delay=_delay;let propString=getPropString();_object._mathTween=_this,_object.multiTween&&(_object._mathTweens||(_object._mathTweens=[]),_object._mathTweens.forEach(t=>{t.props==propString&&t.tween.stop()}),_this._tweenWrapper={props:propString,tween:_this},_object._mathTweens.push(_this._tweenWrapper)),"string"==typeof _ease&&(_ease=TweenManager.Interpolation.convertEase(_ease),_easeFunction="function"==typeof _ease),_startTime=performance.now(),_startTime+=_delay,_endValues=_props,_startValues={},_props.spring&&(_spring=_props.spring),_props.damping&&(_damping=_props.damping),_this.startValues=_startValues;for(var prop in _endValues)"number"==typeof _object[prop]&&(_startValues[prop]=_object[prop])}function getPropString(){let string="";for(let key in _props)"number"==typeof _props[key]&&(string+=key+" ");return string}function clear(){if(!_object&&!_props)return!1;_object._mathTween=null,TweenManager._removeMathTween(_this),Utils.nullObject(_this),_object._mathTweens&&_object._mathTweens.remove(_this._tweenWrapper)}var _startTime,_startValues,_endValues,_easeFunction,_paused,_newEase,_spring,_damping,_update,_this=this,_elapsed=0;defer(function(){if(_this.overrideValues){let values=_this.overrideValues(_this,_object,_props,_time,_ease,_delay);values&&(_props=values.props||_props,_time=values.time||_time,_ease=values.ease||_ease,_delay=values.delay||_delay)}if(_object&&_props){if("number"!=typeof _time)throw"MathTween Requires object, props, time, ease";start()}}),this.update=function(time){if(_paused||time<_startTime)return;_elapsed=(_elapsed=(time-_startTime)/_time)>1?1:_elapsed;let delta=this.interpolate(_elapsed);_update&&_update(delta),1==_elapsed&&(_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve(),clear())},this.pause=function(){_paused=!0},this.resume=function(){_paused=!1,_startTime=performance.now()-_elapsed*_time},this.stop=function(){return _this.stopped=!0,clear(),null},this.setEase=function(ease){_newEase!=ease&&(_newEase=ease,_ease=TweenManager.Interpolation.convertEase(ease),_easeFunction="function"==typeof _ease)},this.getValues=function(){return{start:_startValues,end:_endValues}},this.interpolate=function(elapsed){var delta=_easeFunction?_ease(elapsed,_spring,_damping):TweenManager.Interpolation.solve(_ease,elapsed);for(var prop in _startValues)if("number"==typeof _startValues[prop]&&"number"==typeof _endValues[prop]){var start=_startValues[prop],end=_endValues[prop];_object[prop]=start+(end-start)*delta}return delta},this.onUpdate=function(callback){return _update=callback,this},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise=Promise.create(),_this.completePromise}}),Class(function TweenTimeline(){function calculate(){_tweens.sort(function(a,b){const ta=a.time+a.delay;return b.time+b.delay-ta});const first=_tweens[0];_total=first.time+first.delay}function loop(){let time=_this.elapsed*_total;for(let i=_tweens.length-1;i>-1;i--){let t=_tweens[i],relativeTime=time-t.delay,elapsed=Math.clamp(relativeTime/t.time,0,1);t.interpolate(elapsed)}_this.events.fire(Events.UPDATE,_this,!0)}Inherit(this,Component);const _this=this;let _tween,_total=0;const _tweens=[];this.elapsed=0,this.get("timeRemaining",()=>_total-_this.elapsed*_total),this.add=function(object,props,time,ease,delay){let tween;return tween=object instanceof HydraObject?new FrameTween(object,props,time,ease,delay,null,!0):new MathTween(object,props,time,ease,delay,null,!0),_tweens.push(tween),defer(calculate),tween},this.tween=function(to,time,ease,delay,callback){_this.clearTween(),_tween=tween(_this,{elapsed:to},time,ease,delay).onUpdate(loop).onComplete(callback)},this.clearTween=function(){_tween&&_tween.stop&&_tween.stop()},this.startRender=function(){Render.start(loop)},this.stopRender=function(){Render.stop(loop)},this.update=function(){loop()},this.destroy=function(){_this.clearTween(),Render.stop(loop);for(var i=0;i<_tweens.length;i++)_tweens[i].stop()}}),Class(function PushState(_isHash){function addHandlers(){if(_isHash)return window.addEventListener("hashchange",()=>handleStateChange(getState()),!1);window.onpopstate=history.onpushstate=(()=>handleStateChange(getState()))}function getState(){return _isHash?String(window.location.hash.slice(3)):("/"!==_root?location.pathname.split(_root)[1]:location.pathname.slice(1))||""}function handleStateChange(state){if(state!==_store)if(_this.isLocked){if(!_store)return;_isHash?window.location.hash="!/"+_store:window.history.pushState(null,null,_root+_store)}else _store=state,_this.events.fire(Events.UPDATE,{value:state,split:state.split("/")})}const _this=this;let _store,_root="";"boolean"!=typeof _isHash&&(_isHash=Hydra.LOCAL||!Device.system.pushstate),this.isLocked=!1,addHandlers(),_store=getState(),this.getState=function(){return Device.mobile.native?Storage.get("app_state")||"":getState()},this.setRoot=function(root){_root="/"===root.charAt(0)?root:"/"+root},this.setState=function(state){if(Device.mobile.native&&Storage.set("app_state",state),state!==_store)return _store=state,_isHash?window.location.hash="!/"+state:window.history.pushState(null,null,_root+state),!0},this.replaceState=function(state){state!==_store&&(_store=state,_isHash?window.location.hash="!/"+state:window.history.replaceState(null,null,_root+state))},this.setTitle=function(title){document.title=title},this.lock=function(){this.isLocked=!0},this.unlock=function(){this.isLocked=!1},this.useHash=function(){_isHash=!0}}),Class(function Data(){function addListeners(){_this.events.sub(Experience.STATE_UPDATE,setState)}function setState(e){_this.setState(e.state)}Inherit(this,Model),Inherit(this,PushState,!0);const _this=this;!async function(){await Hydra.ready(),_this.dataReady=!0,addListeners()}()},"static"),window.ASSETS=["assets/images/background/mars.jpg","assets/images/background/open.jpg","assets/images/grid-color.png","assets/images/particle.jpg","assets/images/rover/arrow.jpg","assets/images/rover/code.jpg","assets/images/rover/holes.jpg","assets/images/rover/mars.jpg","assets/images/rover/open-ao.jpg","assets/images/rover/screen/glow.jpg","assets/images/rover/screen/glow2.jpg","assets/images/rover/screen/signup/0-glow.jpg","assets/images/rover/screen/signup/0.jpg","assets/images/rover/screen/signup/1-glow.jpg","assets/images/rover/screen/signup/1.jpg","assets/images/rover/screen/signup/2-glow.jpg","assets/images/rover/screen/signup/2.jpg","assets/images/rover/screen/signup/3-glow.jpg","assets/images/rover/screen/signup/3.jpg","assets/images/rover/screen/sprite.jpg","assets/images/rover/screen/sprite2.jpg","assets/images/rover/tread-normal.jpg","assets/images/terrain/diffuse.jpg","assets/images/terrain/grid.jpg","assets/images/terrain/height.jpg","assets/images/terrain/normal.jpg","assets/images/terrain/rock-diffuse.jpg","assets/images/ui/arrow.svg","assets/images/ui/arrows.png","assets/images/ui/facebook.svg","assets/images/ui/instagram.svg","assets/images/ui/joystick.png","assets/images/ui/keyboard.png","assets/images/ui/logo-cit.png","assets/images/ui/logo-jpl.png","assets/images/ui/logo-nasa.png","assets/images/ui/logo.png","assets/images/ui/rotate.png","assets/images/ui/signup/book.png","assets/images/ui/signup/dollar.png","assets/images/ui/signup/group.png","assets/images/ui/signup/icon-users.png","assets/images/ui/signup/tools.png","assets/images/ui/thumb.png","assets/images/ui/twitter.svg","assets/js/lib/three.min.js","assets/data/uil.json","assets/shaders/compiled.vs"],ASSETS.SW=["assets/fonts/opensans-bold.woff","assets/fonts/opensans-bold.woff2","assets/fonts/opensans-bolditalic.woff","assets/fonts/opensans-bolditalic.woff2","assets/fonts/opensans-extrabold.woff","assets/fonts/opensans-extrabold.woff2","assets/fonts/opensans-extrabolditalic.woff","assets/fonts/opensans-extrabolditalic.woff2","assets/fonts/opensans-italic.woff","assets/fonts/opensans-italic.woff2","assets/fonts/opensans-light.woff","assets/fonts/opensans-light.woff2","assets/fonts/opensans-lightitalic.woff","assets/fonts/opensans-lightitalic.woff2","assets/fonts/opensans-regular.woff","assets/fonts/opensans-regular.woff2","assets/fonts/opensans-semibold.woff","assets/fonts/opensans-semibold.woff2","assets/fonts/opensans-semibolditalic.woff","assets/fonts/opensans-semibolditalic.woff2","assets/fonts/titillium-bold-webfont.woff","assets/fonts/titillium-bold-webfont.woff2","assets/fonts/titillium-light-webfont.woff","assets/fonts/titillium-light-webfont.woff2","assets/fonts/titillium-regular-webfont.woff","assets/fonts/titillium-regular-webfont.woff2","assets/fonts/titillium-semibold-webfont.woff","assets/fonts/titillium-semibold-webfont.woff2","assets/fonts/titillium-thin-webfont.woff","assets/fonts/titillium-thin-webfont.woff2","assets/css/style.css","assets/js/app.js"],Class(function Config(){this.UI_PADDING=Device.mobile.phone?30:55,this.ANALYTICS_ID="UA-117250321-1",this.LANDING_TITLE=[{text:"Ever wanted to build"},{text:"your own Mars rover?"},{text:"Well now, you can.",bold:!0,delay:1e3}],this.LANDING_SUBTITLE=["WE DESIGNED. NOW YOU BUILD"],this.EXPLORE_INTRO=['We designed a driving 6-wheel rover with almost the same suspension system as the <a href="https://mars.nasa.gov" target=_blank>real rovers on Mars</a>, but using only commonly available components that you can easily buy online and assemble in a garage.',"We provide the parts list and the build instructions, you provide the hands, brains, and elbow grease to put it all together."],this.EXPLORE_TITLE=[{text:"JPL's Open Source"},{text:"Build-It-Yourself Rover",bold:!0}],this.EXPLORE_SUBTITLE=["INTRODUCTION"],this.EXPLORE_INSTRUCTION=(Device.mobile?"TAP":"CLICK")+" THE HOTSPOTS TO LEARN MORE",this.SCROLL_INSTRUCTION="SCROLL DOWN TO GET STARTED",this.SIGNUP_TITLE=[{text:"Space Robots for Everyone"}],this.SIGNUP_SUBTITLE=["GET STARTED"],this.SIGNUP_INFO=[{title:"High School and Beyond",icon:"group.png",copy:"We designed our instructions to be easy to follow by high school students and enthusiasts."},{title:"Detailed Instructions",icon:"book.png",copy:"Our detailed parts list and step-by-step instructions are easy to understand, tested by the community, and should make building a breeze... even if this is your first robot!"},{title:"Reasonable Cost",icon:"dollar.png",copy:"You can build this rover for less than $2,500."},{title:"Improve & Share",icon:"tools.png",copy:"The rover was built to be improved. Share your ideas and improvements with the world and see how other groups are improving on the original design!"}],this.SIGNUP_HEADER="Ready to start building?",this.SIGNUP_COPY="Get started here:",this.TWITTER_SHARE="JPL's Open Source Build-It-Yourself Rover. Build your very own Mars rover at home!",this.REDDIT_LINK="http://s15.zetaboards.com/JPL_OpenSource_Rover/index/",this.GITHUB_LINK="https://github.com/nasa-jpl/open-source-rover",this.FOOTER='<a role="link" href="http://www.nasa.gov/" target="_blank">NASA</a>&nbsp;&nbsp;\n                   <a role="link" href="http://www.caltech.edu/" target="_blank">CALTECH</a>&nbsp;&nbsp;\n                   <a role="link" href="https://www.jpl.nasa.gov/copyrights.php" target="_blank">PRIVACY</a>&nbsp;&nbsp;\n                   <a role="link" href="https://www.jpl.nasa.gov/imagepolicy/" target="_blank">IMAGE POLICY</a>&nbsp;&nbsp;\n                   <a role="link" href="https://www.jpl.nasa.gov/faq.php" target="_blank">FAQ</a>&nbsp;&nbsp;\n                   <a role="link" href="https://www.jpl.nasa.gov/contact_JPL.php" target="_blank">FEEDBACK</a>&nbsp;&nbsp; \n                   Site Manager: Michael Cox'},"static"),Class(function ConfigHotspots(){this.DATA={steering:{title:"Corner Steering",body:["Each of the corner wheels can steer independently using corner steering motors, just like the real Mars rovers.","The corner steering allows the rover to make very delicate, precise turns instead of relying on “tank drive” to spin the rover around.","In addition, corner steering allows the rover to “turn in place”, meaning that it can spin around without needing to move forwards or backwards at all!"],animation:"RoverAnimationSteering"},wheels:{title:"Wheel & Tire Assembly",body:["The wheels on the Open Source Rover are made of rubber and are very soft.","This allows the wheel to bend and conform around the objects it’s climbing over, giving it excellent climbing ability and traction.","This is different from the wheels on the real Mars rovers, which have to be light yet still support a lot of weight and are therefore made out of metal."],animation:"RoverAnimationWheels"},rockerBogie:{title:"Rocker-Bogie<br>Suspension System",body:["The rocker-bogie suspension system was designed for extreme maneuverability on rocky, bumpy terrain like that on Mars.","It is specifically designed to keep all 6 wheels on the ground at all times, maximizing the rover's traction.","The suspension system on a normal car could get over a block that is about half as tall as the wheel, but a vehicle with rocker-bogie suspension can easily climb over a block that's more than 2 times the height of its wheel!"],animation:"RoverAnimationRockerBogie"},pivot:{title:"Differential Pivot",body:["Part of the rocker-bogie system, the differential pivot helps transfer weight from left to right across the rover and to keep it level.","When one side of the suspension system hits an obstacle like a rock, the differential pivot helps shift the rover’s weight over to the other side, moving weight off of the obstacle and onto the other wheels which have more traction.","This helps the rover conquer bigger obstacles without losing traction!"],animation:"RoverAnimationPivot"},chassis:{title:"Chassis & Electronics",body:["Inside the Open Source Rover lies the “brain” and all the electronics that the rover needs to control its motors and LED face.","It can be controlled by a smartphone app or a game controller out of the box, or you can program your own control system.","The body is made of lightweight Aluminum just like many components on the real Mars rovers.","The body of the Open Source Rover was also built with parts that have common mounting patterns so that you can design and build your own attachments so that your rover can do totally new things!"],animation:"RoverAnimationChassis"},face:{title:"LED Face",body:["The Curiosity Mars rover has a drilling laser (yes, a drilling laser) and advanced camera packages on its head.","The Open Source Rover has something a little less complicated and a lot more cute: a programmable red/green/blue LED array!","The face can be programmed through the rover’s software to take any shape you like, and included are some pre-built faces to give the rover some personality."],animation:"RoverAnimationFace"}}},"static"),Mobile.Class(function Accelerometer(){function updateAccel(e){switch(window.orientation){case 0:_this.x=-e.accelerationIncludingGravity.x,_this.y=e.accelerationIncludingGravity.y,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=e.rotationRate.beta*_this.toRadians,_this.rotationRate.beta=-e.rotationRate.alpha*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians);break;case 180:_this.x=e.accelerationIncludingGravity.x,_this.y=-e.accelerationIncludingGravity.y,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=-e.rotationRate.beta*_this.toRadians,_this.rotationRate.beta=e.rotationRate.alpha*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians);break;case 90:_this.x=e.accelerationIncludingGravity.y,_this.y=e.accelerationIncludingGravity.x,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=e.rotationRate.alpha*_this.toRadians,_this.rotationRate.beta=e.rotationRate.beta*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians);break;case-90:_this.x=-e.accelerationIncludingGravity.y,_this.y=-e.accelerationIncludingGravity.x,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=-e.rotationRate.alpha*_this.toRadians,_this.rotationRate.beta=-e.rotationRate.beta*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians)}"android"==Device.system.os&&(_this.x*=-1,_this.y*=-1,_this.z*=-1)}function updateOrientation(e){for(var key in e)key.toLowerCase().includes("heading")&&(_this.heading=e[key]);switch(window.orientation){case 0:_this.alpha=e.beta*_this.toRadians,_this.beta=-e.alpha*_this.toRadians,_this.gamma=e.gamma*_this.toRadians;break;case 180:_this.alpha=-e.beta*_this.toRadians,_this.beta=e.alpha*_this.toRadians,_this.gamma=e.gamma*_this.toRadians;break;case 90:_this.alpha=e.alpha*_this.toRadians,_this.beta=e.beta*_this.toRadians,_this.gamma=e.gamma*_this.toRadians;break;case-90:_this.alpha=-e.alpha*_this.toRadians,_this.beta=-e.beta*_this.toRadians,_this.gamma=e.gamma*_this.toRadians}_this.tilt=e.beta*_this.toRadians,_this.yaw=e.alpha*_this.toRadians,_this.roll=-e.gamma*_this.toRadians,"android"==Device.system.os&&(_this.heading=compassHeading(e.alpha,e.beta,e.gamma))}function compassHeading(alpha,beta,gamma){var degtorad=Math.PI/180,_x=beta?beta*degtorad:0,_y=gamma?gamma*degtorad:0,_z=alpha?alpha*degtorad:0,cY=(Math.cos(_x),Math.cos(_y)),cZ=Math.cos(_z),sX=Math.sin(_x),sY=Math.sin(_y),sZ=Math.sin(_z),Vx=-cZ*sY-sZ*sX*cY,Vy=-sZ*sY+cZ*sX*cY,compassHeading=Math.atan(Vx/Vy);return Vy<0?compassHeading+=Math.PI:Vx<0&&(compassHeading+=2*Math.PI),compassHeading*(180/Math.PI)}var _this=this;this.x=0,this.y=0,this.z=0,this.alpha=0,this.beta=0,this.gamma=0,this.heading=0,this.rotationRate={},this.rotationRate.alpha=0,this.rotationRate.beta=0,this.rotationRate.gamma=0,this.toRadians="ios"==Device.system.os?Math.PI/180:1,this.capture=function(){this.active||(this.active=!0,window.ondevicemotion=updateAccel,window.addEventListener("deviceorientation",updateOrientation))},this.stop=function(){this.active=!1,window.ondevicemotion=null,_this.x=_this.y=_this.z=0,window.removeEventListener("deviceorientation",updateOrientation)}},"Static"),Class(function Antimatter(_num,_renderer){function createBuffer(){AntimatterUtil.createBufferArray(_size,_num,function(geometry,vertices,attribs){_this.vertices=_this.vertices||new AntimatterAttribute(vertices,4),(_geometry=new THREE.BufferGeometry).addAttribute("position",new THREE.BufferAttribute(geometry,3)),_geometry.addAttribute("attribs",new THREE.BufferAttribute(attribs,4)),_this.vertices.geometry=_geometry,_this.attribs=new AntimatterAttribute(attribs),_this.init(_geometry,_renderer,_size)})}Inherit(this,AntimatterFBO);var _geometry,_this=this,_size=function findSize(){for(var values=[2,4,8,16,32,64,128,256,512,1024,2048],i=0;i<values.length;i++){var p2=values[i];if(p2*p2>=_num)return p2}}();this.particleCount=_num,function(){if(!window.Shader)throw"Antimatter requires hydra-three";defer(createBuffer)}(),this.createFloatArray=function(components){return new Float32Array(_size*_size*(components||3))},this.ready=function(callback){return _this.wait(_this,"vertices")},this.getMesh=function(unique="",shadow=!1){"boolean"==typeof unique&&(shadow=unique,unique="");var shader=_this.createShader(_this.fragmentShader||"void main() { gl_FragColor = vec4(1.0); }",unique,shadow);return _this.mesh=new THREE.Points(_geometry,shader.material),_this.mesh.frustumCulled=!1,shadow&&(_this.mesh.receiveShadow=!0,_this.mesh.castShadow=!0),_this.shader=shader,_this.geometry=_geometry,_this.mesh},this.createShader=function(fs,unique,shadow){var uniforms=_this.uniforms||{};let obj={unique:unique,receiveShadow:shadow,tPos:{type:"t",value:_this.vertices.texture}};for(let key in uniforms)obj[key]=uniforms[key];return new Shader(_this.vertexShader||"AntimatterPosition",fs,obj)},this.getLookupArray=function(){return new Float32Array(_this.vertices.geometry.attributes.position.array)}}),Class(function AntimatterAttribute(_data,_components){Inherit(this,Component);var _this=this,_size=Math.sqrt(_data.length/(_components||3));this.size=_size,this.count=_size*_size,this.buffer=_data,this.texture=new THREE.DataTexture(_data,_size,_size,4==_components?THREE.RGBAFormat:THREE.RGBFormat,THREE.FloatType),this.texture.needsUpdate=!0,this.set("needsUpdate",function(){_this.texture.needsUpdate=!0}),this.bufferData=function(data,components){_components=components,_data=data,_this.buffer=data,_this.texture&&_this.texture.dispose&&_this.texture.dispose(),_this.texture=new THREE.DataTexture(_data,_size,_size,4==_components?THREE.RGBAFormat:THREE.RGBFormat,THREE.FloatType),_this.texture.needsUpdate=!0},this.clone=function(){var array=new Float32Array(_data.length);return array.set(_data),new AntimatterAttribute(array,_components)},this.onDestroy=function(){_this.texture&&_this.texture.dispose&&_this.texture.dispose()}}),Class(function AntimatterFBO(){function initPasses(){_camera=new THREE.OrthographicCamera(_size/-2,_size/2,_size/2,_size/-2,1,1e3),_geometry=new THREE.PlaneBufferGeometry(2,2,1,1),_scene=new THREE.Scene,_mesh=new THREE.Mesh(_geometry,new THREE.MeshBasicMaterial),_scene.add(_mesh);var copyShader=AntimatterFBO.getCopyShader();_copy=new THREE.Mesh(_geometry,copyShader.material),_scene.add(_copy),_copy.visible=!1}function copy(input,output){_copy.visible=!0,_mesh.visible=!1,_copy.material.uniforms.tDiffuse.value=input,_renderer.render(_scene,_camera,output),_copy.visible=!1,_mesh.visible=!0}function postRender(callback){_callbacks.push(callback)}Inherit(this,Component);var _this,_gpuGeom,_renderer,_size,_scene,_mesh,_camera,_copy,_geometry,_output={type:"t",value:null},_callbacks=[];this.passes=[],this.init=function(geometry,renderer,size){_this=this,_gpuGeom=geometry.attributes.position.array,_renderer=renderer,_size=size,initPasses()},this.getGPUGeom=function(){return _gpuGeom},this.addPass=function(pass,index){var add=function(pass,index){"number"!=typeof index?_this.passes.push(pass):_this.passes.splice(index,0,pass)};(_this=this).passes.length?add(pass,index):postRender(function(){add(pass,index)})},this.findPass=function(name){for(var i=0;i<_this.passes.length;i++){var pass=_this.passes[i];if(pass.name==name)return pass}},this.removePass=function(pass){_this=this,"number"==typeof pass?_this.passes.splice(pass):_this.passes.remove(pass)},this.update=function(){if((_this=this).mesh){for(var output=_output.value||_this.vertices.texture,i=0;i<_this.passes.length;i++){var pass=_this.passes[i],needsInit=!pass.init,firstRender=!pass.first;needsInit&&pass.initialize(_size,_this.particleCount),pass.first=!0,_mesh.material=pass.shader.material,_mesh.material.uniforms.tInput.value=pass.lockIO?firstRender?pass.origin||_this.vertices.texture:pass.output:output,_mesh.material.uniforms.tValues.value=firstRender?i==_this.passes.length-1||(pass.origin?pass.origin.texture||pass.origin||_this.vertices.texture:null):pass.output,_mesh.material.uniforms.tPrev.value=firstRender?i==_this.passes.length-1?_this.vertices.texture:null:pass.getRead(),_mesh.material.uniforms.time.value=World.TIME.value;var rt=firstRender?pass.getRT(0):pass.getWrite(),output=pass.output;if(_renderer.render(_scene,_camera,rt),copy(rt,output),firstRender){if(copy(rt,pass.getRT(1)),copy(rt,pass.getRT(2)),pass.setRead(2),pass.setWrite(1),0==i&&_this.passes.length>1)return}else pass.swap()}output&&(_output.value=output,_this.mesh.material.uniforms.tPos=_output,_callbacks.length&&(_callbacks.forEach(function(c){c()}),_callbacks.length=0))}},this.onDestroy=function(){_geometry.dispose(),_this.vertices.destroy(),_this.passes.forEach(function(pass){pass.first=!1,_this.persistPasses||pass&&pass.destroy&&pass.destroy()}),_this.mesh.material.dispose(),_this.mesh.geometry.dispose()},this.getOutput=function(){return _output},this.setDepthMaterial=function(mesh,light,size=.5,shader="AntimatterDepth"){mesh.customDepthMaterial=new Shader(shader,{tPos:_output,pointSize:{type:"f",value:size},lightPos:{type:"v3",value:light.position},far:{type:"f",value:light.shadow.camera.far},receiveShadow:!0}).material}},function(){var _shader;AntimatterFBO.getCopyShader=function(){return _shader||((_shader=new Shader("AntimatterCopy","AntimatterCopy")).uniforms={tDiffuse:{type:"t",value:null}}),_shader}}),Class(function AntimatterPass(_shader,_uni,_clone){function prepareShader(size){var utils=Shaders.getShader("antimatter.glsl"),fragment=Shaders.getShader(_shader+".fs");let shader=["uniform sampler2D tInput;","uniform sampler2D tPrev;","uniform sampler2D tValues;","uniform float fSize;","uniform float fTotalNum;","uniform float time;","vec2 getUV() { return (gl_FragCoord.xy / fSize); }","bool notUsed() { return (gl_FragCoord.x * gl_FragCoord.y) > fTotalNum; }",utils,fragment=fragment.replace("@SIZE",size)].join("\n");return _this.onCreateShader&&(shader=_this.onCreateShader(shader)),shader}function initRT(size){var type="android"==Device.system.os?THREE.FloatType:THREE.HalfFloatType,parameters={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1,type:type},rt=new THREE.WebGLRenderTarget(size,size,parameters);return rt.texture.generateMipmaps=!1,rt}var _this=this;this.UILPrefix="am_"+_shader;var _uniforms={tInput:{type:"t",value:null},tPrev:{type:"t",value:null},tValues:{type:"t",value:null},time:{type:"f",value:0},fSize:{type:"f",value:64},fTotalNum:{type:"f",value:64}},_rts=[],_read=0,_write=0;this.uniforms=_uniforms,this.output=initRT(64),this.name=_shader,this.id=Utils.timestamp(),function(){if(_uni){_uni.unique&&(_this.UILPrefix+="_"+_uni.unique.replace("/","_"),delete _uni.unique);for(var key in _uni)_uniforms[key]=_uni[key]}}(),this.addInput=function(name,attribute){var uniform="object"!=typeof attribute||attribute.height||"string"!=typeof attribute.type?attribute instanceof AntimatterAttribute?{type:"t",value:attribute.texture}:{type:"t",value:attribute}:attribute;let lookup=UILStorage.parse(_this.UILPrefix+name);return lookup&&(uniform.value=lookup.value),_uniforms[name]=uniform,_uniforms[name]},this.getRT=function(index){return _rts[index]},this.getRead=function(){return _rts[_read]},this.getWrite=function(){return _rts[_write]},this.setRead=function(index){_read=index},this.setWrite=function(index){_write=index},this.swap=function(){++_write>2&&(_write=0),++_read>2&&(_read=0)},this.initialize=function(size,num){if(!_this.init){_this.init=!0;for(var i=0;i<3;i++)_rts.push(initRT(size));_this.output.setSize(size,size),_uniforms.fTotalNum.value=num,_shader instanceof Shader||((_shader=new Shader("AntimatterPass",prepareShader(size))).uniforms=_uniforms,_shader.UILPrefix=_this.UILPrefix,_shader.id=Utils.timestamp()),_this.shader=_shader,_shader.uniforms.fSize.value=size}},this.setUniform=function(key,value){_shader&&_shader.uniforms&&(_shader.uniforms[key].value=value)},this.tween=function(key,value,time,ease,delay,callback,update){return tween(_shader.uniforms[key],{value:value},time,ease,delay,callback,update)},this.clone=function(){return new AntimatterPass(_shader,_uni)},this.destroy=function(){_rts.forEach(function(rt){rt&&rt.dispose&&rt.dispose()})}}),Class(function AntimatterUtil(){function initThread(){(_thread=_this.initClass(Thread)).loadFunction(createBufferArray)}function createBufferArray(e,id){for(var size=e.size,num=e.num,position=new Float32Array(3*num),i=0;i<num;i++)position[3*i+0]=i%size/size,position[3*i+1]=Math.floor(i/size)/size,position[3*i+2]=0;let{w:w,h:h,d:d}=e.dimensions;for(var vertices=new Float32Array(4*num),i=0;i<num;i++)vertices[4*i+0]=Math.random(w[0],w[1],4),vertices[4*i+1]=Math.random(h[0],h[1],4),vertices[4*i+2]=Math.random(d[0],d[1],4),vertices[4*i+3]=1;for(var attribs=new Float32Array(4*num),i=0;i<num;i++)attribs[4*i+0]=Math.random(0,1,4),attribs[4*i+1]=Math.random(0,1,4),attribs[4*i+2]=Math.random(0,1,4),attribs[4*i+3]=Math.random(0,1,4);resolve({array:position,vertices:vertices,attribs:attribs},id,[position.buffer,vertices.buffer,attribs.buffer])}Inherit(this,Component);var _thread,_this=this;this.dimensions={w:[-10,10],h:[-10,10],d:[-10,10]},this.createBufferArray=function(size,num,callback){_thread||initThread(),_thread.createBufferArray({size:size,num:num,dimensions:_this.dimensions},function(data){callback(data.array,data.vertices,data.attribs)})}},"static"),Class(function Canvas(_width,_height,_retina){function resize(w,h,retina){var ratio=retina&&Device.system.retina?2:1;_this.div&&(_this.div.width=w*ratio,_this.div.height=h*ratio),_this.width=w,_this.height=h,_this.scale=ratio,_this.element&&_this.element.size(_this.width,_this.height),Device.system.retina&&retina&&(_this.context.scale(ratio,ratio),_this.div.style.width=w+"px",_this.div.style.height=h+"px")}Inherit(this,Component);var _imgData,_this=this;this.children=[],this.offset={x:0,y:0},this.retina=_retina,_this.div=document.createElement("canvas"),_this.context=_this.div.getContext("2d"),_this.element=$(_this.div),_this.width=_width,_this.height=_height,_this.context._matrix=new Matrix2,resize(_width,_height,_retina),this.toDataURL=function(type,quality){return _this.div.toDataURL(type,quality)},this.sort=function(){_objects.sort(function(a,b){return a.z-b.z})},this.render=function(noClear){"boolean"==typeof noClear&&noClear||_this.clear();for(var len=_this.children.length,i=0;i<len;i++)_this.children[i].render();_this._rendered=Render.TIME},this.clear=function(){_this.context.clearRect(0,0,_this.div.width,_this.div.height)},this.add=function(display){display.setCanvas(this),display._parent=this,this.children.push(display),display._z=this.children.length},this.remove=function(display){if(display){display._canvas=null,display._parent=null;var i=this.children.indexOf(display);i>-1&&this.children.splice(i,1)}},this.destroy=function(){this.stopRender();for(var i=0;i<this.children.length;i++)this.children[i].destroy&&this.children[i].destroy();return this._destroy&&this._destroy()},this.startRender=function(){Render.start(_this.render)},this.stopRender=function(){Render.stop(_this.render)},this.getImageData=function(x,y,w,h){return this.imageData=this.context.getImageData(x||0,y||0,w||this.width,h||this.height),this.imageData},this.getPixel=function(x,y,dirty){this.imageData&&!dirty||_this.getImageData(0,0,_this.width,_this.height),_imgData||(_imgData={});var index=4*(x+y*_this.width),pixels=this.imageData.data;return _imgData.r=pixels[index],_imgData.g=pixels[index+1],_imgData.b=pixels[index+2],_imgData.a=pixels[index+3],_imgData},this.texture=function(src){var img=new Image;return img.src=src,img},this.size=resize}),Class(function Matrix2(){function identity(d){(d=d||_this.data)[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=1,d[5]=0,d[6]=0,d[7]=0,d[8]=1}function noE(n){return n=Math.abs(n)<1e-6?0:n}var a11,a12,a13,a21,a22,a23,a31,a32,a33,b11,b12,b13,b21,b22,b23,b31,b32,b33,_this=this,prototype=Matrix2.prototype;this.type="matrix2",this.data=new Float32Array(9),identity(),void 0===prototype.identity&&(prototype.identity=function(d){return identity(d),this},prototype.transformVector=function(v){var d=this.data,x=v.x,y=v.y;return v.x=d[0]*x+d[1]*y+d[2],v.y=d[3]*x+d[4]*y+d[5],v},prototype.setTranslation=function(tx,ty,m){var d=m||this.data;return d[0]=1,d[1]=0,d[2]=tx,d[3]=0,d[4]=1,d[5]=ty,d[6]=0,d[7]=0,d[8]=1,this},prototype.getTranslation=function(v){var d=this.data;return v=v||new Vector2,v.x=d[2],v.y=d[5],v},prototype.setScale=function(sx,sy,m){var d=m||this.data;return d[0]=sx,d[1]=0,d[2]=0,d[3]=0,d[4]=sy,d[5]=0,d[6]=0,d[7]=0,d[8]=1,this},prototype.setShear=function(sx,sy,m){var d=m||this.data;return d[0]=1,d[1]=sx,d[2]=0,d[3]=sy,d[4]=1,d[5]=0,d[6]=0,d[7]=0,d[8]=1,this},prototype.setRotation=function(a,m){var d=m||this.data,r0=Math.cos(a),r1=Math.sin(a);return d[0]=r0,d[1]=-r1,d[2]=0,d[3]=r1,d[4]=r0,d[5]=0,d[6]=0,d[7]=0,d[8]=1,this},prototype.setTRS=function(tx,ty,a,sx,sy){var d=this.data,r0=Math.cos(a),r1=Math.sin(a);return d[0]=r0*sx,d[1]=-r1*sy,d[2]=tx,d[3]=r1*sx,d[4]=r0*sy,d[5]=ty,d[6]=0,d[7]=0,d[8]=1,this},prototype.translate=function(tx,ty){return this.identity(Matrix2.__TEMP__),this.setTranslation(tx,ty,Matrix2.__TEMP__),this.multiply(Matrix2.__TEMP__)},prototype.rotate=function(a){return this.identity(Matrix2.__TEMP__),this.setTranslation(a,Matrix2.__TEMP__),this.multiply(Matrix2.__TEMP__)},prototype.scale=function(sx,sy){return this.identity(Matrix2.__TEMP__),this.setScale(sx,sy,Matrix2.__TEMP__),this.multiply(Matrix2.__TEMP__)},prototype.shear=function(sx,sy){return this.identity(Matrix2.__TEMP__),this.setRotation(sx,sy,Matrix2.__TEMP__),this.multiply(Matrix2.__TEMP__)},prototype.multiply=function(m){var a=this.data,b=m.data||m;return a11=a[0],a12=a[1],a13=a[2],a21=a[3],a22=a[4],a23=a[5],a31=a[6],a32=a[7],a33=a[8],b11=b[0],b12=b[1],b13=b[2],b21=b[3],b22=b[4],b23=b[5],b31=b[6],b32=b[7],b33=b[8],a[0]=a11*b11+a12*b21+a13*b31,a[1]=a11*b12+a12*b22+a13*b32,a[2]=a11*b13+a12*b23+a13*b33,a[3]=a21*b11+a22*b21+a23*b31,a[4]=a21*b12+a22*b22+a23*b32,a[5]=a21*b13+a22*b23+a23*b33,this},prototype.inverse=function(m){var a=(m=m||this).data,b=this.data;a11=a[0],a12=a[1],a13=a[2],a21=a[3],a22=a[4],a23=a[5],a31=a[6],a32=a[7],a33=a[8];var det=m.determinant();Math.abs(det);var invdet=1/det;return b[0]=(a22*a33-a32*a23)*invdet,b[1]=(a13*a32-a12*a33)*invdet,b[2]=(a12*a23-a13*a22)*invdet,b[3]=(a23*a31-a21*a33)*invdet,b[4]=(a11*a33-a13*a31)*invdet,b[5]=(a21*a13-a11*a23)*invdet,b[6]=(a21*a32-a31*a22)*invdet,b[7]=(a31*a12-a11*a32)*invdet,b[8]=(a11*a22-a21*a12)*invdet,m},prototype.determinant=function(){var a=this.data;return a11=a[0],a12=a[1],a13=a[2],a21=a[3],a22=a[4],a23=a[5],a31=a[6],a32=a[7],a33=a[8],a11*(a22*a33-a32*a23)-a12*(a21*a33-a23*a31)+a13*(a21*a32*a22*a31)},prototype.copyTo=function(m){var a=this.data,b=m.data||m;return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],m},prototype.copyFrom=function(m){var a=this.data,b=m.data||m;return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],this},prototype.getCSS=function(force2D){var d=this.data;return Device.tween.css3d&&!force2D?"matrix3d("+noE(d[0])+", "+noE(d[3])+", 0, 0, "+noE(d[1])+", "+noE(d[4])+", 0, 0, 0, 0, 1, 0, "+noE(d[2])+", "+noE(d[5])+", 0, 1)":"matrix("+noE(d[0])+", "+noE(d[3])+", "+noE(d[1])+", "+noE(d[4])+", "+noE(d[2])+", "+noE(d[5])+")"})},function(){Matrix2.__TEMP__=(new Matrix2).data}),Class(function CSSAnimation(){function complete(){_this.playing=!1,_this.events&&_this.events.fire(Events.COMPLETE,null,!0)}function updateCSS(){var css=CSS._read(),id="/*"+_name+"*/",string=id+("@"+CSS.vendor+"keyframes "+_name+" {\n");if(css.includes(_name)){var split=css.split(id);css=css.replace(id+split[1]+id,"")}for(var steps=_frames.length-1,perc=Math.round(100/steps),total=0,i=0;i<_frames.length;i++){var frame=_frames[i];i==_frames.length-1&&(total=100),string+=(frame.percent||total)+"% {\n";var hasTransform=!1,transforms={},styles={};for(var key in frame)TweenManager._isTransform(key)?(transforms[key]=frame[key],hasTransform=!0):styles[key]=frame[key];hasTransform&&(string+=CSS.vendor+"transform: "+TweenManager._parseTransform(transforms)+";");for(key in styles){var val=styles[key];"string"!=typeof val&&"opacity"!=key&&"zIndex"!=key&&(val+="px"),string+=CSS._toCSS(key)+": "+val+";"}string+="\n}\n",total+=perc}css+=string+="}"+id,CSS._write(css)}function destroy(){var css=CSS._read(),id="/*"+_name+"*/";if(css.includes(_name)){var split=css.split(id);css=css.replace(id+split[1]+id,"")}CSS._write(css)}function applyTo(callback){for(var i=_applyTo.length-1;i>-1;i--)callback(_applyTo[i])}Inherit(this,Component);var _frames,_timer,_started,_this=this,_name="a"+Utils.timestamp(),_duration=1e3,_ease="linear",_delay=0,_loop=!1,_count=1,_steps=null,_applyTo=[];this.set("frames",function(frames){_frames=frames,updateCSS()}),this.set("steps",function(steps){_steps=steps,_this.playing&&applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationTimingFunction")]="steps("+steps+")"})}),this.set("duration",function(duration){_duration=Math.round(duration),_this.playing&&applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationDuration")]=_this.duration+"ms"})}),this.get("duration",function(){return _duration}),this.set("ease",function(ease){_ease=ease,_this.playing&&applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationTimingFunction")]=TweenManager._getEase(_ease)})}),this.get("ease",function(){return _ease}),this.set("loop",function(loop){_loop=loop,_this.playing&&applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationIterationCount")]=_loop?"infinite":_count})}),this.get("loop",function(){return _loop}),this.set("count",function(count){_count=count,_this.playing&&applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationIterationCount")]=_loop?"infinite":_count})}),this.get("count",function(){return _count}),this.set("delay",function(delay){_delay=delay,_this.playing&&applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationDelay")]=_delay+"ms"})}),this.get("delay",function(){return _delay}),this.play=function(){applyTo(function($obj){defer(function(){$obj.div.style[CSS.prefix("Animation")]=_name+" "+_this.duration+"ms "+(_steps?"steps("+_steps+")":TweenManager._getEase(_ease))+" "+(_loop?"infinite":_count),$obj.div.style[CSS.prefix("AnimationPlayState")]="running"})}),_this.playing=!0,clearTimeout(_timer),_this.loop||(_started=Date.now(),_timer=_this.delayedCall(complete,_count*_duration))},this.pause=function(){_this.playing=!1,clearTimeout(_timer),applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationPlayState")]="paused"})},this.stop=function(){_this.playing=!1,clearTimeout(_timer),applyTo(function($obj){$obj&&$obj.div&&$obj.div.style&&($obj.div.style[CSS.prefix("AnimationName")]="")})},this.applyTo=function($obj){_applyTo.push($obj),_this.playing&&defer(function(){$obj.div.style[CSS.prefix("Animation")]=_name+" "+_this.duration+"ms "+(_steps?"steps("+_steps+")":TweenManager._getEase(_ease))+" "+(_loop?"infinite":_count),$obj.div.style[CSS.prefix("AnimationPlayState")]="running"})},this.remove=function($obj){$obj.div.style[CSS.prefix("AnimationName")]="";var i=_applyTo.indexOf($obj);i>-1&&_applyTo.splice(i,1)},this.destroy=function(){if(this._destroy)return this.stop(),_frames=null,destroy(),this._destroy()}}),Class(function SplitTextfield(){function splitLetter($obj){var _array=[],split=$obj.div.innerHTML.split("");$obj.div.innerHTML="";for(var i=0;i<split.length;i++){" "==split[i]&&(split[i]="&nbsp;");var letter=$("t","span");letter.html(split[i],!0).css(_style),_array.push(letter),$obj.add(letter)}return _array}function splitWord($obj){var _array=[],text=$obj.div.innerHTML,split=(text=text.replace("&nbsp;"," ")).split(" ");$obj.empty();for(var i=0;i<split.length;i++){var word=$("t","span"),empty=$("t","span");word.html(split[i]).css(_style),empty.html("&nbsp",!0).css(_style),_array.push(word),_array.push(empty),$obj.add(word),$obj.add(empty)}return _array}var _style={padding:0,margin:0,position:"relative",float:"",cssFloat:"",styleFloat:"",display:"inline-block",width:"auto",height:"auto"};this.split=function($obj,by){return"word"==by?splitWord($obj):splitLetter($obj)}},"Static"),Module(function Flatten(){this.exports=function flatten(arr,res=[]){let i=0;const len=arr.length;for(;i<len;i++){const cur=arr[i];Array.isArray(cur)?flatten(cur,res):res.push(cur)}return res}}),Class(function Fullscreen(){function addHandlers(){["onfullscreenchange","onwebkitfullscreenchange","onmozfullscreenchange","onmsfullscreenchange","onfullscreenerror","onwebkitfullscreenerror","onmozfullscreenerror","onmsfullscreenerror"].forEach(evt=>{void 0!==document[evt]&&(document[evt]=update)})}function update(){const isOpen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);isOpen!==_this.isOpen&&(_this.isOpen=isOpen,_this.events.fire(Events.FULLSCREEN,{fullscreen:_this.isOpen}))}Inherit(this,Events);const _this=this;this.isOpen=!1,addHandlers(),this.open=function(element){if(!Device.system.fullscreen)return console.warn("Fullscreen API not supported");element=element||document.body,["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"].every(method=>{if(void 0===element[method])return!0;element[method]()})},this.close=function(){if(!Device.system.fullscreen)return console.warn("Fullscreen API not supported");["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"].every(method=>{if(void 0===document[method])return!0;document[method]()})}},"static"),Class(function FXAA(){Inherit(this,NukePass);this.uniforms={resolution:World.RESOLUTION},this.init("FXAA","FXAA")}),Class(function GLScreenProjection(_camera,_target){function loop(){_this.pos.set(_target.x,_target.y),_this.pos3D.copy(_projection.unproject(_this.pos)),_m0.copy(_camera.projectionMatrix),_m1.getInverse(_camera.matrixWorld),_this.matrix.multiplyMatrices(_m0,_m1),_this.resolution.set(Stage.width,Stage.height),_this.uniforms.normalMatrix.value.setFromMatrix4(_camera.matrixWorld)}Inherit(this,Component);var _this=this,_projection=new ScreenProjection(_camera),_m0=new THREE.Matrix4,_m1=new THREE.Matrix4;this.resolution=new THREE.Vector2,this.pos=new THREE.Vector2,this.pos3D=new THREE.Vector3,this.matrix=new THREE.Matrix4,this.uniforms={projMatrix:{type:"m4",value:this.matrix},pos:{type:"v2",value:this.pos},pos3D:{type:"v3",value:this.pos3D},resolution:{type:"v2",value:this.resolution},normalMatrix:{type:"m3",value:new THREE.Matrix3}},this.set("camera",v=>{_camera=v,_projection.camera=_camera}),this.set("target",v=>{_target=v}),this.update=loop,this.start=function(){_this.startRender(loop)},this.stop=function(){_this.stopRender(loop)}}),Class(function GPU(){Inherit(this,Component);var _this=this,_split={};Hydra.ready(()=>{function splitGPU(string){if(_split[string])return _split[string];if(!_this.detect(string))return-1;try{var num=Number(_this.gpu.split(string)[1].split(" ")[0]);return _split[string]=num,num}catch(e){return-1}}_this.detect=function(match){if(Device.graphics.webgl)return Device.graphics.webgl.detect(match)},_this.detectAll=function(){if(Device.graphics.webgl){for(var match=!0,i=0;i<arguments.length;i++)Device.graphics.webgl.detect(arguments[i])||(match=!1);return match}},_this.matchGPU=function(str,min,max=99999){let num=splitGPU(str);return num>=min&&num<max},_this.gpu=Device.graphics.webgl?Device.graphics.webgl.gpu:"",Mobile.iOS=require("iOSDevices").find(),_this.BLACKLIST=require("GPUBlacklist").match(),_this.T0=!Device.mobile&&(!!_this.BLACKLIST||(!!_this.detect("radeon(tm) r5")||(_this.detectAll("intel","hd")?_this.matchGPU("hd graphics ",1e3,4400):"intel iris opengl engine"===_this.gpu.toLowerCase()))),_this.T1=!_this.BLACKLIST&&(!Device.mobile&&(!!_this.matchGPU("iris(tm) graphics ",540)||(!!_this.matchGPU("hd graphics ",514,1e3)||!_this.detect(["nvidia","amd","radeon","geforce"])&&!_this.T0))),_this.T2=!_this.BLACKLIST&&(!Device.mobile&&!(!_this.detect(["nvidia","amd","radeon","geforce"])||_this.T1||_this.T0)),_this.T3=!_this.BLACKLIST&&(!Device.mobile&&(!!_this.detect(["titan","amd radeon pro","quadro"])||(!!_this.matchGPU("gtx ",940)||(!!_this.matchGPU("radeon (tm) rx ",400)||!!_this.matchGPU("radeon pro ",420))))),_this.T4=!_this.BLACKLIST&&(!Device.mobile&&(!!_this.detect(["titan","quadro"])||!!_this.matchGPU("gtx ",1040))),_this.MT0=!!Device.mobile&&(!!Mobile.iOS.includes(["legacy","ipad mini 1","5x","ipad 4"])||(!("android"!=Device.system.os||!_this.detect("sgx"))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",0,330):!!_this.detect("mali")&&_this.matchGPU("mali-t",0,628)))),_this.MT1=!!Device.mobile&&(!!Mobile.iOS.includes(["5s","ipad air 1"])||"android"==Device.system.os&&!_this.MT0),_this.MT2=!!Device.mobile&&(!!Mobile.iOS.includes(["6x","ipad air 2"])||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",399):!!_this.detect("mali-g"))),_this.MT3=!!Device.mobile&&(!!Mobile.iOS.includes(["6s","ipad pro","7x"])||(!(!_this.detect("nvidia tegra")||!Device.detect("pixel c"))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",530):_this.detect("mali-g")?_this.matchGPU("mali-g",71):!!navigator.platform.toLowerCase().includes("mac")))),_this.MT4=!!Device.mobile&&(!("ios"!=Device.system.os||!_this.detect(["a10","a11","a12","a13","a14","a15","a16","a17","a18"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",540):!!navigator.platform.toLowerCase().includes("mac"))),_this.lt=function(num){return _this.TIER>-1&&_this.TIER<=num},_this.gt=function(num){return _this.TIER>-1&&_this.TIER>=num},_this.eq=function(num){return _this.TIER>-1&&_this.TIER==num},_this.mobileEq=function(num){return _this.M_TIER>-1&&_this.M_TIER==num},_this.mobileLT=function(num){return _this.M_TIER>-1&&_this.M_TIER<=num},_this.mobileGT=function(num){return _this.M_TIER>-1&&_this.M_TIER>=num};for(var key in _this)"T"==key.charAt(0)&&!0===_this[key]&&(_this.TIER=Number(key.charAt(1))),"MT"==key.slice(0,2)&&!0===_this[key]&&(_this.M_TIER=Number(key.charAt(2)));_this.OVERSIZED=!Device.mobile&&_this.TIER<2&&Math.max(window.innerWidth,window.innerHeight)>1440,_this.initialized=!0}),this.ready=function(){let promise=Promise.create();return _this.wait(()=>promise.resolve(),_this,"initialized"),promise}},"static"),Module(function GPUBlacklist(){this.exports={match:function(){return!Device.graphics.webgl||Device.graphics.webgl.detect(["radeon hd 6970m","radeon hd 6770m","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 5750","radeon hd 5670","radeon hd 4850","radeon hd 4870","radeon hd 4670","geforce 9400m","geforce 320m","geforce 330m","geforce gt 130","geforce gt 120","geforce gtx 285","geforce 8600","geforce 9600m","geforce 9400m","geforce 8800 gs","geforce 8800 gt","quadro fx 5","quadro fx 4","radeon hd 2600","radeon hd 2400","radeon hd 2600","radeon r9 200","mali-4","mali-3","mali-2"])}}}),Class(function InteractionMaskCanvas(){function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){_camera.left=SIZE/-2,_camera.right=SIZE/2,_camera.top=SIZE/2,_camera.bottom=SIZE/-2,_camera.near=.01,_camera.far=1e3,_camera.updateProjectionMatrix(),_camera.position.x=SIZE/2,_camera.position.y=-SIZE/2}Inherit(this,Component);const _this=this;var _scene=new THREE.Scene,_camera=new THREE.OrthographicCamera(1,1,1,1,.1,1);const SIZE=512;this.rt=Utils3D.createRT(SIZE,SIZE),this.texture=this.rt.texture,_camera.position.z=1,addListeners(),resizeHandler(),this.add=function(obj){_scene.add(obj)},this.remove=function(obj){_scene.remove(obj)},this.draw=function(){let clear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(_scene,_camera,_this.rt),World.RENDERER.autoClear=clear}}),Module(function iOSDevices(){this.exports={find:function(){if("ios"==Device.system.os&&navigator.platform.toLowerCase().includes("macintel"))return"";if(!Device.graphics.webgl)return"legacy";var detect=Device.graphics.webgl.detect;return detect(["a9","a10","a11","a12","a13","a14","a15","a16","a17","a18"])||navigator.platform.toLowerCase().includes("mac")?Device.mobile.phone?"6s, 7x":"ipad pro":detect("a8")?Device.mobile.phone?"6x":"ipad air 2, ipad mini 4":detect("a7")?Device.mobile.phone?"5s":"ipad air 1, ipad mini 2, ipad mini 3":detect(["sgx554","sgx 554"])?Device.mobile.phone?"":"ipad 4":detect(["sgx543","sgx 543"])?Device.mobile.phone?"5x, 5c, 4s":"ipad mini 1, ipad 2":"legacy"}}}),Class(function KeyboardUtil(){function addListeners(){__window.keydown(keydown),__window.keyup(keyup),__window.keypress(keypress)}function keydown(e){_this.events.fire(_this.DOWN,e)}function keyup(e){_this.events.fire(_this.UP,e)}function keypress(e){_this.events.fire(_this.PRESS,e)}Inherit(this,Component);var _this=this;_this.DOWN="keyboard_down",_this.PRESS="keyboard_press",_this.UP="keyboard_up",Hydra.ready(addListeners)},"static"),Class(function MouseFlowMap({size:size=512,radius:radius=.15,falloff:falloff=1,speed:speed=0,velocity:velocity=!0}={}){function initPass(){_this.setShader(_this.initClass(Shader,"MouseFlowMapBlend",{uStamp:{value:_this.rt.texture},uSpeed:{value:Math.pow(Math.clamp(speed,0,1),3)},uTexture:{value:null},uFirstDraw:{value:1}}))}function initStamps(){let geometry=new THREE.PlaneBufferGeometry(1,1);_stampShader=_this.initClass(Shader,"MouseFlowMapStamp",{uVelocity:{value:new Vec2(1,1)},uFalloff:{value:Math.clamp(falloff,0,1)},transparent:!0,depthWrite:!1});for(let i=0;i<_numStamps;i++){let stamp=new THREE.Mesh(geometry,_stampShader.material);stamp.frustumCulled=!1,stamp.scale.setScalar(radius),_this.add(stamp),_stamps.push(stamp)}}function loop(){_velocity.multiplyScalar(.93),velocity&&_stampShader.uniforms.uVelocity.value.lerp(_velocity,.5),_mouse.lerp(Mouse.inverseNormal,.4),_mouseStep.copy(_mouse).sub(_mouseLast).multiplyScalar(1/_numStamps),_mouseLast.copy(_mouse),_stampPos.copy(_mouse),_stamps.forEach(stamp=>{_stampPos.add(_mouseStep),stamp.position.x=_stampPos.x,stamp.position.y=_stampPos.y}),_this.draw()}function addHandlers(){_this.events.sub(Mouse.input,Interaction.MOVE,move),_this.events.sub(Mouse.input,Interaction.START,start),_this.events.sub(Mouse.input,Interaction.END,end),document.body.addEventListener("mouseleave",out,!1)}function start(){_this.isDragging=!0}function end(e){defer(()=>{_this.isDragging=!1,(e.x<0||e.y<0||e.x>Stage.width||e.y>Stage.width)&&(_this.isMouseLeft=!0)})}function out(e){e.toElement||_this.isDragging||(_this.isMouseLeft=!0)}function move(){_this.isMouseLeft&&(_this.isMouseLeft=!1,_mouse.copy(Mouse.inverseNormal),_mouseLast.copy(_mouse)),_velocity.copy(Mouse.delta).multiplyScalar(.03)}Inherit(this,MouseFlowMapRenderer,size);const _this=this;let _stampShader;const _stamps=[],_mouse=new Vec2,_mouseLast=new Vec2,_mouseStep=new Vec2,_stampPos=new Vec2,_numStamps=4,_velocity=new Vec2;initPass(),initStamps(),addHandlers(),_this.startRender(loop)}),Class(function MouseFlowMapRenderer(_size){function init(){_camera.position.z=1}Inherit(this,Component);const _this=this;let _shader;const _scene1=new THREE.Scene,_scene2=new THREE.Scene,_camera=new THREE.OrthographicCamera(0,1,1,0,.1,2);let _count=0;const _rtPing=Utils3D.createRT(_size,_size),_rtPong=Utils3D.createRT(_size,_size);this.rt=Utils3D.createRT(_size,_size),this.texture={type:"t",value:null},init(),this.add=function(mesh){_scene1.add(mesh)},this.setShader=function(shader){_shader=shader;let mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),shader.material);_scene2.add(mesh)},this.draw=function(){_shader&&(_count++,World.RENDERER.render(_scene1,_camera,_this.rt),_count%2==0?(_shader.uniforms.uTexture.value=_rtPing.texture,World.RENDERER.render(_scene2,_camera,_rtPong),_this.texture.value=_rtPong.texture):(_shader.uniforms.uTexture.value=_rtPong.texture,World.RENDERER.render(_scene2,_camera,_rtPing),_this.texture.value=_rtPing.texture),_shader.uniforms.uFirstDraw.value=0)}}),Class(function OrbitCamera($element){function initBehaviors(){_this.group.remove(_camera),_root=new THREE.Group,_wrap1=new THREE.Group,_wrap2=new THREE.Group,_root.add(_wrap1),_wrap1.add(_wrap2),_wrap2.add(_camera),_this.group.add(_root),_rotation=_this.initClass(OrbitCameraRotation,_root,_wrap1),_gaze=_this.initClass(OrbitCameraGaze,_camera),_this.rotation=_rotation,_this.gaze=_gaze,_camera.position.z=_zDistance}function loop(){_camera.position.z=_this.zDistance}function decompose(obj){var wrap1x=_wrap1.rotation.x;_wrap1.rotation.x=0,_root.updateMatrixWorld(),Utils3D.decompose(_camera,obj),_wrap1.rotation.x=wrap1x}Inherit(this,BaseCamera);var _root,_wrap1,_wrap2,_rotation,_gaze,_null,_e,_q,_this=this,_camera=_this.camera,_zDistance=4;this.zOrigin=_zDistance,this.$element=$element,this.maxZoom=2,this.minZoom=5,this.lockZoom=!1,this.screenRotation=180,this.xLimit=.4,this.xMax=30,this.set("zDistance",z=>{_zDistance=z,_this.zOrigin=z}),this.get("zDistance",_=>_zDistance),initBehaviors(),_this.startRender(loop),this.center=function(lat,lng,snap){_null||(_null=new THREE.Group,_e=new THREE.Euler,_q=new THREE.Quaternion,_camera=new THREE.Group);var y=-lng*Math.PI/180-Math.PI+Math.radians(90),x=-lat*Math.PI/180;decompose(_camera),_rotation.center(x,snap),_null.rotation.set(0,0,0),_null.lookAt(_camera.position),_null.updateMatrix(),_e.set(0,y,0),_q.setFromEuler(_e),_null.quaternion.multiply(_q)}}),Class(function OrbitCameraGaze(_camera){function loop(){Device.mobile.phone?_mouse.lerp(Mobile.Accelerometer,_this.lerpSpeed):_mouse.lerp(Mouse,_this.lerpSpeed),Device.mobile?(_move.x=_this.position.x+Math.range(_mouse.x,-6,6,-2.5,2.5,!0)*_this.moveXY.x,_move.y=_this.position.y+Math.range(_mouse.y,-3,3,-1,1,!0)*_this.moveXY.y):(_move.x=_this.position.x+Math.range(_mouse.x,0,Stage.width,-1.5,1.5,!0)*_this.moveXY.x,_move.y=_this.position.y+Math.range(_mouse.y,0,Stage.height,-1,1,!0)*_this.moveXY.y),_move.z=_this.position.z,_camera.position.lerp(_move,_this.lerpSpeed),_this.lookAt&&_camera.lookAt(_this.lookAt),Global.CAMERA_MOVE.copy(_camera.position),Global.CAMERA_MOVE.x-=_this.position.x,Global.CAMERA_MOVE.y-=_this.position.y}Inherit(this,Component);var _this=this,_move=new Vector3;this.moveXY=new THREE.Vector2(4,4),this.position=new THREE.Vector3,this.lerpSpeed=Device.mobile.phone?.3:.1,this.lookAt=new THREE.Vector3;var _mouse=new Vector2;Global.CAMERA_MOVE=new THREE.Vector3,Mobile.Accelerometer.capture(),_this.startRender(loop)}),Class(function OrbitCameraRotation(_root,_wrap){function initInput(){_input=_this.initClass(Interaction,_this.parent.$element||Stage),_this.events.sub(_input,Interaction.START,touchStart),_this.events.sub(_input,Interaction.MOVE,touchMove),_this.events.sub(_input,Interaction.END,touchEnd)}function loop(){_enabled&&(_camera||(_camera=_this.parent),_target.lerp(_velocity,.07),_rotation.y-_target.y>180&&(_rotation.y-=360),_rotation.y-_target.y<-180&&(_rotation.y+=360),_rotation.lerp(_target,.4),_root.rotation.y=Math.radians(_rotation.y),_wrap.rotation.x=Math.radians(_rotation.x),_camera.zMove+=(_moveTarget-_camera.zMove)*_moveAlpha)}function touchStart(e){if(!_prevent){if(e.touches&&e.touches.length>1||"hit"==e.target.className)return _moving=!1;UIJoystick.instance().delayAutoplay(),_moving=!0,_velocity.y=_target.y,_hold.y=_target.y,_hold.x=_target.x,_moveAlpha=.07}}function touchMove(e){_moving&&!_prevent&&(UIJoystick.instance().delayAutoplay(),_target.y=_hold.y+-_input.move.x/Stage.width*_this.parent.screenRotation,_target.x=_hold.x+-_input.move.y/Stage.height*(_this.parent.screenRotation*_this.parent.xLimit),_target.y>180&&(_hold.y-=360),_target.y<-180&&(_hold.y+=360),Math.abs(_target.x),_this.parent.xMax,_velocity.y=_target.y,_velocity.x=_target.x,_move.copy(_input.delta),_moveTarget=Math.range(Math.abs(_input.velocity.x),0,7,0,.5*_this.parent.zOrigin))}function touchEnd(e){if(_moving&&!_prevent){var moveX=200*-Math.abs(_input.velocity.x)/Stage.width*_this.parent.screenRotation*Math.sign(_move.x),moveY=200*-Math.abs(_input.velocity.y)/Stage.height*(_this.parent.screenRotation*_this.parent.xLimit)*Math.sign(_move.y);_velocity.y=_target.y+Math.clamp(moveX,-360,360),_velocity.x=Math.clamp(_target.x+moveY,-_this.parent.xMax,_this.parent.xMax),_moveTarget=0,_moveAlpha=.02,_moving=!1,_move&&(_move.x=0,_move.y=0)}}Inherit(this,Component);var _input,_camera,_prevent,_moving,_this=this,_move=new THREE.Vector2,_hold=new THREE.Vector3,_target=new THREE.Vector3,_rotation=new THREE.Vector3,_velocity=new THREE.Vector3,_moveTarget=0,_moveAlpha=.07,_enabled=!0;defer(initInput),_this.startRender(loop),this.center=function(x,snap){_velocity.x=Math.degrees(x),snap&&(_target.x=_velocity.x,_wrap.rotation.x=x)},this.set("rotationY",y=>{_velocity.y=_target.y=_rotation.y=y,_root.rotation.y=Math.radians(y)}),this.get("rotationY",()=>Math.degrees(_root.rotation.y)),this.set("prevent",value=>_prevent=value)}),Class(function OrbitCameraZoom(_parent){function loop(){_scroll&&(_this.z+=.02*_scroll.delta.y,_this.z=Math.clamp(_this.z,_this.parent.maxZoom,_this.parent.minZoom)),_parent.zDistance+=.07*(_this.z-_parent.zDistance)}function addListeners(){Device.mobile?((_pinch=_this.initClass(PinchMechanism)).start(),_pinch.max=100,_this.events.sub(_pinch,PinchMechanism.UPDATE,pinch)):_scroll=_this.initClass(Scroll,{limit:!1})}function pinch(e){_hold||(_this.z=Math.range(1-e.percent,0,1,_this.parent.maxZoom,_this.parent.minZoom))}Inherit(this,Component);var _pinch,_hold,_scroll,_this=this;this.z=_parent.zDistance,addListeners(),_this.startRender(loop),this.zoomIn=function(z,time=1e3,ease="easeInOutCubic",snap){_hold=_this.z,snap?(_this.z=z,_parent.zDistance=_this.z):tween(_this,{z:z},time,ease)},this.zoomOut=function(){tween(_this,{z:_hold},2e3,"easeInOutCubic",function(){_hold=null})}}),Class(function PinchMechanism(){function setTouches(e){var p0=e.touches[0],p1=e.touches[1];p0&&_p0.set(p0.pageX,p0.pageY),p1&&_p1.set(p1.pageX,p1.pageY)}function addListeners(){Stage.bind("touchstart",touchStart),Stage.bind("touchend",touchEnd),Stage.bind("touchcancel",touchEnd)}function removeListeners(){Stage.unbind("touchstart",touchStart),Stage.unbind("touchend",touchEnd),Stage.unbind("touchcancel",touchEnd),Stage.unbind("touchmove",touchMove)}function touchStart(e){2!=e.touches.length||_touching||(_touching=!0,_start=_percent,setTouches(e),Stage.bind("touchmove",touchMove),_dist=_calc.subVectors(_p0,_p1).length())}function touchMove(e){setTouches(e);var dist=_calc.subVectors(_p0,_p1).length(),absDist=dist-_dist,perc=Math.range(absDist,0,_this.max,0,1);_percent=Math.clamp(_start+perc,0,1),_event.delta=dist>_last?1:-1,_event.percent=_percent,_this.events.fire(PinchMechanism.UPDATE,_event,!0),_last=dist}function touchEnd(e){_touching&&(_touching=!1,_start=_percent,Stage.unbind("touchmove",touchMove),_this.events.fire(PinchMechanism.END,null,!0))}Inherit(this,Component);var _this=this,_event={percent:0},_p0=new Vector2,_p1=new Vector2,_calc=new Vector2,_dist=0,_start=0,_percent=0,_last=0,_touching=!1;this.max=150,this.set("percent",function(value){_percent=value}),this.start=function(){addListeners()},this.stop=function(){removeListeners()},this.snapTo=function(to,time){let d={v:_percent};tween(d,{v:to},time,"linear").onUpdate(()=>{_event.delta=0,_event.percent=d.v,_start=d.v,_this.events.fire(Events.UPDATE,_event,!0)})}},function(){PinchMechanism.END="pinch_end",PinchMechanism.UPDATE="pinch_update"}),Class(function RenderGL(){function onRenderEye(stage,camera){_evt.stage=stage,_evt.camera=camera,_this.events.fire(_this.RENDER,_evt)}function resizeHandler(){_this.renderer&&_this.renderer.setSize(Stage.width,Stage.height)}Inherit(this,Component);const _this=this,_evt={stage:null,camera:null};var _dpr=null;this.NORMAL="normal",this.WEBVR="webvr",this.STEREO="stereo",this.ARKIT="ARKit",this.ARCORE="ARCore",this.AR="AR",this.DAYDREAM="daydream",this.GEARVR="gearVR",this.RENDER="rendergl_render",this.READY="render_gl_ready",_this.events.sub(Events.RESIZE,resizeHandler),this.set("DPR",v=>{_dpr=v,_this.renderer&&_this.renderer.setSize(Stage.width,Stage.height)}),this.get("DPR",v=>_dpr),this.initialize=function(type,params={}){if(_this.camera&&_this.camera.destroy(),_this.renderer&&_this.renderer.destroy(),type==_this.AR&&(type="ios"==Device.system.os?_this.ARKIT:_this.ARCORE),type==_this.ARKIT){if(!window.ARKit)throw"RenderGL.ARKIT requires ARKit module";ARKit.init()}if(type==_this.ARCORE){if(!window.ARCore)throw"RenderGL.ARCORE requires ARCore module";ARCore.init()}if(!_this.threeRenderer){let camera=new THREE.PerspectiveCamera(45,Stage.width/Stage.height,.01,200);_this.threeRenderer=function(){if(window.ARKit&&window.ARKit.renderer)return ARKit.renderer;if(window.ARCore&&window.ARCore.renderer)return ARCore.renderer;if(window._canvas&&(params.canvas=window._canvas),!Device.graphics.webgl)return{render:_=>{},setPixelRatio:_=>{},setSize:_=>{},readRenderTargetPixels:_=>{}};let renderer=new THREE.WebGLRenderer(params);return renderer.setSize(Stage.width,Stage.height),renderer.setPixelRatio(World.DPR),renderer}(),_this.scene=window.ARKit&&window.ARKit.scene?ARKit.scene:window.ARCore&&window.ARCore.scene?ARCore.scene:new THREE.Scene;let useDrawBuffers=!Utils.query("drawbuffers")&&void 0;_this.nuke=_this.initClass(Nuke,Stage,Object.assign({renderer:_this.threeRenderer,scene:_this.scene,camera:camera,dpr:World.DPR,useDrawBuffers:useDrawBuffers},params))}switch(_dpr=_dpr||World.DPR||1,type){case _this.WEBVR:_this.renderer=_this.initClass(VRRenderer,_this.threeRenderer,_this.nuke),_this.camera=_this.initClass(VRCamera);break;case _this.STEREO:_this.renderer=_this.initClass(VRStereoRenderer,_this.threeRenderer,_this.nuke),_this.camera=_this.initClass(VRStereoCamera);break;case _this.NORMAL:_this.renderer=_this.initClass(RenderGLRenderer,_this.threeRenderer,_this.nuke),_this.camera=_this.initClass(RenderGLCamera);break;case _this.ARKIT:_this.renderer=_this.initClass(RenderGLRenderer,ARKit.renderer,_this.nuke),_this.camera=ARKit;break;case _this.ARCORE:_this.renderer=_this.initClass(RenderGLRenderer,ARCore.renderer,_this.nuke),_this.camera=ARCore;break;case _this.DAYDREAM:_this.renderer=_this.initClass(DaydreamRenderer,_this.threeRenderer,_this.nuke),_this.camera=_this.initClass(DaydreamCamera)}_this.type=type,_this.nuke.camera=_this.camera.worldCamera,_this.renderer.onRenderEye=onRenderEye,defer(()=>{_this.events.fire(_this.READY)})},this.render=function(scene,camera,renderTarget,forceClear){_this.renderer.render(scene||_this.scene,camera||_this.camera.worldCamera,renderTarget,forceClear)},this.startRender=function(){Render.start(_this.render)},this.stopRender=function(){Render.stop(_this.render)},this.requestPresent=function(bool){_this.renderer.requestPresent&&_this.renderer.requestPresent(bool)},this.setSize=function(width,height){_this.events.unsub(Events.RESIZE,resizeHandler),_this.renderer.setSize(width,height)},this.set("onRenderEye",callback=>{_this.renderer.onRenderEye=callback})},"static"),Class(function RenderGLCamera(){Inherit(this,Component);const _this=this;this.worldCamera=new THREE.PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3),_this.events.sub(Events.RESIZE,()=>{_this.worldCamera.aspect=Stage.width/Stage.height,_this.worldCamera.updateProjectionMatrix()})}),Class(function RenderGLRenderer(_renderer,_nuke){Inherit(this,Component);const _this=this;this.render=function(scene,camera){_nuke.camera=camera,_this.onRenderEye&&_this.onRenderEye(Stage,camera),_nuke?_nuke.render():_renderer.render(scene,camera)},this.setSize=function(width,height){_renderer.setPixelRatio(RenderGL.DPR),_renderer.setSize(width,height)}}),Class(function Scroll(_object,_params){function initParams(){_object&&_object.div||(_params=_object,_object=null),_params||(_params={}),_this.object=_object,_this.hitObject=_params.hitObject||_this.object,_this.max.y=_params.height||0,_this.max.x=_params.width||0,_this.scale=_params.scale||1,_this.drag=void 0!==_params.drag?_params.drag:!!Device.mobile,_this.mouseWheel=!1!==_params.mouseWheel,_this.limit=!1!==_params.limit,Array.isArray(_params.axes)&&(_axes=_params.axes)}function style(){}function loop(){_axes.forEach(axis=>{_this.isInertia&&(_scrollInertia[axis]*=.2,_scrollTarget[axis]+=_scrollInertia[axis]),_this.limit&&(_scrollTarget[axis]=Math.max(_scrollTarget[axis],0)),_this.limit&&(_scrollTarget[axis]=Math.min(_scrollTarget[axis],_this.max[axis]/_this.scale)),_this.delta[axis]=.5*(_scrollTarget[axis]*_this.scale-_this[axis]),_this[axis]+=_this.delta[axis],Math.abs(_this.delta[axis])<.01&&(_this.delta[axis]=0),Math.abs(_this[axis])<.001&&(_this[axis]=0),_this.object})}function stopInertia(){_this.isInertia=!1,clearTween(_scrollTarget)}function addHandlers(){if(Device.mobile||("ie"==Device.system.browser?window.addEventListener("wheel",scroll,!0):__window.bind("wheel",scroll)),_this.drag){_this.hitObject&&_this.hitObject.bind("touchstart",e=>e.preventDefault());let input=_this.hitObject?_this.initClass(Interaction,_this.hitObject):Mouse.input;_this.events.sub(input,Interaction.START,down),_this.events.sub(input,Interaction.DRAG,drag),_this.events.sub(input,Interaction.END,up)}_this.events.sub(Events.RESIZE,resize)}function scroll(e){if(_this.enabled&&(e.preventDefault&&e.target.className&&e.target.className.length&&!e.target.className.includes(["notes","list","scroll","SignupView","Signup"])&&e.preventDefault(),_this.mouseWheel)){if(stopInertia(),_block&&"number"==typeof _block.y){if(_block.force)return;let val=Math.abs(_block.x)>Math.abs(_block.y)?"x":"y";_axes.forEach(axis=>{_block&&Math.abs(e["delta"+axis.toUpperCase()])<=Math.abs(_block[val])||(_block=null)})}_axes.forEach(axis=>{let delta="delta"+axis.toUpperCase();if(_last[axis]=e[delta],"mac"==Device.system.os){if("firefox"==Device.system.browser)return 1===e.deltaMode?(_scrollTarget[axis]+=4*e[delta],_scrollInertia[axis]=4*e[delta],void(_this.isInertia=!0)):void(_scrollTarget[axis]+=e[delta]);if(Device.system.browser.includes(["chrome","safari"]))return _scrollTarget[axis]+=.33*e[delta],_scrollInertia[axis]=.33*e[delta],void(_this.isInertia=!0)}if("windows"==Device.system.os&&"firefox"==Device.system.browser&&1===e.deltaMode)return _scrollTarget[axis]+=10*e[delta],_scrollInertia[axis]=10*e[delta],void(_this.isInertia=!0);_scrollTarget[axis]+=e[delta],_this.onScroll&&_this.onScroll(e)})}}function down(){_this.enabled&&stopInertia()}function drag(){_this.enabled&&_axes.forEach(axis=>{_scrollTarget[axis]-=Mouse.delta[axis]})}function up(){if(!_this.enabled)return;const m="android"==Device.system.os?35:25,obj={};_axes.forEach(axis=>{obj[axis]=_scrollTarget[axis]-Mouse.delta[axis]*m}),tween(_scrollTarget,obj,2500,"easeOutQuint")}function resize(){if(!_this.enabled)return;if(stopInertia(),!_this.object)return;const p={};Device.mobile&&_axes.forEach(axis=>p[axis]=_this.max[axis]?_scrollTarget[axis]/_this.max[axis]:0),void 0===_params.height&&(_this.max.y=_this.object.div.scrollHeight-_this.object.div.clientHeight),void 0===_params.width&&(_this.max.x=_this.object.div.scrollWidth-_this.object.div.clientWidth),Device.mobile&&_axes.forEach(axis=>_this[axis]=_scrollTarget[axis]=p[axis]*_this.max[axis])}Inherit(this,Component);const _this=this;this.x=0,this.y=0,this.max={x:0,y:0},this.delta={x:0,y:0},this.enabled=!0;const _scrollTarget={x:0,y:0},_scrollInertia={x:0,y:0};let _axes=["x","y"];var _block,_last={};initParams(),_this.object&&style(),addHandlers(),resize(),_this.startRender(loop),this.reset=function(){_this.object.div.scrollLeft=_this.x=0,_this.object.div.scrollTop=_this.y=0,_scrollTarget.x=_scrollTarget.y=0,_scrollInertia.x=_scrollInertia.y=0},this.onDestroy=function(){__window.unbind("wheel",scroll)},this.resize=resize,this.scrollTo=function(value,axis="y"){let values={};values[axis]=value,tween(_scrollTarget,values,800,"easeInOutCubic")},this.block=function(){(_block=Utils.cloneObject(_last)).force=!0,_this.delayedCall(_=>_block.force=!1,750)}}),Class(function Shaders(){function parseSingleShader(code){let uniforms=code.split("#!UNIFORMS")[1].split("#!")[0],varyings=code.split("#!VARYINGS")[1].split("#!")[0],attributes=code.split("#!ATTRIBUTES")[1].split("#!")[0];for(;code.includes("#!SHADER");){let split=(code=code.slice(code.indexOf("#!SHADER"))).split("#!SHADER")[1],br=split.indexOf("\n"),name=split.slice(0,br).split(": ")[1],glsl=split.slice(br);glsl=name.includes(".vs")?attributes+uniforms+varyings+glsl:uniforms+varyings+glsl;let splitName=name.split(".");_this[splitName[0]+(splitName[1].includes("vs")?".vs":".fs")]=glsl,code=code.replace("#!SHADER","$")}}function parseCompiled(shaders){var split=shaders.split("{@}");split.shift();for(var i=0;i<split.length;i+=2){var name=split[i],text=split[i+1];text.includes("#!UNIFORMS")?parseSingleShader(text):_this[name]=text}}function parseRequirements(){for(var key in _this){var obj=_this[key];"string"==typeof obj&&(_this[key]=require(obj))}}function require(shader){if(!shader.includes("require"))return shader;for(shader=shader.replace(/# require/g,"#require");shader.includes("#require");){var name=shader.split("#require(")[1].split(")")[0];if(name=name.replace(/ /g,""),!_this[name])throw"Shader required "+name+", but not found in compiled shaders.\n"+shader;shader=shader.replace("#require("+name+")",_this[name])}return shader}Inherit(this,Component);var _this=this;this.parse=function(code,file){code.includes("{@}")?(parseCompiled(code),parseRequirements()):(file=(file=file.split("/"))[file.length-1],_this[file]=code),_this.shadersParsed=!0},this.onReady=this.ready=function(callback){let promise=Promise.create();return callback&&promise.then(callback),_this.wait(()=>promise.resolve(),_this,"shadersParsed"),promise},this.getShader=function(string){_this.FALLBACKS&&_this.FALLBACKS[string]&&(string=_this.FALLBACKS[string]);var code=_this[string];if(code)for(;code.includes("#test ");)try{var test=code.split("#test ")[1],name=test.split("\n")[0],glsl=code.split("#test "+name+"\n")[1].split("#endtest")[0];eval(name)||(code=code.replace(glsl,"")),code=code.replace("#test "+name+"\n",""),code=code.replace("#endtest","")}catch(e){throw"Error parsing test :: "+string}return code}},"static"),Class(function Share(){function url(){return location.protocol+"//"+location.host+location.pathname}this.twitter=function(text){window.open(`https://twitter.com/share?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url())}`,"_blank","height=555,width=577,scrollbars=yes")},this.facebook=function(){window.open(`https://www.facebook.com/sharer?u=${url()}`,"_blank","height=555,width=577,scrollbars=yes")}},"static"),Class(function BaseCamera(){Inherit(this,Object3D);const _this=this;this.camera=new THREE.PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3),this.group.add(this.camera),this.startRender(_=>{_this.group.updateMatrixWorld()}),this.playgroundLock=function(){Global.PLAYGROUND&&Utils.getConstructorName(_this.parent).includes(Global.PLAYGROUND.split("/")[0])&&Camera.instance().lock(_this.camera)},this.lock=function(){Camera.instance().lock(_this.camera)},this.transition=function(time,ease,delay){return Camera.instance().transition(_this.camera,time,ease,delay)},this.setFOV=function(fov){this.camera.fov=fov}}),Class(function Camera(_worldCamera){function initDebug(){let white=new THREE.MeshBasicMaterial({color:16777215}),materials=[white,white,white,white,white,new THREE.MeshBasicMaterial({color:16711680})];_debug=new THREE.Mesh(new THREE.BoxGeometry(.25,.25,.5),materials),World.SCENE.add(_debug),_worldCamera=new THREE.PerspectiveCamera}function loop(){_prevCamera?(_worldCamera.position.copy(_prevCamera.getWorldPosition()).lerp(_lockCamera.getWorldPosition(),_anim.weight),_worldCamera.quaternion.copy(_prevCamera.getWorldQuaternion()).slerp(_lockCamera.getWorldQuaternion(),_anim.weight),_this.tweenFOV&&(_worldCamera.fov+=(_lockCamera.fov-_worldCamera.fov)*_anim.weight,_worldCamera.updateProjectionMatrix())):_lockCamera&&Utils3D.decompose(_lockCamera,_worldCamera),_debug&&(_debug.position.copy(_worldCamera.position),_debug.quaternion.copy(_worldCamera.quaternion))}Inherit(this,Component);const _this=this;var _debug,_prevCamera,_lockCamera;let _anim={weight:0};this.tweenFOV=!1,Utils.query("orbit")?initDebug():World.CONTROLS.enabled=!1,_this.startRender(loop),this.lock=function(camera){_lockCamera=camera,_worldCamera.fov=_lockCamera.fov,_worldCamera.updateProjectionMatrix()},this.transition=function(camera,duration=1e3,ease="easeInOutCubic"){return _prevCamera===camera?(duration*=.5*Math.smoothStep(.5,1,_anim.weight)+.5,_anim.weight=1-_anim.weight):_anim.weight=0,_prevCamera=_lockCamera,_lockCamera=camera,tween(_anim,{weight:1},duration,ease)},this.get("worldCamera",_=>_worldCamera),this.set("debugScale",s=>{_debug&&_debug.scale.setScalar(s)})},"singleton"),Class(function GazeCamera(){function loop(){Device.mobile?(_position.x=Math.range(Mobile.Accelerometer.x,-2,2,-1,1,!0)*_strength.v*_this.moveXY.x,_position.y=Math.range(Mobile.Accelerometer.y,-2,2,-1,1,!0)*_strength.v*_this.moveXY.y):(_position.x=Math.range(Mouse.x,0,Stage.width,-1,1,!0)*_strength.v*_this.moveXY.x,_position.y=Math.range(Mouse.y,0,Stage.height,-1,1,!0)*_strength.v*_this.moveXY.y),_position2.lerp(_position,_this.lerpSpeed),_move.x=_this.position.x+_position2.x,_move.y=_this.position.y+_position2.y,_move.z=_this.position.z,_this.camera.position.copy(_move),_this.camera.lookAt(_this.lookAt)}Inherit(this,BaseCamera);const _this=this;var _strength={v:1},_move=new THREE.Vector3,_position=new THREE.Vector3,_position2=new THREE.Vector3;this.moveXY=new THREE.Vector2(4,4),this.position=new function Position(){Inherit(this,Component);var _x=0,_y=0,_z=0;this.get("x",_=>_x),this.get("y",_=>_y),this.get("z",_=>_z),this.set("x",x=>{_x=x}),this.set("y",y=>{_y=y}),this.set("z",z=>{_z=z,_move.z=_z,_this.camera.position.copy(_move)}),this.set=function(x,y,z){_x=x,_y=y,_z=z,_move.z=z,_this.camera.position.copy(_move)}},this.lerpSpeed=.05,this.lookAt=new THREE.Vector3(0,0,0),_this.startRender(loop),this.orbit=function(time=1e3,ease="easeInOutSine"){return tween(_strength,{v:1},time,ease)},this.still=function(time=300,ease="easeInOutSine"){return tween(_strength,{v:0},time,ease)}}),Class(function Interaction3D(_camera){function parseMeshes(meshes){function checkMesh(obj){(obj.type=obj.isHitMesh)&&(obj.mouseEnabled=function(visible){visible?~_meshes.indexOf(obj)||_meshes.push(obj):_meshes.remove(obj)},output.push(obj)),obj.children.length&&obj.children.forEach(checkMesh)}void 0===meshes.length&&(meshes=[meshes]);let output=[];return meshes.forEach(checkMesh),output}function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,start),Device.mobile&&_this.events.sub(Mouse.input,Interaction.END,end),_this.events.sub(Mouse.input,Interaction.MOVE,move),_this.events.sub(Mouse.input,Interaction.CLICK,click)}function start(){if(!_this.enabled)return;let hit=move();hit?(_click=hit.object).time=Render.TIME:_click=null}function move(){if(!_this.enabled)return void Stage.css("cursor",_this.cursor);let hit=_ray.checkHit(_meshes)[0];if(hit){let mesh=hit.object;return _hover!==mesh?(_hover&&triggerHover("out",_hover,hit),triggerHover("over",_hover=mesh,hit),_hover.__clickCallback?Stage.css("cursor","pointer"):Stage.css("cursor",_this.cursor)):triggerMove(_hover,hit),hit}return _hover&&(triggerHover("out",_hover,hit),_hover=null,Stage.css("cursor",_this.cursor)),!1}function end(){_hover&&(triggerHover("out",_hover,null),_hover=null)}function click(e){if(!_this.enabled)return;if(!_click)return;let element=document.elementFromPoint(e.x,e.y);if(element&&"hit"===element.className)return;let hit=_ray.checkHit(_meshes,Mouse)[0];hit&&hit.object===_click&&triggerClick(_click,hit),_click=null}function triggerHover(action,mesh,hit){_event.action=action,_event.mesh=mesh,_event.hit=hit,_this.events.fire(Interaction3D.HOVER,_event,!0),_hover.__hoverCallback&&_hover.__hoverCallback(_event)}function triggerClick(mesh,hit){_event.action="click",_event.mesh=mesh,_event.hit=hit,_this.events.fire(Interaction3D.CLICK,_event,!0),_click.__clickCallback&&_click.__clickCallback(_event)}function triggerMove(mesh,hit){_event.action="move",_event.mesh=mesh,_event.hit=hit,_this.events.fire(Interaction3D.MOVE,_event,!0),mesh.__moveCallback&&mesh.__moveCallback(_event)}Inherit(this,Component);const _this=this;let _hover,_click;_camera=_camera||World.CAMERA;let _ray=_this.initClass(Raycaster,_camera),_meshes=[];const _event={};this.cursor="auto",addHandlers(),_this.enabled=!0,this.set("camera",c=>{_ray.camera=c}),this.add=function(meshes,hover,click,move,isParse){(void 0===meshes.length||isParse)&&(meshes=parseMeshes(meshes)),meshes.forEach(mesh=>{hover&&(mesh.__hoverCallback=hover),click&&(mesh.__clickCallback=click),move&&(mesh.__moveCallback=move),_meshes.push(mesh)})},this.remove=function(meshes,isParse){(void 0===meshes.length||isParse)&&(meshes=parseMeshes(meshes)),meshes.forEach(mesh=>{if(_hover==mesh)for(let i=_meshes.length-1;i>=0;i--)mesh===_meshes[i]&&_meshes.splice(i,1)})},this.set("testVisibility",v=>_ray.testVisibility=v)},()=>{Interaction3D.HOVER="interaction3d_hover",Interaction3D.CLICK="interaction3d_click",Interaction3D.MOVE="interaction3d_move"}),Class(function Lighting(){function loop(){decomposeLights(_lights)}function decomposeLights(lights){for(var i=lights.length-1;i>-1;i--){var light=lights[i];light.parent||light.updateMatrixWorld(),light._world||(light._world=new THREE.Vector3),light.getWorldPosition(light._world)}}function updateArrays(shader){var light,lights=shader.lights,lighting=shader.__lighting;lighting.position.length=0,lighting.color.length=0,lighting.intensity.length=0,lighting.distance.length=0;for(var i=0;i<lights.length;i++)light=lights[i],lighting.position.push(light._world),lighting.color.push(light.color.r,light.color.g,light.color.b),lighting.intensity.push(light.intensity),lighting.distance.push(light.distance);for(i=0;i<_lights.length;i++)light=_lights[i],lighting.position.push(light._world),lighting.color.push(light.color.r,light.color.g,light.color.b),lighting.intensity.push(light.intensity),lighting.distance.push(light.distance)}Inherit(this,Component);var _lights=[];this.push=function(light){_lights.push(light),Render.start(loop)},this.remove=function(light){_lights.remove(light)},this.getLighting=function(shader,force){if(shader.__lighting&&!force)return shader.__lighting;var lighting={position:[],color:[],intensity:[],distance:[]};return shader.__lighting=lighting,_lights[0]&&!_lights[0]._world&&decomposeLights(_lights),decomposeLights(shader.lights),updateArrays(shader),lighting},this.update=function(shader){decomposeLights(shader.lights),updateArrays(shader)},this.sort=function(callback){_lights.sort(callback)}},"static"),Class(function Object3D(){Inherit(this,Component);var _this=this;this.group=new THREE.Group,this.freezeMatrix=function(group){(group=group||_this.group).matrixAutoUpdate=!1,group.updateMatrix()},this.add=function(child){this.group.add(child.group||child)},this.remove=function(child){this.group.remove(child.group||child)},this.onDestroy=function(){this.group&&this.group.parent&&this.group.parent.remove(this.group)}}),Class(function FXLayer(_parentNuke,_type){function editShader(mesh){let modifyShader=(shader,name)=>{shader.material;let fs=shader.fragmentShader,marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" ");fs=split[0]+split[1]}for(;fs.includes("#drawbuffer");){fs=fs.split("\n");for(let i=0;i<fs.length;i++)fs[i].includes("#drawbuffer")&&(fs[i]="");fs=fs.join("\n")}for(;fs.includes("#applyShadow");){fs=fs.split("\n");for(let i=0;i<fs.length;i++)_this.renderShadows?fs[i].includes("#applyShadow")&&(fs[i]=""):fs[i].includes("#applyShadow")&&(fs[i]=fs[i].replace("#applyShadow",""));fs=fs.join("\n")}shader.fragmentShader=shader.material.fragmentShader=fs};modifyShader(mesh.material.shader,"Color");let shader=mesh.material.shader.clone(!_this.renderShadows);modifyShader(shader,_this.name||_name),shader.uniforms=shader.material.uniforms=mesh.material.uniforms,shader.material.transparent=mesh.material.transparent,shader.material.depthWrite=mesh.material.depthWrite,shader.material.depthTest=mesh.material.depthTest,mesh.material=shader.material}function editDBShader(mesh){let modifyMarker=(fs,name,index)=>{let marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" ");split[1]=split[1].replace("gl_FragColor",`gl_FragData[${index}]`),fs=split[0]+split[1]}for(;fs.includes("#applyShadow");){fs=fs.split("\n");for(let i=0;i<fs.length;i++)fs[i].includes("#applyShadow")&&(fs[i]=fs[i].replace("#applyShadow",""));fs=fs.join("\n")}return fs},shader=mesh.material.shader,fs=shader.fragmentShader;fs=modifyMarker(fs=modifyMarker(fs,"Color",0),_this.name||_name,_textureIndex),shader.fragmentShader=shader.material.fragmentShader=fs}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){_rt.setSize&&_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}function initRT(){if(_useDrawBuffers){let texture=new THREE.Texture;texture.minFilter=THREE.LinearFilter,texture.magFilter=THREE.LinearFilter,texture.format=THREE.RGBAFormat,_this.rtType&&(texture.type=_this.rtType),texture.wrapS=texture.wrapT=THREE.ClampToEdgeWrapping,_textureIndex=_parentNuke.attachDrawBuffer(texture),_rt={texture:texture}}else _rt=Utils3D.createRT(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr,_this.rtType);_this.rt=_rt}Inherit(this,Component);var _nuke,_rt,_this=this,_scene=new THREE.Scene,_objects=[],_textureIndex=-1,_id=Utils.timestamp(),_name=Utils.getConstructorName(_this),_useDrawBuffers=!0;this.resolution=1,this.enabled=!0,this.renderShadows=!0,this.create=function(nuke=World.NUKE,type){nuke&&(type&&(_this.rtType=type),_useDrawBuffers=nuke.useDrawBuffers,(_this=this).scene=_scene,(_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr,useDrawBuffers:!1})).parentNuke=nuke,_parentNuke=nuke,_this.nuke=_nuke,initRT(),addListeners())},this.addObject=this.add=function(object){if(_nuke){if(_useDrawBuffers)object.material&&editDBShader(object);else{var clone=object.clone();for(object["clone_"+_id]=clone,_scene.add(clone),_objects.push(object),object.material&&editShader(clone);clone.children.length;)clone.remove(clone.children[0])}return clone}},this.removeObject=function(object){_nuke&&(_scene.remove(object["clone_"+_id]),_objects.remove(object),delete object["clone_"+_id])},this.render=this.draw=function(stage,camera){if(!_nuke||!_this.enabled||_useDrawBuffers)return;if(!_parentNuke.enabled||!_objects.length)return;stage&&(_nuke.stage=stage,_this.setSize(stage.width,stage.height)),_nuke.camera=camera||_nuke.parentNuke.camera;let shadowEnabled=_nuke.renderer.shadowMap.enabled;_this.renderShadows||(_nuke.renderer.shadowMap.enabled=!1);for(var i=_objects.length-1;i>-1;i--){var obj=_objects[i],clone=obj["clone_"+_id];clone.visible=!0;for(var parent=obj;parent;)(0==parent.visible||parent.material&&0==parent.material.visible)&&(clone.visible=!1),parent=parent.parent;_this.forceVisible&&(clone.visible=!0),obj.updateMatrixWorld(),obj.ignoreMatrix||Utils3D.decompose(obj,clone)}_nuke.renderer.shadowMap.enabled=shadowEnabled,_nuke.rtt=_rt,_nuke.render()},this.addPass=function(pass){_nuke&&_nuke.add(pass)},this.removePass=function(pass){_nuke&&_nuke.remove(pass)},this.setSize=function(width,height){_nuke&&(_rt.width==width&&_rt.height==height||(_this.events.unsub(Events.RESIZE,resizeHandler),_rt&&_rt.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr),_nuke.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr)))},this.setDPR=function(dpr){_nuke&&(_nuke.dpr=dpr,resizeHandler())},this.setResolution=function(res){_this.resolution=res,resizeHandler()},this.getObjects=function(){return _objects},_parentNuke instanceof Nuke&&this.create(_parentNuke,_type)}),Namespace("FX"),Class(function FXScene(_parentNuke,_type){function initRT(){_rt=Utils3D.createRT(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr,_this.rtType),_this.rt=_rt}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){_rt.setSize&&_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}Inherit(this,Component);var _nuke,_rt,_this=this,_scene=new THREE.Scene,_id=Utils.timestamp(),_objects=[];this.resolution=1,this.autoVisible=!0,this.enabled=!0,this.scene=_scene,this.create=function(nuke=World.NUKE){(_this=this).scene=_scene,_this.nuke=_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr,useDrawBuffers:!1}),initRT(),addListeners()},this.onDestroy=function(){_rt.dispose()},this.setSize=function(width,height){_nuke&&(_rt.width==width&&_rt.height==height||(_this.events.unsub(Events.RESIZE,resizeHandler),_rt&&_rt.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr),_nuke.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr)))},this.add=this.addObject=function(object){let clone=object.clone();for(object["clone_"+_id]=clone,_scene.add(clone),_objects.push(object);clone.children.length;)clone.remove(clone.children[0]);return clone},this.removeObject=function(object){_scene.remove(object["clone_"+_id]),_objects.remove(object),delete object["clone_"+_id]},this.render=this.draw=function(){var clearColor=null;_this.clearColor&&(clearColor=_nuke.renderer.getClearColor().getHex(),_nuke.renderer.setClearColor(_this.clearColor)),_this.clearAlpha>-1&&(_nuke.renderer.getClearAlpha(),_nuke.renderer.setClearAlpha(_this.clearAlpha));for(var i=_objects.length-1;i>-1;i--){var obj=_objects[i],clone=obj["clone_"+_id];if(_this.autoVisible){clone.visible=!0;for(var parent=obj;parent;)(0==parent.visible||parent.material&&0==parent.material.visible)&&(clone.visible=!1),parent=parent.parent}_this.forceRender&&(clone.material.visible=!0),obj.updateMatrixWorld(),obj.ignoreMatrix||(Utils3D.decompose(obj,clone),clone.overrideScale&&clone.scale.setScalar(clone.overrideScale))}_this.preventRTDraw||(_nuke.rtt=_rt,_nuke.render()),_this.clearColor&&_nuke.renderer.setClearColor(clearColor),_this.clearAlpha>-1&&_nuke.renderer.setClearAlpha(_this.clearAlpha)},this.setDPR=function(dpr){return _nuke?(_nuke.dpr=dpr,resizeHandler(),this):this},this.addPass=function(pass){_nuke&&_nuke.add(pass)},this.removePass=function(pass){_nuke&&_nuke.remove(pass)},this.setResolution=function(res){return _this.resolution=res,resizeHandler(),this},_parentNuke instanceof Nuke&&this.create(_parentNuke,_type)}),Class(function BasicPass(){Inherit(this,NukePass);this.fragmentShader=["varying vec2 vUv;","uniform sampler2D tDiffuse;","void main() {","gl_FragColor = texture2D(tDiffuse, vUv);","}"],this.init(this.fragmentShader)}),Class(function Nuke(_stage,_params){function initNuke(){var width=_this.stage.width*_dpr,height=_this.stage.height*_dpr;_rttPing=Nuke.getRT(width,height,!1),_rttPong=Nuke.getRT(width,height,!1),_rttBuffer=Nuke.getRT(width,height,_this.useDrawBuffers),_rttCamera=new THREE.OrthographicCamera(_this.stage.width/-2,_this.stage.width/2,_this.stage.height/2,_this.stage.height/-2,1,1e3),_nukeScene=new THREE.Scene,_nukeMesh=new THREE.Mesh(World.QUAD,new THREE.MeshBasicMaterial),_nukeScene.add(_nukeMesh)}function finalRender(scene,camera){_this.rtt?_this.renderer.render(scene,camera||_this.camera,_this.rtt):_this.renderer.render(scene,camera||_this.camera),_this.postRender&&_this.postRender()}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){var width=_this.stage.width*_dpr,height=_this.stage.height*_dpr;_rttPing.dispose(),_rttPong.dispose(),_rttPing.setSize(width,height),_rttPong.setSize(width,height),_rttBuffer.setSize(width,height),_rttCamera.left=_this.stage.width/-2,_rttCamera.right=_this.stage.width/2,_rttCamera.top=_this.stage.height/2,_rttCamera.bottom=_this.stage.height/-2,_rttCamera.updateProjectionMatrix()}Inherit(this,Component);var _this=this;_params.renderer||console.error("Nuke :: Must define renderer"),_this.stage=_stage,_this.renderer=_params.renderer,_this.camera=_params.camera,_this.scene=_params.scene,_this.rtt=_params.rtt,_this.enabled=0!=_params.enabled,_this.passes=_params.passes||[],_this.useDrawBuffers=void 0!==_params.useDrawBuffers?_params.useDrawBuffers:Device.graphics.webgl&&Device.graphics.webgl.detect("draw_buffers");var _rttPing,_rttPong,_nukeScene,_nukeMesh,_rttCamera,_rttBuffer,_dpr=_params.dpr||1,_rts={},_rtStack=[],_drawBuffers=[];initNuke(),addListeners(),_this.add=function(pass,index){pass.pass?"number"!=typeof index?_this.passes.push(pass):_this.passes.splice(index,0,pass):defer(function(){_this.add(pass,index)})},_this.remove=function(pass){"number"==typeof pass?_this.passes.splice(pass):_this.passes.remove(pass)},_this.renderToTexture=function(clear,rtt){_this.renderer.render(_this.scene,_this.camera,rtt||_rttPing,"boolean"!=typeof clear||clear)},_this.render=function(){if(_this.enabled&&_this.passes.length){_this.renderer.render(_this.scene,_this.camera,_rttBuffer,!0);for(var usedBuffer=!1,pingPong=!0,i=0;i<_this.passes.length-1;i++)_nukeMesh.material=_this.passes[i].pass,usedBuffer=!0,_nukeMesh.material.uniforms.tDiffuse.value=0==i?_rttBuffer.texture:pingPong?_rttPing.texture:_rttPong.texture,_this.renderer.render(_nukeScene,_rttCamera,pingPong?_rttPong:_rttPing),pingPong=!pingPong;_nukeMesh.material=_this.passes[_this.passes.length-1].pass,_nukeMesh.material.uniforms.tDiffuse.value=usedBuffer?pingPong?_rttPing.texture:_rttPong.texture:_rttBuffer.texture,finalRender(_nukeScene,_rttCamera)}else finalRender(_this.scene)},_this.setSize=function(width,height){if(_this.events.unsub(Events.RESIZE,resizeHandler),!_rts[width+"_"+height]){var rttPing=Nuke.getRT(width*_dpr,height*_dpr,_this.useDrawBuffers),rttPong=Nuke.getRT(width*_dpr,height*_dpr,!1),rttBuffer=Nuke.getRT(width*_dpr,height*_dpr,!1);if(_rts[width+"_"+height]={ping:rttPing,pong:rttPong,name:width+"_"+height,buffer:rttBuffer},_rtStack.push(_rts[width+"_"+height]),_rtStack.length>3){let rts=_rtStack.shift();delete _rts[rts.name],rts.ping.dispose(),rts.pong.dispose(),rts.buffer.dispose()}}var rts=_rts[width+"_"+height];if(_rttPing=rts.ping,_rttPong=rts.pong,(_rttBuffer=rts.buffer)&&_rttBuffer.attachments){_rttBuffer.attachments=[_rttBuffer.attachments[0]];for(let i=0;i<_drawBuffers.length;i++)_rttBuffer.attachments.push(_drawBuffers[i])}},_this.attachDrawBuffer=function(texture){if(_drawBuffers.push(texture),_rttBuffer&&_rttBuffer.attachments){_rttBuffer.attachments=[_rttBuffer.attachments[0]];for(let i=0;i<_drawBuffers.length;i++)_rttBuffer.attachments.push(_drawBuffers[i])}return _drawBuffers.length},_this.set("dpr",function(v){_dpr=v||Device.pixelRatio,resizeHandler()}),_this.get("dpr",function(){return _dpr}),_this.get("output",function(){return _nukeMesh.material.uniforms?_nukeMesh.material.uniforms.tDiffuse.value:null}),_this.get("rttBuffer",function(){return _rttBuffer})},function(){Nuke.getRT=function(width,height,multi){return multi?Utils3D.createMultiRT(width,height):Utils3D.createRT(width,height)}}),Class(function NukePass(_fs,_uniforms,_pass){function prefix(code){if(!code)throw`No shader ${_fs} found`;let pre="";return pre+="precision highp float;\n",pre+="precision highp int;\n",code.includes("uniform sampler2D tDiffuse")||(pre+="uniform sampler2D tDiffuse;\n",pre+="varying vec2 vUv;\n"),code=pre+code}Inherit(this,Component);var _this=this;this.UILPrefix="string"==typeof _fs?_fs:Utils.getConstructorName(_fs),this.init=function(fs,vs){if(_this.pass)return;_this=this;let name=fs||this.constructor.toString().match(/function ([^\(]+)/)[1],fragmentShader=Array.isArray(fs)?fs.join(""):null;if(_this.uniforms=_uniforms||_this.uniforms||{},_this.uniforms.tDiffuse={type:"t",value:null},_this.uniforms.unique&&(_this.UILPrefix+="_"+_this.uniforms.unique+"_"),window.UILStorage)for(let key in _this.uniforms)"unique"!==key&&(_this.uniforms[key]=UILStorage.parse(_this.UILPrefix+key)||_this.uniforms[key]);_this.pass=new THREE.RawShaderMaterial({uniforms:_this.uniforms,vertexShader:vs?Shaders.getShader(vs+".vs"):"\n        precision highp float;\n        precision highp int;\n\n        varying vec2 vUv;\n\n        attribute vec2 uv;\n        attribute vec3 position;\n\n        void main() {\n            vUv = uv;\n            gl_Position = vec4(position, 1.0);\n        }\n        ",fragmentShader:fragmentShader||prefix(Shaders.getShader(name+".fs"))}),_this.uniforms=_this.pass.uniforms},this.set=function(key,value){TweenManager.clearTween(_this.uniforms[key]),_this.uniforms[key].value=value},this.get=function(key){return void 0===_this.uniforms[key]?null:_this.uniforms[key].value},this.tween=function(key,value,time,ease,delay,callback,update){return tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)},this.clone=function(){return _this.pass||_this.init(_fs),new NukePass(null,null,_this.pass.clone())},"string"==typeof _fs?_this.init(_fs):_pass&&(_this.pass=_pass,_this.uniforms=_pass.uniforms)}),Class(function Raycaster(_camera){function ascSort(a,b){return a.distance-b.distance}function intersectObject(object,raycaster,intersects,recursive){if(_this.testVisibility){if(!1===object.visible)return;let parent=object.parent;for(;parent;){if(!1===parent.visible)return;parent=parent.parent}}if(object.raycast&&(object.raycast(raycaster,intersects),!0===recursive)){let children=object.children;for(let i=0,l=children.length;i<l;i++)intersectObject(children[i],raycaster,intersects,!0)}}function intersect(objects){Array.isArray(objects)||(objects=[objects]);let intersects=[];return objects.forEach(object=>{intersectObject(object,_raycaster,intersects,!1)}),intersects.sort(ascSort),_debug&&updateDebug(),intersects}function updateDebug(){let vertices=_debug.geometry.vertices;vertices[0].copy(_raycaster.ray.origin.clone()),vertices[1].copy(_raycaster.ray.origin.clone().add(_raycaster.ray.direction.clone().multiplyScalar(1e4))),_debug.geometry.verticesNeedUpdate=!0}Inherit(this,Component);const _this=this;let _mouse=new THREE.Vector3,_raycaster=new THREE.Raycaster,_debug=null;this.testVisibility=!0,this.set("camera",function(camera){_camera=camera}),this.set("pointsThreshold",function(value){_raycaster.params.Points.threshold=value}),this.get("ray",()=>_raycaster.ray),this.debug=function(scene){let geom=new THREE.Geometry;geom.vertices.push(new THREE.Vector3(-100,0,0)),geom.vertices.push(new THREE.Vector3(100,0,0));let mat=new THREE.LineBasicMaterial({color:16711680});_debug=new THREE.Line(geom,mat),scene.add(_debug)},this.checkHit=function(objects,mouse){mouse=mouse||Mouse;let rect=_this.rect||Stage;return mouse===Mouse&&rect===Stage?_mouse.copy(Mouse.tilt):(_mouse.x=mouse.x/rect.width*2-1,_mouse.y=-mouse.y/rect.height*2+1),_raycaster.setFromCamera(_mouse,_camera),intersect(objects)},this.checkFromValues=function(objects,origin,direction){return _raycaster.set(origin,direction,0,Number.POSITIVE_INFINITY),intersect(objects)}},_=>{var _ray;Raycaster.checkHit=function(objects,mouse){return _ray||(_ray=new Raycaster(World.CAMERA)),_ray.checkHit(objects,mouse)},Raycaster.checkFromValues=function(objects,origin,direction){return _ray||(_ray=new Raycaster(World.CAMERA)),_ray.checkFromValues(objects,origin,direction)}}),Class(function ScreenProjection(_camera){Inherit(this,Component);var _this=this,_v3=new THREE.Vector3,_v32=new THREE.Vector3,_value=new THREE.Vector3;this.set("camera",function(v){_camera=v}),this.unproject=function(mouse,distance){var rect=_this.rect||Stage;_v3.set(mouse.x/rect.width*2-1,-mouse.y/rect.height*2+1,.5),_v3.unproject(_camera);var pos=_camera.position;_v3.sub(pos).normalize();var dist=distance||-pos.z/_v3.z;return _value.copy(pos).add(_v3.multiplyScalar(dist)),_value},this.project=function(pos,screen){return screen=screen||Stage,pos instanceof THREE.Object3D?(pos.updateMatrixWorld(),_v32.set(0,0,0).setFromMatrixPosition(pos.matrixWorld)):_v32.copy(pos),_v32.project(_camera),_v32.x=(_v32.x+1)/2*screen.width,_v32.y=-(_v32.y-1)/2*screen.height,_v32}},_=>{var _screen;ScreenProjection.unproject=function(mouse,distance){return _screen||(_screen=new ScreenProjection(World.CAMERA)),_screen.unproject(mouse,distance)},ScreenProjection.project=function(pos,screen){return _screen||(_screen=new ScreenProjection(World.CAMERA)),_screen.project(pos,screen)}}),Class(function Shader(_vertexShader,_fragmentShader,_params){function parseParams(){for(let key in _params)if("useShaderMaterial"==key)_this.useShaderMaterial=_params[key];else if("receiveShadow"==key)_this.receiveShadow=_params[key];else if("receiveLight"==key)_this.receiveLight=_params[key];else if("noAttributes"==key)_this.noAttributes=_params[key];else if("defines"==key)_this.defines=_params[key];else if("lights"==key)_this.lights=_params[key];else if(void 0!==_params[key].value)window.UILStorage?_this.uniforms[key]=UILStorage.parse(_this.UILPrefix+key)||_params[key]:_this.uniforms[key]=_params[key];else{if("unique"==key)continue;_this.properties[key]=_params[key]}}function parseShaders(){_this.vertexShader=process(Shaders.getShader(_vertexShader+".vs")||_vertexShader,"vs"),_this.fragmentShader=process(Shaders.getShader(_fragmentShader+".fs")||_fragmentShader,"fs")}function process(code,type){let header="";_this.useShaderMaterial||_this.receiveShadow?"fs"==type&&(header=["uniform mat4 modelViewMatrix;","uniform mat3 normalMatrix;"].join("\n")):header="vs"==type?["precision highp float;","precision highp int;",_this.noAttributes?"":"attribute vec2 uv;",_this.noAttributes?"":"attribute vec3 position;",_this.noAttributes?"":"attribute vec3 normal;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;"].join("\n"):[code.includes("samplerExternalOES")?"#extension GL_OES_EGL_image_external : require":"","precision highp float;","precision highp int;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;"].join("\n"),header+="\n__ACTIVE_THEORY_LIGHTS__\n\n",window.AURA&&(header+="#define AURA\n");return(code=header+code).replace(/#s?chunk\(\s?(\w+)\s?\);/g,function(a,b){return THREE.ShaderChunk[b]+"\n"})}function addLightingCode(){let lightCode=function(){if(!_this.receiveLight)return"";let numLights=Lighting.getLighting(_this).position.length;return 0==numLights?(Shader.disableWarnings||console.warn("Lighting enabled but 0 lights added. Be sure to add them before calling shader.material"),""):[`#define NUM_LIGHTS ${numLights}`,`uniform vec3 lightPos[${numLights}];`,`uniform vec3 lightColor[${numLights}];`,`uniform float lightIntensity[${numLights}];`,`uniform float lightDistance[${numLights}];`,""].join("\n")}();_this.vertexShader=_this.vertexShader.replaceAll("__ACTIVE_THEORY_LIGHTS__",lightCode),_this.fragmentShader=_this.fragmentShader.replaceAll("__ACTIVE_THEORY_LIGHTS__",lightCode)}function updateMaterialLight(lighting){_material.uniforms.lightPos={type:"v3v",value:lighting.position},_material.uniforms.lightColor={type:"fv",value:lighting.color},_material.uniforms.lightIntensity={type:"fv1",value:lighting.intensity},_material.uniforms.lightDistance={type:"fv1",value:lighting.distance},_this.startRender(updateLights)}function updateLights(){!1!==_material.visible&&Lighting.update(_this,!0)}Inherit(this,Component);const _this=this;let _material;this.receiveShadow=!1,this.receiveLight=!1,this.lights=[],this.persists=!1,this.uniforms={},this.properties={},this.vsName=_vertexShader,this.fsName=_fragmentShader||_vertexShader,"string"!=typeof _fragmentShader&&(_params=_fragmentShader,_fragmentShader=_vertexShader),_params=_params||{},_this.UILPrefix=`${_vertexShader}/${_fragmentShader}/${_params.unique?_params.unique+"/":""}`,parseParams(),parseShaders(),this.get("material",function(){if(!_material){let params={};if(addLightingCode(),params.vertexShader=_this.vertexShader,params.fragmentShader=_this.fragmentShader,params.uniforms=_this.uniforms,_this.receiveShadow)for(let key in THREE.UniformsLib.lights)params.uniforms[key]=THREE.UniformsLib.lights[key];for(let key in _this.properties)params[key]=_this.properties[key];(_material=_this.receiveShadow||_this.useShaderMaterial?new THREE.ShaderMaterial(params):new THREE.RawShaderMaterial(params)).shader=_this,_this.uniforms=_material.uniforms,_material.defines=_this.defines,_this.receiveLight&&updateMaterialLight(_this.__lighting),_this.receiveShadow&&(_material.lights=!0),params.fragmentShader.includes(["dFdx","fwidth"])&&(_material.extensions.derivatives=!0),params.fragmentShader.includes(["gl_FragData","#drawbuffer"])&&World.NUKE.useDrawBuffers&&!params.fragmentShader.includes("fxlayer")&&(_material.extensions.drawBuffers=!0)}return _material}),this.set=function(key,value){return void 0!==value&&(_this.uniforms[key].value=value),_this.uniforms[key].value},this.get=function(key){return"undefined"==typeof value?null:_this.uniforms[key].value},this.tween=function(key,value,time,ease,delay,callback,update){return tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)},this.clone=function(noShadows){noShadows&&(_params.receiveShadow=!1);let shader=new Shader(_vertexShader,_fragmentShader,_params);shader.receiveLight=_this.receiveLight,noShadows||(shader.receiveShadow=_this.receiveShadow),shader.properties=_this.properties;for(let key in _this.uniforms)shader.uniforms[key]={type:_this.uniforms[key].type,value:_this.uniforms[key].value};return shader},this.copyUniformsTo=function(shader,linked){for(let key in _this.uniforms)shader.uniforms[key]=linked?_this.uniforms[key]:{type:_this.uniforms[key].type,value:_this.uniforms[key].value}},this.updateLighting=function(){let lighting=Lighting.getLighting(_this,!0);_material.uniforms.lightPos.value=lighting.position,_material.uniforms.lightColor.value=lighting.color,_material.uniforms.lightIntensity.value=lighting.intensity,_material.uniforms.lightDistance.value=lighting.distance},this.onDestroy=function(){_this.persists||_material&&_material.dispose&&_material.dispose()}}),Class(function GeomThread(){function initThreads(){for(let i=0;i<_this.THREAD_COUNT;i++){let thread=_this.initClass(Thread);thread.loadFunction(loadBufferGeometry,loadSkinnedGeometry,useFn),_threads.push(thread)}}function getThread(){return _threads.length||initThreads(),++_index==_threads.length&&(_index=0),_threads[_index]}function getThreads(){return _threads.length||initThreads(),_threads}function loadBufferGeometry(e,id){get(e.path).then(data=>{e.custom&&self[e.custom](data);let buffers=[];for(let key in data)Array.isArray(data[key])?(data[key]=new Float32Array(data[key]),buffers.push(data[key].buffer)):data[key].length>0&&buffers.push(data[key].buffer);resolve(data,id,buffers)})}function loadSkinnedGeometry(e,id){get(e.path).then(data=>{e.custom&&self[e.custom](data);let buffers=[];for(let key in data)"bones"!=key&&(Array.isArray(data[key])?(data[key]=new Float32Array(data[key]),buffers.push(data[key].buffer)):data[key].length>0&&buffers.push(data[key].buffer));resolve(data,id,buffers)})}function useFn(e){Global.FNS||(Global.FNS=[]),Global.FNS.push(e.name)}Inherit(this,Component);const _this=this;var _cache={},_cacheWait={},_receive={},_threads=[],_index=0;this.THREAD_COUNT=3,this.CACHING=!0,this.includeThree=function(){getThreads().forEach(t=>t.importScript(Thread.absolutePath("assets/js/lib/three.min.js")))},this.loadBufferGeometry=function(path,custom){if(_cache[path])return Promise.resolve(_cache[path]);if(path.includes("assets/geometry/")||(path="assets/geometry/"+path),path.includes(".")||(path+=".json"),path=Thread.absolutePath(path),_this.CACHING){if(_cacheWait[path])return _cacheWait[path];_cacheWait[path]=Promise.create()}return getThread().loadBufferGeometry({path:path,custom:custom}).then(data=>{let geometry;if(custom&&_receive[custom])geometry=_receive[custom](data);else{let geom=new THREE.BufferGeometry;geom.addAttribute("position",new THREE.BufferAttribute(data.position,3)),geom.addAttribute("normal",new THREE.BufferAttribute(data.normal||data.position.length,3)),geom.addAttribute("uv",new THREE.BufferAttribute(data.uv||data.position.length/3*2,2)),data.uv2&&geom.addAttribute("uv2",new THREE.BufferAttribute(data.uv2,2)),geometry=geom}_this.CACHING&&(_cache[path]=geometry),_cacheWait[path].resolve(geometry),delete _cacheWait[path]}),_cacheWait[path]},this.loadSkinnedGeometry=function(path,custom){if(_cache[path])return Promise.resolve(_cache[path]);if(path.includes("assets/geometry/")||(path="assets/geometry/"+path),path.includes(".")||(path+=".json"),path=Thread.absolutePath(path),_this.CACHING){if(_cacheWait[path])return _cacheWait[path];_cacheWait[path]=Promise.create()}return getThread().loadSkinnedGeometry({path:path,custom:custom}).then(data=>{let geometry;if(custom&&_receive[custom])geometry=_receive[custom](data);else{let geom=new THREE.BufferGeometry;geom.addAttribute("position",new THREE.BufferAttribute(data.position,3)),geom.addAttribute("normal",new THREE.BufferAttribute(data.normal||data.position.length,3)),geom.addAttribute("uv",new THREE.BufferAttribute(data.uv||data.position.length/3*2,2)),geom.addAttribute("skinIndex",new THREE.BufferAttribute(data.skinIndices,4)),geom.addAttribute("skinWeight",new THREE.BufferAttribute(data.skinWeights,4)),geom.bones=data.bones.slice(0),geometry=geom}_this.CACHING&&(_cache[path]=geometry),_cacheWait[path].resolve(geometry),delete _cacheWait[path]}),_cacheWait[path]},this.destroyThreads=function(){getThreads().forEach(t=>t.destroy()),_threads=null},this.customFunction=function(fn,receive){var name;getThreads().forEach(t=>{name=t.loadFunction(fn),name=name[0],t.useFn({name:name})}),_receive[name]=receive}},"static"),Class(function Initializer3D(){async function resolve(){await Promise.all(_promises),_this.events.fire(_this.READY),_this.resolved=!0}Inherit(this,Component);const _this=this;var _promises=[];this.READY="initializer_ready",this.promise=function(promise){return _promises.push(promise),clearTimeout(_this.timer),_this.timer=_this.delayedCall(resolve,100),promise},this.ready=function(){return _this.wait(_this,"resolved")},this.createWorld=async function(){await Promise.all([AssetLoader.waitForLib("THREE"),Shaders.ready()]),World.instance()}},"static"),Class(function Utils3D(){var _objectLoader,_geomLoader,_bufferGeomLoader,_this=this,_textures={};AssetLoader.waitForLib("THREE",()=>{window.Vector2||(window.Vector2=THREE.Vector2,window.Vector3=THREE.Vector3,window.Vector4=THREE.Vector4,window.Matrix3=THREE.Matrix3,window.Matrix4=THREE.Matrix4,window.Quaternion=THREE.Quaternion),window.Vec2||(window.Vec2=THREE.Vector2,window.Vec3=THREE.Vector3,window.Vec4=THREE.Vector4,window.Mat3=THREE.Matrix3,window.Mat4=THREE.Matrix4,window.Quat=THREE.Quaternion),Hydra.LOCAL||(window.console.warn=function(str,msg){},window.console.error=function(){})}),this.decompose=function(local,world){local.matrixWorld.decompose(world.position,world.quaternion,world.scale)},this.createDebug=function(size,color){var geom=new THREE.IcosahedronGeometry(size||40,1),mat=color?new THREE.MeshBasicMaterial({color:color}):new THREE.MeshNormalMaterial;return new THREE.Mesh(geom,mat)},this.createRT=function(width,height,type){var params={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,type:type};let rt=new THREE.WebGLRenderTarget(width,height,params);return rt.texture.generateMipmaps=!1,rt},this.createMultiRT=function(width,height){var params={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1};let rt=new THREE.WebGLMultiRenderTarget(width,height,params);return rt.texture.generateMipmaps=!1,rt},this.getFloatType=function(){return"android"==Device.system.os?THREE.FloatType:THREE.HalfFloatType},this.getTexture=function(path){if(!_textures[path]){let texture=new THREE.Texture;texture.promise=Promise.create(),texture._dispose=texture.dispose,texture.dispose=function(){delete _textures[path],this._dispose()},_textures[path]=texture,texture.format=path.includes("jpg")?THREE.RGBFormat:THREE.RGBAFormat,Assets.decodeImage(path).then(imgBmp=>{texture.image=imgBmp,texture.needsUpdate=!0,THREE.Math.isPowerOfTwo(imgBmp.width*imgBmp.height)||(texture.minFilter=THREE.LinearFilter),texture.onUpdate=function(){imgBmp.close&&imgBmp.close(),texture.onUpdate=null},texture.promise.resolve(),texture.onload&&(texture.onload(),texture.onload=null)})}return _textures[path]},this.setInfinity=function(v){var inf=Number.POSITIVE_INFINITY;return v.set(inf,inf,inf),v},this.getCubemap=function(src){var path="cube_"+(Array.isArray(src)?src[0]:src);if(!_textures[path]){for(var images=[],i=0;i<6;i++){var img=new Image;img.crossOrigin="",img.src=Assets.getPath(Array.isArray(src)?src[i]:src),images.push(img),img.onload=function(){_textures[path].needsUpdate=!0}}let texture=new THREE.Texture;texture.image=images,texture.minFilter=THREE.LinearFilter,texture._dispose=texture.dispose,texture.dispose=function(){delete _textures[path],this._dispose()},_textures[path]=texture}return _textures[path]},this.loadObject=function(name){let json="object"==typeof name?name:Assets.JSON[name];if("hydra_c4d"==json.type){let group=new THREE.Group,mat=new THREE.MeshBasicMaterial({wireframe:!0,color:1044480});return json.geometries.forEach(obj=>{let data=obj.data,geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3)),geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal),3)),geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv),2));let mesh=new THREE.Mesh(geometry,mat);mesh.position.copy(obj.position),mesh.rotation.x=obj.rotation.x,mesh.rotation.y=obj.rotation.y,mesh.rotation.z=obj.rotation.z,mesh.scale.copy(obj.scale),mesh.name=obj.id,group.add(mesh)}),group}return _objectLoader||(_objectLoader=new THREE.ObjectLoader),_objectLoader.parse(Assets.JSON[name])},this.loadGeometry=function(name){_geomLoader||(_geomLoader=new THREE.JSONLoader),_bufferGeomLoader||(_bufferGeomLoader=new THREE.BufferGeometryLoader);var json=Assets.JSON[name];return"BufferGeometry"==json.type?_bufferGeomLoader.parse(json):_geomLoader.parse(json.data).geometry},this.disposeAllTextures=function(){for(var key in _textures)_textures[key].dispose()},this.loadBufferGeometry=function(name){console.warn("You should be using GeomThread.loadBufferGeometry instead"),name.includes("geometry/")||(name="geometry/"+name);var data=Assets.JSON[name],geometry=new THREE.BufferGeometry;return data.data&&(data=data.data),geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3)),geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal||data.position.length),3)),geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv||data.position.length/3*2),2)),geometry},this.loadSkinnedGeometry=function(name){console.warn("You should be using GeomThread.loadSkinnedGeometry instead");var data=Assets.JSON[name],geometry=new THREE.BufferGeometry;return geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3)),geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal),3)),geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv),2)),geometry.addAttribute("skinIndex",new THREE.BufferAttribute(new Float32Array(data.skinIndices),4)),geometry.addAttribute("skinWeight",new THREE.BufferAttribute(new Float32Array(data.skinWeights),4)),geometry.bones=data.bones.slice(0),geometry},this.loadCurve=function(obj){"string"==typeof obj&&((obj=Assets.JSON[obj]).curves=obj.curves[0]);for(var data=obj.curves,points=[],j=0;j<data.length;j+=3)points.push(new THREE.Vector3(data[j+0],data[j+1],data[j+2]));return new THREE.CatmullRomCurve3(points)},this.setLightCamera=function(light,size,near,far,texture){light.shadow.camera.left=-size,light.shadow.camera.right=size,light.shadow.camera.top=size,light.shadow.camera.bottom=-size,light.castShadow=!0,near&&(light.shadow.camera.near=near),far&&(light.shadow.camera.far=far),texture&&(light.shadow.mapSize.width=light.shadow.mapSize.height=texture),light.shadow.camera.updateProjectionMatrix()},this.getRepeatTexture=function(src){var texture=_this.getTexture(src);return texture.onload=function(){texture.wrapS=texture.wrapT=THREE.RepeatWrapping},texture},this.forceVisible=function(group){let setProperties=obj=>{void 0!==obj.visible&&(obj.__visible=obj.visible,obj.visible=!0),void 0!==obj.frustumCulled&&(obj.__frustumCulled=obj.frustumCulled,obj.frustumCulled=!1)};group.children.forEach(child=>{setProperties(child),child.material&&setProperties(child.material),_this.forceVisible(child)})},this.resetForceVisible=function(group){let setProperties=obj=>{void 0!==obj.__visible&&(obj.visible=obj.__visible,delete obj.__visible),void 0!==obj.__frustumCulled&&(obj.frustumCulled=obj.__frustumCulled,delete obj.__frustumCulled)};group.children.forEach(child=>{setProperties(child),child.material&&setProperties(child.material),_this.resetForceVisible(child)})},this.findTexturesByPath=function(path){let array=[];for(let key in _textures)key.includes(path)&&array.push(_textures[key]);return array},this.getHeightFromCamera=function(camera){let dist=camera.position.length(),fov=camera.fov;return 2*dist*Math.tan(.5*Math.radians(fov))},this.getPositionFromCameraSize=function(camera,size){let fov=Math.radians(camera.fov);return Math.abs(size/Math.sin(fov/2))},this.geomToExport=function(geom){let output=geom.toJSON(),values={};return["position","uv","normal"].forEach(key=>{let array=[];values[key]=array;let attrib=output.data.attributes[key].array;for(let i=0;i<attrib.length;i++)array.push(Number(attrib[i].toFixed(3)))}),values},this.getEquiRect=function(path,refract){let texture=_this.getTexture(path);return texture.mapping=refract?THREE.EquirectangularRefractionMapping:THREE.EquirectangularReflectionMapping,texture.magFilter=THREE.LinearFilter,texture.minFilter=THREE.LinearMipMapLinearFilter,texture},this.getParticleDepthShader=function(light,size){return new Shader("ParticleDepth",{pointSize:{type:"f",value:size||.5},lightPos:{type:"v3",value:light.position},far:{type:"f",value:light.shadow.camera.far},receiveShadow:!0})},this.setupShadowMap=function(light,size=20,far=60,mapSize=512){light.castShadow=!0,light.shadow.camera.left=-size,light.shadow.camera.right=size,light.shadow.camera.top=size,light.shadow.camera.bottom=-size,light.shadow.camera.far=far,light.shadow.camera.updateProjectionMatrix(),light.shadow.mapSize.width=mapSize,light.shadow.mapSize.height=mapSize},this.setDepthMaterial=function(mesh,light,far){if(!mesh.material.shader.vertexShader.includes(["//startCustomPos","//endCustomPos"]))throw"Custom depth material required startCustomPos/endCustomPos";let pos=mesh.material.shader.vertexShader.split("//startCustomPos")[1];pos=pos.split("//endCustomPos")[0];let uniforms=mesh.material.shader.vertexShader.split("void main")[0],shader=new Shader("CustomShadow",{uLightPos:{type:"v3",value:light.position},uFar:{type:"f",value:far||light.shadow.camera.far},receiveShadow:!0});shader.vertexShader=shader.vertexShader.replace("//customPos",pos),shader.vertexShader=shader.vertexShader.replace("//customUniforms",uniforms),mesh.material.shader.copyUniformsTo(shader,!0),mesh.customDepthMaterial=shader.material}},"static"),Class(function Track(){Inherit(this,Model);const DEBUG=Utils.query("debug");this.page=function(title,path){let data={};title&&(data.page_title=title),path&&(data.page_path=path),window.gtag&&gtag("config",Config.ANALYTICS_ID,data),DEBUG&&(window.gtag||console.log("no gtag"),Config.ANALYTICS_ID||console.log("Config.ANALYTICS_ID required"),console.log(`>>> track page: '${JSON.stringify(data)}'`))},this.event=function(category,action,label,value,params){let data={event:"event",event_category:null,event_action:null,event_label:null,value:null};category&&(data.event_category=category),action&&(data.event_action=action),label&&(data.event_label=label),value&&(data.value=value),params&&(data=Object.assign(params,data)),window.gtag&&gtag("event",action,data),DEBUG&&(window.gtag||console.log("no gtag"),console.log(`>>> track event: '${action}', '${JSON.stringify(data)}'`))}},"Static"),Class(function UILBase(){function initUIL(){Global.UIL?_uil=Global.UIL:(_uil=new UIL.Gui({css:"top: 0; right: 50px;",size:300,center:!0}),Stage.add(_uil),Global.UIL=_uil),_this.flag("invert")&&invert(),addListeners()}function invert(){if(_uil.inner.style.filter="invert(1)",Global.UIL.invert=!0,window.CSS){let css=CSS._read();css+=".noInvert {filter: invert(1);}",CSS._write(css)}}function addListeners(){window.addEventListener("contextmenu",openContext),Stage.bind("click",closeContext)}function openContext(){_context&&_context.destroy(),_context=new UILContextMenu}function closeContext(){_context&&(_context=_context.destroy())}Inherit(this,Component);const _this=this;var _uil,_context;Hydra.ready(()=>{Hydra.LOCAL&&!Device.mobile&&location.search.includes("uil")&&(Global.UIL_ACTIVE=!0,new AssetLoader(["assets/js/app/modules/uil/_uil.min.js"]),AssetLoader.waitForLib("UIL",initUIL))}),this.invert=async function(){_this.flag("invert",!0),await defer(),_uil&&invert()}},"static"),Class(function UILItem(_name,_value,_params={},_callback){function initUIL(){if(_this.obj={name:_name,type:"html",value:_value,callback:callback},_params)for(var key in _params)_this.obj[key]=_params[key]}function callback(v){_value=v,Array.isArray(v)&&1==v.length&&0==v[0]&&(v=0),UILStorage.set(_params.prefix+_name,v),_callback&&_callback(v)}Inherit(this,Component);var _this=this;_params.prefix=_params.prefix?_params.prefix.slice(0,100):"",_value=UILStorage.get(_params.prefix+_name)||_value,"function"==typeof _params&&(_callback=_params,_params=null),_callback&&_callback(_value),initUIL(),this.clear=function(){UILStorage.set(_params.prefix+_name,null)},this.get("value",function(){return _value})}),Class(function UILStorage(){function write(){Dev.writeFile("assets/data/uil.json",_data),__body.css({display:"none"}),_this.delayedCall(()=>{__body.css({display:"block"})},100)}Inherit(this,Component);const _this=this;var _data={};Hydra.ready(_=>{Hydra.LOCAL&&!Device.mobile&&(location.search.includes("uil")||location.port>80)&&__window.bind("keydown",e=>{(e.ctrlKey||e.metaKey)&&83==e.keyCode&&(e.preventDefault(),write())})}),this.wait(Assets.JSON,"data/uil",()=>{_data=Assets.JSON["data/uil"]}),this.set=function(key,value){null===value?delete _data[key]:_data[key]=value},this.setWrite=function(key,value){this.set(key,value),write()},this.clearMatch=function(string){for(let key in _data)key.includes(string)&&delete _data[key];write()},this.write=function(){write()},this.get=function(key){return _data[key]},this.parse=function(key){let data=_data[key];return void 0===data?null:Array.isArray(data)?{value:(new THREE.Color).setRGB(data[0],data[1],data[2])}:{value:data}}},"static"),Class(function InputUIL(){this.create=function(name){return new InputUILConfig(name,Global.UIL)}},"static"),Class(function InputUILConfig(_name){const _this=this;var prefix="INPUT_"+_name,_group=Global.UIL?Global.UIL.add("group",{name:prefix}):null;this.group=_group,this.add=function(key,initValue){if(!_group)return;let value=UILStorage.get(`${prefix}_${key}`)||initValue,change=(val,first)=>{UILStorage.set(`${prefix}_${key}`,val),first||_this.onUpdate&&_this.onUpdate(val)};void 0===initValue||UILStorage.get(`${prefix}_${key}`)||change(initValue,!0),_group.add("string",{name:key,value:value,callback:change})},this.setValue=function(key,value){UILStorage.set(`${prefix}_${key}`,value)},this.get=function(key){return UILStorage.get(`${prefix}_${key}`)},this.getNumber=function(key){return Number(this.get(key))}}),Class(function LightUIL(){Inherit(this,Component);this.exists={},this.add=function(light){return new LightUILGroup(light,Global.UIL)}},"static"),Class(function MeshUIL(){Inherit(this,Component);this.exists={},this.add=function(mesh){return new MeshUILGroup(mesh,Global.UIL)}},"static"),Class(function MeshUILGroup(_mesh,_uil){function initVec(key){if(_group){let val=new UILItem(key,_mesh[key].toArray(),{prefix:prefix},val=>{_mesh[key].fromArray(val),"position"==key&&_mesh.physics&&_mesh.physics.updatePosition()});_group.add("number",val.obj)}_mesh[key].fromArray(UILStorage.get(`${prefix}${key}`)||_mesh[key].toArray())}function initRotation(){let key="rotation",toRadians=array=>array?(array.length=3,array.map(x=>Math.radians(x))):[0,0,0];if(_group){let val=new UILItem(key,(array=>array?(array.length=3,array.map(x=>Math.degrees(x))):[0,0,0])(_mesh[key].toArray()),{prefix:prefix},val=>{_mesh[key].fromArray(toRadians(val)),_mesh.physics&&_mesh.physics.updateRotation()});_group.add("number",val.obj)}_mesh[key].fromArray(toRadians(UILStorage.get(`${prefix}${key}`))),_mesh.physics&&_mesh.physics.updateRotation()}Inherit(this,Component);if(!_mesh.prefix)throw"mesh.prefix required when using MeshUIL";var prefix="MESH_"+_mesh.prefix,_group=Global.UIL&&!MeshUIL.exists[prefix]?Global.UIL.add("group",{name:prefix}):null;MeshUIL.exists[prefix]=!0,initVec("position"),initVec("scale"),initRotation(),this.initVec=initVec}),Class(function PhysicsUIL(){Inherit(this,Component);this.UPDATE="physics_uil_update",this.exists={},this.add=function(group){return new PhysicsUILGroup(group,Global.UIL)}},"static"),Class(function PhysicsUILGroup(_physics,_uil){function initNumber(key){if(_group){let val=new UILItem(key,_physics[key],{prefix:prefix},val=>{_physics[key]=val,_this.events.fire(PhysicsUIL.UPDATE,{prefix:prefix,key:key,val:val})});_group.add("number",val.obj)}let defined=UILStorage.get(`${prefix}${key}`);defined&&(_physics[key]=defined)}function addListeners(){_this.events.sub(PhysicsUIL.UPDATE,updateFromUIL)}function updateFromUIL(e){e.prefix==prefix&&(_physics[e.key]=e.val)}Inherit(this,Component);const _this=this;var prefix="PHYSICS_"+_physics.name;if(!_physics.name)throw"PhysicsUIL requires a name property";var _group=Global.UIL&&!PhysicsUIL.exists[prefix]?Global.UIL.add("group",{name:prefix}):null;!_group&&Global.UIL&&addListeners(),PhysicsUIL.exists[prefix]=!0,initNumber("friction"),initNumber("density"),initNumber("restitution")}),Class(function ShaderUIL(){Inherit(this,Component);var _groups=[];this.exists={},this.UPDATE="update",this.add=function(shader){Global.UIL_ACTIVE&&this.wait(Global,"UIL",()=>{let group=new ShaderUILGroup(shader,Global.UIL);_groups.push(group)})},this.list=function(){_groups.forEach(group=>group.console())},this.clear=function(){_groups.forEach(group=>group.clear())}},"static"),Class(function ShaderUILGroup(_shader,_uil){function initItems(){for(var key in _shader.uniforms){let obj=_shader.uniforms[key];if(!obj.ignoreUIL){if(_shader.UILPrefix.includes("_am_")){if(key.includes("time"))continue;if(key.includes("fSize"))continue;if(key.includes("fTotalNum"))continue}obj.value instanceof THREE.Color&&createColor(obj,key),"number"==typeof obj.value&&createNumber(obj,key)}}}function createNumber(obj,key){let val=new UILItem(key,obj.value,{prefix:_shader.UILPrefix},val=>{obj.value=val,_group&&_this.events.fire(ShaderUIL.UPDATE,{prefix:_shader.UILPrefix,key:key,val:val})});_group&&_group.add("number",val.obj),_objects.push({key:key,obj:obj}),_items.push(val)}function createColor(obj,key){let val=new UILItem(key,obj.value.getHex(),{prefix:_shader.UILPrefix},val=>{Array.isArray(val)?obj.value.setRGB(val[0],val[1],val[2]):obj.value.set(val),_group&&_this.events.fire(ShaderUIL.UPDATE,{prefix:_shader.UILPrefix,key:key,val:val,color:!0})}),uil=_group.add("color",val.obj);_objects.push({key:key,obj:obj}),_items.push(val);for(let i=2;i<uil.c.length;i++)uil.c[i].className="noInvert"}function addListeners(){_this.events.sub(ShaderUIL.UPDATE,update)}function update(e){if(e.prefix==_shader.UILPrefix)if(e.color){let val=e.val,obj=_shader.uniforms[e.key];Array.isArray(val)?obj.value.setRGB(val[0],val[1],val[2]):obj.value.set(val)}else _shader.uniforms[e.key].value=e.val}Inherit(this,Component);var _this=this,_group=Global.UIL&&!ShaderUIL.exists[_shader.UILPrefix]?_uil.add("group",{name:"SHADER_"+function getName(){let split=_shader.UILPrefix.split("/");return split.length>2?split[0]+"_"+split[2]:split[0]}()}):null,_objects=[],_items=[];ShaderUIL.exists[_shader.UILPrefix]=!0,_group?initItems():Global.UIL&&addListeners(),this.console=function(){console.log(_shader.UILPrefix),_objects.forEach(obj=>{"c"==obj.obj.type?console.log(obj.key,"#"+obj.obj.value.getHexString()):console.log(obj.key,obj.obj.value)}),console.log("----")},this.clear=function(){_items.forEach(item=>item.clear())}}),Class(function TimelineUIL(){function removeEditor(){_editor=_editor.destroy()}Inherit(this,Component);const _this=this;var _editor,_created={};this.create=function(name,version){let config=new TimelineUILConfig(name,version,Global.UIL&&!_created[name]);return Global.UIL&&(_created[name]||(_created[name]=config,config.appendUILGroup())),config},this.openEditor=function(name,callbacks){_editor&&_editor.destroy(),_editor=new TimelineUILEditor(name,callbacks),_this.events.sub(_editor,Events.COMPLETE,removeEditor)}},"static"),Class(function TimelineUILConfig(_name,_version=1,_store){function updateConfig(){_config.version=_version,UILStorage.setWrite("TIMELINE_"+_name+"_config",_config)}function edit(){TimelineUIL.openEditor(_name,_callbacks)}function replay(){_callbacks.forEach(obj=>{_this.delayedCall(obj.callback,UILStorage.get("TIMELINE_"+_name+"_"+obj.name)||obj.time)})}Inherit(this,Component);const _this=this;var _callbacks,_config=UILStorage.get("TIMELINE_"+_name+"_config");_store&&(_callbacks=[]),_config?_config.version!=_version&&(updateConfig(),UILStorage.clearMatch("TIMELINE_"+_name)):(_config={},updateConfig()),this.add=function(callback,time,name){name||(name=callback.toString().match(/function ([^\(]+)/)[1]),time=UILStorage.get("TIMELINE_"+_name+"_"+name)||time,_this.delayedCall(callback,time),_store&&_callbacks.push({name:name,time:time,callback:callback})},this.appendUILGroup=function(){let group=Global.UIL.add("group",{name:"TIMELINE_"+_name});group.add("button",{name:"Edit",callback:edit}),group.add("button",{name:"Replay",callback:replay})}}),Class(function TimelineUILEditor(_name,_callbacks){function exit(){_this.events.fire(Events.COMPLETE)}function create({name:name,time:time}){_gui.add("string",{name:name,value:time.toString(),fontColor:"#D4B87B",height:20}).onChange(val=>{UILStorage.setWrite("TIMELINE_"+_name+"_"+name,Number(val))})}Inherit(this,Component);const _this=this;var _gui=new UIL.Gui({width:300,css:"top:0px; left:0px;"});!function(){for(let cb of _callbacks)create(cb);_gui.add("button",{name:"Exit",callback:exit}),Global.UIL.invert&&(_gui.inner.style.filter="invert(1)")}(),this.onDestroy=function(){__body.div.removeChild(_gui.content),_gui.remove()}}),Class(function TweenUIL(){function removeEditor(){_editor=_editor.destroy()}Inherit(this,Component);const _this=this;var _editor,_data={},_created={};this.create=function(name,version=1){let config=new TweenUILConfig(name,version,Global.UIL&&!_created[name]);return Global.UIL&&(_created[name]||(_created[name]=config,config.appendUILGroup())),config},this.openEditor=function(name,tweens){_editor&&_editor.destroy(),_editor=new TweenUILEditor(name,tweens),_this.events.sub(_editor,Events.COMPLETE,removeEditor)},this.set=function(key,value){_data[key]=value},this.get=function(key){return _data[key]}},"static"),Class(function TweenUILConfig(_name,_version=1,_store){function updateConfig(){_config.version=_version,UILStorage.setWrite("TWEEN_"+_name+"_config",_config)}function override(tween,object,props,time,ease,delay){let key="TWEEN_"+_name+"_"+tween._id,storage=UILStorage.get(key),obj={props:props,time:time,ease:ease,delay:delay};for(let key in storage)obj[key]=storage[key];return TweenUIL.set(key,obj),obj}function edit(){TweenUIL.openEditor(_name,_tweens)}var _tweens,_config=UILStorage.get("TWEEN_"+_name+"_config");_store&&(_tweens=[]),_config?_config.version!=_version&&(updateConfig(),UILStorage.clearMatch("TWEEN_"+_name)):(_config={},updateConfig()),this.add=function(tween,name){return tween._id=name,tween.overrideValues=override,_tweens&&_tweens.push(tween),tween},this.appendUILGroup=function(){Global.UIL.add("group",{name:"TWEEN_"+_name}).add("button",{name:"Edit",callback:edit})}}),Class(function TweenUILEditor(_name,_tweens){function createGroup(tween){let obj=TweenUIL.get("TWEEN_"+_name+"_"+tween._id),group=_gui.add("group",{name:tween._id});for(let key in obj)createString(obj,key,group,"TWEEN_"+_name+"_"+tween._id);group.open()}function createString(obj,key,group,lookup){let value=obj[key],height="props"==key?100:20;"props"==key&&(value=JSON.stringify(value,null,"\t")),group.add("string",{name:key,value:value.toString(),fontColor:"#D4B87B",height:height}).onChange(val=>{"props"==key&&(val=JSON.parse(val)),"time"!=key&&"delay"!=key||(val=Number(val)),write(lookup,key,val)})}function write(lookup,key,value){let obj=UILStorage.get(lookup)||{};obj[key]=value,UILStorage.setWrite(lookup,obj)}function exit(){_this.events.fire(Events.COMPLETE)}Inherit(this,Component);const _this=this;var _gui=new UIL.Gui({width:600,css:"top:0px; left:0px;"});this.gui=_gui,function(){for(let tween of _tweens)createGroup(tween);_gui.add("button",{name:"Exit",callback:exit}),Global.UIL.invert&&(_gui.inner.style.filter="invert(1)")}(),this.onDestroy=function(){__body.div.removeChild(_gui.content),_gui.remove()}}),Class(function HotspotTool(_uil){function init(){_meshes=flatten(Rover.parts.map(o=>o.meshes))}function creatPoint(hit){let name=hit.object.name,hotspot=Utils3D.createDebug(.1);hotspot.position.copy(hit.point),hit.object.worldToLocal(hotspot.position),hit.object.add(hotspot),_uil.add(name,hotspot.position)}function raycast(){let hits=Raycaster.checkHit(_meshes,Mouse);if(hits.length)return creatPoint(hits[0])}function AddListeners(){_this.events.sub(KeyboardUtil.DOWN,keypress)}function keypress(e){"Space"===e.code&&raycast()}Inherit(this,Object3D);const _this=this;let _meshes;const flatten=require("Flatten");init(),AddListeners()}),Class(function HotspotUIL(){function initItems(){for(let i=0;i<_count;i++)createItem(i)}function createItem(i,name,position){let item=InputUIL.create(`hotspot_${i}`);item.add("attach",name),item.add("position",position?JSON.stringify(position):null),item.add("key",""),_items[i]=item}Inherit(this,Component);var _count=UILStorage.get("hotspotUIL_config")||0,_items=[];initItems(),this.get("data",_=>{let data=[];for(let item of _items)data.push({attach:item.get("attach"),position:JSON.parse(item.get("position")),key:item.get("key")});return data}),this.add=function(name,position){createItem(_count,name,position),_count++,UILStorage.set("hotspotUIL_config",_count)}}),Class(function Tests(){this.getDPR=function(){return GPU.gt(2)?1.25:GPU.mobileGT(3)?1.75:GPU.OVERSIZED?.9:1},this.simpleUI=function(){return!1},this.renderShadows=function(){return!GPU.mobileGT(2)},this.shadowType=function(){return GPU.lt(1)?THREE.BasicShadowMap:THREE.PCFShadowMap},this.ui3D=function(){return!Device.mobile.phone&&(!(Stage.width<1100||Stage.height<750)&&(!GPU.lt(1)&&!GPU.mobileLT(2)))},this.shadowMapSize=function(){return 1024},this.useAlpha=function(){return"safari"==Device.system.browser&&!Device.mobile},this.rgbShift=function(){return GPU.gt(2)},this.fallback=function(){return!!Utils.query("fallback")||!Device.detect("googlebot")&&("ie"===Device.system.browser&&Device.system.browserVersion<=11||(!Device.graphics.webgl||!!Device.graphics.webgl.detect("adreno (tm) 306")))}},"static"),Class(function WireframeUtil(){function initThread(){(_thread=_this.initClass(Thread)).importScript("assets/js/lib/three.min.js"),_thread.loadFunction(generate)}function generate({positions:positions,normals:normals},id){for(var face,edge=[0,0],hash={},centers=new THREE.BufferAttribute(new Float32Array(positions.length),3),f=0;f<positions.length;f++)centers.array[f]=1;for(var i=0;i<positions.length/9;i++){var a=9*i;face=[[positions[a+0],positions[a+1],positions[a+2]],[positions[a+3],positions[a+4],positions[a+5]],[positions[a+6],positions[a+7],positions[a+8]]];for(var j=0;j<3;j++){var k=(j+1)%3,b=3*j,c=3*k;edge[0]=face[j],edge[1]=face[k],edge.sort(function sortFunction(a,b){return a[0]-b[0]!=0?a[0]-b[0]:a[1]-b[1]!=0?a[1]-b[1]:a[2]-b[2]}),key=edge[0]+" | "+edge[1],void 0==hash[key]?(hash[key]={face1:a,face1vert1:a+b,face1vert2:a+c,face2:void 0,face2vert1:void 0,face2vert2:void 0},0):(hash[key].face2=a,hash[key].face2vert1=a+b,hash[key].face2vert2=a+c)}}for(key in hash){h=hash[key];var normal1,normal2;if(!(void 0!==h.face2&&(normal1=new THREE.Vector3(normals[h.face1+0],normals[h.face1+1],normals[h.face1+2]),normal2=new THREE.Vector3(normals[h.face2+0],normals[h.face2+1],normals[h.face2+2]),normal1.dot(normal2)>=.9999))){var otherVert;otherVert=3-h.face1vert1/3%3-h.face1vert2/3%3,centers.array[h.face1vert1+otherVert]=0,centers.array[h.face1vert2+otherVert]=0,otherVert=3-h.face2vert1/3%3-h.face2vert2/3%3,centers.array[h.face2vert1+otherVert]=0,centers.array[h.face2vert2+otherVert]=0}}let centerBuffer=centers.array;resolve({centerBuffer:centerBuffer},id,[centerBuffer.buffer])}Inherit(this,Component);const _this=this;var _thread;this.apply=async function(geometry){_thread||initThread();let positions=new Float32Array(geometry.attributes.position.array),normals=new Float32Array(geometry.attributes.normal.array),{centerBuffer:centerBuffer}=await _thread.generate({transfer:!0,msg:{positions:positions,normals:normals,buffer:[positions.buffer,normals.buffer]}});geometry.addAttribute("center",new THREE.BufferAttribute(centerBuffer,3)),console.log(centerBuffer)}},"static"),Class(function Blocker(){function initHTML(){($container=_this.element).size("100%").setZ(1e11).bg("#111"),$container.hide(),Stage.add($container),($message=$container.create("rotation-message").size(400,400).center()).css({opacity:0}).transform({scale:1.1}),($icon=$message.create("icon")).size(60,60).center().css({marginTop:-55}).bg("assets/images/ui/rotate.png"),(_anim=_this.initClass(CSSAnimation)).loop=!0,_anim.ease="easeInOutQuint",_anim.duration=3e3,_anim.frames=[{rotation:0},{rotation:-180}],_anim.applyTo($icon),($text=$message.create("text")).size(400,30).css({fontFamily:"Open",color:"#fff",fontSize:12,textTransform:"uppercase",top:"220px",width:"100%",lineHeight:15,letterSpacing:"0.15em",textAlign:"center",marginTop:0}),$text.transform({y:10}).css({opacity:0}),$text.html(_message)}function initSize(){_dimensions.width=Stage.width,_dimensions.height=Stage.height}function rotateMessage(flip){flip?(_this.landscape=!0,_anim.stop(),$container.hide(),$message.css({opacity:0}),$text.css({opacity:0})):($container.show(),_anim.play(),$message.tween({opacity:1,scale:1},1500,"easeOutCubic",200),$text.tween({y:0,opacity:1},4e3,"easeOutCubic",500)),_cover=flip}function addListener(){_this.events.sub(Events.RESIZE,checkOrientation)}function checkOrientation(){Device.mobile.phone&&rotateMessage(Stage.width>Stage.height&&Stage.height<321?!1:!0)}Inherit(this,Element);var $container,$message,$text,$icon,_anim,_this=this,_message="Please rotate<br/>to portrait",_dimensions={},_cover=!1;initHTML(),initSize(),addListener(),checkOrientation(),this.ready=function(){if(!Device.mobile)return Promise.resolve();let promise=Promise.create();return this.wait(promise.resolve,_this,"landscape"),promise}},"Singleton"),Class(function Container(){function initHTML(){Stage.add($this),$this.css({position:"static"})}async function loadView(){let loaderView=_this.initClass(LoaderView),loader=_this.initClass(AssetLoader,Assets.list());loader.add(5),_this.events.sub(loader,Events.PROGRESS,loaderView.progress),_this.events.sub(loader,Events.COMPLETE,()=>{loaderView.animateOut(()=>loaderView=loaderView.destroy())}),UIInstruction.instance().animateIn(),await Initializer3D.createWorld(),Assets.list().filter("images").exclude("svg").forEach(img=>{let fn=img.includes(["terrain","holes","tread","background","code"])?Utils3D.getRepeatTexture:Utils3D.getTexture;Initializer3D.promise(fn(img).promise)}),$this.add(World.ELEMENT),UI.instance(),_this.initClass(Experience),await Initializer3D.ready(),loader.trigger(5),UIInstruction.instance().animateOut(),Blocker.instance(),Footer.instance();let state=Data.getState()||Experience.STATE.landing;state==Experience.STATE.hotspot&&(state=Experience.STATE.explore),state==Experience.STATE.landing?Transition.instance().setValue(-.65):Transition.instance().setValue(1),_this.events.fire(Experience.STATE_UPDATE,{state:state})}Inherit(this,Element);const _this=this,$this=this.element;initHTML(),loadView()},"singleton"),Class(function Experience(){function initViews(){VFX.instance(),_background=_this.initClass(Background),_rover=_this.initClass(Rover),_terrain=_this.initClass(Terrain,_background,_rover.group.position),_particles=_this.initClass(FloatingParticles,_rover.group.position),Hotspots.instance()}function initInteraction(){PageScroll.instance()}function addHandlers(){_this.events.sub(Experience.STATE_UPDATE,updateState)}function updateState(e){Experience.ACTIVE_STATE=e.state}Inherit(this,Component);const _this=this;let _background,_terrain,_rover,_particles;addHandlers(),initViews(),initInteraction()},()=>{Experience.TOGGLE_UI="toggle_ui_event",Experience.ACTIVE_STATE=null,Experience.STATE={landing:"home",explore:"explore",signup:"signup",hotspot:"hotspot"},Experience.STATE_UPDATE="state_update_event",Experience.TRANSITION="transition_event",Experience.SIGNUP_CHANGE="event_signup_change"}),Class(function Footer(){function initHTML(){($this=_this.element).size(20,20).setZ(1),$this.css({bottom:_bottom,left:_left}),$this.attr("role","contentinfo"),$this.attr("tabindex",1),$this.keydown(keydown),Stage.add($this),($info=$this.create("info")).size(12,12).css({fontFamily:"OpenBold",color:"#000",fontSize:10,backgroundColor:"#fff",borderRadius:10,textAlign:"center",lineHeight:12,margin:4}).text("i"),($message=$this.create("message")).css({fontFamily:"Open",color:"white",fontSize:10,textAlign:"left",lineHeight:14,margin:4,opacity:0,width:Device.mobile?300:500}),$message.transform({x:-40}),$message.hide(),$message.html(Config.FOOTER)}function addListeners(){$this.interact(hover,click),_this.events.sub(Mouse.input,Interaction.START,move),_this.events.sub(Mouse.input,Interaction.MOVE,move)}function hover(e){"over"===e.action&&toggle(!0)}function keydown(e){(["Enter","Space"].includes(e.code)||"32"===e.keyCode)&&toggle(!0)}function click(){Device.mobile&&toggle(!_closed)}function move(){Mouse.y<Stage.height-50&&toggle(!1)}function toggle(over){over&&_closed?($info.tween({x:-20,opacity:0},300,"easeOutCubic"),$message.show(),$message.tween({x:0,opacity:1},400,"easeOutCubic",200),_closed=!1):over||!1!==_closed||($message.tween({x:-40,opacity:0},400,"easeOutCubic",function(){$message.hide()}),$info.tween({x:0,opacity:1},300,"easeOutCubic",200),_closed=!0)}Inherit(this,Element);var $this,$info,$message,_this=this,_closed=!0,_left=Device.mobile?30:20,_bottom=(Device.mobile,20);initHTML(),addListeners()},"Singleton"),Class(function PageScroll(){function initScroll(){(_scroll=_this.initClass(Scroll,{limit:!1,axes:["y"],drag:!1})).target=0}function nextPage(){return Experience.ACTIVE_STATE==Experience.STATE.landing?Experience.STATE.explore:Experience.ACTIVE_STATE==Experience.STATE.explore&&Experience.STATE.signup}function prevPage(){return Experience.ACTIVE_STATE==Experience.STATE.explore?Experience.STATE.landing:Experience.ACTIVE_STATE==Experience.STATE.signup&&Experience.STATE.explore}function loop(){let x=_scroll.delta.y-_scroll.delta.x;if(Math.abs(x)<=DELTA||_preventScroll)return;let state,dir=Math.sign(x);1===dir&&(state=nextPage()),-1===dir&&(state=prevPage()),state&&_this.events.fire(Experience.STATE_UPDATE,{state:state}),_preventScroll=!0,_this.delayedCall(()=>_preventScroll=!1,BOUNCE)}function addListeners(){}Inherit(this,Component);const _this=this;let _scroll,_preventScroll;const DELTA=7,BOUNCE=1200;Utils.query("orbit")||Utils.query("noscroll")||Device.mobile.phone||(initScroll(),addListeners(),_this.startRender(loop))},"singleton"),Class(function Playground(){function initThree(){World.instance(),Stage.add(World.ELEMENT)}function initView(){let request=Global.PLAYGROUND.split("/")[0],view=window["Playground"+request]||window[request]||null;if(!view)throw`No Playground class ${request} found.`;(_view=view.instance?view.instance():_this.initClass(view)).element&&Stage.add(_view.element),World.SCENE.add(_view.group||_view.mesh||_view.object3D||new THREE.Group),Dev.expose("view",_view)}Inherit(this,Component);const _this=this;let _view;Global.PLAYGROUND=Utils.query("p"),initThree(),initView(),defer(window.onresize)},"singleton"),Class(function PlaygroundBogie(){function init(){_lRockerBogie=_this.initClass(RockerBogie,1),_rRockerBogie=_this.initClass(RockerBogie,-1)}function AddListeners(){_this.events.sub(KeyboardUtil.PRESS,keypress)}function keypress(e){console.log(e)}Inherit(this,Object3D);const _this=this;let _lRockerBogie,_rRockerBogie;console.log("hello"),init(),AddListeners()}),Class(function SEO(){function initHTML(){Stage.add($this),$this.size("100%"),$this.css({padding:50,boxSizing:"border-box"}),(_logo=_this.initClass(UILogo)).element.css({position:"relative",display:"block",top:0,left:0,marginBottom:40}),_logo.animateIn();var $title=$this.create("title","h1");$title.fontStyle("OpenBold",24,"#FFF"),$title.css({position:"relative",display:"block"}),$title.text(Config.EXPLORE_TITLE[0].text+" "+Config.EXPLORE_TITLE[1].text);var $subtitle=$this.create("subtitle","h2");$subtitle.text(Config.LANDING_TITLE[0].text+". "+Config.LANDING_TITLE[1].text+" "+Config.LANDING_TITLE[2].text),$subtitle.fontStyle("OpenBold",20,"#FFF"),$subtitle.css({position:"relative",display:"block"});var $intro=$this.create("intro","p");$intro.fontStyle("Open",18,"#FFF"),$intro.css({position:"relative",boxSizing:"border-box"}),$intro.html(Config.EXPLORE_INTRO[0]+" "+Config.EXPLORE_INTRO[1]);var $links=$this.create("links","p");$links.fontStyle("Open",20,"#FFF"),$links.html(`<a href="${Config.GITHUB_LINK}" target="_blank">See the plans</a><br><a href="${Config.REDDIT_LINK}" target="_blank">Discuss / FAQ</a>`);var $footer=$this.create("footer","p");$footer.fontStyle("Open",12,"#FFF"),$footer.css({bottom:40}),$footer.html(Config.FOOTER)}Inherit(this,Element);const _this=this,$this=this.element;var _logo;initHTML()},"singleton"),Class(function Transition(){Inherit(this,Component);const _this=this;let _landingTween,_exploreTween,_anim={transition:1},_first=Data.getState()==Experience.STATE.landing;this.setValue=function(value){_this.value=value,_anim.transition=value,_this.events.fire(Experience.TRANSITION,{value:value})},this.toLanding=function(){let p=new Promise.create,first=_first;return _first=!1,_exploreTween&&_exploreTween.stop(),_landingTween=tween(_anim,{transition:0},first?3e3:2200,first?"easeInOutCubic":"easeOutCubic").onUpdate(()=>{_this.value=_anim.transition,_this.events.fire(Experience.TRANSITION,{value:_anim.transition})}).onComplete(()=>{p.resolve(),UIJoystick.instance().delayAutoplay()}),p},this.toExplore=function(){let p=new Promise.create;return _landingTween&&_landingTween.stop(),_anim.transition>=1?p.resolve():(_exploreTween=tween(_anim,{transition:1},2200,"easeOutCubic").onUpdate(()=>{_this.value=_anim.transition,_this.events.fire(Experience.TRANSITION,{value:_anim.transition})}).onComplete(()=>{p.resolve()}),p)}},"singleton"),Class(function UI(){function initHTML(){($this=_this.element).css({position:"static"}).setZ(2),Tests.ui3D()&&$this.enable3D(2e3),Stage.add($this),($wrapper=$this.create("wrapper")).css({position:"static"})}function initStaticViews(){_menu=_this.initClass(MenuController),UIJoystick.instance()}function initNav(){_nav=_this.initClass(NavController)}function addListeners(){_this.events.sub(Experience.STATE_UPDATE,setState),_this.events.sub(Experience.TOGGLE_UI,toggleUI),_this.events.sub(Events.RESIZE,resize)}async function setState({state:state,key:key}){if(Experience.ACTIVE_STATE===state)return;let fromHotspot=!1;if(_views.length){let view=_views.pop();view.hotspot&&(fromHotspot=!0),view.animateOut(()=>view.destroy())}let{landing:landing,explore:explore,signup:signup,hotspot:hotspot}=Experience.STATE;state!==explore&&(fromHotspot=!1);let view;switch(state){case landing:_menu.animateIn(),_nav.animateIn(),UIJoystick.instance().animateIn(),_views.push(_this.initClass(LandingController,[$wrapper])),Track.page("Home","/home");break;case explore:_menu.animateIn(),_nav.animateIn(),UIJoystick.instance().animateIn(),_views.push(_this.initClass(ExploreController,[$wrapper])),Track.page("Explore","/explore");break;case hotspot:_menu.animateOutLinks(),_nav.animateOut(),UIJoystick.instance().animateOut(),(view=_this.initClass(HotspotController,key,[$wrapper])).hotspot=!0,_hotspot=view,_views.push(view),Track.page("Hotspot: "+key,"/hotspot/"+key),Track.event("hotspot","click",key);break;case signup:_menu.animateIn(),_nav.animateIn(),UIJoystick.instance().animateIn(),_views.push(_this.initClass(SignupController,[$wrapper])),Track.page("Get Started","/get-started")}_views[0]&&_views[0].animateIn&&_views[0].animateIn(fromHotspot),resize()}function resize(){_views.forEach(view=>{let scaleX=Math.range(Stage.width,0,1e3,0,1);Device.mobile.phone&&(scaleX=Math.range(Stage.width,0,450,0,1,!0));let scaleY=Math.range(Stage.height,0,440+2*Config.UI_PADDING,0,1),scale=Math.min(scaleX,scaleY);scale=Math.clamp(scale,0,1),_this.scale=scale;let x=Config.UI_PADDING+Math.round(Math.range(Stage.width,1200,3e3,0,700,!0)),y=Config.UI_PADDING+85+Math.round(Math.range(Stage.height,600,2e3,0,300,!0));Device.mobile.phone&&(x=Config.UI_PADDING-20,Stage.width>Stage.height&&Device.system.version>10&&"ios"==Device.system.os&&(x+=30),y=Config.UI_PADDING+55),view.hotspot&&(x=Device.mobile.phone?Config.UI_PADDING-10:0,y+=Device.mobile.phone?-50:30),view.element.transformPoint(0,0).transform({scale:scale,x:x,y:y})})}function loop(){if(Tests.ui3D()&&Global.CAMERA_MOVE){$wrapper.x=15*-Global.CAMERA_MOVE.x,$wrapper.rotationY=4*-Global.CAMERA_MOVE.x,$wrapper.y=15*Global.CAMERA_MOVE.y,$wrapper.rotationX=4*-Global.CAMERA_MOVE.y}else $wrapper.x=$wrapper.y=0,$wrapper.rotationY=$wrapper.rotationX=0;$wrapper.transform()}function toggleUI({show:show}){show?(_menu.animateIn(),_nav.animateIn()):(_menu.animateOut(),_nav.animateOut())}Inherit(this,Element);const _this=this;var $this,$wrapper;let _menu,_nav,_views=[];var _hotspot;new Vector2;initStaticViews(),initHTML(),initNav(),addListeners(),resize(),_this.startRender(loop)},"singleton"),Class(function ExploreController(){function initHTML(){($this=_this.element).css({position:"static",opacity:.85}),_view=_this.initClass(ExploreView)}function addListeners(){_this.events.sub(Events.RESIZE,resize)}function resize(){Stage.height<400?_view.element.size("100%","30vh").css({maxWidth:350}):_view.element.size("100%","60vh").css({maxWidth:540,maxHeight:200})}Inherit(this,Element);const _this=this;var $this;let _view;initHTML(),addListeners(),resize(),"ExploreController"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(hotspot){_this.delayedCall(_view.animateIn,500,hotspot),Hotspots.instance().animateIn(hotspot?1500:2300,hotspot)},this.animateOut=async function(cb){Hotspots.instance().animateOut(),await $this.tween({opacity:0},300,"easeOutSine").promise(),cb()}}),Class(function HotspotController(_key){function initHTML(){($this=_this.element).css({position:"static"});let data=ConfigHotspots.DATA[_key];_view=_this.initClass(HotspotView,data,_key)}function addHandlers(){_this.events.sub(Events.RESIZE,resize)}function resize(){Device.mobile.phone&&Stage.width<Stage.height?_view.element.size("100%","80vh").css({maxHeight:200,left:0,right:0}):_view.element.size("100%","60vh").css({maxWidth:380,maxHeight:Device.mobile.phone?300:350,left:Device.mobile.phone?"80%":"60%",marginLeft:10})}Inherit(this,Element);const _this=this;var $this,_view;initHTML(),addHandlers(),resize(),"HotspotController"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(){_view.animateIn(),Hotspots.instance().animateOut()},this.animateOut=async function(cb){RoverOrbitCamera.instance().reset(),Hotspots.instance().animateIn(500),await _view.animateOut(),cb()}}),Class(function LandingController(){function initHTML(){($this=_this.element).css({position:"static",opacity:.85}),(_view=_this.initClass(LandingView)).element.css({pointerEvents:"none"})}function addListeners(){_this.events.sub(Events.RESIZE,resize)}function resize(){}Inherit(this,Element);const _this=this;var $this;let _view;initHTML(),addListeners(),resize(),"LandingController"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(){Transition.instance().toLanding(_this.first),Global.FIRST_LOAD=!1,_this.delayedCall(_view.animateIn,500)},this.animateOut=async function(cb){Transition.instance().toExplore(),Global.FIRST_LOAD=!1,await $this.tween({opacity:0},300,"easeOutSine").promise(),cb()}}),Class(function MenuController(){function initHTML(){($this=_this.element).css({position:"static"})}function initViews(){_logo=_this.initClass(UILogo),_mobile=_this.initClass(UIMobileMenu),_menu=_this.initClass(UIMenu)}function addListeners(){_this.events.sub(_logo,Events.CLICK,logoClick),_this.events.sub(Events.RESIZE,resize)}function logoClick(){_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.landing})}function resize(){let offset=Stage.width>Stage.height&&Device.system.version>10&&"ios"==Device.system.os?30:0;_logo.element.css({top:Config.UI_PADDING-10,left:Config.UI_PADDING-12+offset}),Device.mobile.phone&&Stage.width<Stage.height?(_mobile.element.show(),_menu.element.css({top:"",right:"",bottom:Config.UI_PADDING+(Device.mobile.phone?10:0),left:Config.UI_PADDING+offset}),_mobile.element.css({top:Config.UI_PADDING,right:Config.UI_PADDING})):(Device.mobile.phone?_mobile.element.show():_mobile.element.hide(),_mobile.element.css({top:Config.UI_PADDING,right:Stage.width-280-offset}),_menu.element.css({top:Config.UI_PADDING,right:Config.UI_PADDING}))}Inherit(this,Element);const _this=this;var $this,_menu,_logo,_mobile;initHTML(),initViews(),addListeners(),resize(),this.animateIn=function(){return $this.show().mouseEnabled(!0),_mobile?Promise.all([_mobile.animateIn(),_menu.animateIn(),_logo.animateIn()]):Promise.all([_menu.animateIn(),_logo.animateIn()])},this.animateOut=async function(){console.log("out"),$this.mouseEnabled(!1),_mobile?await Promise.all([_mobile.animateOut(),_menu.animateOut(),_logo.animateOut()]):await Promise.all([_menu.animateOut(),_logo.animateOut()]),$this.hide()},this.animateOutLinks=async function(){console.log("out links"),$this.mouseEnabled(!1),_mobile?await Promise.all([_mobile.animateOut(),_menu.animateOut(),_logo.animateOut()]):await Promise.all([_menu.animateOut(),_logo.animateOut()]),$this.hide()}}),Class(function NavController(){function initHTML(){($this=_this.element).css({position:"static"})}function initViews(){(_nav=_this.initClass(UINav)).element.css({right:Config.UI_PADDING})}function addHandlers(){_this.events.sub(Events.RESIZE,resize)}function resize(){Device.mobile.phone?$this.hide():$this.show(),_nav.element.css({top:.5*(Stage.height-_nav.height)})}Inherit(this,Element);const _this=this;var $this,_nav;initHTML(),initViews(),addHandlers(),resize(),this.animateIn=function(){_nav.animateIn()},this.animateOut=function(){_nav.animateOut()}}),Class(function SignupController(){function initHTML(){($this=_this.element).css({position:"static",opacity:.85}),_view=_this.initClass(SignupView)}function addListeners(){_this.events.sub(Events.RESIZE,resize)}function resize(){}Inherit(this,Element);const _this=this;var $this;let _view;initHTML(),addListeners(),resize(),"SignupController"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(){_this.delayedCall(_view.animateIn,500)},this.animateOut=async function(cb){await $this.tween({opacity:0},300,"easeOutSine").promise(),cb()}}),Class(function World(){function initWorld(){World.PLANE=new THREE.PlaneBufferGeometry(1,1),World.QUAD=new THREE.PlaneBufferGeometry(2,2),World.BOX=new THREE.BoxBufferGeometry(1,1,1),RenderGL.initialize(RenderGL.NORMAL,{powerPreference:"high-performance",alpha:Tests.useAlpha()}),_renderer=RenderGL.threeRenderer,_scene=RenderGL.scene,_camera=RenderGL.camera.worldCamera,_nuke=RenderGL.nuke,Tests.renderShadows()&&(_renderer.shadowMap.enabled=!0,_renderer.shadowMap.type=Tests.shadowType()),World.SCENE=_scene,World.RENDERER=_renderer,World.ELEMENT=$(_renderer.domElement),World.CAMERA=_camera,World.NUKE=_nuke,World.TIME={ignoreUIL:!0,type:"f",value:0},World.RESOLUTION={ignoreUIL:!0,type:"v2",value:new THREE.Vector2(Stage.width*World.DPR,Stage.height*World.DPR)},World.GROUP=new THREE.Group,_scene.add(World.GROUP)}function initControls(){_controls=new THREE.OrbitControls(_camera,World.ELEMENT.div),RenderGL.type==RenderGL.NORMAL?(_camera.position.set(0,20,30),_camera.target=new THREE.Vector3(0,0,0),_camera.lookAt(_camera.target),_controls.target=_camera.target):_controls.enabled=!1,World.CONTROLS=_controls}function addHandlers(){_this.events.sub(Events.RESIZE,resize)}function resize(){_renderer.setSize(Stage.width,Stage.height),_camera.aspect=Stage.width/Stage.height,_camera.updateProjectionMatrix(),World.RESOLUTION.value.set(Stage.width*World.DPR,Stage.height*World.DPR)}function loop(t,delta){World.TIME.value+=.001*delta,_controls&&_controls.enabled&&_controls.update(),RenderGL.render()}Inherit(this,Component);const _this=this;let _renderer,_scene,_camera,_nuke,_controls;World.DPR=Tests.getDPR(),initWorld(),initControls(),addHandlers(),_this.startRender(loop),RenderGL.type==RenderGL.NORMAL&&Camera.instance(_camera)},function(){var _instance;World.instance=function(){return _instance||(_instance=new World),_instance}}),Class(function Background(){function init(){let open=_this.initClass(BackgroundOpen),mars=_this.initClass(BackgroundMars);_this.open=open.rt.texture,_this.mars=mars.rt.texture,Background.open=_this.open;let shader=_this.initClass(Shader,"Background",{uOpen:{value:_this.open},uMars:{value:_this.mars},depthWrite:!1}),mesh=new THREE.Mesh(World.QUAD,shader.material);mesh.frustumCulled=!1,World.GROUP.add(mesh),FX.Mars.instance().addObject(mesh)}Inherit(this,Component);const _this=this;init()},_=>{var _geom;Background.getGeometry=function(){return _geom||(_geom=new THREE.IcosahedronBufferGeometry(1,3)),_geom}}),Class(function BackgroundMars(){function initMesh(){let geometry=Background.getGeometry(),shader=_this.initClass(Shader,"BackgroundMars",{uTexture:{value:Utils3D.getRepeatTexture("assets/images/background/mars.jpg")},side:THREE.BackSide});ShaderUIL.add(shader);let mesh=new THREE.Mesh(geometry,shader.material);mesh.scale.multiplyScalar(100),mesh.frustumCulled=!1,_this.scene.add(mesh),_this.startRender(()=>{mesh.rotation.y+=.002,mesh.position.copy(World.CAMERA.position),mesh.position.y=0})}Inherit(this,FXScene);const _this=this;_this.create(),_this.resolution=.5,_this.nuke.dpr=1,initMesh(),_this.startRender(_=>_this.render()),_this.events.sub(Events.RESIZE,_=>_this.render())}),Class(function BackgroundOpen(){function initMesh(){let geometry=Background.getGeometry(),shader=_this.initClass(Shader,"BackgroundOpen",{uTexture:{value:Utils3D.getRepeatTexture("assets/images/background/open.jpg")},side:THREE.BackSide});ShaderUIL.add(shader);let mesh=new THREE.Mesh(geometry,shader.material);mesh.scale.multiplyScalar(100),mesh.frustumCulled=!1,_this.scene.add(mesh),_this.startRender(()=>{mesh.rotation.y+=.003,mesh.position.copy(World.CAMERA.position),mesh.position.y=0})}Inherit(this,FXScene);const _this=this;_this.create(),_this.resolution=.5,_this.nuke.dpr=1,initMesh(),_this.startRender(_=>_this.render()),_this.events.sub(Events.RESIZE,_=>_this.render())}),Class(function Hotspot(_index,_data,_parent){function initProps(){_this.position=_data.position,_this.attach=_data.attach,_this.index=_index,_this.key=_data.key}function initContainer(){(_null=new THREE.Group).position.copy(_data.position),_null.position.add((new Vector3).applyQuaternion(_parent.getWorldQuaternion())),_null.prefix=`${KEY}_offset`,MeshUIL.add(_null),_parent.add(_null),_worldSibling=new THREE.Group,World.GROUP.add(_worldSibling)}function initMesh(){_shader=_this.initClass(Shader,"Hotspot",{uColorInner:{value:new THREE.Color(15601688)},uColorOuter:{value:new THREE.Color(16777215)},uColorVisited:{value:new THREE.Color(2441870)},uVisited:{value:0},uTransition:{value:0},transparent:!0}),(_mesh=new THREE.Mesh(World.QUAD,_shader.material)).scale.setScalar(.01),_worldSibling.add(_mesh)}function initHitMesh(){(_hit=new THREE.Mesh(World.BOX,new THREE.MeshBasicMaterial({wireframe:!0,visible:!1}))).scale.setScalar(3*SCALE),_this.hit=_hit,_worldSibling.add(_hit)}function loop(){_quaternion.copy(_parent.getWorldQuaternion()).inverse(),_mesh.quaternion.copy(World.CAMERA.quaternion),_worldSibling.position.copy(_null.getWorldPosition())}Inherit(this,Object3D);const _this=this;let _mesh,_shader,_hit,_worldSibling,_null,_quaternion=new THREE.Quaternion;const SCALE=.15,KEY=`hotspot_${_index}`;initProps(),initContainer(),initMesh(),initHitMesh(),_this.startRender(loop),this.click=function(){console.log("clicked"),_shader.tween("uVisited",1,500,"easeOutSine")},this.over=function(fade){UIJoystick.instance().delayAutoplay();let scale=fade?.8:1.4;return tween(_mesh.scale,{x:SCALE*scale,y:SCALE*scale,z:SCALE*scale},300,"easeOutBack"),_shader.tween("uTransition",fade?.4:1,300,"easeOutBack").promise()},this.out=function(){return tween(_mesh.scale,{x:SCALE,y:SCALE,z:SCALE},300,"easeOutBack"),_shader.tween("uTransition",.7,500,"easeOutBack").promise()},this.transition=function(value,index){_shader.uniforms.uTransition.value=value},this.reset=function(){_shader.uniforms.uTransition.value=0,_mesh.scale.setScalar(.01)},this.animateIn=function(delay=0){tween(_mesh.scale,{x:SCALE,y:SCALE,z:SCALE},600,"easeOutBack",delay),_shader.tween("uTransition",.7,800,"easeInOutCubic",delay)},this.animateOut=function(delay=0){tween(_mesh.scale,{x:.01,y:.01,z:.01},600,"easeInBack",delay),_shader.tween("uTransition",0,800,"easeInOutCubic",delay)}}),Class(function Hotspots(){function initInteraction(){(_interaction=_this.initClass(Interaction3D)).enabled=!1}function loadHotspots(){_uil=_this.initClass(HotspotUIL),_data=_uil.data}function initHotspots(){for(let i=0;i<_data.length;i++){let parent=World.SCENE.getObjectByName(_data[i].attach,!0),hotspot=_this.initClass(Hotspot,i,_data[i],parent);_interaction.add([hotspot.hit],e=>hover(e,hotspot),e=>click(e,hotspot)),_hotspots.push(hotspot)}_this.hotspots=_hotspots}function hotspotsTool(){(Hydra.LOCAL||"tool"===Global.PLAYGROUND)&&_this.initClass(HotspotTool,_uil)}function addListeners(){_this.events.sub(Experience.STATE_UPDATE,state)}function click(e,hotspot){hotspot.click(),_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.hotspot,key:hotspot.key})}function hover(e,hotspot){Device.mobile||("over"===e.action?_hotspots.forEach((h,i)=>{h.index===hotspot.index?h.over():h.over(!0)}):_hotspots.forEach((h,i)=>h.out()))}function state({state:state}){_interaction.enabled=state===Experience.STATE.explore}Inherit(this,Object3D);const _this=this;let _uil,_data,_interaction,_hotspots=[];!async function(){await Initializer3D.ready(),initInteraction(),loadHotspots(),initHotspots(),hotspotsTool(),addListeners(),World.GROUP.add(_this.group)}(),this.animateIn=function(delay=0,fast){_hotspots.map((h,i)=>h.animateIn(delay+i*(fast?50:100)))},this.animateOut=function(delay=0){_hotspots.map((h,i)=>h.animateOut(delay+30*i))}},"singleton"),Class(function Rover(){function initCameras(){_camera=RoverOrbitCamera.instance()}function initRaycast(){_raycast=_this.initClass(RoverRaycast)}function initMovement(){_movement=_this.initClass(RoverMovement,_camera),_this.movement=_movement}function initMarsModel(){_chassisMars=_this.initClass(MarsChassis,_transition),_lRockerBogieMars=_this.initClass(MarsRockerBogie,1,_transition),_rRockerBogieMars=_this.initClass(MarsRockerBogie,-1,_transition),_this.inner.add(_lRockerBogieMars.group),_this.inner.add(_rRockerBogieMars.group),_this.inner.add(_chassisMars.group)}function initOpenModel(){_chassis=_this.initClass(OpenChassis,_transition),_lRockerBogie=_this.initClass(OpenRockerBogie,1,_transition),_rRockerBogie=_this.initClass(OpenRockerBogie,-1,_transition),_this.chassis=_chassis,_this.lRockerBogie=_lRockerBogie,_this.rRockerBogie=_rRockerBogie,_this.inner.add(_lRockerBogie.group),_this.inner.add(_rRockerBogie.group),_this.inner.add(_chassis.group),Rover.parts=[_lRockerBogie,_rRockerBogie,_chassis]}function initAnimation(){_animation=_this.initClass(RoverAnimation)}function loop(){if(_camera.update(_this.group.position),_transition.value+=.04*(_targetTransition-_transition.value),_transition.value<.001&&(_transition.value=0),_transition.value>.999&&(_transition.value=1),_light&&(_light.position.copy(_this.group.position),_light.target.position.copy(_this.group.position),_light.position.add(_light.offset)),!(_lRockerBogie.loaded&&_chassis.loaded&&_lRockerBogieMars.loaded&&_chassisMars.loaded))return;_openMeshes||(_openMeshes=[..._chassis.meshes,..._lRockerBogie.meshes,..._rRockerBogie.meshes]),_marsMeshes||(_marsMeshes=[..._chassisMars.meshes,..._lRockerBogieMars.meshes,..._rRockerBogieMars.meshes]),_this.isRendered&&(_openMeshes.forEach(mesh=>{mesh.visible=_transition.value>.5}),_marsMeshes.forEach(mesh=>{mesh.visible=_transition.value<.5})),_this.isRendered=!0,_movement.update(),_this.group.rotation.y=_movement.rotation,_this.group.position.x=_movement.pos.x+_this.animationOffset.x,_this.group.position.z=_movement.pos.z+_this.animationOffset.z,_this.group.updateMatrixWorld(!0),_raycast.update();let o=_raycast.output,o2=_raycast.output2;for(let prop in _this.raycastOffsets)o[prop]+=_this.raycastOffsets[prop];let[ly,lr]=_lRockerBogie.update(o.la,o.lb,o.lc,o.lLengthAB,o.lLengthC,o.rb,o.lengthLR,_movement.wheelRotation,_movement.speed),[ry,rr]=_rRockerBogie.update(o.ra,o.rb,o.rc,o.rLengthAB,o.rLengthC,o.lb,o.lengthLR,_movement.wheelRotation,_movement.speed);_chassis.update(lr,rr);let[mly,mlr]=_lRockerBogieMars.update(o2.la,o2.lb,o2.lc,o2.lLengthAB,o2.lLengthC,o2.rb,o2.lengthLR,_movement.wheelRotation,_movement.speed),[mry,mrr]=_rRockerBogieMars.update(o2.ra,o2.rb,o2.rc,o2.rLengthAB,o2.rLengthC,o2.lb,o2.lengthLR,_movement.wheelRotation,_movement.speed);_chassisMars.update(mlr,mrr),_this.group.position.y=Math.mix((mly+mry)/2,(ly+ry)/2,_transition.value)+_this.animationOffset.y,_this.group.rotation.z=Math.mix(Math.asin((mly-mry)/o2.lengthLR),Math.asin((ly-ry)/o.lengthLR),_transition.value),_this.inner.position.y+=.1*(2*Math.smoothStep(.5,.35,Math.abs(_transition.value-.5))-_this.inner.position.y),_this.inner.rotation.y+=.1*(Math.smoothStep(.1,.9,_transition.value)*Math.PI*2*1-_this.inner.rotation.y),_this.group.updateMatrixWorld(!0),_chassis.updatePivots(_lRockerBogie,_rRockerBogie)}function addHandlers(){_this.events.sub(Experience.TRANSITION,transition)}function transition(e){_targetTransition=Math.abs(e.value)}Inherit(this,Object3D);const _this=this;let _camera,_raycast,_movement,_light,_animation,_lRockerBogieMars,_rRockerBogieMars,_chassisMars,_lRockerBogie,_rRockerBogie,_chassis,_openMeshes,_marsMeshes,_transition={value:0};Rover.TRANSITION=_transition;let _targetTransition=0;_this.animationOffset=new Vec3,_this.raycastOffsets={la:0,lb:0,lc:0,ra:0,rb:0,rc:0},_this.inner=new THREE.Group,_this.add(_this.inner),World.GROUP.add(_this.group),Rover.ROTATION=_this.group.rotation,function initLight(){(_light=new THREE.DirectionalLight(16777215,1)).offset=new Vec3(-10,10,10),Utils3D.setupShadowMap(_light,5,200,Tests.shadowMapSize()),World.SCENE.add(_light),World.SCENE.add(_light.target),FX.Mars.instance().add(_light),FX.Mars.instance().add(_light.target)}(),initCameras(),initRaycast(),initMovement(),initMarsModel(),initOpenModel(),initAnimation(),addHandlers(),_this.startRender(loop)}),Class(function RoverAnimation(){function initAnimations(){for(let prop in ConfigHotspots.DATA){let d=ConfigHotspots.DATA[prop];d.animation&&window[d.animation]&&(_animations[prop]=_this.initClass(window[d.animation],_this.parent),_this.parent.group.add(_animations[prop].group))}}function addHandlers(){_this.events.sub(Experience.STATE_UPDATE,stateUpdate)}function stateUpdate({state:state,key:key}){state===Experience.STATE.hotspot?_animations[key]&&(_active=_animations[key],_animations[key].activate()):_active&&(_active.deactivate&&_active.deactivate(),_active=null)}Inherit(this,Component);const _this=this;let _active,_animations={};initAnimations(),addHandlers()}),Class(function RoverAnimationBase(){function initCamera(){_this.camera=_this.initClass(GazeCamera),_this.camera.group.rotation.reorder("YXZ"),_this.camera.position.z=5,_this.camera.moveXY.set(1,1)}Inherit(this,Object3D);const _this=this;initCamera(),this.activate=function(){_this.camera.transition(2e3)}}),Class(function RoverAnimationChassis(_rover){function init(){_this.camera.position.y=4.5,_this.camera.position.z=8,_this.camera.group.rotation.y=3.14,_this.camera.lookAt.set(1.7,2.5,3);let lookAt=new Vec3(1.7,2.5,3);_this.startRender(()=>{let portaitPhone=Device.mobile.phone&&Stage.width<Stage.height;lookAt.x=portaitPhone?0:1.7,lookAt.y=portaitPhone?4:2.5,_this.camera.lookAt.lerp(lookAt,.1)})}function initShader(){_shader=_this.initClass(Shader,"RoverAddons",{uTime:World.TIME,uAlpha:{value:0},transparent:!0})}async function initInternals(){let[geometry]=await Promise.all([GeomThread.loadBufferGeometry("addons/internals")]),mesh=new THREE.Mesh(geometry,_shader.material);_group.add(mesh)}async function initAddons(){let[cameraGeom,speakerGeom,armGeom,xboxGeom]=await Promise.all([GeomThread.loadBufferGeometry("addons/camera"),GeomThread.loadBufferGeometry("addons/ultrasonico"),GeomThread.loadBufferGeometry("addons/arm"),GeomThread.loadBufferGeometry("addons/xbox")]),camera=new THREE.Mesh(cameraGeom,_shader.material),speaker=new THREE.Mesh(speakerGeom,_shader.material),arm=new THREE.Mesh(armGeom,_shader.material),xbox=new THREE.Mesh(xboxGeom,_shader.material);_group.add(camera),_group.add(speaker),_group.add(arm),_group.add(xbox),_this.startRender(t=>{let time=.001*t,z=-.8;camera.position.x=1.2*Math.cos(time),camera.position.y=1.2*Math.sin(time)*.5+1.4,camera.position.z=z,camera.rotation.x=.13,camera.rotation.y+=.01,speaker.position.x=1.2*Math.cos(time+2*Math.PI/4),speaker.position.y=1.2*Math.sin(time+2*Math.PI/4)*.5+1.4,speaker.position.z=z,speaker.rotation.x=.13,speaker.rotation.y+=.01,arm.position.x=1.2*Math.cos(time+2*Math.PI*2/4),arm.position.y=1.2*Math.sin(time+2*Math.PI*2/4)*.5+1.4,arm.position.z=z,arm.rotation.x=.13,arm.rotation.y+=.01,xbox.position.x=1.2*Math.cos(time+3*Math.PI*2/4),xbox.position.y=1.2*Math.sin(time+3*Math.PI*2/4)*.5+1.4,xbox.position.z=z,xbox.rotation.x=.13,xbox.rotation.y+=.01})}function initCode(){(_codeShader=_this.initClass(Shader,"RoverAddonCode",{uAlpha:{value:0},uTime:World.TIME,uTexture:{value:Utils3D.getRepeatTexture("assets/images/rover/code.jpg")},transparent:!0})).uniforms.uTexture.value.magFilter=THREE.NearestFilter;let code=new THREE.Mesh(World.PLANE,_codeShader.material);code.rotation.set(.5,Math.PI,0),code.scale.set(1,2,1),code.position.set(0,-.78,-1.5),_group.add(code)}Inherit(this,RoverAnimationBase);const _this=this;let _shader,_codeShader,_group=_rover.chassis.addons;init(),initShader(),initInternals(),initAddons(),initCode(),this.activate=function(){_this._activate(),_rover.chassisShader.material.transparent=!0,_rover.chassisShader.tween("uAlpha",.25,2e3,"easeInOutCubic"),_shader.tween("uAlpha",1,2e3,"easeInOutCubic"),_codeShader.tween("uAlpha",.5,2e3,"easeInOutCubic")},this.deactivate=function(){_rover.chassisShader.tween("uAlpha",1,2e3,"easeInOutCubic",_=>{_rover.chassisShader.material.transparent=!1}),_shader.tween("uAlpha",0,2e3,"easeInOutCubic"),_codeShader.tween("uAlpha",0,2e3,"easeInOutCubic")}}),Class(function RoverAnimationFace(_rover){function init(){_this.camera.position.y=5,_this.camera.lookAt.set(1.7,3,0);let lookAt=new Vec3(1.7,3,0);_this.startRender(()=>{let portaitPhone=Device.mobile.phone&&Stage.width<Stage.height;lookAt.x=portaitPhone?0:1.7,lookAt.y=portaitPhone?4:3,_this.camera.lookAt.lerp(lookAt,.1)})}Inherit(this,RoverAnimationBase);const _this=this;let _shader=_rover.chassis.screenShader;init(),this.activate=function(){_this._activate(),_shader.uniforms.uSprite.value=Utils3D.getTexture("assets/images/rover/screen/sprite2.jpg"),_shader.uniforms.uGlow.value=Utils3D.getTexture("assets/images/rover/screen/glow2.jpg"),_shader.uniforms.uCells.value=new Vec2(4,6),_shader.uniforms.uIndex.value=0},this.deactivate=function(){_shader.uniforms.uSprite.value=Utils3D.getTexture("assets/images/rover/screen/sprite.jpg"),_shader.uniforms.uGlow.value=Utils3D.getTexture("assets/images/rover/screen/glow.jpg"),_shader.uniforms.uCells.value=new Vec2(4,4),_shader.uniforms.uIndex.value=0}}),Class(function RoverAnimationPivot(_rover){function init(){_this.camera.position.z=9,_this.camera.position.y=4,_this.camera.group.rotation.y=1.57,_this.camera.lookAt.set(1.7,1.8,0);let lookAt=new Vec3(1.7,1.8,0);_this.startRender(()=>{let portaitPhone=Device.mobile.phone&&Stage.width<Stage.height;_this.camera.position.z+=.1*((portaitPhone?13:9)-_this.camera.position.z),lookAt.x=portaitPhone?0:1.7,lookAt.y=portaitPhone?3.5:1.8,_this.camera.lookAt.lerp(lookAt,.1)})}function initArrows(){_leftArrowShader=initArrowSide(_rover.lRockerBogie.arrowBogie,_rover.lRockerBogie.arrowRocker,1,new THREE.Color("#ff585f")),_rightArrowShader=initArrowSide(_rover.rRockerBogie.arrowBogie,_rover.rRockerBogie.arrowRocker,-1,new THREE.Color("#cffcff"))}function initArrowSide(bogie,rocker,dir,color){let arrowShader=_this.initClass(Shader,"RoverArrow",{uTime:World.TIME,uTexture:{value:Utils3D.getTexture("assets/images/rover/arrow.jpg")},uColor:{value:color},uAlpha:{value:0},side:THREE.DoubleSide,transparent:!0}),rockerArrow=new THREE.Mesh(World.PLANE,arrowShader.material),bogieArrow=new THREE.Mesh(World.PLANE,arrowShader.material),s=.6;return rockerArrow.scale.set(1.2,s,s),bogieArrow.scale.set(1.2,s,s),rockerArrow.position.set(.3,1.4,1.1),bogieArrow.position.set(.3,1.4,-1.2),rockerArrow.rotation.y=Math.PI/2*dir,rockerArrow.rotation.x=-.05,bogieArrow.rotation.y=Math.PI/2*dir,bogie.add(bogieArrow),rocker.add(rockerArrow),arrowShader}async function initRock(){let[rockGeom]=await Promise.all([GeomThread.loadBufferGeometry("rocks/04")]);(rockGeom=rockGeom.clone()).scale(.6,.6,.6),_rockShader=_this.initClass(Shader,"Rock",{uResolution:World.RESOLUTION,uTime:World.TIME,uBg:{value:Background.open},uAlpha:{value:1},transparent:!0}),(_rock=new THREE.Mesh(rockGeom,_rockShader.material)).position.set(1.3,.7,9),_rock.rotation.y=3.1,_rockGroup.add(_rock)}function placeRock(){_rover.group.updateMatrixWorld(!0),_rockGroup.position.x=_rover.group.position.x,_rockGroup.position.y=0,_rockGroup.position.z=_rover.group.position.z,_rockGroup.rotation.y=_rover.group.rotation.y,_rock.position.y=0,_rockGroup.updateMatrixWorld(!0),_rock.position.y=RoverRaycast.rayCastTerrain(_rock)}function animate(){let t=++_frame%780;if(t<_lastTime&&placeRock(),_lastTime=t,_controls.speed=0,_controls.speed+=.5*Math.smoothStep(103,102,t),_controls.speed+=.5*Math.smoothStep(420,541,t),_raycast.la=0,_raycast.lb=0,_raycast.lc=0,_raycast.la+=Math.smoothStep(90,138,t)*Math.smoothStep(552,510,t)*.18,_raycast.lb+=Math.smoothStep(120,210,t)*Math.smoothStep(618,588,t)*.1,_raycast.lb+=Math.smoothStep(480,600,t)*Math.smoothStep(618,588,t)*.08,_raycast.lc+=Math.smoothStep(558,600,t)*Math.smoothStep(660,630,t)*.18,_rockShader.uniforms.uAlpha.value=Math.smoothStep(10,90,t)*Math.smoothStep(780,660,t),_leftArrowShader.uniforms.uAlpha.value=Math.smoothStep(210,270,t)*Math.smoothStep(360,300,t),_rightArrowShader.uniforms.uAlpha.value=Math.smoothStep(318,378,t)*Math.smoothStep(510,462,t),_leftShader.uniforms.uColorSlider.value=Math.smoothStep(210,270,t)*Math.smoothStep(360,300,t)*-1,_rightShader.uniforms.uColorSlider.value=Math.smoothStep(318,378,t)*Math.smoothStep(510,462,t),_anim.strength<1)for(let prop in _raycast)_raycast[prop]*=_anim.strength}Inherit(this,RoverAnimationBase);const _this=this;let _leftArrowShader,_rightArrowShader,_rockShader,_rock,_lastTime,_rockGroup=new THREE.Group,_controls=_rover.movement.animatedValues,_raycast=_rover.raycastOffsets,_leftShader=_rover.lRockerBogie.shader,_rightShader=_rover.rRockerBogie.shader,_frame=0,_anim={strength:0};init(),initArrows(),initRock(),this.activate=function(){_this._activate(),_anim.strength=0,tween(_anim,{strength:1},2e3,"easeInOutCubic"),_rockGroup.position.set(0,-100,0),_lastTime=_frame=660,_this.startRender(animate),_rockShader&&(World.GROUP.add(_rockGroup),_rockShader.tween("uAlpha",1,2e3,"easeInOutCubic"))},this.deactivate=function(){_this.stopRender(animate),tween(_raycast,{la:0,lb:0,lc:0,ra:0,rb:0,rc:0},2e3,"easeInOutCubic"),_controls.speed=0,_rockShader&&(_rockShader.tween("uAlpha",0,2e3,"easeInOutCubic").onComplete(()=>{World.SCENE.remove(_rockGroup)}),_leftArrowShader.tween("uAlpha",0,1e3,"easeInOutCubic"),_rightArrowShader.tween("uAlpha",0,1e3,"easeInOutCubic"),_leftShader.tween("uAlpha",0,1e3,"easeInOutCubic"),_rightShader.tween("uAlpha",0,1e3,"easeInOutCubic"))}}),Class(function RoverAnimationRockerBogie(_rover){function init(){_this.camera.position.z=8,_this.camera.position.y=4,_this.camera.group.rotation.y=-1.57,_this.camera.lookAt.set(1.7,2,0);let lookAt=new Vec3(1.7,2,0);_this.startRender(t=>{let portaitPhone=Device.mobile.phone&&Stage.width<Stage.height;_this.camera.position.z+=.1*((portaitPhone?13:8)-_this.camera.position.z),lookAt.x=portaitPhone?0:1.7,lookAt.y=portaitPhone?3.5:2,_this.camera.lookAt.lerp(lookAt,.1)})}async function initRock(){let[rockGeom1,rockGeom2]=await Promise.all([GeomThread.loadBufferGeometry("rocks/04"),GeomThread.loadBufferGeometry("rocks/01")]);rockGeom1=rockGeom1.clone(),rockGeom2=rockGeom2.clone();let s=.5;rockGeom1.scale(s,s,s),s=.4,rockGeom2.scale(s,s,s),_rockShader=_this.initClass(Shader,"Rock",{uResolution:World.RESOLUTION,uTime:World.TIME,uBg:{value:Background.open},uAlpha:{value:1},transparent:!0}),(_rock1=new THREE.Mesh(rockGeom1,_rockShader.material)).position.set(-1.5,.7,10),_rock1.rotation.y=3,_rockGroup.add(_rock1),(_rock2=new THREE.Mesh(rockGeom2,_rockShader.material)).position.set(1.5,.7,16),_rockGroup.add(_rock2)}function placeRock(){_rover.group.updateMatrixWorld(!0),_rockGroup.position.x=_rover.group.position.x,_rockGroup.position.y=0,_rockGroup.position.z=_rover.group.position.z,_rockGroup.rotation.y=_rover.group.rotation.y,_rock1.position.y=0,_rock2.position.y=0,_rockGroup.updateMatrixWorld(!0),_rock1.position.y=RoverRaycast.rayCastTerrain(_rock1),_rock2.position.y=RoverRaycast.rayCastTerrain(_rock2)}function animate(){let t=++_frame%480;t<_lastTime&&placeRock(),_lastTime=t,_controls.speed=.5,_raycast.ra=0,_raycast.rb=0,_raycast.rc=0,_raycast.la=0,_raycast.lb=0,_raycast.lc=0;let d=0;if(_raycast.ra+=Math.smoothStep(90+d,150+d,t)*Math.smoothStep(204+d,174+d,t)*.16,d+=50,_raycast.rb+=Math.smoothStep(90+d,150+d,t)*Math.smoothStep(198+d,174+d,t)*.16,d+=50,_raycast.rc+=Math.smoothStep(90+d,150+d,t)*Math.smoothStep(192+d,180+d,t)*.15,d=126,_raycast.la+=Math.smoothStep(90+d,150+d,t)*Math.smoothStep(204+d,174+d,t)*.15,d+=50,_raycast.lb+=Math.smoothStep(90+d,150+d,t)*Math.smoothStep(198+d,174+d,t)*.15,d+=50,_raycast.lc+=Math.smoothStep(90+d,150+d,t)*Math.smoothStep(192+d,180+d,t)*.15,_rockShader.uniforms.uAlpha.value=Math.smoothStep(10,90,t)*Math.smoothStep(480,360,t),_anim.strength<1)for(let prop in _raycast)_raycast[prop]*=_anim.strength}Inherit(this,RoverAnimationBase);const _this=this;let _rockShader,_rock1,_rock2,_lastTime,_rockGroup=new THREE.Group,_controls=_rover.movement.animatedValues,_raycast=_rover.raycastOffsets,_frame=0,_anim={strength:0};init(),initRock(),this.activate=function(){_this._activate(),_anim.strength=0,tween(_anim,{strength:1},2e3,"easeInOutCubic"),_rockGroup.position.set(0,-100,0),_lastTime=_frame=360,_this.startRender(animate),_rockShader&&(World.GROUP.add(_rockGroup),_rockShader.tween("uAlpha",1,2e3,"easeInOutCubic"))},this.deactivate=function(){_this.stopRender(animate),tween(_raycast,{la:0,lb:0,lc:0,ra:0,rb:0,rc:0},2e3,"easeInOutCubic"),_controls.speed=0,_rockShader&&_rockShader.tween("uAlpha",0,2e3,"easeInOutCubic").onComplete(()=>{World.SCENE.remove(_rockGroup)})}}),Class(function RoverAnimationSteering(_rover){function init(){_this.camera.position.z=11,_this.camera.group.rotation.x=-1,_this.camera.group.rotation.y=3.14,_this.camera.lookAt.set(2.4,.5,0),defer(()=>{World.GROUP.add(_this.group)});let lookAt=new Vec3(2.4,.5,0);_this.startRender(()=>{_this.group.position.copy(_rover.group.position);let portaitPhone=Device.mobile.phone&&Stage.width<Stage.height;_this.camera.position.z+=.1*((portaitPhone?15:11)-_this.camera.position.z),lookAt.x=portaitPhone?0:2.4,lookAt.y=portaitPhone?2.5:.5,_this.camera.lookAt.lerp(lookAt,.1)})}async function initRocks(){let[rockGeom1,rockGeom2]=await Promise.all([GeomThread.loadBufferGeometry("rocks/02"),GeomThread.loadBufferGeometry("rocks/03")]);rockGeom1=rockGeom1.clone(),rockGeom2=rockGeom2.clone();let s=.5;rockGeom1.scale(s,1,s),rockGeom2.scale(.7,1,.7),_rockShader=_this.initClass(Shader,"Rock",{uResolution:World.RESOLUTION,uTime:World.TIME,uBg:{value:Background.open},uAlpha:{value:0},transparent:!0}),(_rock1=new THREE.Mesh(rockGeom1,_rockShader.material)).position.set(0,1,15.5),_rockGroup.add(_rock1),(_rock2=new THREE.Mesh(rockGeom2,_rockShader.material)).position.set(0,1,30),_rockGroup.add(_rock2)}function placeRocks(){_rover.group.updateMatrixWorld(!0),_rockGroup.position.x=_rover.group.position.x,_rockGroup.position.y=0,_rockGroup.position.z=_rover.group.position.z,_rockGroup.rotation.y=_rover.group.rotation.y,_rock1.position.y=0,_rock2.position.y=0,_rockGroup.updateMatrixWorld(!0),_rock1.position.y=RoverRaycast.rayCastTerrain(_rock1),_rock2.position.y=RoverRaycast.rayCastTerrain(_rock2)}function animate(){let t=++_frame%900;t<_lastTime&&placeRocks(),_lastTime=t,_controls.speed=0,_controls.wheelRotation=0,_controls.speed+=.7*Math.smoothStep(61,60,t),_controls.speed+=.7*Math.smoothStep(170,190,t),_controls.wheelRotation+=1*Math.smoothStep(50,20,Math.abs(t-200)),_controls.wheelRotation+=-.9*Math.smoothStep(80,15,Math.abs(t-350)),_controls.wheelRotation+=.67*Math.smoothStep(120,55,Math.abs(t-630)),_rockShader.uniforms.uAlpha.value=Math.smoothStep(10,90,t)*Math.smoothStep(780,660,t)}Inherit(this,RoverAnimationBase);const _this=this;let _rockShader,_rock1,_rock2,_lastTime,_rockGroup=new THREE.Group,_controls=_rover.movement.animatedValues,_frame=0;init(),initRocks(),this.activate=function(){_this._activate(),World.GROUP.add(_this.group),_this.group.rotation.y=_rover.group.rotation.y,_rockGroup.position.set(0,-100,0),_lastTime=_frame=780,_this.startRender(animate),_rockShader&&(World.GROUP.add(_rockGroup),_rockShader.tween("uAlpha",1,2e3,"easeInOutCubic"))},this.deactivate=function(){_this.stopRender(animate),_controls.wheelRotation=0,_controls.speed=0,_rockShader&&_rockShader.tween("uAlpha",0,2e3,"easeInOutCubic").onComplete(()=>{World.SCENE.remove(_rockGroup)})}}),Class(function RoverAnimationWheels(_rover){function init(){_this.camera.position.z=6,_this.camera.position.y=1.5,_this.camera.group.rotation.y=1.13,_this.camera.lookAt.set(2,.5,2.5);let group=new THREE.Group;group.position.set(0,0,0),_group.add(group),_this.startRender(t=>{let target=Math.mix(-2,.3*(.5*Math.sin(.002*t)-.5)-.7,_anim.active);group.position.y=target,group.getWorldPosition(_shader.uniforms.uBulgePosition.value),_rock&&(_rock.position.copy(group.position),_rock.position.y*=.5,_rock.position.y-=.3)});let lookAt=new Vec3(2,.5,2.5);_this.startRender(()=>{let portaitPhone=Device.mobile.phone&&Stage.width<Stage.height;_this.camera.position.z+=.1*((portaitPhone?10:6)-_this.camera.position.z),lookAt.x=portaitPhone?.5:2,lookAt.y=portaitPhone?2:.5,_this.camera.lookAt.lerp(lookAt,.1)})}async function initRock(){let[geometry]=await Promise.all([GeomThread.loadBufferGeometry("rocks/01")]);(geometry=geometry.clone()).scale(.3,.3,.3),geometry.rotateY(Math.PI),geometry.translate(-.4,-.6,0),_rockShader=_this.initClass(Shader,"Rock",{uResolution:World.RESOLUTION,uTime:World.TIME,uBg:{value:Background.open},uAlpha:{value:0},transparent:!0}),(_rock=new THREE.Mesh(geometry,_rockShader.material)).rotation.set(0,-4,0),_group.add(_rock)}Inherit(this,RoverAnimationBase);const _this=this;let _rock,_rockShader,_shader=_rover.lRockerBogie.wheelsShader,_group=_rover.lRockerBogie.wheelRock,_anim={active:0};init(),initRock(),this.activate=function(){_this._activate(),tween(_anim,{active:1},2e3,"easeInOutCubic"),tween(_rover.animationOffset,{y:3},2e3,"easeInOutCubic"),_rockShader&&(_group.add(_rock),tween(_rock.rotation,{y:0},1800,"easeOutCubic",300),_rockShader.tween("uAlpha",1,2e3,"easeInOutCubic"))},this.deactivate=function(){tween(_anim,{active:0},2e3,"easeInOutCubic"),tween(_rover.animationOffset,{y:0},2e3,"easeInOutCubic"),_rockShader&&(tween(_rock.rotation,{y:-4},1300,"easeInCubic"),_rockShader.tween("uAlpha",0,2e3,"easeInOutCubic").onComplete(()=>{_group.remove(_rock)}))}}),Class(function RoverGamepad(){function update(){let gamepads=navigator.getGamepads();if(_this.isActive=!!gamepads[0],!_this.isActive)return;let gamepad=gamepads[0];_this.vector.x=gamepad.axes[0],_this.vector.y=gamepad.axes[1],Math.abs(_this.vector.x)<.2&&(_this.vector.x=0),Math.abs(_this.vector.y)<.2&&(_this.vector.y=0),_this.camVector.x=gamepad.axes[2],_this.camVector.y=gamepad.axes[3],Math.abs(_this.camVector.x)<.2&&(_this.camVector.x=0),Math.abs(_this.camVector.y)<.2&&(_this.camVector.y=0)}Inherit(this,Component);const _this=this;this.vector={x:0,y:0},this.camVector={x:0,y:0},_this.startRender(update)}),Class(function RoverMovement(_camera){function init(){_gamepad=_this.initClass(RoverGamepad)}function addHandlers(){_this.events.sub(KeyboardUtil.DOWN,keydown),_this.events.sub(KeyboardUtil.UP,keyup),_this.events.sub(Experience.STATE_UPDATE,stateUpdate)}function keydown(e){UIJoystick.instance().delayAutoplay(),"ArrowUp"!==e.key&&"w"!==e.key||(_keys.up=1),"ArrowRight"!==e.key&&"d"!==e.key||(_keys.right=1),"ArrowDown"!==e.key&&"s"!==e.key||(_keys.down=1),"ArrowLeft"!==e.key&&"a"!==e.key||(_keys.left=1)}function keyup(e){"ArrowUp"!==e.key&&"w"!==e.key||(_keys.up=0),"ArrowRight"!==e.key&&"d"!==e.key||(_keys.right=0),"ArrowDown"!==e.key&&"s"!==e.key||(_keys.down=0),"ArrowLeft"!==e.key&&"a"!==e.key||(_keys.left=0)}function stateUpdate({state:state}){state===Experience.STATE.hotspot?_this.isActive&&(_this.isActive=!1):_this.isActive||(_this.isActive=!0),_this.ROVER_TYPE=state===Experience.STATE.landing?"mars":"blueprint"}Inherit(this,Component);const _this=this;let _gamepad,_camDir=new Vec3;new Vec2;let ANIM_SPEED=1;_this.pos=new Vec3(18.8,5.6,39.5),_this.rotation=0,_this.wheelRotation=0,_this.isActive=!0;let _targetSpeed=0,_speed=0,_targetRotation=0,_rotation=0,_targetWheelRotation=0,_wheelRotation=0,_keys={right:0,left:0,up:0,down:0};_this.animatedValues={wheelRotation:0,speed:0},_this.ROVER_TYPE="mars";const _tracking={accrueTime:{mars:0,blueprint:0},timeEventFired:{mars:-5,blueprint:-5}};init(),addHandlers(),this.update=function(){_targetSpeed=0,_targetWheelRotation=0;let inputX=0,inputY=0;if(_this.isActive){_keys.up&&_targetSpeed++,_keys.down&&_targetSpeed--,_keys.right&&_targetWheelRotation++,_keys.left&&_targetWheelRotation--,inputX=_targetWheelRotation,inputY=-_targetSpeed,World.CAMERA.getWorldDirection(_camDir);let camAngle=Math.atan2(_camDir.z,_camDir.x);Math.cos(camAngle),Math.sin(camAngle);_gamepad&&(inputX+=_gamepad.vector.x,inputY+=_gamepad.vector.y,_targetSpeed-=Math.sign(_gamepad.vector.y)*Math.sqrt(_gamepad.vector.x**2+_gamepad.vector.y**2),_targetWheelRotation+=_gamepad.vector.x,(_gamepad.vector.x||_gamepad.vector.x)&&UIJoystick.instance().delayAutoplay(),Math.abs(_gamepad.camVector.x)&&(_camera.rot.rotationY=_camera.rot.rotationY-1.5*_gamepad.camVector.x)),inputX+=UIJoystick.instance().vector.x,inputY+=UIJoystick.instance().vector.y,_targetSpeed-=Math.sign(UIJoystick.instance().vector.y)*Math.sqrt(UIJoystick.instance().vector.x**2+UIJoystick.instance().vector.y**2),_targetWheelRotation+=UIJoystick.instance().vector.x,ANIM_SPEED=1,!_targetSpeed&&!_targetWheelRotation||UIJoystick.instance().isAutoplay||(_tracking.accrueTime[_this.ROVER_TYPE]+=Render.DELTA/1e3,_tracking.accrueTime[_this.ROVER_TYPE]>_tracking.timeEventFired[_this.ROVER_TYPE]+5&&(_tracking.timeEventFired[_this.ROVER_TYPE]+=5,Track.event(`drive-${_this.ROVER_TYPE}`,"move",`duration-${_tracking.timeEventFired[_this.ROVER_TYPE]}`)))}else _targetSpeed=_this.animatedValues.speed,_targetWheelRotation=_this.animatedValues.wheelRotation,ANIM_SPEED=1.67;_targetSpeed=Math.clamp(_targetSpeed,-1,1)*ANIM_SPEED,_targetWheelRotation=Math.clamp(_targetWheelRotation,-1,1),UIJoystick.instance().finalVector.x=inputX,UIJoystick.instance().finalVector.y=inputY,_speed+=.02*(_targetSpeed-_speed),Math.abs(_speed)<.001&&(_speed=0),_this.speed=_speed,_wheelRotation+=.04*(_targetWheelRotation-_wheelRotation),Math.abs(_wheelRotation)<.001&&(_wheelRotation=0),_this.wheelRotation=_wheelRotation*Math.PI/4,_rotation+=1*((_targetRotation+=-.1*_wheelRotation*_speed*.18)-_rotation),_this.rotation=_rotation,_this.pos.x+=.06*_speed*Math.sin(_rotation),_this.pos.z+=.06*_speed*Math.cos(_rotation)}}),Class(function RoverOrbitCamera(){function initOrbitCamera(){(_orbit=_this.initClass(OrbitCamera,World.ELEMENT)).camera.fov=55,_orbit.zDistance=14,_orbit.minZoom=_orbit.maxZoom=_orbit.zDistance,_orbit.screenRotation=280,_orbit.xLimit=.1,_orbit.xMax=10,_orbit.gaze.moveXY.set(1,1),_orbit.gaze.lookAt=new Vector3(-4,0,0),_orbit.gaze.position.set(0,8,0),_orbit.lock(),_orbit.groupTarget=new Vector3,_orbit.rotation.rotationY=50,_this.rot=_orbit.rotation}function loop(){let portaitPhone=Device.mobile.phone&&Stage.width<Stage.height;_transition+=.02*(_targetTransition-_transition);let zoomTarget=3*Math.smoothStep(.5,.3,Math.abs(_transition-.5))+Math.mix(14,12,_transition);portaitPhone&&(zoomTarget+=4);let zoomTo=Math.mix(zoomTarget,.95*zoomTarget,_anim.zoom);zoomTo=Math.mix(zoomTo,.45*zoomTarget,_anim.signup),_orbit.zDistance+=.1*(zoomTo-_orbit.zDistance),_orbit.minZoom=_orbit.maxZoom=_orbit.zDistance;let yTarget=-1*Math.smoothStep(.5,.3,Math.abs(_transition-.5))+8;yTarget=Math.mix(yTarget,4,_anim.signup),_orbit.gaze.position.y+=.1*(yTarget-_orbit.gaze.position.y);let lookYTarget=2*Math.smoothStep(.5,.3,Math.abs(_transition-.5))+.5;lookYTarget=Math.mix(lookYTarget,2.5,_anim.signup),portaitPhone&&(lookYTarget=_this.isSignup?5.2:4.4),_orbit.gaze.lookAt.y+=.1*(lookYTarget-_orbit.gaze.lookAt.y),_orbit.gaze.lookAt.x=portaitPhone?0:Math.mix(-4,-1.7,_anim.signup);let rotationTarget=Math.smoothStep(.1,1,_transition)*Math.PI*-2*1.05;if(_this.isSignup){let rotY=_orbit.rotation.rotationY;_orbit.rotation.rotationY=rotY+.05*(0-rotY),rotationTarget=Rover.ROTATION.y-2*Math.PI}_orbit.group.rotation.y+=.07*(rotationTarget-_orbit.group.rotation.y)}function addHandlers(){_this.events.sub(Experience.TRANSITION,transition),_this.events.sub(Experience.STATE_UPDATE,stateUpdate),_this.events.sub(Mouse.input,Interaction.START,start),_this.events.sub(Mouse.input,Interaction.END,end)}function transition(e){_targetTransition=Math.abs(e.value)}function stateUpdate({state:state}){state===Experience.STATE.signup?(_this.isSignup=!0,tween(_anim,{signup:1},2e3,"easeOutCubic"),_orbit.rotation.prevent=!0):_this.isSignup&&(_this.isSignup=!1,tween(_anim,{signup:0},2e3,"easeOutCubic"),_orbit.rotation.prevent=!1)}function start(){_this.isSignup||tween(_anim,{zoom:1},500,"easeOutCubic")}function end(){tween(_anim,{zoom:0},800,"easeOutCubic")}Inherit(this,Component);const _this=this;let _orbit,_transition=0,_targetTransition=0,_anim={zoom:0,signup:0};_anim.multitween=!0,initOrbitCamera(),addHandlers(),_this.startRender(loop),this.update=function(pos){_orbit.groupTarget.copy(pos),_orbit.group.position.lerp(_orbit.groupTarget,.2)},this.reset=function(){return _orbit.transition(2e3,"easeInOutQuad").promise()}},"singleton"),Class(function RoverRaycast(){function init(){_this.add(_wheelOffsets.la),_this.add(_wheelOffsets.lb),_this.add(_wheelOffsets.lc),_this.add(_wheelOffsets.ra),_this.add(_wheelOffsets.rb),_this.add(_wheelOffsets.rc),_this.add(_wheelOffsets2.la),_this.add(_wheelOffsets2.lb),_this.add(_wheelOffsets2.lc),_this.add(_wheelOffsets2.ra),_this.add(_wheelOffsets2.rb),_this.add(_wheelOffsets2.rc),_wheelOffsets.la.position.set(1.378,.514,1.865),_wheelOffsets.lb.position.set(2.0467,.513,-.349),_wheelOffsets.lc.position.set(1.406,.513,-2.812),_wheelOffsets.ra.position.set(-1.378,.514,1.865),_wheelOffsets.rb.position.set(-2.047,.513,-.349),_wheelOffsets.rc.position.set(-1.406,.513,-2.812),_this.output.lLengthAB=_wheelOffsets.la.position.distanceTo(_wheelOffsets.lb.position),_this.output.lLengthC=_wheelOffsets.lc.position.length(),_this.output.rLengthAB=_wheelOffsets.ra.position.distanceTo(_wheelOffsets.rb.position),_this.output.rLengthC=_wheelOffsets.rc.position.length(),_this.output.lengthLR=_wheelOffsets.lb.position.distanceTo(_wheelOffsets.rb.position),_wheelOffsets2.la.position.set(2.3,.514,2.45),_wheelOffsets2.lb.position.set(2.6,.513,-.2),_wheelOffsets2.lc.position.set(2.3,.513,-2.6),_wheelOffsets2.ra.position.set(-2.3,.514,2.45),_wheelOffsets2.rb.position.set(-2.6,.513,-.2),_wheelOffsets2.rc.position.set(-2.3,.513,-2.6),_this.output2.lLengthAB=_wheelOffsets2.la.position.distanceTo(_wheelOffsets2.lb.position),_this.output2.lLengthC=_wheelOffsets2.lc.position.length(),_this.output2.rLengthAB=_wheelOffsets2.ra.position.distanceTo(_wheelOffsets2.rb.position),_this.output2.rLengthC=_wheelOffsets2.rc.position.length(),_this.output2.lengthLR=_wheelOffsets2.lb.position.distanceTo(_wheelOffsets2.rb.position)}function initImageLUT(){let canvas=document.createElement("canvas");canvas.width=canvas.height=LUT_SIZE;let context=canvas.getContext("2d"),img=Assets.loadImage("assets/images/terrain/height.jpg");img.loadPromise().then(()=>{context.drawImage(img,0,0,canvas.width,canvas.height);let imageData=context.getImageData(0,0,canvas.width,canvas.height);_lut=new Float32Array(canvas.width*canvas.height);for(let i=0,j=0;i<imageData.data.length;i+=4,j++)_lut[j]=imageData.data[i+1]/255})}function castHeight(){_this.output.la+=.17*(rayCastTerrain(_wheelOffsets.la)-_this.output.la),_this.output.lb+=.17*(rayCastTerrain(_wheelOffsets.lb)-_this.output.lb),_this.output.lc+=.17*(rayCastTerrain(_wheelOffsets.lc)-_this.output.lc),_this.output.ra+=.17*(rayCastTerrain(_wheelOffsets.ra)-_this.output.ra),_this.output.rb+=.17*(rayCastTerrain(_wheelOffsets.rb)-_this.output.rb),_this.output.rc+=.17*(rayCastTerrain(_wheelOffsets.rc)-_this.output.rc),_this.output2.la+=.17*(rayCastTerrain(_wheelOffsets2.la)-_this.output2.la),_this.output2.lb+=.17*(rayCastTerrain(_wheelOffsets2.lb)-_this.output2.lb),_this.output2.lc+=.17*(rayCastTerrain(_wheelOffsets2.lc)-_this.output2.lc),_this.output2.ra+=.17*(rayCastTerrain(_wheelOffsets2.ra)-_this.output2.ra),_this.output2.rb+=.17*(rayCastTerrain(_wheelOffsets2.rb)-_this.output2.rb),_this.output2.rc+=.17*(rayCastTerrain(_wheelOffsets2.rc)-_this.output2.rc)}function rayCastTerrain(mesh){if(!_lut)return 0;mesh.getWorldPosition(_raycaster.ray.origin);let x=Math.mod(_raycaster.ray.origin.x+50,100)/100*(LUT_SIZE-1),y=Math.mod(_raycaster.ray.origin.z+50,100)/100*(LUT_SIZE-1),xMin=Math.floor(x),xMax=xMin+1,xFract=x-xMin,yMin=Math.floor(y),yMax=yMin+1,yFract=y-yMin,i1=yMin*LUT_SIZE+xMax,i2=yMax*LUT_SIZE+xMin,i3=yMax*LUT_SIZE+xMax,p0=(1-xFract)*(1-yFract),p1=xFract*(1-yFract),p2=(1-xFract)*yFract,p3=xFract*yFract,height=_lut[yMin*LUT_SIZE+xMin]*p0+_lut[i1]*p1+_lut[i2]*p2+_lut[i3]*p3;return height*=15}Inherit(this,Object3D);const _this=this;let _lut,_raycaster=new THREE.Raycaster;_raycaster.ray.direction.set(0,-1,0);const LUT_SIZE=1024;let _wheelOffsets={la:new THREE.Group,lb:new THREE.Group,lc:new THREE.Group,ra:new THREE.Group,rb:new THREE.Group,rc:new THREE.Group},_wheelOffsets2={la:new THREE.Group,lb:new THREE.Group,lc:new THREE.Group,ra:new THREE.Group,rb:new THREE.Group,rc:new THREE.Group};this.output={la:0,lb:0,lc:0,lLengthAB:0,lLengthC:0,ra:0,rb:0,rc:0,rLengthAB:0,rLengthC:0,lengthLR:0},this.output2={la:0,lb:0,lc:0,lLengthAB:0,lLengthC:0,ra:0,rb:0,rc:0,rLengthAB:0,rLengthC:0,lengthLR:0},init(),initImageLUT(),this.update=function(){_this.group.updateMatrixWorld(),castHeight()},RoverRaycast.rayCastTerrain=rayCastTerrain}),Class(function MarsChassis(_transition){async function init(){let shader=_this.initClass(Shader,"MarsRover",{uTexture:{value:Utils3D.getTexture("assets/images/rover/mars.jpg")},uTransition:_transition,uPosition:{value:_this.parent.group.position},uTime:World.TIME});_this.group.name="_chassis";let[chassis,pivot]=await Initializer3D.promise(Promise.all([GeomThread.loadBufferGeometry("marsrover/chassis"),GeomThread.loadBufferGeometry("marsrover/pivot")]));_chassis=new THREE.Mesh(chassis,shader.material),_pivot=new THREE.Mesh(pivot,shader.material),_this.meshes.push(_chassis,_pivot),_inner=new THREE.Group,_this.add(_inner),_inner.add(_chassis),_chassis.add(_pivot),_inner.position.set(0,1.429,-1.198),_chassis.position.set(0,2.008,.475),_chassis.position.sub(_inner.position),_pivot.position.set(0,.541,-1.192),_this.loaded=!0,_this.meshes.forEach(mesh=>{mesh.castShadow=!0,FX.Mars.instance().addObject(mesh)})}Inherit(this,Object3D);const _this=this;let _chassis,_pivot,_inner;this.meshes=[],init(),this.update=function(lRot,rRot){if(!_chassis)return;let o=lRot-rRot,angle=Math.asin(Math.clamp(o/3,-1,1));_chassis.rotation.z=angle,_pivot.rotation.y=-angle,_inner.rotation.x=(lRot+rRot)/2}}),Class(function MarsRockerBogie(_side,_transition){async function init(){let shader=_this.initClass(Shader,"MarsRover",{uTexture:{value:Utils3D.getTexture("assets/images/rover/mars.jpg")},uTransition:_transition,uPosition:{value:_this.parent.group.position},uTime:World.TIME}),[rocker,bogie,cornerPivot,wheel]=await Promise.all([GeomThread.loadBufferGeometry("marsrover/rocker"),GeomThread.loadBufferGeometry("marsrover/bogie"),GeomThread.loadBufferGeometry("marsrover/corner-pivot"),GeomThread.loadBufferGeometry("marsrover/wheel")]);_rocker=new THREE.Mesh(rocker,shader.material),_bogie=new THREE.Mesh(bogie,shader.material),_rockerPivot=new THREE.Mesh(cornerPivot,shader.material),_bogiePivot=new THREE.Mesh(cornerPivot,shader.material),_rockerWheel=new THREE.Mesh(wheel,shader.material),_bogieWheel=new THREE.Mesh(wheel,shader.material),_centerWheel=new THREE.Mesh(wheel,shader.material),_this.meshes.push(_rocker,_bogie,_rockerPivot,_bogiePivot,_rockerWheel,_bogieWheel,_centerWheel),_this.add(_rocker),_this.add(_bogie),_rocker.add(_rockerPivot),_bogie.add(_bogiePivot),_rocker.add(_centerWheel),_rockerPivot.add(_rockerWheel),_bogiePivot.add(_bogieWheel),_this.group.position.x=1.936*_side,_rocker.position.set(0,1.429,-1.198),_bogie.position.set(0,1.429,-1.198),_rockerPivot.position.set(.421,-.21,-1.385),_bogiePivot.position.set(.422,-.192,3.628),_centerWheel.position.set(.896,-.891,1.001),_rockerWheel.position.set(.185,-.681,.003),_bogieWheel.position.set(.185,-.81,0),_rocker.scale.x=_side,_bogie.scale.x=_side,_this.loaded=!0,_this.meshes.forEach(mesh=>{mesh.castShadow=!0,FX.Mars.instance().addObject(mesh)})}Inherit(this,Object3D);const _this=this;let _rocker,_bogie,_rockerPivot,_bogiePivot,_centerWheel,_rockerWheel,_bogieWheel;this.meshes=[],init(),this.update=function(a,b,c,lengthAB,lengthC,ob,lengthLR,wheelRotation,speed){if(!_centerWheel)return;let o=c-b,h=Math.max(lengthAB,Math.abs(o)),angle=Math.asin(Math.clamp(o/h,-1,1));_rocker.rotation.x=angle;let y=b+.7*Math.sin(angle);o=y-a,h=Math.max(lengthC,Math.abs(o)),angle=Math.asin(Math.clamp(o/h,-1,1)),_bogie.rotation.x=angle;let turnScale=Math.map(wheelRotation*_side*-1,-1,0,.3,1,!0);_bogiePivot.rotation.y=-1*wheelRotation*_side*turnScale,_rockerPivot.rotation.y=wheelRotation*_side*turnScale;let turnSpeed=.09*speed*Math.map(wheelRotation*_side,-1,1,.7,1.3);return _centerWheel.rotation.x+=turnSpeed,_rockerWheel.rotation.x+=turnSpeed,_bogieWheel.rotation.x+=turnSpeed,[y,_bogie.rotation.x]}}),Class(function OpenChassis(_transition){async function init(){let shader=_this.initClass(Shader,"OpenRover",{uTransparency:{value:Utils3D.getRepeatTexture("assets/images/rover/holes.jpg")},uAO:{value:Utils3D.getTexture("assets/images/rover/open-ao.jpg")},uTransition:_transition,uAlpha:{value:1},uPosition:{value:_this.parent.group.position},uTime:World.TIME,uSide:{value:1},uColor:{value:new THREE.Color},uColorSlider:{value:0},uColor2:{value:new THREE.Color},uColor3:{value:new THREE.Color}});_this.parent.chassisShader=shader,ShaderUIL.add(shader);let screenShader=_this.initClass(Shader,"OpenRoverScreen",{uTransition:_transition,uPosition:{value:_this.parent.group.position},uTime:World.TIME,uSprite:{value:Utils3D.getTexture("assets/images/rover/screen/sprite.jpg")},uGlow:{value:Utils3D.getTexture("assets/images/rover/screen/glow.jpg")},uBackground:{value:new THREE.Color},uCells:{value:new Vec2(4,4)},uIndex:{value:0}});screenShader.uniforms.uSprite.value.magFilter=THREE.NearestFilter,_this.screenShader=screenShader,Render.start(()=>{screenShader.uniforms.uIndex.value++},5),ShaderUIL.add(screenShader),_this.group.name="_chassis";let[chassis,head,headFace,pivot,pivotConnection]=await Initializer3D.promise(Promise.all([GeomThread.loadBufferGeometry("rover/chassis"),GeomThread.loadBufferGeometry("rover/head"),GeomThread.loadBufferGeometry("rover/head-face"),GeomThread.loadBufferGeometry("rover/pivot"),GeomThread.loadBufferGeometry("rover/pivot-connection")]));_chassis=new THREE.Mesh(chassis,shader.material),_head=new THREE.Mesh(head,shader.material),_headFace=new THREE.Mesh(headFace,screenShader.material),_pivot=new THREE.Mesh(pivot,shader.material),_leftPivotConnection=new THREE.Mesh(pivotConnection,shader.material),_rightPivotConnection=new THREE.Mesh(pivotConnection,shader.material),_chassis.name="chassis"+_this.group.name,_head.name="head"+_this.group.name,_headFace.name="headface"+_this.group.name,_pivot.name="pivot"+_this.group.name,_this.meshes.push(_chassis,_head,_headFace,_pivot),_this.leftPivotConnection=new THREE.Group,_this.leftPivotConnection.position.set(1.365,.09,0),_this.rightPivotConnection=new THREE.Group,_this.rightPivotConnection.position.set(-1.365,.09,0),World.GROUP.add(_leftPivotConnection),World.GROUP.add(_rightPivotConnection),_inner=new THREE.Group,_this.add(_inner),_inner.add(_chassis),_chassis.add(_head),_chassis.add(_pivot),_head.add(_headFace),_pivot.add(_this.leftPivotConnection),_pivot.add(_this.rightPivotConnection),_chassis.add(_this.addons),_inner.position.set(0,1.447,.302),_chassis.position.set(-.018,2.224,-1.142),_chassis.position.sub(_inner.position),_head.position.set(.44,.344,.942),_pivot.position.set(.002,.784,-.492),_pivot.rotation.set(Math.radians(7.676),0,0),_headFace.position.set(-.072,.946,.407),_headFace.rotation.set(Math.radians(97.186),Math.radians(.154),Math.radians(13.951)),_this.loaded=!0,_this.meshes.forEach(mesh=>{mesh.castShadow=!0,FX.Mars.instance().addObject(mesh)})}function addHandlers(){_this.events.sub(Experience.SIGNUP_CHANGE,singupFaceChange),_this.events.sub(Experience.STATE_UPDATE,stateChange)}function stateChange({state:state}){if(_this.isSignupFaces&&state!==Experience.STATE.signup){_this.isSignupFaces=!1;let shader=_this.screenShader;shader.uniforms.uSprite.value=Utils3D.getTexture("assets/images/rover/screen/sprite.jpg"),shader.uniforms.uGlow.value=Utils3D.getTexture("assets/images/rover/screen/glow.jpg"),shader.uniforms.uCells.value=new Vec2(4,4),shader.uniforms.uIndex.value=0}}function singupFaceChange({index:index}){_this.isSignupFaces=!0;let shader=_this.screenShader;shader.uniforms.uSprite.value=Utils3D.getTexture(`assets/images/rover/screen/signup/${index}.jpg`),shader.uniforms.uGlow.value=Utils3D.getTexture(`assets/images/rover/screen/signup/${index}-glow.jpg`),shader.uniforms.uCells.value=_sinupFaces[index],shader.uniforms.uIndex.value=0}Inherit(this,Object3D);const _this=this;let _chassis,_head,_headFace,_pivot,_inner,_leftPivotConnection,_rightPivotConnection,_pivotA=new Vec3,_pivotB=new Vec3;_this.meshes=[],_this.addons=new THREE.Group;let _sinupFaces=[new Vec2(2,2),new Vec2(3,4),new Vec2(2,3),new Vec2(3,6)];init(),addHandlers(),this.update=function(lRot,rRot){if(!_chassis)return;let o=lRot-rRot,angle=Math.asin(Math.clamp(o/1.4,-1,1));_chassis.rotation.z=angle,_pivot.rotation.y=-angle,_inner.rotation.x=(lRot+rRot)/2},this.updatePivots=function(leftRB,rightRB){_this.leftPivotConnection.getWorldPosition(_pivotA),leftRB.pivotConnection.getWorldPosition(_pivotB),_leftPivotConnection.position.copy(_pivotA),_leftPivotConnection.lookAt(_pivotB);let dist=_pivotA.distanceTo(_pivotB);_leftPivotConnection.scale.z=dist/.5,_this.rightPivotConnection.getWorldPosition(_pivotA),rightRB.pivotConnection.getWorldPosition(_pivotB),_rightPivotConnection.position.copy(_pivotA),_rightPivotConnection.lookAt(_pivotB),dist=_pivotA.distanceTo(_pivotB),_rightPivotConnection.scale.z=dist/.5}}),Class(function OpenRockerBogie(_side,_transition){async function init(){let shader=_this.initClass(Shader,"OpenRover",{uTransparency:{value:Utils3D.getRepeatTexture("assets/images/rover/holes.jpg")},uAO:{value:Utils3D.getTexture("assets/images/rover/open-ao.jpg")},uTransition:_transition,uPosition:{value:_this.parent.group.position},uTime:World.TIME,uSide:{value:_side},uColor:{value:new THREE.Color},uColorSlider:{value:0},uColor2:{value:new THREE.Color("#7a0032")},uColor3:{value:new THREE.Color("#454ba5")}});ShaderUIL.add(shader);let wheelsShader=_this.initClass(Shader,"OpenRoverWheels",{uTread:{value:Utils3D.getRepeatTexture("assets/images/rover/tread-normal.jpg")},uAO:{value:Utils3D.getTexture("assets/images/rover/open-ao.jpg")},uSide:{value:_side},uTransition:_transition,uPosition:{value:_this.parent.group.position},uTime:World.TIME,uColor:{value:new THREE.Color},uBulgePosition:{value:new Vec3}});_this.wheelsShader=wheelsShader,_this.shader=shader,ShaderUIL.add(wheelsShader),_this.group.name=`rocker_${_side}`;let[rocker,bogie,cornerPivot,wheel]=await Promise.all([GeomThread.loadBufferGeometry("rover/rocker"),GeomThread.loadBufferGeometry("rover/bogie"),GeomThread.loadBufferGeometry("rover/corner-pivot"),GeomThread.loadBufferGeometry("rover/wheel")]);_rocker=new THREE.Mesh(rocker,shader.material),_bogie=new THREE.Mesh(bogie,shader.material),_rockerPivot=new THREE.Mesh(cornerPivot,shader.material),_bogiePivot=new THREE.Mesh(cornerPivot,shader.material),_rockerWheel=new THREE.Mesh(wheel,wheelsShader.material),_bogieWheel=new THREE.Mesh(wheel,wheelsShader.material),_centerWheel=new THREE.Mesh(wheel,wheelsShader.material),_rocker.name="rocker"+_this.group.name,_bogie.name="bogie"+_this.group.name,_rockerPivot.name="rocker-pivot"+_this.group.name,_bogiePivot.name="bogie-pivot"+_this.group.name,_bogieWheel.name="bogie-pivot-wheel"+_this.group.name,_rockerWheel.name="rocker-pivot-wheel"+_this.group.name,_centerWheel.name="center-wheel"+_this.group.name,_this.meshes.push(_rocker,_bogie,_rockerPivot,_bogiePivot,_rockerWheel,_bogieWheel,_centerWheel),_this.pivotConnection=new THREE.Group,_this.pivotConnection.position.set(0,1.469,-1.459),_this.add(_rocker),_this.add(_bogie),_rocker.add(_rockerPivot),_bogie.add(_bogiePivot),_bogie.add(_this.pivotConnection),_rocker.add(_centerWheel),_rockerPivot.add(_rockerWheel),_bogiePivot.add(_bogieWheel),_rocker.add(_this.wheelRock),_this.wheelRock.position.set(.807,-.833,-.437),_rocker.add(_this.arrowRocker),_bogie.add(_this.arrowBogie),_this.group.position.x=1.227*_side,_rocker.position.set(0,1.447,.302),_bogie.position.set(0,1.447,.302),_rockerPivot.position.set(-.007,.548,1.629),_rockerPivot.rotation.set(Math.radians(-3.993),0,0),_bogiePivot.position.set(-.007,.555,-2.9),_bogiePivot.rotation.set(Math.radians(-2.134),0,0),_centerWheel.position.set(.807,-.833,-.437),_rockerWheel.position.set(.24,-1.393,.089),_bogieWheel.position.set(.24,-1.392,.052),_rocker.scale.x=_side,_bogie.scale.x=_side,_this.loaded=!0,_this.meshes.forEach(mesh=>{mesh.castShadow=!0,FX.Mars.instance().addObject(mesh)})}Inherit(this,Object3D);const _this=this;let _rocker,_bogie,_rockerPivot,_bogiePivot,_centerWheel,_rockerWheel,_bogieWheel;_this.meshes=[],_this.wheelRock=new THREE.Group,_this.arrowRocker=new THREE.Group,_this.arrowBogie=new THREE.Group,init(),this.update=function(a,b,c,lengthAB,lengthC,ob,lengthLR,wheelRotation,speed){if(!_centerWheel)return;let o=b-a,h=Math.max(lengthAB,Math.abs(o)),angle=Math.asin(Math.clamp(o/h,-1,1));_rocker.rotation.x=angle;let y=b-.7*Math.sin(angle);o=c-y,h=Math.max(lengthC,Math.abs(o)),angle=Math.asin(Math.clamp(o/h,-1,1)),_bogie.rotation.x=angle;let turnScale=Math.map(wheelRotation*_side*-1,-1,0,.3,1,!0);_rockerPivot.rotation.y=-1*wheelRotation*_side*turnScale,_bogiePivot.rotation.y=wheelRotation*_side*turnScale;let turnSpeed=.1*speed*Math.map(wheelRotation*_side,-1,1,.7,1.3);return _centerWheel.rotation.x+=turnSpeed,_rockerWheel.rotation.x+=turnSpeed,_bogieWheel.rotation.x+=turnSpeed,[y,_bogie.rotation.x]}}),Class(function Terrain(_background,_pos){async function init(){let geometry=await GeomThread.loadBufferGeometry("terrain");addQuadrantAttrib(geometry),_shader=_this.initClass(Shader,"Terrain",{uTime:World.TIME,uTransition:Rover.TRANSITION,uBgOpen:{value:_background.open},uBgMars:{value:_background.mars},uGrid:{value:Utils3D.getRepeatTexture("assets/images/terrain/grid.jpg")},uDiffuse:{value:Utils3D.getRepeatTexture("assets/images/terrain/diffuse.jpg")},uNormal:{value:Utils3D.getRepeatTexture("assets/images/terrain/normal.jpg")},uResolution:World.RESOLUTION,uCenterPosition:{value:_pos},receiveShadow:!0}),_this.mesh=new THREE.Mesh(geometry,_shader.material),_this.mesh.frustumCulled=!1,_this.mesh.receiveShadow=!0,World.GROUP.add(_this.mesh),FX.Mars.instance().addObject(_this.mesh)}function addQuadrantAttrib(geometry){let count=geometry.attributes.position.count,quadrant=new Float32Array(count);for(let i=0;i<count;i++)quadrant[i]=Math.floor(i/geometry.attributes.position.count*4);geometry.addAttribute("quadrant",new THREE.BufferAttribute(quadrant,1))}async function initRocks(){let rockGeometry=await GeomThread.loadBufferGeometry("terrain-rocks");addQuadrantAttribRocks(rockGeometry),_shader=_this.initClass(Shader,"TerrainRocks",{uTime:World.TIME,uTransition:Rover.TRANSITION,uBgOpen:{value:_background.open},uBgMars:{value:_background.mars},uGrid:{value:Utils3D.getRepeatTexture("assets/images/terrain/grid.jpg")},uDiffuse:{value:Utils3D.getRepeatTexture("assets/images/terrain/rock-diffuse.jpg")},uResolution:World.RESOLUTION,uCenterPosition:{value:_pos},receiveShadow:!0,transparent:!0});let rocks=new THREE.Mesh(rockGeometry,_shader.material);rocks.frustumCulled=!1,rocks.receiveShadow=!0,World.GROUP.add(rocks),FX.Mars.instance().addObject(rocks)}function addQuadrantAttribRocks(geometry){let positions=geometry.attributes.position.array,count=geometry.attributes.position.count,quadrant=new Float32Array(count);for(let i=0,j=0;i<count;i++,j+=3){let q=0;positions[j+0]>0&&(q+=1),positions[j+2]>0&&(q+=2),quadrant[i]=q}geometry.addAttribute("quadrant",new THREE.BufferAttribute(quadrant,1))}Inherit(this,Object3D);const _this=this;let _shader;Initializer3D.promise(init()),Initializer3D.promise(initRocks()),this.update=function(pos){_shader&&_shader.uniforms.uCenterPosition.value.copy(pos)}}),Class(function FloatingParticles(_center){async function initAntimatter(){AntimatterUtil.dimensions={w:[-20,20],h:[0,20],d:[-20,20]},_antimatter=_this.initClass(Antimatter,256,World.RENDERER),await _antimatter.ready()}function initProjection(){(_projection=_this.initClass(GLScreenProjection,World.CAMERA,Mouse)).start()}function initShader(){_antimatter.uniforms={uSize:{value:.2*World.DPR},tMap:{value:Utils3D.getTexture("assets/images/particle.jpg")},uPosition:{value:_center}},_antimatter.fragmentShader=_antimatter.vertexShader="FloatingParticles"}function initBehavior(){_behavior=new AntimatterPass("FloatingParticlesFlow");let options={tAttribs:_antimatter.attribs,tOrigin:_antimatter.vertices,uProjMatrix:_projection.uniforms.projMatrix,uProjNormalMatrix:_projection.uniforms.normalMatrix,uFlowMap:_this.initClass(MouseFlowMap,{radius:.3,speed:.1}).texture,uTime:World.TIME,uCenterPosition:{type:"v3",value:_center},uFlowSpeed:{type:"f",value:0},uMaxRange:{type:"f",value:20},uMaxHeight:{type:"f",value:20}};for(let name in options)_behavior.addInput(name,options[name]);_antimatter.addPass(_behavior)}function addToWorld(){let mesh=_antimatter.getMesh();_this.add(mesh),_antimatter.shader.material.transparent=!0,_antimatter.shader.material.depthTest=!1,ShaderUIL.add(_behavior),World.GROUP.add(_this.group),FX.Mars.instance().addObject(mesh)}function loop(){_antimatter.update()}Inherit(this,Object3D);const _this=this;let _antimatter,_projection,_behavior;!async function(){await initAntimatter(),initProjection(),initShader(),initBehavior(),addToWorld(),_this.startRender(loop)}()}),Class(function LoaderView(){function initHTML(){$this.size("100%").css({backgroundColor:"#1E255B"}).setZ(20),($container=$this.create(".container")).size("100%").invisible(),($bg=$container.create(".bg")).size("100%").bg("assets/images/grid-color.png").css({backgroundSize:"100px 100px",backgroundPosition:"center center"}),($fade=$container.create("fade")).size("100%","100%").css({background:"radial-gradient(ellipse at center, rgba(28,36,91,0) 0%,rgba(28,36,91,1) 100%)"}),($wrapper=$container.create(".wrapper")).size(_size,_size).center().css({opacity:.9}),$this.perc=0}function initSpinner(){let size=26*_scale;($text=$wrapper.create("text")).fontStyle("Open",size,"#FFF"),$text.html("0").size(200,.95*size).center().css({lineHeight:.95*size,letterSpacing:1,textAlign:"center"}),(_canvas=_this.initClass(Canvas,_size,_size)).element.div.className="rotate",_context=_canvas.context,$wrapper.add(_canvas.element)}function initLogo(){($logo=$wrapper.create("logo")).size(362,68).center(1,0).css({top:.4*-_size-75,backgroundRepeat:"no-repeat"}),$logo.bg("assets/images/ui/logo.png","contain"),Device.mobile&&$logo.transform({scale:.75})}function animateIn(){$container.visible().css({opacity:0}).tween({opacity:1},800,"easeInOutSine",100),$bg.transform({scale:1.1}).css({opacity:0}).tween({scale:1,opacity:.5},2e3,"easeOutSine",100),$logo.css({opacity:0}).tween({opacity:1},800,"easeInOutSine",100)}function loop(t){_context.clearRect(0,0,_size,_size),_context.lineWidth=6;let center=.5*_size,start=Math.radians(-90);_context.save(),_context.translate(center,center),_context.beginPath(),_context.strokeStyle="#eee",_context.arc(0,0,Math.round(.38*_size),start,start+Math.radians(360)*$this.perc,!1),_context.stroke(),_context.closePath(),_context.rotate(-Math.radians(360)*$this.perc*2+Math.radians(180)),_context.lineWidth=2,_context.beginPath(),_context.strokeStyle="#FD1A20",_context.arc(0,0,Math.round(.45*_size),start,start+Math.radians(360)*$this.perc,!1),_context.stroke(),_context.closePath(),_context.restore(),_prev!==$this.perc&&($text.html(`${Math.round(100*$this.perc)}`),_prev=$this.perc)}Inherit(this,Element);const _this=this,$this=this.element;let $text,$container,$wrapper,$logo,$fade,$bg,_canvas,_context,_prev,_progress,_scale=Device.mobile.phone?.8:1,_size=180*_scale;initHTML(),initSpinner(),initLogo(),_this.startRender(loop),defer(animateIn),this.progress=function(e){_progress=tween($this,{perc:.99*e.percent},1500,"easeInOutSine")},this.animateOut=async function(callback){_progress.stop(),await tween($this,{perc:1},800,"easeOutSine").promise(),$logo.tween({opacity:0},300,"easeOutSine"),$wrapper.tween({opacity:0,scale:Device.mobile.phone?1:.9},500,"easeInCubic"),$this.tween({opacity:0,scale:Device.mobile.phone?1:1.1},500,"easeInSine",300).onComplete(()=>callback&&callback())}}),Class(function PlaygroundShadowTest(){function initLight(){let light=new THREE.DirectionalLight(16777215,1);Utils3D.setupShadowMap(light,5,400,1024),_this.add(light),_light=light,light.prefix="shadowlight",LightUIL.add(light)}function initPlane(){let shader=_this.initClass(Shader,"ShadowTestPlane",{receiveShadow:!0}),mesh=new THREE.Mesh(World.PLANE,shader.material);mesh.receiveShadow=!0,mesh.prefix="shadowplane",MeshUIL.add(mesh),_this.add(mesh)}function initDeform(){let geometry=new THREE.IcosahedronBufferGeometry(.4,2),shader=_this.initClass(Shader,"ShadowIcosahedron",{uTime:World.TIME,receiveShadow:!0,wireframe:!1}),mesh=new THREE.Mesh(geometry,shader.material);Utils3D.setDepthMaterial(mesh,_light),_this.add(mesh),mesh.castShadow=mesh.receiveShadow=!0,mesh.prefix="shadowicosa",MeshUIL.add(mesh)}Inherit(this,Object3D);const _this=this;var _light;initLight(),initPlane(),initDeform()}),Class(function UI3DBlock(_Class,_props){function initUI(){_view=_this.initClass(_Class,_props),_this.view=_view,Stage.add(_view)}function loop(){let pos=ScreenProjection.project(_this.group.getWorldPosition());_view.element.transform(pos)}Inherit(this,Object3D);const _this=this;let _view;initUI(),_this.startRender(loop)}),Class(function UIButton(_copy="Hello World",_width=130,_height=45){function initHTML(){($this=_this.element).size(_width,_height).setZ(1).invisible(),$this.attr("tabindex",1),$this.attr("role","button"),($wrapper=$this.create("wrapper")).size("100%").css({overflow:"hidden"}),($bg=$this.create(".bg")).size("100%").bg("#fff").css({opacity:0}).transform({scaleX:(_width-10)/_width,scaleY:(_height-10)/_height})}function initLines(){_border=_this.initClass(UIButtonBorder,{width:_width,height:_height})}function initText(){($text=$wrapper.create("text")).fontStyle("OpenBold",11,"#fff"),$text.text(_copy).size("100%").css({textAlign:"center",letterSpacing:"0.1em",textTransform:"uppercase",lineHeight:_height*_scale,opacity:0}).transform({y:10}).setZ(10),($textOver=$wrapper.create("text-over")).fontStyle("OpenBold",11,"#1A2B61"),$textOver.text(_copy).size("100%").css({textAlign:"center",letterSpacing:"0.1em",textTransform:"uppercase",lineHeight:_height*_scale,top:0,opacity:0}).transform({y:10}).setZ(10)}function addListeners(){$this.interact(hover,click),$this.hit.size(1.2*_width,1.2*_height).center(),$this.keydown(keydown)}function hover(e){switch(e.action){case"over":over();break;case"out":out()}}function over(){_border.over(),$text.tween({y:-10,opacity:0},300,"easeOutCubic"),$textOver.tween({y:0,opacity:1},300,"easeOutCubic"),$bg.tween({scaleX:1,scaleY:1,opacity:1},300,"easeOutCubic")}function out(){_border.out(),$text.tween({y:0,opacity:1},500,"easeOutCubic"),$textOver.tween({y:10,opacity:0},500,"easeOutCubic"),$bg.tween({scaleX:(_width-10)/_width,scaleY:(_height-10)/_height,opacity:0},500,"easeOutCubic")}function click(){_this.events.fire(Events.CLICK)}function keydown(e){(["Enter","Space","Escape"].includes(e.code)||"32"===e.keyCode)&&click()}Inherit(this,Element);const _this=this;var $this,$wrapper,$bg,$text,$textOver;let _scale=1;var _border;_width*=_scale,_height*=_scale,initHTML(),initLines(),initText(),addListeners(),"UIButton"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(){$this.visible(),_border.animateIn(),$text.transform({y:10}).tween({y:0,opacity:1},700,"easeOutCubic",500,_=>{$this.hit.mouseEnabled(!0)})},this.animateOut=function(){}}),Class(function UIButtonBorder(_config){function initHTML(){($this=_this.element).size(_config.width,_config.height).invisible().css({opacity:.5})}function initLines(){($top=$this.create(".top")).size(_config.width,1).bg("#fff").transformPoint("0%","50%"),($left=$this.create(".top")).size(1,_config.height).bg("#fff").transformPoint("50%","100%"),($right=$this.create(".top")).size(1,_config.height).css({right:0}).bg("#fff").transformPoint("50%","0%"),($bottom=$this.create(".top")).size(_config.width,1).bg("#fff").css({bottom:0}).transformPoint("100%","50%")}Inherit(this,Element);const _this=this;var $this,$top,$left,$right,$bottom;initHTML(),initLines(),this.over=function(){$this.tween({scaleX:(_config.width+10)/_config.width,scaleY:(_config.height+10)/_config.height,opacity:0},300,"easeOutSine")},this.out=function(){$this.tween({scaleX:1,scaleY:1,opacity:.4},500,"easeOutSine")},this.animateIn=function(){$this.visible(),$top.transform({scaleX:0,x:-30}).tween({scaleX:1,x:0},1200,"easeInOutQuart"),$left.transform({scaleY:0,y:-30}).tween({scaleY:1,y:0},1200,"easeInOutQuart"),$right.transform({scaleY:0,y:30}).tween({scaleY:1,y:0},1200,"easeInOutQuart"),$bottom.transform({scaleX:0,x:30}).tween({scaleX:1,x:0},1200,"easeInOutQuart")}}),Class(function UIClose(){function initHTML(){($this=_this.element).size(_this.size,_this.size).invisible().css({right:.5*-_this.size,top:.5*-_this.size}),Device.mobile.phone&&$this.css({right:0,top:-1}),($lines=$this.create(".line")).size("100%"),($line1=$lines.create("line")).size(2,_this.size).transform({rotation:45}).center(),$line1.inner=$line1.create(".inner"),$line1.inner.size(2,_this.size).bg("#fff").transform({scaleY:0}),($line2=$lines.create("line")).size(2,_this.size).transform({rotation:-45}).center(),$line2.inner=$line2.create(".inner"),$line2.inner.size(2,_this.size).bg("#fff").transform({scaleY:0})}function addHandlers(){$this.interact(hover,click),$this.hit.size(2*_this.size,2*_this.size).center().mouseEnabled(!0),_this.events.sub(KeyboardUtil.DOWN,keydown)}function keydown(e){27==e.keyCode&&click()}function hover(e){switch(e.action){case"over":$line1.inner.tween({scaleY:.8},300,"easeOutCubic"),$line2.inner.tween({scaleY:.8},300,"easeOutCubic");break;case"out":$line1.inner.tween({scaleY:1},500,"easeOutCubic"),$line2.inner.tween({scaleY:1},500,"easeOutCubic")}}function click(){_this.events.fire(Events.CLICK)}Inherit(this,Element);const _this=this;var $this,$lines,$line1,$line2;_this.size=36,_this.rotation=0,initHTML(),addHandlers(),this.animateIn=function(delay){$this.visible(),$line1.inner.transform({scaleY:0}).tween({scaleY:1},800,"easeInOutCubic",delay),$line2.inner.transform({scaleY:0}).tween({scaleY:1},800,"easeInOutCubic",delay+300)},this.animateOut=function(){$this.tween({scale:.5,opacity:0},300,"easeOutCubic")}}),Class(function UICopy(_text=["Hello world","yolo"]){function initHTML(){($this=_this.element).fontStyle(Device.mobile.phone?"Open":"OpenLight",_size,"#fff"),$this.css({position:"relative",opacity:Device.mobile.phone?1:.9,display:"block",margin:Device.mobile.phone?"5px 0":"30px 0"}),$this.attr("aria-label",_text.join(" ")),$this.attr("tabindex",1),$this.attr("role","text"),_text.forEach((line,i)=>{let $line=$this.create("line");$line.html(line).css({position:"relative",display:"block",letterSpacing:"0.02em",marginTop:.8*_size,lineHeight:1.7*_size,opacity:0}).willChange(!0),$lines.push($line)})}Inherit(this,Element);const _this=this;var $this,$lines=[],_size=Device.mobile.phone?12:13;initHTML(),"UICopy"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(delay=0){$lines.forEach((line,i)=>{line.transform({y:15}).css({opacity:0}),line.tween({y:0,opacity:1},1500,"easeOutQuart",delay+250*i)})}}),Class(function UIInstruction(){function initHTML(){($this=_this.element).size(3*_size,_size+30).center(1,0).css({bottom:Config.UI_PADDING,opacity:.75}).hide().setZ(1e4),Stage.add($this)}function initText(){($text=$this.create(".text")).fontStyle("OpenLight",Device.mobile.phone?8:10,"#fff"),$text.text("Control the rover using"),$text.css({width:"100%",whiteSpace:"nowrap",fontStyle:"italic",textTransform:"uppercase",letterSpacing:"0.2em",textAlign:"center"}),_elements.push($text)}function initElements(){($joystick=$this.create("joystick")).size(_size,_size).bg("assets/images/ui/joystick.png").center(1,0).css({bottom:0}),Device.mobile||($joystick.css({marginLeft:35}),($keyboard=$this.create("joystick")).size(_size,_size).bg("assets/images/ui/keyboard.png").center(1,0).css({bottom:0,marginLeft:-_size-35}),_elements.push($keyboard),($or=$this.create(".text")).fontStyle("OpenLight",10,"#fff"),$or.text("or"),$or.css({width:"100%",top:"50%",whiteSpace:"nowrap",fontStyle:"italic",textTransform:"uppercase",letterSpacing:"0.2em",textAlign:"center",marginTop:9}),_elements.push($or)),_elements.push($joystick),Device.mobile.phone&&($text.html("Control the<br/>rover using"),$text.css({right:15,textAlign:"right",lineHeight:12}),$joystick.css({left:"",marginLeft:"",right:0}),$this.css({left:"",right:Config.UI_PADDING,marginLeft:""}))}Inherit(this,Element);const _this=this;var $this,$text,$keyboard,$or,$joystick,_elements=[],_size=100;initHTML(),initText(),initElements(),this.animateIn=function(){$this.show(),_elements.forEach(($el,i)=>{$el.transform({y:10}).css({opacity:0}).tween({y:0,opacity:1},1e3,"easeOutCubic",250*i)})},this.animateOut=function(){$this.tween({opacity:0,scale:.9,y:0},2500,"easeInOutSine",500,_=>{$this.hide()})}},"singleton"),Class(function UIJoystick(){function initHTML(){($this=_this.element).size(_size,_size).css({right:Config.UI_PADDING-10,bottom:Config.UI_PADDING-10}),Stage.add($this),($arrows=$this.create("Arrows")).size("100%").bg("assets/images/ui/arrows.png","cover").css({top:0,left:0,opacity:.6}),($thumbs=$this.create(".thumbs")).size(_size,_size).center().css({opacity:.8}).transform({scale:.9}),$thumbs.one=$thumbs.create("one"),$thumbs.one.size(Math.round(.29*_size),Math.round(.29*_size)).center().css({borderRadius:_size,boxShadow:"inset 0 0 0 5px #fff"}),$thumbs.two=$thumbs.create("two"),$thumbs.two.size(Math.round(.45*_size),Math.round(.45*_size)).center().css({borderRadius:_size,opacity:.5,boxShadow:"inset 0 0 0 2px #fff"})}function loop(){let lerp=_this.isDown?.1:.05;if(Device.mobile.phone&&(lerp*=2),_this.vector.x=0,_this.vector.y=0,!_this.isDown&&_this.canAutoplay&&_this.isAutoplay){let frame=++_autoFrame%2400;_this.vector.y+=addAutoStep(frame,-1,0,600,60),_this.vector.y+=addAutoStep(frame,1,660,960),_this.vector.y+=addAutoStep(frame,-1,1020,1800,60),_this.vector.x+=addAutoStep(frame,-1,180,300,30),_this.vector.x+=addAutoStep(frame,1,420,540,30),_this.vector.x+=addAutoStep(frame,-1,600,780,60),_this.vector.x+=addAutoStep(frame,1,1140,1260,30),_this.vector.x+=addAutoStep(frame,-1,1320,1440,30)}else _this.vector.x=_this.dragVector.x,_this.vector.y=_this.dragVector.y;_move.copy(_this.finalVector);let sqr=Math.sqrt(_move.x**2+_move.y**2);sqr>1&&(_move.x/=sqr,_move.y/=sqr),_thumb1.lerp(_move,2*lerp),$thumbs.one.x=_thumb1.x*_size*.45,$thumbs.one.y=_thumb1.y*_size*.45,$thumbs.one.transform(),_thumb2.lerp(_move,lerp),$thumbs.two.x=_thumb2.x*_size*.15,$thumbs.two.y=_thumb2.y*_size*.15,$thumbs.two.transform()}function addAutoStep(frame,value,start,end,falloff=0){let halfLength=(end-start)/2,middle=start+halfLength;return Math.smoothStep(halfLength,Math.max(0,halfLength-falloff-.01),Math.abs(frame-middle))*value}function addListeners(){_interaction=_this.initClass(Interaction,$thumbs),_this.events.sub(_interaction,Interaction.START,start),_this.events.sub(_interaction,Interaction.DRAG,drag),_this.events.sub(_interaction,Interaction.END,end),$thumbs.hover(hover),_this.events.sub(Experience.STATE_UPDATE,stateUpdate)}function start(){_this.isDown=!0,_this.delayAutoplay()}function drag(){_this.dragVector.x=Math.clamp(_interaction.move.x/_size,-1,1),_this.dragVector.y=Math.clamp(_interaction.move.y/_size,-1,1),_this.delayAutoplay()}function end(){_this.isDown=!1,hover({action:"out"}),_this.dragVector.x=_this.dragVector.y=0,_this.delayAutoplay()}function hover(e){if(!_this.isDown){switch(e.action){case"over":$arrows.tween({opacity:1},300,"easeOutSine"),$thumbs.tween({scale:1,opacity:1},200,"easeOutCubic");break;case"out":$arrows.tween({opacity:.6},300,"easeOutSine"),$thumbs.tween({scale:.9,opacity:.8},400,"easeOutCubic")}_this.delayAutoplay()}}function stateUpdate({state:state}){_this.delayAutoplay(),_this.canAutoplay=state===Experience.STATE.landing||state===Experience.STATE.explore,_this.canAutoplay||(_this.vector.x=0,_this.vector.y=0)}function startAutoplay(){_autoFrame=0,_this.isAutoplay=!0}Inherit(this,Element);const _this=this;var $this,$thumbs,$arrows;let _interaction;var _thumb1=new Vector2,_thumb2=new Vector2,_move=new Vector2,_size=Device.mobile.phone?120:140;this.dragVector={x:0,y:0},this.vector={x:0,y:0},this.finalVector={x:0,y:0};let _autoTimer,_autoFrame=0;initHTML(),addListeners(),_this.startRender(loop),this.animateOut=function(){$this.tween({opacity:0},500,"easeInOutQuad",()=>$this.hide())},this.animateIn=function(){$this.show(),$this.tween({opacity:1},500,"easeInOutQuad")},this.delayAutoplay=function(){_this.isAutoplay=!1,_autoTimer&&clearTimeout(_autoTimer),_autoTimer=_this.delayedCall(startAutoplay,1e4)}},"singleton"),Class(function UILink(_text="Link",_width){function initHTML(){($this=_this.element).css({position:"relative",textAlign:"center",width:_width||"auto"}),($inner=$this.create("inner")).css({position:"relative",display:"inline-block"})}function initText(){($text=$inner.create("selectable","a")).fontStyle(Device.mobile.phone?"openSsemiBold":"Open",Device.mobile.phone?9.5:11,"#FFF"),$text.css({position:"relative",display:"inline-block",opacity:Device.mobile.phone?.8:.6,letterSpacing:"0.15em",textTransform:"uppercase"}),$text.text(_text)}function initLine(){($line=$inner.create("line")).size("100%",1).css({bottom:Device.mobile.phone?-1:-2,left:-1}).bg("#fff").transform({scaleX:0})}function addListeners(){$text.interact(hover,click),$this.keydown(keydown),$text.hit.css({padding:20,left:-20,top:-20})}function hover(e){if(!_this.activated){switch(e.action){case"over":$text.tween({opacity:1},300,"easeOutSine"),$line.tween({scaleX:1},300,"easeOutCubic");break;case"out":$text.tween({opacity:.6},500,"easeOutSine"),$line.tween({scaleX:0},500,"easeOutCubic")}e.origin=_this,_this.events.fire(Events.HOVER,e)}}function click(){_this.events.fire(Events.CLICK)}function keydown(e){"Enter"!==e.code&&"Space"!==e.code&&"Escape"!==e.code&&"32"!==e.keyCode||click()}Inherit(this,Element);const _this=this;var $this,$inner,$line,$text;initHTML(),initText(),initLine(),addListeners(),this.animateIn=function(){},this.animateOut=function(){},this.activate=function(){hover({action:"over"}),_this.activated=!0},this.deactivate=function(){_this.activated=!1,hover({action:"out"})},this.out=function(){$text.tween({opacity:.6},500,"easeOutSine"),$line.tween({scaleX:0},500,"easeOutCubic")},this.fadeOut=function(delay=0){return $this.tween({opacity:0,y:-10},150,"easeOutCubic",delay).promise()},this.fadeIn=function(delay=0){return $this.tween({opacity:1,y:0},150,"easeOutCubic",delay).promise()}}),Class(function UILogo(){function initHTML(){($this=_this.element).size(362*_scale,68*_scale).css({top:Config.UI_PADDING,left:Config.UI_PADDING}),$this.attr("role","menu"),($nasa=$this.create("nasa")).size(84*_scale,68*_scale).bg("assets/images/ui/logo-nasa.png","contain").css({opacity:0}),$nasa.attr("aria-label","NASA"),$nasa.attr("tabindex",1),$nasa.attr("role","menuitem"),$nasa.keydown(keydown),($jpl=$this.create("jpl")).size(278*_scale,38*_scale).bg("assets/images/ui/logo-jpl.png","contain").css({left:84*_scale,top:0,opacity:0}),$jpl.attr("aria-label","jet propulsion laboratory"),$jpl.attr("tabindex",1),$jpl.attr("role","menuitem"),$jpl.keydown(keydown),($cit=$this.create("cit")).size(278*_scale,30*_scale).bg("assets/images/ui/logo-cit.png","contain").css({left:84*_scale,top:38*_scale,opacity:0}),$cit.attr("aria-label","california institute of technology"),$cit.attr("tabindex",1),$cit.attr("role","menuitem"),$cit.keydown(keydown)}function addListeners(){$nasa.interact(null,nasaClick),$jpl.interact(null,jplClick),$cit.interact(null,citClick),_this.events.sub(Events.RESIZE,resize)}function keydown(e){if(["Enter","Space","Escape"].includes(e.code))switch(e.target.className){case"nasa":return nasaClick();case"jpl":return jplClick();case"cit":return citClick()}}function nasaClick(){open("https://www.nasa.gov/"),Track.event("logo","click","nasa"),_this.events.fire(Events.CLICK)}function jplClick(){open("https://www.jpl.nasa.gov/"),Track.event("logo","click","jpl"),_this.events.fire(Events.CLICK)}function citClick(){open("http://www.caltech.edu/"),Track.event("logo","click","caltech"),_this.events.fire(Events.CLICK)}function resize(){Device.mobile.phone?($this.size(60*_scale,50*_scale),$jpl.hide(),$cit.hide()):($this.size(230*_scale,50*_scale),$jpl.show(),$cit.show())}Inherit(this,Element);const _this=this;var $this,$nasa,$jpl,$cit,_scale=Device.mobile.phone?.8:1;initHTML(),addListeners(),resize(),this.animateIn=function(delay=0){return $nasa.tween({opacity:1,y:0},650,"easeOutSine",delay).promise(),$jpl.tween({opacity:1,y:0},650,"easeOutSine",delay+200).promise(),$cit.tween({opacity:1,y:0},650,"easeOutSine",delay+400).promise()},this.animateOut=function(delay=0){return $nasa.tween({opacity:0,y:-10*_scale},325,"easeOutSine",delay).promise(),$jpl.tween({opacity:0,y:-10*_scale},325,"easeOutSine",delay+200).promise(),$cit.tween({opacity:0,y:-10*_scale},325,"easeOutSine",delay+400).promise()}}),Class(function UIScrollWrap(){function initHTML(){($this=_this.element).size("100%","100%")}function initScroll(){($wrapper=$this.create("scroll-wrap fade-scroll")).size("100%",`calc(100% + ${SHIFT}px`),$wrapper.css({display:"inline-block",position:"relative",overflow:"hidden",marginTop:-SHIFT,pointerEvents:"all"}),Device.mobile||$wrapper.css({pointerEvents:"none"}),($scroller=$wrapper.create("scroll")).size("calc(100% + 16px)","100%"),$scroller.css({position:"relative",paddingTop:.85*SHIFT,paddingRight:10,boxSizing:"border-box"}).overflowScroll({y:1}),_this.view=$scroller}Inherit(this,Element);const _this=this;var $this,$scroller,$wrapper;const SHIFT=20;initHTML(),initScroll(),this.add=function(view){$scroller.add(view.element||view)}}),Class(function UISubtitle(_lines=["Hello World"]){function initHTML(){($this=_this.element).size("auto",Math.max(FONTSIZE+10*_scale,_lines.length*(FONTSIZE+10*_scale))).css({position:"relative",padding:`${4*_scale}px 0`}),$wrap=$this.create("wrap")}function initText(){($text=$wrap.create("label")).fontStyle("OpenBold",FONTSIZE,"#FFF"),$text.css({position:"relative",display:"inline-block",opacity:0,letterSpacing:1.5*_scale,textTransform:"uppercase"}),$text.html(_lines.join("<br>")),$text.attr("tabindex",1),$text.attr("aria-label",_lines.join("<br>")),$text.attr("id","subtitle"),$text.attr("role","text")}function initLine(){($line=$wrap.create("line")).size("100%",2*_scale).css({bottom:-4*_scale,transformOrigin:"left center"}).bg("#fff").transform({scaleX:0})}Inherit(this,Element);const _this=this;var $this,$wrap,$line,$text,_scale=Device.mobile.phone?.8:1;const FONTSIZE=13*_scale;initHTML(),initText(),initLine(),"UISubtitle"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(){$line.tween({scaleX:1},600,"easeOutCubic"),$text.transform({y:-12}).tween({y:0,opacity:1},1400,"easeOutQuart",100)},this.animateOut=function(){$this.tween({opacity:0},400,"easeInCubic")}}),Class(function UITitle(_lines,_fontSize=42){function initHTML(){_fontSize*=_scale,_this.height=_lines.length*(LINEHEIGHT+_fontSize+15),($this=_this.element).size("auto",_this.height).css({position:"relative",padding:"4px 0",opacity:.9,margin:Device.mobile.phone?"10px 0":"20px 0",display:"block"}).invisible(),($wrap=$this.create("wrap")).size("100%","100%");let text=_lines.reduce((accum,line)=>accum+=" "+line.text,"");$wrap.attr("aria-label",text),$wrap.attr("tabindex",1),$wrap.attr("role","text")}function initText(){$lines=_lines.map((line,i)=>{let $line=$wrap.create("label");$line.fontStyle(line.bold?"TitBold":"TitThin",_fontSize,"#FFF"),$line.css({position:"relative",display:"inline-block",whiteSpace:"nowrap",opacity:1,letterSpacing:"0.03em",top:i*LINEHEIGHT,clear:"both",float:"left"}).enable3D(2e3),$line.text(line.text).willChange(!0),Tests.simpleUI()||_letters.push(SplitTextfield.split($line,"letter"));let $line2=$line.create(".line");return $line2.size("100%",Device.mobile.phone?1:2).bg("#fff").css({bottom:3*_scale,left:0,opacity:.7}).transformPoint("0%","50%").transform({scaleX:0}),_lines2.push($line2),{$line:$line,delay:line.delay||300}})}Inherit(this,Element);const _this=this;var $this,$wrap,_letters=[],$lines=[],_lines2=[],_scale=Device.mobile.phone?.65:1;const LINEHEIGHT=-.1*_fontSize*_scale;initHTML(),initText(),"UITitle"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(simple){$this.visible().css({opacity:0}).tween({opacity:1},500,"easeInOutSine"),simple||(_letters?$lines.forEach((line,lineNumber)=>{let d=lineNumber*(100+line.delay)+200;_lines2[lineNumber].tween({scaleX:1},600,"easeOutCubic",d-300).onComplete(_=>{_lines2[lineNumber].transformPoint("100%","50%").tween({scaleX:0},1500,"easeInOutQuart")}),_letters[lineNumber].forEach((letter,i)=>{let delay=d+30*i;letter.css({opacity:0}).transform({z:Math.random(250,400)}).enable3D(),letter.tween({opacity:1,z:0,x:0,y:0,rotationY:0},1200,"easeOutQuart",delay)})}):$lines.forEach((line,i)=>line.transform({y:-20*_scale,opacity:1}).tween({y:0},1200,"easeOutQuart")))},this.animateOut=function(){$this.tween({opacity:0},400,"easeInCubic")}}),Class(function ExploreView(){function initHTML(){($this=_this.element).size("100%","auto").css({padding:"0 20px",boxSizing:"border-box",maxWidth:500,pointerEvents:"none"}),$this.attr("role","main"),$this.attr("aria-labelledby","subtitle"),$this.attr("aria-live","polite")}function initViews(){_subtitle=_this.initClass(UISubtitle,Config.EXPLORE_SUBTITLE),_title=_this.initClass(UITitle,Config.EXPLORE_TITLE);let copy=Config.EXPLORE_INTRO;Device.mobile.phone&&(copy=[Config.EXPLORE_INTRO[0]]),_copy=_this.initClass(UICopy,copy)}function initInstruction(){($instruction=$this.create("instruction")).text(Config.EXPLORE_INSTRUCTION).fontStyle(Device.mobile.phone?"OpenItalic":"OpenLightItalic",Device.mobile.phone?10:11,"#fff"),$instruction.css({position:"relative",marginTop:Device.mobile.phone?20:30,letterSpacing:"0.15em",opacity:0,display:"block"}),$instruction.transform({y:10}),$instruction.attr("tabindex",1),$instruction.attr("role","text")}function initScroll(){($scroll=$this.create("scroll")).text(Config.SCROLL_INSTRUCTION).fontStyle("OpenItalic",Device.mobile.phone?10:11,"#fff"),$scroll.css({position:"relative",marginTop:5,letterSpacing:"0.15em",opacity:0,display:"block"}),$scroll.transform({y:10}),$scroll.attr("tabindex",1),$scroll.attr("role","text")}Inherit(this,Element);const _this=this;var $this,$instruction,$scroll,_title,_subtitle,_copy;initHTML(),initViews(),initInstruction(),Device.mobile||initScroll(),"ExploreView"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(fromHotspot){_subtitle.animateIn(fromHotspot),_title.animateIn(fromHotspot),_copy.animateIn(fromHotspot?300:1600),$instruction.tween({opacity:Device.mobile.phone?.6:.5,y:0},500,"easeOutQuart",fromHotspot?800:2100),$scroll&&$scroll.tween({opacity:1,y:0},500,"easeOutQuart",fromHotspot?800:2100,_=>{$scroll.div.className+=" flash"})},this.animateOut=async function(){return $this.tween({opacity:0},600,"easeOutQuart").promise()}}),Class(function HotspotView(_data=ConfigHotspots.DATA.face,_key="face"){function initHTML(){($this=_this.element).size("100%","auto").css({padding:"0 10px",boxSizing:"border-box",display:"flex",flexDirection:"column"}).setZ(10)}function initViews(){(_title=_this.initClass(UIHotspotTitle,_data.title)).element.size("calc(100% - 40px)",null).css({flex:"0 1 auto",position:"relative"}),(_body=_this.initClass(UICopy,_data.body)).element.css({margin:"0 0 40px 0"})}function initClose(){_close=_this.initClass(UIClose)}function addListeners(){_this.events.sub(_close,Events.CLICK,close)}function close(e){_this.closed||(_this.closed=!0,_close.animateOut(),Track.event("hotspot","closed",_key),_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.explore}))}Inherit(this,Element);const _this=this;var $this,_title,_body,_close;initHTML(),initViews(),initClose(),addListeners(),"HotspotView"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(delay=0){_title.animateIn(delay+1e3),_body.animateIn(delay+1200),_close.animateIn(delay+1500)},this.animateOut=function(delay=0){return $this.tween({opacity:0},300,"easeOutQuad").promise()}}),Class(function UIHotspotTitle(_text){function initHTML(){($this=_this.element).fontStyle("TitBold",SIZE,"#FFF").css({width:"90%",textTransform:"uppercase",position:"relative",lineHeight:"1",marginBottom:20*_scale,opacity:0}),$this.html(_text)}Inherit(this,Element);const _this=this;var $this,_scale=Device.mobile.phone?.85:1;const SIZE=40*_scale;initHTML(),"UIHotspotTitle"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(delay=0){return $this.transform({y:30}).tween({opacity:1,y:0},1e3,"easeOutCubic",delay).promise()},this.animateOut=function(delay=0){return $this.tween({opacity:0},225,"easeOutCubic",delay).promise()}}),Class(function LandingView(){function initHTML(){($this=_this.element).size("100%","auto").css({padding:"0 20px",boxSizing:"border-box",maxWidth:450,userSelect:"auto"}),$this.attr("role","main"),$this.attr("aria-labelledby","subtitle"),$this.attr("aria-live","polite")}function initViews(){_subtitle=_this.initClass(UISubtitle,Config.LANDING_SUBTITLE),_title=_this.initClass(UITitle,Config.LANDING_TITLE),($drag=$this.create("drag")).size("100%",40).css({position:"relative",maxWidth:350}),(_dragCopy=_this.initClass(UIDragCopy,[$drag])).element.css({top:8}),_prompt=_this.initClass(UIDragPrompt,[$drag])}function addListeners(){_this.events.sub(_prompt,UIDragPrompt.VALUE,promptValue),_this.events.sub(_prompt,UIDragPrompt.CLICK,promptClick),_this.events.sub(Events.RESIZE,resize)}function resize(){_scale=Math.max(0,Math.min(1,Math.min(Stage.height,Stage.width)/800)),$drag.css({marginTop:40*_scale}),Stage.width<850?(_dragCopy.element.hide(),_prompt.element.css({right:"auto"})):(_dragCopy.element.show(),_prompt.element.css({right:0}))}async function promptClick(){await Transition.instance().toExplore(),_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.explore})}async function promptValue({value:value}){if(_draggedToEnd)return;Transition.instance().setValue(value);let opacity=Math.map(value,0,.8,1,0);_dragCopy.element.css({opacity:opacity}),_title.element.css({opacity:opacity}),_subtitle.element.css({opacity:opacity}),value>=1&&(_draggedToEnd=!0,await Transition.instance().toExplore(),_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.explore}))}Inherit(this,Element);const _this=this;var $this,$drag;let _prompt,_subtitle,_draggedToEnd,_title,_dragCopy;var _scale=1;initHTML(),initViews(),addListeners(),resize(),"LandingView"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(){_this.delayedCall(()=>{_subtitle.animateIn(),_title.animateIn(),_dragCopy.animateIn(3800),_prompt.animateIn(3900)},300)},this.animateOut=function(){_prompt.animateOut(),$this.tween({opacity:0},400,"easeOutCubic")}}),Class(function UIDragCopy(){function initHTML(){($this=_this.element).size(100,30).css({opacity:0}),($text=$this.create("copy")).fontStyle("OpenLightItalic",10,"#fff").css({textTransform:"uppercase",letterSpacing:"0.18em",lineHeight:13}),$text.html((Device.mobile?"Tap":"Click")+" and drag<br/>to learn more")}Inherit(this,Element);const _this=this;var $this,$text;initHTML(),this.animateIn=function(delay=0){$this.tween({opacity:1},600,"easeInOutQuad",delay)},this.animateOut=function(){$this.tween({opacity:0},300,"easeInOutQuad")}}),Class(function UIDragPrompt(){function initHTML(){($this=_this.element).size(WIDTH,HEIGHT).css({pointerEvents:"all",opacity:0}),($drag=$this.create("drag-container")).size(WIDTH,HEIGHT).css({right:0})}function initDots(){let offsetX=.3*WIDTH,offsetY=(HEIGHT-6)/2;for(let i=0;i<DOTS;i++){let dot=$drag.create("drag-dot");dot.offset=offsetX+14*i,dot.size(6,6).css({left:dot.offset,top:offsetY,borderRadius:3,opacity:i/100,animationDelay:`${.2*i}s`}).bg("#fff"),_dots.push(dot)}}function initTarget(){($target=$drag.create("target")).size(HEIGHT,HEIGHT).css({border:`${BORDER}px solid #fff`,borderRadius:"50%",boxSizing:"border-box",opacity:.4,right:0})}function initDragger(){($dragger=$drag.create("dragger")).size(DRAG_SIZE,DRAG_SIZE).willChange(!0),$dragger.css({marginTop:BORDER,cursor:"e-resize"}),$dragger.inner=$dragger.create("dragger"),$dragger.inner.size(DRAG_SIZE,DRAG_SIZE).willChange(!0),$dragger.inner.css({border:`${.45*DRAG_SIZE}px solid #fff`,borderRadius:"50%",boxSizing:"border-box",boxShadow:"0 5px 14px rgba(0,0,0,0.3)"}),$dragger.hit=$dragger.create("hit"),$dragger.hit.css({padding:40,margin:-40,top:"50%",left:"50%"})}function initArrow(){($arrow=$this.create("arrow")).size(25,15).bg("assets/images/ui/arrow.svg").css({left:-55,top:13,opacity:.75})}function initInteraction(){_dragInteraction=_this.initClass(Interaction,$dragger)}function addListeners(){$dragger.hover(hover),_this.events.sub(_dragInteraction,Interaction.START,start),_this.events.sub(_dragInteraction,Interaction.DRAG,drag),_this.events.sub(_dragInteraction,Interaction.END,end),_this.events.sub(Events.RESIZE,resize)}function hover(e){"over"==e.action?$dragger.inner.tween({scale:1.15},300,"easeOutCubic"):_this.down||$dragger.inner.tween({scale:1},500,"easeOutCubic")}function start(){UIJoystick.instance().delayAutoplay(),_this.down=!0,_tweenRelease.stop&&_tweenRelease.stop(),_anim.transition=Math.max(_anim.transition,0),$dragger.inner.tween({scale:1.15},300,"easeOutCubic")}function drag(){_anim.transition+=_dragInteraction.delta.x/DRAG_WIDTH;let value=Math.clamp(_anim.transition,0,1);_this.events.fire(UIDragPrompt.VALUE,{value:value});let x=Math.clamp(_dragInteraction.x-_dragInteraction.hold.x,0,DRAG_WIDTH),opacity=Math.map(value,0,.8,.75,0);$dragger.transform({x:x}),$arrow&&$arrow.transform({x:1.2*x}).css({opacity:opacity}),_dots.forEach(dot=>{dot.offset<x?dot.transform({scale:0}):dot.transform({scale:1})})}function end(){_this.down=!1,_anim.transition=Math.max(_anim.transition,0);let autoComplete=_anim.transition>.6;autoComplete&&$this.tween({opacity:0},200,"easeOutSine"),_tweenRelease=tween(_anim,{transition:autoComplete?1:0},autoComplete?600:1e3,"easeOutCubic").onUpdate(()=>{if(null===_this.events)return;_this.events.fire(UIDragPrompt.VALUE,{value:_anim.transition});let x=_anim.transition*DRAG_WIDTH,opacity=Math.map(_anim.transition,0,.8,.75,0);$dragger.transform({x:x}),$arrow&&$arrow.transform({x:1.2*x}).css({opacity:opacity}),_dots.forEach((dot,i)=>{dot.offset>x&&dot.transform({scale:1})})}),autoComplete||_this.events.fire(UIDragPrompt.CANCELED),$dragger.inner.tween({scale:1},500,"easeOutCubic")}function resize(){Stage.width<850?$arrow.hide():$arrow.show()}Inherit(this,Element);const _this=this;let $this,$drag,$dragger,$target,$arrow,_dragInteraction,_tweenRelease={},_anim={transition:0},_dots=[];const WIDTH=170,HEIGHT=40,BORDER=2,DOTS=5,DRAG_SIZE=HEIGHT-2*BORDER,DRAG_WIDTH=WIDTH-DRAG_SIZE-BORDER;initHTML(),initDots(),initTarget(),initDragger(),initArrow(),initInteraction(),resize(),addListeners(),this.animateIn=function(delay=0){$this.tween({opacity:1},600,"easeInOutQuad",delay)},this.animateOut=function(){$this.tween({opacity:0},600,"easeInOutQuad")}},()=>{UIDragPrompt.VALUE="UIPromptValue",UIDragPrompt.CANCELED="UIPromptCanceled",UIDragPrompt.CLICK="UIPromptClick"}),Class(function UIMenu(){function initHTML(){($this=_this.element).size("auto","auto").css({textAlign:"center"}).mouseEnabled(!1),$this.attr("role","menu"),$this.attr("aria-label","navigation")}function initLinks(){_list=[],Device.mobile.phone||((_signup=_this.initClass(UILink,"GET STARTED")).element.attr("aria-label","GET STARTED"),_signup.element.attr("tabindex",1),_signup.element.attr("role","menuitem"),_signup.element.attr("aria-haspopup","false"),_signup.element.css({float:"left"}).mouseEnabled(!0),_list.push(_signup)),(_share=_this.initClass(UIMenuSocial)).element.css({float:"left"}).mouseEnabled(!0),_list.push(_share),(_follow=_this.initClass(UIMenuSocial,!0)).element.css({float:"left"}).mouseEnabled(!0),_list.push(_follow),_list.forEach((link,i)=>link.element.transform({y:-10}).css({opacity:0}))}function addListeners(){_signup&&_this.events.sub(_signup,Events.CLICK,clickSignup),_this.events.sub(Events.RESIZE,resize),_this.events.sub(Experience.STATE_UPDATE,stateUpdate),_list.forEach(item=>{_this.events.sub(item,Events.HOVER,hover)})}function hover(e){switch(e.action){case"over":_list.forEach(item=>{item!==e.origin&&item.out()})}}function resize(){let padding=Device.mobile.phone?22:35;_share.element.css({marginRight:padding}),_signup&&_signup.element.css({marginRight:padding})}function clickSignup(){_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.signup})}function stateUpdate(e){_signup&&("signup"==e.state?_signup.activate():_signup.deactivate())}Inherit(this,Element);const _this=this;var $this,_signup,_share,_follow,_list=[];initHTML(),initLinks(),addListeners(),resize(),this.animateIn=function(){return _list.map((link,i)=>link.element.tween({opacity:1,y:0},700,"easeOutCubic",200*i).promise())},this.animateOut=function(){return _list.map((link,i)=>link.element.tween({opacity:0,y:-10},400,"easeOutCubic",100*i).promise())}}),Class(function UIMobileMenu(){function initHTML(){($this=_this.element).size("auto","auto").css({textAlign:"center"}).setZ(10),$this.attr("role","menu"),$this.attr("aria-label","navigation")}function initLinks(){(_signup=_this.initClass(UILink,"GET STARTED")).element.css({float:"right"}),_signup.element.attr("aria-label","GET STARTED"),_signup.element.attr("tabindex",1),_signup.element.attr("role","menuitem"),(_explore=_this.initClass(UILink,"EXPLORE")).element.css({float:"right"}),_explore.element.attr("aria-label","GET STARTED"),_explore.element.attr("tabindex",1),_explore.element.attr("role","menuitem"),(_home=_this.initClass(UILink,"HOME")).element.css({float:"right"}),_home.element.attr("aria-label","GET STARTED"),_home.element.attr("tabindex",1),_home.element.attr("role","menuitem"),(_list=[_signup,_explore,_home]).forEach((link,i)=>link.element.transform({y:-10}).css({opacity:0}))}function addListeners(){_this.events.sub(_signup,Events.CLICK,clickSignup),_this.events.sub(_home,Events.CLICK,clickHome),_this.events.sub(_explore,Events.CLICK,clickExplore),_this.events.sub(Events.RESIZE,resize),_this.events.sub(Experience.STATE_UPDATE,stateUpdate)}function resize(){let padding=Device.mobile.phone?20:35;_home.element.css({marginRight:padding}),_explore.element.css({marginRight:padding})}function clickSignup(){_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.signup})}function clickExplore(){_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.explore})}function clickHome(){_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.landing})}function stateUpdate(e){switch(e.state){case Experience.STATE.signup:_home.deactivate(),_explore.deactivate(),_signup.activate();break;case Experience.STATE.explore:_home.deactivate(),_explore.activate(),_signup.deactivate();break;case Experience.STATE.landing:_home.activate(),_explore.deactivate(),_signup.deactivate()}}Inherit(this,Element);const _this=this;var $this,_home,_explore,_signup,_list=[];initHTML(),initLinks(),addListeners(),resize(),this.animateIn=function(){return $this.mouseEnabled(!0),_list.map((link,i)=>link.element.tween({opacity:1,y:0},700,"easeOutCubic",200*i).promise())},this.animateOut=function(){return $this.mouseEnabled(!1),_list.map((link,i)=>link.element.tween({opacity:0,y:-10},400,"easeOutCubic",100*i).promise())}}),Class(function UIMenuSocial(_follow){function initHTML(){($this=_this.element).css({position:"relative"})}function initLink(){(_link=_this.initClass(UILink,_follow?"FOLLOW US":"SHARE")).element.attr("role","menuitem"),_link.element.attr("aria-haspopup","true"),_link.element.attr("aria-expanded","false"),_link.element.attr("tabindex",1),_link.element.attr("aria-label",_follow?"FOLLOW US":"SHARE")}function initSocial(){($icons=$this.create("social")).size(140,70).center().css({marginTop:0}).mouseEnabled(!1),_icons=[],($tw=$icons.create("tw")).size(BTN_SIZE,BTN_SIZE).bg("assets/images/ui/twitter.svg").center(),$tw.transform({y:BTN_SIZE}).css({opacity:0}),$tw.div.onkeydown=keydown,$tw.attr("aria-label","twitter"),$tw.attr("role","link"),_icons.push($tw),_follow&&(($ig=$icons.create("ig")).size(BTN_SIZE,BTN_SIZE).bg("assets/images/ui/instagram.svg").center(),$ig.transform({y:BTN_SIZE}).css({opacity:0}),$ig.div.onkeydown=keydown,$ig.attr("aria-label","instagram"),$ig.attr("role","link"),_icons.push($ig)),($fb=$icons.create("fb")).size(BTN_SIZE,BTN_SIZE).bg("assets/images/ui/facebook.svg").center(),$fb.transform({y:BTN_SIZE}).css({opacity:0}),$fb.div.onkeydown=keydown,$fb.attr("aria-label","facebook"),$fb.attr("role","link"),_icons.push($fb)}function addListeners(){_this.events.sub(_link,Events.CLICK,click),Device.mobile||_this.events.sub(_link,Events.HOVER,hover),_this.events.sub(Mouse.input,Interaction.START,start),_this.events.sub(Mouse.input,Interaction.MOVE,start),_this.events.sub(Events.RESIZE,resize),_icons.forEach(icon=>{icon.interact(buttonHover,buttonClick),icon.hit.size(2*BTN_SIZE,2*BTN_SIZE).center()})}function hover(e){"over"==e.action&&open()}function click(){_this.opened?close():open()}function keydown(e){switch(this.className){case"tw":e.object=$tw;break;case"fb":e.object=$fb;break;case"ig":e.object=$ig}"Enter"!==e.code&&"Space"!==e.code&&"32"!==e.keyCode||buttonClick(e)}function start(){Device.mobile.phone?(Mouse.y<Stage.height-250||Mouse.x>200)&&close():(Mouse.y>250||Mouse.x<Stage.width-250)&&close()}function resize(){close(),_this.up=Device.mobile.phone&&Stage.width<Stage.height;let padding=Device.mobile.phone?.65*BTN_SIZE:.7*BTN_SIZE,y=_this.up?-75:-5;_icons.forEach(icon=>{icon.css({marginTop:y}),y+=_this.up?-BTN_SIZE-padding:BTN_SIZE+padding})}function open(){_this.opened||(_this.opened=!0,_link.activate(),_link.element.attr("aria-expanded","true"),_this.events.fire(Events.HOVER,{action:"over",origin:_this}),$icons.mouseEnabled(!0),_icons.forEach((icon,i)=>{icon.clearTween().transform({y:BTN_SIZE}).css({opacity:0}).tween({y:0,opacity:.6},500,"easeOutCubic",120*i),icon.attr("tabindex",1)}))}function close(){_this.opened&&(_this.opened=!1,_link.deactivate(),_link.element.attr("aria-expanded","false"),_this.events.fire(Events.HOVER,{action:"out",origin:_this}),$icons.mouseEnabled(!1),_icons.forEach((icon,i)=>{icon.tween({y:BTN_SIZE,opacity:0},300,"easeInSine"),icon.attr("tabindex",-1)}))}function buttonHover(e){if(_this.opened)switch(e.action){case"over":e.object.tween({opacity:1},300,"easeOutCubic");break;case"out":e.object.tween({opacity:.6},300,"easeOutCubic")}}function buttonClick(e){let type=e.object.div.className;if(_follow)switch(type){case"fb":Track.event("follow","click","facebook"),window.open("https://www.facebook.com/NASAJPL/","_blank");break;case"tw":Track.event("follow","click","twitter"),window.open("https://twitter.com/NASAJPL/","_blank");break;case"ig":Track.event("follow","click","instagram"),window.open("https://www.instagram.com/nasajpl/","_blank")}else switch(type){case"fb":Track.event("share","click","facebook"),Share.facebook();break;case"tw":Track.event("share","click","twitter"),Share.twitter(Config.TWITTER_SHARE)}}Inherit(this,Element);const _this=this;var $this,$icons,$tw,$fb,$ig;let _link,_icons;const BTN_SIZE=20;initHTML(),initLink(),initSocial(),addListeners(),resize(),this.out=close,this.animateIn=function(){return _link.animateIn()}}),Class(function UINav(_slider){function initHTML(){$this=_this.element,_this.height=ITEMS*(SIZE+PAD)-PAD,$this.size(SIZE,_this.height).css({opacity:.8}),$this.attr("role","tablist")}function initItems(){for(let i=0;i<ITEMS;i++){let dot=_this.initClass(UINavItem,SIZE,i);dot.element.css({top:(SIZE+PAD)*i}),dot.element.attr("role","tab"),dot.element.attr("tabindex",1),dot.element.attr("data-idx",String(i)),dot.element.keydown(keydown),0===i&&dot.element.attr("aria-label","home"),1===i&&dot.element.attr("aria-label","explore"),2===i&&dot.element.attr("aria-label","get-started"),_items.push(dot)}}function addListeners(){_this.events.sub(Experience.STATE_UPDATE,setState),_items.forEach(item=>{_this.events.sub(item,Events.CLICK,click),_this.events.sub(item,Events.HOVER,hover),setActive()})}function setActive(){let x=.8*-SIZE;_items.forEach((item,index)=>{index==_active?(item.activate(),x=0):item.deactivate()})}function keydown(e){"Enter"!==e.code&&"Space"!==e.code&&"32"!==e.keyCode||click({index:+e.target.hydraObject.attr("data-idx")})}function setInitialState(){switch(Experience.ACTIVE_STATE){case Experience.STATE.landing:_active=0;break;case Experience.STATE.explore:_active=1;break;case Experience.STATE.signup:_active=2;break;default:_active=0}return _active}function setState({state:state}){state==Experience.STATE.landing&&(_active=0),state==Experience.STATE.explore&&(_active=1),state==Experience.STATE.hotspot&&(_active=1),state==Experience.STATE.signup&&(_active=2),setActive()}function click({index:index}){0===index&&_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.landing}),1===index&&_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.explore}),2===index&&_this.events.fire(Experience.STATE_UPDATE,{state:Experience.STATE.signup})}function hover(event){switch(event.e.action){case"over":_items.forEach((item,i)=>{event.index==i?item.hoverIn():item.hoverOut()});break;case"out":_items.forEach((item,i)=>{item.hoverOut()})}}Inherit(this,Element);const _this=this;var $this;let _items=[],_active=0;const ITEMS=3,SIZE=13,PAD=20;initHTML(),initItems(),addListeners(),setInitialState(),this.animateIn=function(delay=0){return $this.tween({opacity:.8},600,"easeInOutSine",delay).promise()},this.animateOut=function(delay=0){return $this.tween({opacity:0},300,"easeOutSine",delay).promise()}}),Class(function UINavItem(_size,_index){function initHTML(){($this=_this.element).size(_size,_size),($dot=$this.create("dot")).size("100%").css({border:"2px solid #fff",borderRadius:_size/2,boxSizing:"border-box",opacity:OPACITY}),($inner=$this.create("inner")).size("100%").css({borderRadius:_size/2,opacity:0}).bg("#fff").transform({scale:0}),($line=$this.create("line")).size(Config.UI_PADDING-15,1).bg("#fff").center(0,1).css({right:-Config.UI_PADDING,transformOrigin:"center right"}).transform({scaleX:0})}function addListeners(){$this.interact(hover,click),$this.hit.size(2*_size,2*_size).center()}function hover(e){_this.events.fire(Events.HOVER,{index:_index,e:e})}function click(){_this.events.fire(Events.CLICK,{index:_index})}Inherit(this,Element);const _this=this;var $this,$dot,$inner,$line;const OPACITY=.5;initHTML(),addListeners(),_this.index=_index,this.hoverIn=function(){$inner.tween({scale:1,opacity:1},200,"easeOutCubic"),$line.tween({scaleX:1},200,"easeOutCubic"),$dot.tween({opacity:1},200,"easeOutCubic")},this.hoverOut=function(){_this.active||($inner.tween({scale:0,opacity:0},400,"easeOutCubic"),$line.tween({scaleX:0},400,"easeOutCubic"),$dot.tween({opacity:OPACITY},400,"easeOutCubic"))},this.activate=function(){_this.active=!0,$inner.tween({scale:1,opacity:1},600,"easeOutCubic"),$dot.tween({opacity:1},600,"easeOutCubic"),$line.tween({scaleX:1},600,"easeOutCubic")},this.deactivate=function(){_this.active=!1,$inner.tween({scale:0,opacity:0},600,"easeOutCubic"),$dot.tween({opacity:OPACITY},600,"easeOutCubic"),$line.tween({scaleX:0},600,"easeOutCubic")}}),Class(function SignupView(){function initHTML(){($this=_this.element).css({boxSizing:"border-box",padding:"0 20px"}),$this.attr("role","main"),$this.attr("aria-labelledby","subtitle"),$this.attr("aria-live","polite"),(_form=_this.initClass(UIFormView)).element.css({width:"100%",maxWidth:420,display:"block",position:"relative",pointerEvents:"none",marginBottom:20})}function addListeners(){_this.events.sub(Events.RESIZE,resize)}function resize(){let scale=Math.max(.25,Math.min(1,Stage.width/1400));_form.element.css({marginRight:250*scale}),Stage.width<850?($this.size("100%","auto"),_form.element.css({maxWidth:320})):$this.size("auto","auto")}Inherit(this,Element);const _this=this;var $this,_form;initHTML(),addListeners(),resize(),"SignupView"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(){_form.animateIn()}}),Class(function UIFormView(){function initHTML(){($this=_this.element).size("100%","auto")}function initViews(){_subtitle=_this.initClass(UISubtitle,Config.SIGNUP_SUBTITLE),_title=_this.initClass(UITitle,Config.SIGNUP_TITLE)}function initInfo(){_info=_this.initClass(UIInfoView,Config.SIGNUP_INTRO)}function initCopy(){($copy=$this.create("copy-container")).css({position:"relative",display:"block",opacity:0});let title=$copy.create("header");title.fontStyle("OpenBold",13,"#fff").css({position:"relative",display:"inline-block"}),title.text(Config.SIGNUP_HEADER),title.attr("tabindex",1),title.attr("role","text");let text=$copy.create("copy");text.fontStyle("OpenLight",13,"#fff").css({position:"relative",display:"inline-block",marginLeft:10}),text.text(Config.SIGNUP_COPY),text.attr("tabindex",1),text.attr("role","text")}function initButtons(){(_github=_this.initClass(UIButton,"See the Plans",150)).element.css({position:"relative",display:"inline-block",marginTop:10,marginRight:10}),(_reddit=_this.initClass(UIButton,"Discuss / FAQ",150)).element.css({position:"relative",display:"inline-block"})}function addHandlers(){_this.events.sub(Events.RESIZE,resize),_this.events.sub(_github,Events.CLICK,githubClick),_this.events.sub(_reddit,Events.CLICK,redditClick)}function githubClick(){open(Config.GITHUB_LINK),Track.event("get-started","click","see-the-plans")}function redditClick(){open(Config.REDDIT_LINK),Track.event("get-started","click","discuss")}function resize(){let scale=Math.max(.2,Math.min(1,Math.min(Stage.height,Stage.width)/800));_title.element.css({marginBottom:10*scale})}Inherit(this,Element);const _this=this;var $this,$copy;let _title,_subtitle,_github,_reddit,_info;initHTML(),initViews(),initInfo(),initCopy(),initButtons(),addHandlers(),resize(),"UIFormView"==Global.PLAYGROUND&&_this.delayedCall(_=>_this.animateIn(),200),this.animateIn=function(delay=0){_subtitle.animateIn(delay),_title.animateIn(delay),$copy.transform({y:30}).css({opacity:0}).tween({y:0,opacity:.8},1e3,"easeOutCubic",delay+1100),_info.animateIn(delay+500),_this.delayedCall(_github.animateIn,delay+1e3),_this.delayedCall(_reddit.animateIn,delay+1500)}}),Class(function UIInfoView(){function initHTML(){($this=_this.element).size("100%","auto").css({display:"block",position:"relative",margin:Device.mobile.phone?"10px 0 40px 0":"25px 0",opacity:.9,height:Device.mobile.phone?120:140,width:360}).invisible()}function initNav(){_buttons=[],_titles=[],_copy=[],Config.SIGNUP_INFO.forEach((d,i)=>{d.index=i;let button=_this.initClass(UIInfoViewButton,d);button.data=d,_buttons.push(button),($title=$this.create("title")).fontStyle("TitBold",Device.mobile.phone?18:20,"#fff"),$title.css({letterSpacing:"0.03em",opacity:0,top:52}),$title.html(d.title),$title.attr("aria-label",d.title),$title.attr("tabindex",1),$title.attr("role","text"),_titles.push($title),($copy=$this.create("copy")).fontStyle("OpenLight",12,"#fff"),$copy.css({lineHeight:"150%",opacity:0,top:82}),$copy.html(d.copy),$copy.attr("aria-label",d.copy),$copy.attr("tabindex",-1),$copy.attr("role","text"),_copy.push($copy)})}function initText(){}function addHandlers(){_buttons.forEach(button=>{_this.events.sub(button,Events.CLICK,click)})}function autoClick(){change({index:_this.index==_buttons.length-1?0:_this.index+1})}function click(e){_this.index!=e.index&&(clearInterval(_auto),change(e))}function change(e){if(!$this||!$this.tween)return void clearInterval(_auto);let dir=e.index>_this.index?1:-1;_this.index=e.index,_this.events.fire(Experience.SIGNUP_CHANGE,{index:_this.index});for(var i=0;i<_buttons.length;i++)i==e.index?(_buttons[i].icon.transform({scale:.9,y:0}).tween({scale:1,opacity:1},300,"easeOutCubic"),_titles[i].clearTween().css({opacity:0}).transform({x:25*dir}).tween({x:0,opacity:1},700,"easeOutCubic"),_copy[i].clearTween().css({opacity:0}).transform({x:15*dir}).tween({x:0,opacity:1},700,"easeOutCubic"),_titles[i].attr("tabindex",1),_copy[i].attr("tabindex",1)):(_buttons[i].icon.tween({opacity:.3},500,"easeOutCubic"),_titles[i].tween({x:-25*dir,opacity:0},500,"easeOutCubic"),_copy[i].tween({x:-15*dir,opacity:0},500,"easeOutCubic"),_titles[i].attr("tabindex",-1),_copy[i].attr("tabindex",-1))}Inherit(this,Element);const _this=this;var $this,$title,$copy;var _buttons,_titles,_copy,_auto;_this.index=-1,initHTML(),initNav(),initText(),addHandlers(),this.animateIn=function(delay=0){$this.visible(),_buttons.forEach((button,i)=>{button.element.transform({y:10}).css({opacity:0}).tween({y:0,opacity:1},700,"easeOutCubic",delay+150*i)}),_this.delayedCall(change,500,{index:0}),_auto=setInterval(autoClick,5e3)},this.onDestroy=function(){clearInterval(_auto)}}),Class(function UIInfoViewButton(_data){function initHTML(){($this=_this.element).size(_this.size,_this.size).css({left:-3,position:"relative",display:"inline-block",marginRight:Device.mobile.phone?15:20}),$this.attr("aria-label",_data.title+" Icon"),$this.attr("tabindex",1),($icon=$this.create(".icon")).size(_this.size,_this.size),$icon.css({opacity:.3}),_this.icon=$icon,$icon.bg(`assets/images/ui/signup/${_data.icon}`)}function addHandlers(){$this.interact(hover,click),$this.hit.mouseEnabled(!0),$this.keydown(keydown)}function hover(e){"over"===e.action&&click()}function click(){_this.events.fire(Events.CLICK,_data)}function keydown(e){"Enter"!==e.code&&"Space"!==e.code&&"32"!==e.keyCode||click()}Inherit(this,Element);const _this=this;var $this,$icon;_this.size=Device.mobile.phone?46:50,initHTML(),addHandlers(),this.click=click,this.animateIn=function(){}}),FX.Class(function Mars(){function loop(){_this.render()}function show(type){DRAW_BUFFERS||("mars"===type?(_this.events.sub(RenderGL.RENDER,loop),_this.isVisible=!0):World.GROUP.visible=!0)}function hide(type){DRAW_BUFFERS||("mars"===type?(_this.events.unsub(RenderGL.RENDER,loop),_this.isVisible=!1):World.GROUP.visible=!1)}function addHandlers(){_this.events.sub(Experience.TRANSITION,transition)}function transition({value:value}){show("blue"),1===value?_this.isVisible&&hide("mars"):_this.isVisible||show("mars")}Inherit(this,FXLayer);var _this=this;const DRAW_BUFFERS=World.NUKE.useDrawBuffers;!async function(){_this.create(),_this.forceVisible=!0,DRAW_BUFFERS||(addHandlers(),hide("blue"))}()},"singleton"),Class(function VFX(){function initComposite(){_pass=_this.initClass(NukePass,"BlendScenes",{tMars:{value:FX.Mars.instance().rt.texture},uTransition:{value:0},uTransition2:{value:0},uSilhouette:{value:1},uRGBStrength:{value:1}}),ShaderUIL.add(_pass),World.NUKE.add(_pass),_this.startRender(()=>{_pass.uniforms.uTransition.value+=.1*(_transition-_pass.uniforms.uTransition.value),_pass.uniforms.uTransition2.value+=.015*(_transition-_pass.uniforms.uTransition2.value)}),World.NUKE.add(new FXAA)}function addHandlers(){_this.events.sub(Experience.TRANSITION,transition)}function transition(e){_transition=e.value<0?2*Math.abs(e.value):e.value}Inherit(this,Component);const _this=this;let _pass,_transition=0;initComposite(),addHandlers()},"singleton"),Class(function Main(){function init(){Container.instance()}Device.detect("googlebot")||Utils.query("seo")?SEO.instance():Tests.fallback()?location="unsupported.html":init()});
window._MINIFIED_ = true;
window._BUILT_ = true;