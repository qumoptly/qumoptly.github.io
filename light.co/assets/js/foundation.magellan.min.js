(function(c,b,a,d){Foundation.libs["magellan-expedition"]={name:"magellan-expedition",version:"5.5.3",settings:{active_class:"active",threshold:0,destination_threshold:20,throttle_delay:30,fixed_top:0,offset_by_height:true,duration:700,easing:"swing"},init:function(f,g,e){Foundation.inherit(this,"throttle");this.bindings(g,e)},events:function(){var e=this,f=e.S,g=e.settings;e.set_expedition_position();f(e.scope).off(".magellan").on("click.fndtn.magellan","["+e.add_namespace("data-magellan-arrival")+"] a[href*=#]",function(l){var o=((this.hostname===location.hostname)||!this.hostname),p=e.filterPathname(location.pathname)===e.filterPathname(this.pathname),q=this.hash.replace(/(:|\.|\/)/g,"\\$1"),j=this;if(o&&p&&q){l.preventDefault();var n=c(this).closest("["+e.attr_name()+"]"),h=n.data("magellan-expedition-init"),i=this.hash.split("#").join(""),k=c('a[name="'+i+'"]');if(k.length===0){k=c("#"+i)}var m=k.offset().top-h.destination_threshold+1;if(h.offset_by_height){m=m-n.outerHeight()}c("html, body").stop().animate({scrollTop:m},h.duration,h.easing,function(){if(history.pushState){history.pushState(null,null,j.pathname+j.search+"#"+i)}else{location.hash=j.pathname+j.search+"#"+i}})}}).on("scroll.fndtn.magellan",e.throttle(this.check_for_arrivals.bind(this),g.throttle_delay))},check_for_arrivals:function(){var e=this;e.update_arrivals();e.update_expedition_positions()},set_expedition_position:function(){var e=this;c("["+this.attr_name()+"=fixed]",e.scope).each(function(f,j){var l=c(this),i=l.data("magellan-expedition-init"),k=l.attr("styles"),g,h;l.attr("style","");g=l.offset().top+i.threshold;h=parseInt(l.data("magellan-fixed-top"));if(!isNaN(h)){e.settings.fixed_top=h}l.data(e.data_attr("magellan-top-offset"),g);l.attr("style",k)})},update_expedition_positions:function(){var f=this,e=c(b).scrollTop();c("["+this.attr_name()+"=fixed]",f.scope).each(function(){var j=c(this),h=j.data("magellan-expedition-init"),i=j.attr("style"),g=j.data("magellan-top-offset");if(e+f.settings.fixed_top>=g){var k=j.prev("["+f.add_namespace("data-magellan-expedition-clone")+"]");if(k.length===0){k=j.clone();k.removeAttr(f.attr_name());k.attr(f.add_namespace("data-magellan-expedition-clone"),"");j.before(k)}j.css({position:"fixed",top:h.fixed_top}).addClass("fixed")}else{j.prev("["+f.add_namespace("data-magellan-expedition-clone")+"]").remove();j.attr("style",i).css("position","").css("top","").removeClass("fixed")}})},update_arrivals:function(){var f=this,e=c(b).scrollTop();c("["+this.attr_name()+"]",f.scope).each(function(){var k=c(this),g=k.data(f.attr_name(true)+"-init"),i=f.offsets(k,e),j=k.find("["+f.add_namespace("data-magellan-arrival")+"]"),h=false;i.each(function(l,m){if(m.viewport_offset>=m.top_offset){var n=k.find("["+f.add_namespace("data-magellan-arrival")+"]");n.not(m.arrival).removeClass(g.active_class);m.arrival.addClass(g.active_class);h=true;return true}});if(!h){j.removeClass(g.active_class)}})},offsets:function(i,e){var f=this,g=i.data(f.attr_name(true)+"-init"),h=e;return i.find("["+f.add_namespace("data-magellan-arrival")+"]").map(function(j,n){var m=c(this).data(f.data_attr("magellan-arrival")),l=c("["+f.add_namespace("data-magellan-destination")+"="+m+"]");if(l.length>0){var k=l.offset().top-g.destination_threshold;if(g.offset_by_height){k=k-i.outerHeight()}k=Math.floor(k);return{destination:l,arrival:c(this),top_offset:k,viewport_offset:h}}}).sort(function(k,j){if(k.top_offset<j.top_offset){return -1}if(k.top_offset>j.top_offset){return 1}return 0})},data_attr:function(e){if(this.namespace.length>0){return this.namespace+"-"+e}return e},off:function(){this.S(this.scope).off(".magellan");this.S(b).off(".magellan")},filterPathname:function(e){e=e||"";return e.replace(/^\//,"").replace(/(?:index|default).[a-zA-Z]{3,4}$/,"").replace(/\/$/,"")},reflow:function(){var e=this;c("["+e.add_namespace("data-magellan-expedition-clone")+"]",e.scope).remove()}}}(jQuery,window,window.document));